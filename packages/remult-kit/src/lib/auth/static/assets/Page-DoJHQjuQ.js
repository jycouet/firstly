var ks=Object.defineProperty;var Is=(r,e,t)=>e in r?ks(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>(Is(r,typeof e!="symbol"?e+"":e,t),t);import{n as ae,s as Os,r as at,a as lt,i as Es,g as Ss,S as ze,b as Xe,c as Fr,d as j,e as Di,v as mt,f as wt,h as Ze,j as Yi,k as ti,o as er,l as ii,m as Cs,p as Dr,q as Ri,t as W,u as Z,w as Ts,x as ie,y as As,z as Q,A as Rr,B as Mr,C as Nr,D as ci,E as tr,F as Ps,G as N,H as ir,I as L,J as $t,K as Ee,L as Fs,M as ne,N as x,O as V,P as Be,Q as E,R as _e,T as zt,U as ye,V as me,W as we,X as ge,Y as Mi,Z as Ni,_ as Li}from"./index-BuKz2MAT.js";function Ds(r,e){const t={},i={},n={$$scope:1};let s=r.length;for(;s--;){const o=r[s],a=e[s];if(a){for(const l in o)l in a||(i[l]=1);for(const l in a)n[l]||(t[l]=a[l],n[l]=1);r[s]=a}else for(const l in o)n[l]=1}for(const o in i)o in t||(t[o]=void 0);return t}const et=[];function Bi(r,e){return{subscribe:It(r,e).subscribe}}function It(r,e=ae){let t;const i=new Set;function n(a){if(lt(r,a)&&(r=a,t)){const l=!et.length;for(const c of i)c[1](),et.push(c,r);if(l){for(let c=0;c<et.length;c+=2)et[c][0](et[c+1]);et.length=0}}}function s(a){n(a(r))}function o(a,l=ae){const c=[a,l];return i.add(c),i.size===1&&(t=e(n,s)||ae),a(r),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:o}}function Ct(r,e,t){const i=!Array.isArray(r),n=i?[r]:r;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Bi(t,(o,a)=>{let l=!1;const c=[];let u=0,f=ae;const h=()=>{if(u)return;f();const y=e(i?c[0]:c,o,a);s?o(y):f=Es(y)?y:ae},p=n.map((y,v)=>Os(y,w=>{c[v]=w,u&=~(1<<v),l&&h()},()=>{u|=1<<v}));return l=!0,h(),function(){at(p),f(),l=!1}})}const Rs=r=>{const{subscribe:e,update:t}=It(r);return{subscribe:e,set:(i={})=>{t(n=>Object.assign(n,i))}}},st=Rs({mode:"window",basePath:null}),ri=(r=Ss(st).mode)=>{let e="popstate";r==="window"&&(e="popstate"),r==="hash"&&(e="hashchange"),window.dispatchEvent(new Event(e))},rr={go:(r=0)=>{history.go(r),ri()},push:(r,e=null)=>{history.pushState(e,"",r),ri()},replace:(r,e=null)=>{history.replaceState(e,"",r),ri()}},Ms=(r,e)=>e===null?r:r.startsWith(e)?r.slice(e.length):r,Ns=r=>{const e=r.match(/^(\/[^?#]*)?/),t=r.match(/\?([^#]*)?/),i=r.match(/#(.*)?/);return{path:(e==null?void 0:e[1])||"/",query:t!=null&&t[1]?`?${t==null?void 0:t[1]}`:"",hash:i!=null&&i[1]?`#${i==null?void 0:i[1]}`:""}},nr=()=>{const{pathname:r,search:e,hash:t}=document.location;return{path:r,query:e,hash:t}},sr=()=>{let r=document.location.hash.substring(1);return r[0]!=="/"&&(r="/"+r),Ns(r)},Ls=Bi(nr(),r=>{const e=()=>r(nr());return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),Bs=Bi(sr(),r=>{const e=()=>r(sr());return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),qi=Ct([st,Ls,Bs],([r,e,t],i)=>{r.mode==="window"&&i(e),r.mode==="hash"&&i(t)}),qs=Ct(qi,r=>r.path);Ct(qi,r=>r.query);Ct(qi,r=>r.hash);const ni=Ct([st,qs],([r,e])=>Ms(e,r.basePath)),bt=r=>r.split(/(?=\/)/),Lr=()=>{let r=0;return()=>r++},{Error:gt}=Di;function di(r){let e;const t=r[10].default,i=Dr(t,r,r[9],null),n={c:function(){i&&i.c()},m:function(o,a){i&&i.m(o,a),e=!0},p:function(o,a){i&&i.p&&(!e||a&512)&&Rr(i,t,o,o[9],e?Nr(t,o[9],a,null):Mr(o[9]),null)},i:function(o){e||(Z(i,o),e=!0)},o:function(o){ie(i,o),e=!1},d:function(o){i&&i.d(o)}};return j("SvelteRegisterBlock",{block:n,id:di.name,type:"if",source:"(96:0) {#if isRouteActive($pathWithoutBase, $route, $contextChildRoutes)}",ctx:r}),n}function hi(r){let e=pi(r[1],r[0],r[2]),t,i,n=e&&di(r);const s={c:function(){n&&n.c(),t=Ri()},l:function(a){throw new gt("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){n&&n.m(a,l),W(a,t,l),i=!0},p:function(a,[l]){l&7&&(e=pi(a[1],a[0],a[2])),e?n?(n.p(a,l),l&7&&Z(n,1)):(n=di(a),n.c(),Z(n,1),n.m(t.parentNode,t)):n&&(Ts(),ie(n,1,1,()=>{n=null}),As())},i:function(a){i||(Z(n),i=!0)},o:function(a){ie(n),i=!1},d:function(a){a&&Q(t),n&&n.d(a)}};return j("SvelteRegisterBlock",{block:s,id:hi.name,type:"component",source:"",ctx:r}),s}const or=(r,e,t,i,n)=>{const s=(c,u,f)=>{const h=bt(u).filter(p=>p!=="/").length;return(f??0)+(c?1:h)},o=(c,u)=>{const f={invalidPath:`<Route path="${c==null?void 0:c.path}" /> has invalid path. Path must start with '/'`,fallbackOutsideRoot:"<Route fallback /> cannot be outside root <Route />",pathOutsideRoot:`<Route path="${c==null?void 0:c.path}" /> cannot be outside root <Route />`,fallbackInsideFallback:"<Route fallback /> cannot be inside <Route fallback>",pathInsideFallback:`<Route path="${c==null?void 0:c.path}" /> cannot be inside <Route fallback>`};if(c.path[0]!=="/")throw new Error(f.invalidPath);if(c.root&&c.fallback)throw new Error(f.fallbackOutsideRoot);if(c.root&&c.path!=="/")throw new Error(f.pathOutsideRoot);if(u!=null&&u.fallback&&c.fallback)throw new Error(f.fallbackInsideFallback);if(u!=null&&u.fallback&&!c.fallback)throw new Error(f.pathInsideFallback)},a=s(t,i,n==null?void 0:n.depth),l={id:r,root:e,fallback:t,path:i,depth:a};return o(l,n),l},ar=()=>{const{subscribe:r,update:e}=It([]);return{subscribe:r,update:t=>e(i=>[...i.filter(n=>t.id!==n.id),t]),remove:t=>e(i=>i.filter(n=>t.id!==n.id))}},pi=(r,e,t)=>{const i=(c,u,f,h)=>{let p=bt(c).filter(w=>w!=="/"),y=bt(f).filter(w=>w!=="/"),v="";if(f==="/")return u||p.length===h;for(let w=h-y.length;w<h;w++)v=v+p[w];return f===v},n=(c,u,f)=>{var y,v,w,I;let h=bt(c).filter(k=>k!=="/"),p=!1;for(let k=0;k<(f==null?void 0:f.length)&&!p;k++)(y=f[k])!=null&&y.fallback||(p=i(c,((v=f[k])==null?void 0:v.root)??!1,((w=f[k])==null?void 0:w.path)??"",((I=f[k])==null?void 0:I.depth)??0));return h.length>=u&&!p},{root:s,fallback:o,path:a,depth:l}=e;return o?n(r,l,t):i(r,s,a,l)},lr=Lr(),Dt={},si={};function js(r,e,t){let i,n,s,o;mt(ni,"pathWithoutBase"),wt(r,ni,k=>t(1,s=k));let{$$slots:a={},$$scope:l}=e;Ze("Route",a,["default"]);const c=lr(),u=!Yi(Dt);let{fallback:f=!1}=e,{path:h="/"}=e;const p=It();mt(p,"route"),wt(r,p,k=>t(0,i=k));const y=ti(Dt);mt(y,"contextRoute"),wt(r,y,k=>t(8,n=k));const v=ar(),w=ti(si);mt(w,"contextChildRoutes"),wt(r,w,k=>t(2,o=k)),er(()=>w==null?void 0:w.remove(i)),ii(Dt,p),ii(si,v);const I=["fallback","path"];return Object.keys(e).forEach(k=>{!~I.indexOf(k)&&k.slice(0,2)!=="$$"&&k!=="slot"&&console.warn(`<Route> was created with unknown prop '${k}'`)}),r.$$set=k=>{"fallback"in k&&t(6,f=k.fallback),"path"in k&&t(7,h=k.path),"$$scope"in k&&t(9,l=k.$$scope)},r.$capture_state=()=>({writable:It,createIdIssuer:Lr,getPathSegments:bt,getRoute:or,createChildRoutes:ar,isRouteActive:pi,getId:lr,routeContextKey:Dt,childRoutesContextKey:si,onDestroy:er,getContext:ti,setContext:ii,hasContext:Yi,pathWithoutBase:ni,id:c,root:u,fallback:f,path:h,route:p,contextRoute:y,childRoutes:v,contextChildRoutes:w,$route:i,$contextRoute:n,$pathWithoutBase:s,$contextChildRoutes:o}),r.$inject_state=k=>{"fallback"in k&&t(6,f=k.fallback),"path"in k&&t(7,h=k.path)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&448&&Cs(p,i=or(c,u,f,h,n),i),r.$$.dirty&1&&(w==null||w.update(i))},[i,s,o,p,y,w,f,h,n,l,a]}class We extends ze{constructor(e){super(e),Xe(this,e,js,hi,Fr,{fallback:6,path:7}),j("SvelteRegisterComponent",{component:this,tagName:"Route",options:e,id:hi.name})}get fallback(){throw new gt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fallback(e){throw new gt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get path(){throw new gt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set path(e){throw new gt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const ur=r=>{var a;const e=(a=r.target)==null?void 0:a.closest("a[href]"),t=e==null?void 0:e.href;if(e===null||t===null)return!0;const i=["","true"].includes(e.getAttribute("data-handle-ignore")??"false"),n=(e.getAttribute("target")??"_self")!=="_self",s=r.metaKey||r.ctrlKey||r.altKey||r.shiftKey,o=new URL(t).origin!==document.location.origin;if(i||n||s||o)return!0;t===document.location.href?rr.replace(t):rr.push(t),r.preventDefault()},Br=r=>(r.addEventListener("click",ur),{destroy:()=>{r.removeEventListener("click",ur)}}),Js="home/jycouet/udev/gh/lib/remult-kit/node_modules/.pnpm/svelte-micro@2.5.6_svelte@4.2.18/node_modules/svelte-micro/dist/lib/components/Link.svelte";function yi(r){let e,t,i,n;const s=r[5].default,o=Dr(s,r,r[4],null);let a=[{href:r[0]},r[1]],l={};for(let u=0;u<a.length;u+=1)l=ci(l,a[u]);const c={c:function(){e=N("a"),o&&o.c(),ir(e,l),L(e,Js,15,0,417)},l:function(f){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(f,h){W(f,e,h),o&&o.m(e,null),t=!0,i||(n=[$t(Br.call(null,e)),Ee(e,"click",r[6],!1,!1,!1,!1)],i=!0)},p:function(f,[h]){o&&o.p&&(!t||h&16)&&Rr(o,s,f,f[4],t?Nr(s,f[4],h,null):Mr(f[4]),null),ir(e,l=Ds(a,[(!t||h&1)&&{href:f[0]},h&2&&f[1]]))},i:function(f){t||(Z(o,f),t=!0)},o:function(f){ie(o,f),t=!1},d:function(f){f&&Q(e),o&&o.d(f),i=!1,at(n)}};return j("SvelteRegisterBlock",{block:c,id:yi.name,type:"component",source:"",ctx:r}),c}const fr=(r,e,t)=>(r==="hash"?"#":"")+(e??"")+t;function Us(r,e,t){let i;const n=["href"];let s=tr(e,n),o;mt(st,"options"),wt(r,st,f=>t(3,o=f));let{$$slots:a={},$$scope:l}=e;Ze("Link",a,["default"]);let{href:c}=e;r.$$.on_mount.push(function(){c===void 0&&!("href"in e||r.$$.bound[r.$$.props.href])&&console.warn("<Link> was created without expected prop 'href'")});function u(f){Fs.call(this,r,f)}return r.$$set=f=>{e=ci(ci({},e),Ps(f)),t(1,s=tr(e,n)),"href"in f&&t(2,c=f.href),"$$scope"in f&&t(4,l=f.$$scope)},r.$capture_state=()=>({getFormatedHref:fr,options:st,linkHandle:Br,href:c,formatedHref:i,$options:o}),r.$inject_state=f=>{"href"in e&&t(2,c=f.href),"formatedHref"in e&&t(0,i=f.formatedHref)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),r.$$.update=()=>{r.$$.dirty&12&&t(0,i=fr(o.mode,o.basePath,c))},[i,s,c,o,l,a,u]}class ut extends ze{constructor(e){super(e),Xe(this,e,Us,yi,Fr,{href:2}),j("SvelteRegisterComponent",{component:this,tagName:"Link",options:e,id:yi.name})}get href(){throw new Error("<Link>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set href(e){throw new Error("<Link>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class Qe{constructor(...e){d(this,"fields");d(this,"options");d(this,"target");d(this,"readonly");d(this,"allowNull");d(this,"dbReadOnly");d(this,"isServerExpression");d(this,"key");d(this,"caption");d(this,"inputType");d(this,"dbName");d(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t=n=>e[n.key];typeof e=="function"&&(t=e);let i="";return this.fields.forEach(n=>{i.length>0&&(i+=","),i+=n.valueConverter.toJson(t(n))}),i}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},n=e.toString().split(",");return this.fields.forEach((s,o)=>{t[s.key]=s.valueConverter.fromJson(n[o])}),t}}function te(r,e=!0){var i;let t=r[He];if(!t&&e)throw new Error("item "+(((i=r.constructor)==null?void 0:i.name)||r)+" was not initialized using a context");return t}const He=Symbol.for("entityMember"),Vs=Symbol.for("entityInfo"),Ks=Symbol.for("entityInfo_key");function Ie(r,e=!0){if(r===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=r[Vs];if(!t&&e)throw new Error(r.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function Hs(r){return r[Ks]}const Ws=Symbol.for("relationInfo");function Qs(r){return r==null?void 0:r[Ws]}const mi=Symbol.for("fieldRelationInfo");function re(r){return r[mi]}function xs(r,e,t){for(const i of r.fields.toArray()){const n=Qs(i.options);if(n&&!i[mi]){const s=n.toType(),o=e.repo(s,t),a=i.options;i[mi]={type:n.type,toEntity:s,options:a,toRepo:o,getFields:()=>{let l=a.field,c={fields:a.fields,compoundIdField:void 0};function u(p){return Error(`Error for relation: "${i.key}" to "${o.metadata.key}": `+p)}let f=()=>l||c.fields;if(n.type==="toMany"&&!f()){for(const p of o.fields.toArray())if(!f()){const y=re(p),v=p.options;if(y&&y.toEntity===r.metadata.entityType){if(y.type==="reference")l=p.key;else if(y.type==="toOne"){if(v.field)l=v.field;else if(v.fields){let w={};for(const I in v.fields)if(Object.prototype.hasOwnProperty.call(v.fields,I)){const k=v.fields[I];w[k]=I}c.fields=w}}}}if(!f())throw u("No matching field found on target. Please specify field/fields")}function h(p,y){const v=y.fields.find(p);if(!v)throw u(`Field "${p}" was not found in "${y.key}".`);return v}n.type==="reference"&&(l=i.key),l&&(n.type==="toOne"||n.type==="reference"?o.metadata.idMetadata.field instanceof Qe?c.compoundIdField=l:c.fields={[o.metadata.idMetadata.field.key]:l}:r.metadata.idMetadata.field instanceof Qe?c.compoundIdField=l:c.fields={[l]:r.metadata.idMetadata.field.key});for(const p in c.fields)Object.prototype.hasOwnProperty.call(c.fields,p)&&(h(p,o.metadata),h(c.fields[p],r.metadata));return c}}}}}class F{constructor(e){d(this,"apply");this.apply=e}static throwErrorIfFilterIsEmpty(e,t){if(F.isFilterEmpty(e))throw{message:`${t}: requires a filter to protect against accidental delete/update of all rows`,httpStatusCode:400}}static isFilterEmpty(e){if(e.$and){for(const t of e.$and)if(!F.isFilterEmpty(t))return!1}if(e.$or){for(const t of e.$or)if(F.isFilterEmpty(t))return!0;return!1}return Object.keys(e).filter(t=>!["$or","$and"].includes(t)).length==0}static async getPreciseValues(e,t){const i=new Kt;return await F.fromEntityFilter(e,t).__applyToConsumer(i),i.preciseValues}async getPreciseValues(){const e=new Kt;return await this.__applyToConsumer(e),e.preciseValues}static createCustom(e,t=""){let i={key:t,rawFilterTranslator:e};return Object.assign(n=>{if(n==null&&(n={}),!i.key)throw"Usage of custom filter before a key was assigned to it";return{[Ge+i.key]:n}},{rawFilterInfo:i})}static entityFilterToJson(e,t){return F.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return jr(e,{get:i=>t[i]})}static fromEntityFilter(e,t){let i=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let s=t[n];if(n=="$or")i.push(new zs(...s.map(o=>F.fromEntityFilter(e,o))));else if(n=="$and")i.push(new cr(...s.map(o=>F.fromEntityFilter(e,o))));else if(n.startsWith(Ge))i.push(new F(o=>{o.custom(n.substring(Ge.length),s)}));else if(n==qr)i.push(new F(o=>o.databaseCustom(s)));else{const o=e.fields[n],a=re(o),l=o.options;let c=(a==null?void 0:a.type)==="toOne"?l.fields?new $s(o,e.fields,l):new Gs(e.fields[l.field]):new Vt(o),u=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const f in s)if(Object.prototype.hasOwnProperty.call(s,f)){const h=s[f];switch(f){case"$gte":case">=":i.push(c.isGreaterOrEqualTo(h)),u=!0;break;case"$gt":case">":i.push(c.isGreaterThan(h)),u=!0;break;case"$lte":case"<=":i.push(c.isLessOrEqualTo(h)),u=!0;break;case"$lt":case"<":i.push(c.isLessThan(h)),u=!0;break;case"$ne":case"!=":case"$nin":u=!0,Array.isArray(h)?i.push(c.isNotIn(h)):i.push(c.isDifferentFrom(h));break;case"$in":u=!0,i.push(c.isIn(h));break;case"$contains":u=!0,i.push(c.contains(h));break;case"$notContains":u=!0,i.push(c.notContains(h));break}}Array.isArray(s)&&(u=!0,i.push(c.isIn(s)))}!u&&s!==void 0&&i.push(c.isEqualTo(s))}}return new cr(...i)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new ji;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,i){let n=new Ji(async(s,o)=>{let a=[];for(const l in t.entityType){const c=t.entityType[l];c&&c.rawFilterInfo&&c.rawFilterInfo.rawFilterTranslator&&c.rawFilterInfo.key==s&&a.push(await F.fromEntityFilter(t,await c.rawFilterInfo.rawFilterTranslator(o,i)))}return a});return e.__applyToConsumer(n),await n.resolve(),e=new F(s=>n.applyTo(s)),e}}class Vt{constructor(e){d(this,"metadata");this.metadata=e}processVal(e){if(Ie(this.metadata.valueType,!1)){if(e==null){if(e===null&&!this.metadata.allowNull){const i=re(this.metadata);if((i==null?void 0:i.type)==="reference")return i.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:te(e).getId()}return e}contains(e){return new F(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new F(t=>t.notContainsCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new F(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new F(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new F(t=>{for(const i of e)t.isDifferentFrom(this.metadata,this.processVal(i))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new F(t=>t.isNotNull(this.metadata)):new F(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new F(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new F(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new F(t=>t.isNull(this.metadata)):new F(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new F(t=>t.isEqualTo(this.metadata,e[0])):new F(t=>t.isIn(this.metadata,e))}}class Gs extends Vt{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:te(e).getId():null}}class $s{constructor(e,t,i){d(this,"metadata");d(this,"fields");d(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=i}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new F(t=>{e.forEach(i=>this.isDifferentFrom(i).__applyToConsumer(t))})}isDifferentFrom(e){return new F(t=>{const i=[];for(const n in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,n)){const s=this.relationOptions.fields[n];i.push(new F(o=>new Vt(this.fields.find(s)).isDifferentFrom(e[n]).__applyToConsumer(o)))}t.or(i)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new F(t=>{for(const i in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,i)){const n=this.relationOptions.fields[i];new Vt(this.fields.find(n)).isEqualTo(e[i]).__applyToConsumer(t)}})}isIn(e){return new F(t=>{t.or(e.map(i=>this.isEqualTo(i)))})}}class cr extends F{constructor(...t){super(i=>{for(const n of this.filters)n&&n.__applyToConsumer(i)});d(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class zs extends F{constructor(...t){super(i=>{let n=this.filters.filter(s=>s!==void 0);n.length>1?i.or(n):n.length==1&&n[0].__applyToConsumer(i)});d(this,"filters");this.filters=t}}const Ge="$custom$",qr="$db$",wi="$an array";class ji{constructor(){d(this,"result",{});d(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[wi]:t}),this.add(Ge+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let i=this.result;if(!i[e]){i[e]=t;return}let n=i[e];n instanceof Array?n.push(t):n=[n,t],i[e]=n}or(e){this.add("OR",e.map(t=>{let i=new ji;return t.__applyToConsumer(i),i.result}))}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(i=>e.valueConverter.toJson(i)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}}function jr(r,e){let t={};function i(a){t.$and||(t.$and=[]),t.$and.push(a)}function n(a,l){t[a]===void 0?t[a]=l:i({[a]:l})}[...r.fields].forEach(a=>{function l(u,f,h=!1,p=!1){let y=e.get(a.key+u);if(y!==void 0){let v=w=>{let I=w;if(h){let G;typeof w=="string"?G=JSON.parse(w):G=w,I=G.map(K=>p?K:a.valueConverter.fromJson(K))}else I=p?I:a.valueConverter.fromJson(I);let k=f(I);k!==void 0&&n(a.key,k)};if(!h&&y instanceof Array)y.forEach(w=>{v(w)});else{h&&typeof y=="string"&&(y=JSON.parse(y));const w=o(y);for(const I of w)v(I)}}}l("",u=>u),l(".gt",u=>({$gt:u})),l(".gte",u=>({$gte:u})),l(".lt",u=>({$lt:u})),l(".lte",u=>({$lte:u})),l(".ne",u=>({$ne:u})),l(".in",u=>u,!0);var c=e.get(a.key+".null");if(c)switch(c=c.toString().trim().toLowerCase(),c){case"y":case"true":case"yes":n(a.key,null);break;default:n(a.key,{$ne:null});break}l(".contains",u=>({$contains:u}),!1,!0),l(".notContains",u=>({$notContains:u}),!1,!0)});let s=e.get("OR");if(s){const l=o(s).map(c=>({$or:c.map(u=>jr(r,{get:f=>u[f]}))}));l.length==1?t.$or?t.$or.push(l[0].$or):t.$or=l[0].$or:i({$and:l})}for(const a in r.entityType){const l=r.entityType[a];if(l&&l.rawFilterInfo&&l.rawFilterInfo.rawFilterTranslator){let c=e.get(Ge+a);if(c!==void 0){const u=f=>{f[wi]!=null&&(f=f[wi]),n(Ge+a,f)};Array.isArray(c)?c.forEach(f=>u(f)):u(c)}}}return t;function o(a){if(!Array.isArray(a))return[a];const l=[],c=[];for(const u of a)Array.isArray(u)?c.push(u):l.push(u);return c.push(l),c}}class Ji{constructor(e){d(this,"translateCustom");d(this,"commands",[]);d(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async i=>{let n=new Ji(this.translateCustom);return i.__applyToConsumer(n),await n.resolve(),new F(s=>n.applyTo(s))})).then(i=>{t=i})),this.commands.push(i=>i.or(t))}isEqualTo(e,t){this.commands.push(i=>i.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(i=>i.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(i=>i.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(i=>i.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(i=>i.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(i=>i.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(i=>i.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(i=>i.notContainsCaseInsensitive(e,t))}isIn(e,t){this.commands.push(i=>i.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let i=await this.translateCustom(e,t);i&&(Array.isArray(i)?i.forEach(n=>n.__applyToConsumer(this)):i.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}class Kt{constructor(){d(this,"rawValues",{});d(this,"preciseValues",new Proxy(this.rawValues,{get:(e,t)=>{if(t in e){let i=e[t];if(i.bad)return;if(i.values.length>0){const n=re(i.field);if(n){if(n.type==="reference")return i.values.map(s=>n.toRepo.metadata.idMetadata.getIdFilter(s));throw new Error("Only relations toOne without field are supported.")}return i.values}}}}))}ok(e,...t){let i=this.rawValues[e.key];i?i.values.push(...t.filter(n=>!i.values.includes(n))):this.rawValues[e.key]={field:e,bad:!1,values:[...t]}}notOk(e){let t=this.rawValues[e.key];t?t.bad=!0:this.rawValues[e.key]={field:e,bad:!0,values:[]}}or(e){const t=e.map(i=>{let n=new Kt;return i.__applyToConsumer(n),n});for(const i of t)for(const n in i.rawValues)if(Object.prototype.hasOwnProperty.call(i.rawValues,n)){const s=i.rawValues[n];s&&(s.bad?this.notOk(s.field):this.ok(s.field,...s.values))}for(const i in this.rawValues)if(Object.prototype.hasOwnProperty.call(this.rawValues,i))for(const n of t)n.rawValues[i]||this.notOk(this.rawValues[i].field)}isEqualTo(e,t){this.ok(e,t)}isDifferentFrom(e,t){this.notOk(e)}isNull(e){this.ok(e,null)}isNotNull(e){this.notOk(e)}isGreaterOrEqualTo(e,t){this.notOk(e)}isGreaterThan(e,t){this.notOk(e)}isLessOrEqualTo(e,t){this.notOk(e)}isLessThan(e,t){this.notOk(e)}containsCaseInsensitive(e,t){this.notOk(e)}notContainsCaseInsensitive(e,t){this.notOk(e)}isIn(e,t){this.ok(e,...t)}custom(e,t){}databaseCustom(e){}}var Xs={};const oi=Symbol.for("remult-static1");let qt={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:r=>r(),startBusyWithProgress:()=>({progress:r=>{},close:()=>{}})},captionTransformer:void 0,defaultDataProvider:()=>{}};typeof process<"u"&&Xs.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[oi]>"u"?(globalThis[oi]=qt,qt.remultFactory=()=>Jr()):qt=globalThis[oi];const S=qt;function Jr(){return S.defaultRemult||(S.defaultRemult=S.defaultRemultFactory()),S.defaultRemult}function Zs(){S.remultFactory=()=>Jr()}function $e(r){const e=r;if(typeof e[Ot]=="function")return e[Ot]();throw Error("Error getting repository internal from "+r)}const Ot=Symbol.for("getInternal");class Ys{constructor(){d(this,"iAmRemultProxy",!0);d(this,"repoCache",new Map);d(this,"repo",(...e)=>{let t=S,i=this.repoCache.get(e[0]);i||this.repoCache.set(e[0],i=new Map);let n=i.get(e[1]);return n||(n={get fields(){return S.remultFactory().repo(...e).metadata.fields},[Ot](){return t.remultFactory().repo(...e)[Ot]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...o)=>t.remultFactory().repo(...e).validate(s,...o),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),deleteMany:s=>t.remultFactory().repo(...e).deleteMany(s),updateMany:(...s)=>t.remultFactory().repo(...e).updateMany(...s),find:(...s)=>t.remultFactory().repo(...e).find(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,o)=>t.remultFactory().repo(...e).findId(s,o),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,o)=>t.remultFactory().repo(...e).fromJson(s,o),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return S.remultFactory().repo(...e).metadata},query:(...s)=>t.remultFactory().repo(...e).query(...s),save:s=>t.remultFactory().repo(...e).save(s),update:(s,o)=>t.remultFactory().repo(...e).update(s,o)},i.set(e[1],n),n)})}get liveQuerySubscriber(){return S.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){S.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return S.remultFactory().liveQueryStorage}set liveQueryStorage(e){S.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return S.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){S.remultFactory().liveQueryPublisher=e}call(e,t,...i){return S.remultFactory().call(e,t,...i)}get context(){return S.remultFactory().context}get dataProvider(){return S.remultFactory().dataProvider}set dataProvider(e){S.remultFactory().dataProvider=e}get repCache(){return S.remultFactory().repCache}authenticated(){return S.remultFactory().authenticated()}isAllowed(e){return S.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return S.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return S.remultFactory().clearAllCache()}get user(){return S.remultFactory().user}set user(e){S.remultFactory().user=e}get apiClient(){return S.remultFactory().apiClient}set apiClient(e){S.remultFactory().apiClient=e}get subscriptionServer(){return S.remultFactory().subscriptionServer}set subscriptionServer(e){S.remultFactory().subscriptionServer=e}}const Oe=new Ys;function eo(r){return r.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail").replace(" I D"," ID")}class to{constructor(e,t,i){d(this,"repository");d(this,"isReferenceRelation");d(this,"allowNull");d(this,"storedItem");d(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=i}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:$e(this.repository)._getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=$e(this.repository)._getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=te(e,!1);t&&!this.isReferenceRelation?($e(this.repository)._addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class dr{constructor(e){d(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var i in e){let n=e[i];this.add(i+t,n)}}}const Ur={error500RetryCount:4};function Tt(r){if(!r)return new hr;let e;return e||Vr(r)&&(e=new io(r)),e||typeof r=="function"&&(e=new hr(r)),e}function Vr(r){let e=r;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class io{constructor(e){d(this,"http");this.http=e}async post(e,t){return await Ht(()=>Rt(this.http.post(e,t)))}delete(e){return Rt(this.http.delete(e))}put(e,t){return Rt(this.http.put(e,t))}async get(e){return await Ht(()=>Rt(this.http.get(e)))}}async function Ht(r){var t,i,n,s;let e=0;for(;;)try{return await r()}catch(o){if(((t=o.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(i=o.message)!=null&&i.startsWith("Error occured while trying to proxy")||(n=o.message)!=null&&n.includes("http proxy error")||(s=o.message)!=null&&s.startsWith("Gateway Timeout")||o.status==500)&&e++<Ur.error500RetryCount){await new Promise((a,l)=>{setTimeout(()=>{a({})},500)});continue}throw o}}function Rt(r){let e;return r.toPromise!==void 0?e=r.toPromise():e=r,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data?t.data:t).catch(async t=>{throw await ro(t)})}async function ro(r){var s,o,a;let e=await r;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(o=e==null?void 0:e.response)==null?void 0:o.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let i=e.status;i===void 0&&(i=(a=e.response)==null?void 0:a.status),i!=null&&(t.httpStatusCode=i);var n=Object.assign(t,{});return n}class Kr{constructor(e){d(this,"apiProvider");d(this,"isProxy",!0);this.apiProvider=e}getEntityDataProvider(e){return new no(()=>{var i;let t=(i=this.apiProvider())==null?void 0:i.url;return t==null&&(t="/api"),t+"/"+e.key},()=>Tt(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function Ui(r,e){if(r.include){let t={};for(const i in r.include)if(Object.prototype.hasOwnProperty.call(r.include,i)){let n=r.include[i];if(typeof n=="object"){const s=re(e.fields.find(i));s&&(n=Ui(n,s.toRepo.metadata))}t[i]=n}r={...r,include:t}}return r.where&&(r={...r,where:F.entityFilterToJson(e,r.where)}),r.load&&(r={...r,load:r.load(e.fields).map(t=>t.key)}),r}class no{constructor(e,t,i){d(this,"url");d(this,"http");d(this,"entity");this.url=e,this.http=t,this.entity=i}translateFromJson(e){let t={};for(const i of this.entity.fields)t[i.key]=i.valueConverter.fromJson(e[i.key]);return t}translateToJson(e){let t={};for(const i of this.entity.fields)t[i.key]=i.valueConverter.toJson(e[i.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(i=>+i.count)}async deleteMany(e){const{run:t}=this.buildFindRequest({where:e},"delete");return t("deleteMany").then(i=>+i.deleted)}async updateMany(e,t){const{run:i}=this.buildFindRequest({where:e},"put");return i("updateMany",this.toJsonOfIncludedKeys(t)).then(n=>+n.updated)}find(e){let{run:t}=this.buildFindRequest(e);return t().then(i=>i.map(n=>this.translateFromJson(n)))}buildFindRequest(e,t){t||(t="get");let i=new dr(this.url()),n;if(e){if(e.where&&(n=e.where.toJson(),oo(n,i)&&(n=void 0)),e.orderBy&&e.orderBy.Segments){let o="",a="",l=!1;e.orderBy.Segments.forEach(c=>{o.length>0&&(o+=",",a+=","),o+=c.field.key,a+=c.isDescending?"desc":"asc",c.isDescending&&(l=!0)}),o&&i.add("_sort",o),l&&i.add("_order",a)}e.limit&&i.add("_limit",e.limit),e.page&&i.add("_page",e.page)}const s=(o,a)=>{let l=new dr(i.url);return!o&&n&&(o="get"),o&&l.add("__action",o),n?(a={set:a,where:n},this.http().post(l.url,a)):this.http()[t](l.url,a)};return{createKey:()=>JSON.stringify({url:i,filterObject:n}),run:s,subscribe:async o=>({result:await s(ao+o),unsubscribe:async()=>S.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:o}))})}}update(e,t){return this.http().put(this.url()+(e!=""?"/"+encodeURIComponent(e):"?__action=emptyId"),this.toJsonOfIncludedKeys(t)).then(i=>this.translateFromJson(i))}toJsonOfIncludedKeys(e){let t={},i=Object.keys(e);for(const n of this.entity.fields)i.includes(n.key)&&(t[n.key]=n.valueConverter.toJson(e[n.key]));return t}async delete(e){if(e=="")await this.deleteMany(F.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)));else return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}insertMany(e){return this.http().post(this.url(),e.map(t=>this.translateToJson(t))).then(t=>t.map(i=>this.translateFromJson(i)))}}class hr{constructor(e){d(this,"fetch");this.fetch=e}async get(e){return await Ht(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await Ht(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const i={};if(t!=null&&t.body&&(i["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const n of window.document.cookie.split(";"))n.trim().startsWith("XSRF-TOKEN=")&&(i["X-XSRF-TOKEN"]=n.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:i}).then(n=>so(n)).catch(async n=>{throw await n})}}function so(r){if(r.status!=204){if(r.status>=200&&r.status<300)return r.json();throw r.json().then(e=>({...e,message:e.message||r.statusText,url:r.url,status:r.status})).catch(()=>{throw{message:r.statusText,url:r.url,status:r.status}})}}function oo(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const i=r[t];if(Array.isArray(i)&&(i.length>0&&typeof i[0]=="object"||i.length>10))return!1}for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const i=r[t];Array.isArray(i)?t.endsWith(".in")?e.add(t,JSON.stringify(i)):i.forEach(n=>e.add(t,n)):t.startsWith(Ge)?e.add(t,JSON.stringify(i)):e.add(t,i)}return!0}const ao="liveQuery-";var Mt,lo=new Uint8Array(16);function uo(){if(!Mt&&(Mt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Mt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mt(lo)}const fo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function co(r){return typeof r=="string"&&fo.test(r)}var fe=[];for(var ai=0;ai<256;++ai)fe.push((ai+256).toString(16).substr(1));function ho(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(fe[r[e+0]]+fe[r[e+1]]+fe[r[e+2]]+fe[r[e+3]]+"-"+fe[r[e+4]]+fe[r[e+5]]+"-"+fe[r[e+6]]+fe[r[e+7]]+"-"+fe[r[e+8]]+fe[r[e+9]]+"-"+fe[r[e+10]]+fe[r[e+11]]+fe[r[e+12]]+fe[r[e+13]]+fe[r[e+14]]+fe[r[e+15]]).toLowerCase();if(!co(t))throw TypeError("Stringified UUID is invalid");return t}function gi(r,e,t){r=r||{};var i=r.random||(r.rng||uo)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,ho(i)}class ke{constructor(...e){d(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new ke;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,i){i||(i=s=>s.key);let n=0;for(let s=0;s<this.Segments.length;s++){let o=this.Segments[s],a=pr(e[i(o.field)]),l=pr(t[i(o.field)]);if(a>l?n=1:a<l&&(n=-1),n!=0)return o.isDescending&&(n*=-1),n}return n}static translateOrderByToSort(e,t){if(!t)return;let i=new ke;if(t){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];let o=e.fields.find(n);const a=l=>{switch(s){case"desc":i.Segments.push({field:l,isDescending:!0});break;case"asc":i.Segments.push({field:l})}};if(o){const l=re(o);if((l==null?void 0:l.type)==="toOne"){const c=l.options;if(typeof c.field=="string")a(e.fields.find(c.field));else if(c.fields){for(const u in c.fields)if(Object.prototype.hasOwnProperty.call(c.fields,u)){const f=c.fields[u];a(e.fields.find(f.toString()))}}}else a(o)}}}return i}static createUniqueSort(e,t){(!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=ke.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new ke);for(const i of e.idMetadata.fields)t.Segments.find(n=>n.field==i)||t.Segments.push({field:i});return t}static createUniqueEntityOrderBy(e,t){(!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={};for(const i of e.idMetadata.fields)t[i.key]||(t[i.key]="asc");return t}}function pr(r){return r==null||r==null?r:r.id!==void 0?r.id:r}const li="stream";class po{constructor(e,t,i){d(this,"repo");d(this,"query");d(this,"queryChannel");d(this,"subscribeCode");d(this,"unsubscribe",()=>{});d(this,"defaultQueryState",[]);d(this,"listeners",[]);d(this,"id",gi());this.repo=e,this.query=t,this.queryChannel=`users:${i}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await $e(this.repo)._fromJsonArray(e,this.query.options);this.forListeners(i=>{i(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(i=>{if(this.defaultQueryState=i(this.defaultQueryState),t.find(n=>n.type==="add"||n.type==="replace")&&this.query.options.orderBy){const n=ke.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,o)=>n.compare(s,o))}});for(const i of this.listeners)e(n=>{i.next(this.createReducerType(n,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:n})=>n=="add"||n=="replace"),i=await $e(this.repo)._fromJsonArray(t.map(n=>n.data.item),this.query.options);for(let n=0;n<t.length;n++){const s=t[n];s.data.item=i[n]}}this.forListeners(t=>{t(i=>{i||(i=[]);for(const n of e)switch(n.type){case"all":this.setAllItems(n.data);break;case"replace":{i=i.map(s=>this.repo.metadata.idMetadata.getId(s)===n.data.oldId?n.data.item:s);break}case"add":i=i.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(n.data.item)),i.push(n.data.item);break;case"remove":i=i.filter(s=>this.repo.metadata.idMetadata.getId(s)!==n.data.id);break}return i})},e)}}const yo="_liveQueryKeepAlive";class mo{constructor(e,t){d(this,"apiProvider");d(this,"getUserId");d(this,"queries",new Map);d(this,"channels",new Map);d(this,"client");d(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let i=()=>{};const n=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new wo);try{s.unsubscribe=await n.subscribe(e,o=>this.wrapMessageHandling(()=>s.handle(o)),o=>{t.error(o)})}catch(o){throw t.error(o),o}}s.listeners.push(t),i=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{i(),i=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,i){let n=!0,s=()=>{n=!1};return this.runPromise($e(e)._buildEntityDataProviderFindOptions(t).then(o=>{if(!n)return;const{createKey:a,subscribe:l}=new Kr(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(o),c=a();let u=this.queries.get(c);u?u.sendDefaultState(i.next):(this.queries.set(c,u=new po(e,{entityKey:e.metadata.key,options:t},this.getUserId())),u.subscribeCode=()=>{u.unsubscribe&&(u.unsubscribe(),u.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(u.queryChannel,{next:f=>this.runPromise(u.handle(f)),complete:()=>{},error:f=>{u.listeners.forEach(h=>h.error(f))}}).then(f=>{if(u.listeners.length==0){f();return}this.runPromise(l(u.queryChannel).then(h=>{if(u.listeners.length===0){h.unsubscribe(),f();return}this.runPromise(u.setAllItems(h.result)),u.unsubscribe=()=>{u.unsubscribe=()=>{},f(),this.runPromise(h.unsubscribe())}}).catch(h=>{u.listeners.forEach(p=>p.error(h)),f(),this.queries.delete(c)}))})).catch(f=>{u.listeners.forEach(h=>h.error(f))})},u.subscribeCode()),u.listeners.push(i),s=()=>{u.listeners.splice(u.listeners.indexOf(i),1),i.complete(),u.listeners.length==0&&(this.queries.delete(c),u.unsubscribe()),this.closeIfNoListeners()}}).catch(o=>{i.error(o)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const i=await this.runPromise(await S.actionInfo.runActionWithoutBlockingUI(()=>Tt(t.httpClient).post(t.url+"/"+yo,e)));for(const n of i)for(const s of this.queries.values())s.queryChannel===n&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class wo{constructor(){d(this,"id");d(this,"unsubscribe",()=>{});d(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class Vi{openConnection(e){let t;const i=new Map,n=Tt(Oe.apiClient.httpClient);let s=!1,o;const a={close(){o.close()},async subscribe(u,f){let h=i.get(u);return h||(i.set(u,h=[]),await c(u)),h.push(f),()=>{h.splice(h.indexOf(f,1)),h.length==0&&(S.actionInfo.runActionWithoutBlockingUI(()=>n.post(Oe.apiClient.url+"/"+li+"/unsubscribe",{channel:u,clientId:t})),i.delete(u))}}},l=()=>new Promise(u=>{h();let f=0;function h(){o&&o.close(),o=Vi.createEventSource(Oe.apiClient.url+"/"+li),o.onmessage=p=>{let y=JSON.parse(p.data);const v=i.get(y.channel);v&&v.forEach(w=>w(y.data))},o.onerror=p=>{console.error("Live Query Event Source Error",p),o.close(),f++<Ur.error500RetryCount&&setTimeout(()=>{h()},500)},o.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const y of i.keys())await c(y);e()}else s=!0,u(a)})}});return l();async function c(u){await S.actionInfo.runActionWithoutBlockingUI(()=>n.post(Oe.apiClient.url+"/"+li+"/subscribe",{channel:u,clientId:t}))===go&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const go="client connection not found",vi=Symbol.for("serverActionField");class vo{constructor(e){d(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){S.remultFactory=()=>{const e=S.asyncContext.getStore();if(e)return e.remult;throw new Error("remult object was requested outside of a valid context, try running it within initApi or a remult request cycle")}}static disable(){Zs()}async run(e,t){return this.remultObjectStorage?this.remultObjectStorage.run({remult:e},()=>t(e)):t(e)}isInInitRequest(){var e,t;return(t=(e=this.remultObjectStorage)==null?void 0:e.getStore())==null?void 0:t.inInitRequest}setInInitRequest(e){var i;const t=(i=this.remultObjectStorage)==null?void 0:i.getStore();t&&(t.inInitRequest=e)}getStore(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}S.asyncContext||(S.asyncContext=new vo(void 0));function bi(){return S.actionInfo.runningOnServer||!Oe.dataProvider.isProxy}class Te{constructor(e){d(this,"repo",(e,t)=>{t===void 0&&(t=this.dataProvider);let i=this.repCache.get(t);i||this.repCache.set(t,i=new Map);let n=i.get(e);return n||(i.set(e,n=new Ki(e,this,t,Co(e,this))),xs(n,this,t)),n});d(this,"user");d(this,"dataProvider",new Kr(()=>this.apiClient));d(this,"repCache",new Map);d(this,"liveQueryStorage");d(this,"subscriptionServer");d(this,"liveQueryPublisher",{itemChanged:async()=>{}});d(this,"liveQuerySubscriber",new mo(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));d(this,"context",{});d(this,"apiClient",{url:"/api",subscriptionClient:new Vi});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if(Vr(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,i;if(e!=null){if(e instanceof Array){for(const n of e)if(this.isAllowed(n)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(i=(t=this.user)==null?void 0:t.roles)!=null&&i.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const i of t)if(this.isAllowedForInstance(e,i))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}call(e,t,...i){const n=e[vi];if(!n.doWork)throw Error("The method received is not a valid backend method");return n.doWork(i,t,this.apiClient.url,Tt(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}d(Te,"onFind",(e,t)=>{}),d(Te,"entityRefInit");S.defaultRemultFactory=()=>new Te;class bo{constructor(){d(this,"classes",new Map)}}const _o={defaultPageSize:200};async function Hr(r,e){const t=new ko(r.liveQueryPublisher);let i=!0;const n=r.dataProvider;try{await r.dataProvider.transaction(async s=>{r.dataProvider=s,r.liveQueryPublisher=t,await e(s),i=!0}),i&&await t.flush()}finally{r.dataProvider=n}}class ko{constructor(e){d(this,"orig");d(this,"transactionItems",new Map);this.orig=e}async itemChanged(e,t){let i=this.transactionItems.get(e);i||this.transactionItems.set(e,i=[]);for(const n of t)if(n.oldId!==void 0){const s=i.find(o=>o.id===n.oldId);s!==void 0?(n.deleted&&(s.deleted=!0),n.id!=s.id&&(s.id=n.id)):i.push(n)}else i.push(n)}async flush(){for(const e of this.transactionItems.keys())await this.orig.itemChanged(e,this.transactionItems.get(e))}}function _i(r,e){return e&&Object.assign(r,e),r}class Ae{}d(Ae,"number","number"),d(Ae,"date","date"),d(Ae,"checkbox","checkbox"),d(Ae,"password","password"),d(Ae,"email","email"),d(Ae,"tel","tel"),d(Ae,"time","time");const R=class R{};d(R,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>R.Date.fromJson(e),toInput:e=>R.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),d(R,"DateOnly",{fromInput:e=>R.DateOnly.fromJson(e),toInput:e=>R.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:Ae.date,toDb:e=>e?R.DateOnly.fromJson(R.DateOnly.toJson(e)):null,fromDb:e=>R.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),d(R,"DateOnlyString",{...R.DateOnly,toDb:e=>{let t=R.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),d(R,"Boolean",{toDb:e=>e,inputType:Ae.checkbox,fromDb:e=>R.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>R.Boolean.fromJson(e),toInput:e=>R.Boolean.toJson(e)}),d(R,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>R.Number.fromDb(e),toJson:e=>R.Number.toDb(e),fromInput:(e,t)=>{let i=+e;if(e!=null)return i},toInput:(e,t)=>e==null?void 0:e.toString(),inputType:Ae.number}),d(R,"String",{fromDb:tt,toDb:tt,fromJson:tt,toJson:tt,fromInput:tt,toInput:tt}),d(R,"Integer",{...R.Number,toJson:e=>{let t=R.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>R.Integer.toJson(e),fieldTypeInDb:"integer"}),d(R,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>R.JsonString.fromDb(e),toDb:e=>R.JsonString.toDb(e),fromInput:e=>R.Default.fromJson(e),toInput:e=>R.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),d(R,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(R.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(R.JsonString.toJson(e)):void 0,fromInput:e=>R.JsonString.fromJson(e),toInput:e=>R.JsonString.toJson(e)}),d(R,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>R.JsonString.fromJson(e),toInput:e=>R.JsonString.toJson(e),fieldTypeInDb:"json"});let pe=R;function tt(r){return r==null?r:typeof r!="string"?r.toString():r}function yr(r,e,t){let i=F.fromEntityFilter(r,e);const n=()=>{};i&&i.__applyToConsumer({custom:n,databaseCustom:n,containsCaseInsensitive:n,notContainsCaseInsensitive:n,isDifferentFrom:n,isEqualTo:(s,o)=>{t[s.key]=o},isGreaterOrEqualTo:n,isGreaterThan:n,isIn:n,isLessOrEqualTo:n,isLessThan:n,isNotNull:n,isNull:n,or:n})}class mr{constructor(){d(this,"entityLoaders",new Map);d(this,"promises",[])}load(e,t){let i=this.entityLoaders.get(e.entityType);i||this.entityLoaders.set(e.entityType,i=new Io(e));const n=i.find(t);return this.promises.push(n),n}async resolveAll(){for(const t of this.entityLoaders.values())for(const i of t.queries.values())i.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class Io{constructor(e){d(this,"rel");d(this,"queries",new Map);this.rel=e}find(e){const{where:t,...i}=Ui(e,this.rel.metadata),n=JSON.stringify(i);let s=this.queries.get(n);return s||this.queries.set(n,s=new Oo(this.rel)),s.find(e,t)}}class Oo{constructor(e){d(this,"rel");d(this,"pendingInStatements",new Map);d(this,"whereVariations",new Map);this.rel=e}find(e,t){const i=JSON.stringify(t);let n=this.whereVariations.get(i);if(!n){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let o=this.pendingInStatements.get(s[0]);o||this.pendingInStatements.set(s[0],o=new Eo(this.rel,s[0],e)),this.whereVariations.set(i,n={result:o.find(t)})}else this.whereVariations.set(i,n={result:this.rel.find(e)})}return n.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class Eo{constructor(e,t,i){d(this,"rel");d(this,"key");d(this,"options");d(this,"values",new Map);this.rel=e,this.key=t,this.options=i}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(n=>n.value)},t.limit=1e3,t.page=1;let i=[];try{for(;;){const n=await this.rel.find(t);if(i.push(...n),n.length<t.limit)break;t.page++}for(const n of this.values.values())n.resolve(i.filter(s=>{const a=te(s).fields.find(this.key),l=re(a.metadata),c=(l==null?void 0:l.type)==="reference"?a.getId():s[this.key];return n.value==c}))}catch(n){for(const s of this.values.values())s.reject(n)}}find(e){const t=e[this.key];let i=this.values.get(t);if(!i){let n,s,o=new Promise((a,l)=>{n=a,s=l});this.values.set(t,i={value:t,resolve:n,reject:s,result:o})}return i.result}}const he=class he{};d(he,"required",vt(async(e,t)=>t.value!=null&&t.value!=null&&t.value!=="","Should not be empty")),d(he,"unique",vt(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),d(he,"uniqueOnBackend",vt(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,he.unique.defaultMessage)),d(he,"regex",ht((e,t)=>t.test(e))),d(he,"email",jt(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),d(he,"url",jt(e=>!!new URL(e),"Invalid Url")),d(he,"in",ht((e,t)=>t.includes(e),e=>`Value must be one of: ${e.map(t=>typeof t=="object"?t.id!==void 0?t.id:t.toString():t).join(", ")}`)),d(he,"notNull",jt(e=>e!=null,"Should not be null")),d(he,"enum",ht((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${Jt(e).join(", ")}`)),d(he,"relationExists",vt(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),d(he,"maxLength",ht((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),d(he,"minLength",ht((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),d(he,"defaultMessage","Invalid value");let Ne=he;function vt(r,e){const t=async(n,s,o)=>{const a=await r(n,s);typeof a=="string"&&a.length>0?s.error=a:a||(s.error=typeof o=="function"&&o(n,s,void 0)||o||typeof e=="function"&&e(n,s,void 0)||e||Ne.defaultMessage)},i=(n,s,o)=>typeof n=="string"||n==="function"||n===void 0&&s===void 0?async(a,l,c)=>await t(a,l,n||c):t(n,s,o);return Object.defineProperty(i,"defaultMessage",{get:()=>e,set:n=>{e=n},enumerable:!0}),Object.assign(i,{withMessage:n=>async(s,o)=>i(s,o,n)})}function jt(r,e){return vt((t,i)=>i.value===void 0||i.value===null?!0:r(i.value),e)}function ht(r,e){const t=So((i,n,s)=>n.value===void 0||n.value===null?!0:r(n.value,s),(i,n,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((i,n)=>t(i,n),{get defaultMessage(){return e},set defaultMessage(i){e=i}})}function So(r,e,t=!1){return Object.assign((n,s)=>async(o,a)=>{const l=await r(o,a,n);typeof l=="string"?a.error=l:l||(a.error=s?typeof s=="function"?t?s(n):s(o,a,n):s:e?typeof e=="function"?e(o,a,n):e:Ne.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(n){e=n}})}function Jt(r){return Object.values(r).filter(e=>typeof r[e]!="number")}function Ut(r,e,t=!1){if(!e)return r;const i=Array.isArray(e)?e:[e],n=Array.isArray(r)?r:r?[r]:[];return t?[...i,...n]:[...n,...i]}function ui(r,e){return typeof r[e]<"u"}class Ki{constructor(e,t,i,n,s){d(this,"_entity");d(this,"_remult");d(this,"_dataProvider");d(this,"_info");d(this,"_defaultFindOptions");d(this,"__edp");d(this,"_idCache",new Map);d(this,"listeners");d(this,"_cache",new Map);this._entity=e,this._remult=t,this._dataProvider=i,this._info=n,this._defaultFindOptions=s}_notFoundError(e){return{message:`id ${e} not found in entity ${this.metadata.key}`,httpStatusCode:404}}[Ot](){return this}async _createAfterFilter(e,t){let i=new Map;for(const o of ke.translateOrderByToSort(this.metadata,e).Segments){let a=t[o.field.key];i.set(o.field.key,a)}let n={$or:[]},s=[];for(const o of ke.translateOrderByToSort(this.metadata,e).Segments){let a={};for(const l of s)a[l.key]=i.get(l.key);s.push(o.field),o.isDescending?a[o.field.key]={$lt:i.get(o.field.key)}:a[o.field.key]={$gt:i.get(o.field.key)},n.$or.push(a)}return n}relations(e){return new Proxy({},{get:(t,i)=>{const n=this.fields.find(i),s=re(n);if(!s)throw Error(i+" is not a relation");const{toRepo:o,returnNull:a,returnUndefined:l}=this._getFocusedRelationRepo(n,e);return s.type==="toMany"?o:{findOne:c=>a?Promise.resolve(null):l?Promise.resolve(void 0):o.findFirst({},c)}}})}_getFocusedRelationRepo(e,t){const i=re(e);let n=i.toRepo,{findOptions:s,returnNull:o,returnUndefined:a}=this._findOptionsBasedOnRelation(i,e,void 0,t,n);return{toRepo:new Ki(n._entity,n._remult,n._dataProvider,n._info,s),returnNull:o,returnUndefined:a}}get _edp(){return this.__edp?this.__edp:this.__edp=this._dataProvider.getEntityDataProvider(this.metadata)}_getCachedById(e,t){e=e+"",this._getCachedByIdAsync(e,t);let i=this._idCache.get(e);if(!(i instanceof Promise))return i}async _getCachedByIdAsync(e,t){e=e+"";let i=this._idCache.get(e);if(i instanceof Promise)return await i;if(this._idCache.has(e))return i;if(t)return;this._idCache.set(e,void 0);let n=this.findId(e).then(s=>(s===void 0?i=null:i=s,this._idCache.set(e,i),i));return this._idCache.set(e,n),await n}_addToCache(e){e&&this._idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new Mo(e,this)}getEntityRef(e){let t=e[He];return t||(this._fixTypes(e),t=new Nt(this._info,e,this,this._edp,this._remult,!0),Object.defineProperty(e,He,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=te(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this._dataProvider.isProxy)return this._edp.delete(e);{let n=await this.findId(e);if(!n)throw this._notFoundError(e);return await te(n).delete()}}let i=this._getRefForExistingRow(e,void 0);return this._dataProvider.isProxy||await i.reload(),i.delete()}async insert(e){if(Array.isArray(e))if(this._dataProvider.isProxy){let t=[],i=[];for(const n of e){let s=te(e,!1);if(s){if(!s.isNew())throw"Item is not new"}else s=await this.getEntityRef(this.create(n));t.push(s),i.push(await s.buildDtoForInsert())}return _t(await this._edp.insertMany(i),(n,s)=>t[s].processInsertResponseDto(n))}else{let t=[];for(const i of e)t.push(await this.insert(i));return t}else{let t=te(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let i=te(e,!1);if(i||(i=this.getEntityRef({...e})),!t||t.length===0)return await i.validate();{i.__clearErrorsAndReportChanged();let n=!1;for(const s of t)await i.fields.find(s).validate()||(n=!0);return n?i.buildErrorInfoObject():void 0}}}async updateMany({where:e,set:t}){if(F.throwErrorIfFilterIsEmpty(e,"updateMany"),this._dataProvider.isProxy)return this._edp.updateMany(await this._translateWhereToFilter(e),t);{let i=0;for await(const n of this.query({where:e}))_i(n,t),await te(n).save(),i++;return i}}async update(e,t){{let n=te(t,!1);if(n)return await n.save()}{let n=te(e,!1);if(n)return _i(e,t),n.save()}let i;if(typeof e=="object"?(i=this._getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(i.instance,t)):i=this._getRefForExistingRow(t,e),this._dataProvider.isProxy)return await i.save(Object.keys(t));{const n=await i.reload();if(!n)throw this._notFoundError(i.id);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let o=i.fields[s];if(t[s]===void 0&&re(o.metadata))continue;o&&(n[s]=t[s])}return await this._fixTypes(n),await i.save()}}_getRefForExistingRow(e,t){let i=te(e,!1);if(!i){const n=new this._entity(this._remult);for(const o of this._fieldsOf(e))n[o.key]=e[o.key];this._fixTypes(n);let s=new Nt(this._info,n,this,this._edp,this._remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),i=s,Object.defineProperty(n,He,{get:()=>s})}return i}async save(e){if(Array.isArray(e))return _t(e,t=>this.save(t));{let t=te(e,!1);if(t)return await t.save();if(e instanceof zr)return await this.getEntityRef(e).save();{let i=this.metadata.idMetadata.getId(e);return i===void 0?this.insert(e):this.update(i,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let i=t;return typeof t=="function"&&(i={next:t,complete:()=>{},error:()=>{}}),i.error??(i.error=()=>{}),i.complete??(i.complete=()=>{}),this._remult.liveQuerySubscriber.subscribe(this,e,i)}}}async _rawFind(e,t=!1,i){e||(e={}),this._defaultFindOptions&&(e={...this._defaultFindOptions,...e});let n=await this._buildEntityDataProviderFindOptions(e);t&&(delete n.orderBy,delete n.limit),Te.onFind(this._info,e);const s=await this._edp.find(n);return await this._loadManyToOneForManyRows(s,e,i)}async find(e,t=!1){const i=new mr,n=await this._rawFind(e,t,i);return await i.resolveAll(),n}async _buildEntityDataProviderFindOptions(e){let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(e.orderBy=this._info.entityInfo.defaultOrderBy),t.where=await this._translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=ke.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async _fromJsonArray(e,t){const i=new mr,n=await this._loadManyToOneForManyRows(e.map(s=>{let o={};for(const a of this.metadata.fields.toArray())o[a.key]=a.valueConverter.fromJson(s[a.key]);return o}),t,i);return await i.resolveAll(),n}async _loadManyToOneForManyRows(e,t,i){var a;let n;t!=null&&t.load&&(n=t.load(this.metadata.fields));for(const l of this.metadata.fields)if(Ie(l.valueType,!1)&&!re(l)){let f=!l.options.lazy;if(n!==void 0&&(f=n.includes(l)),f){let h=this._remult.repo(l.valueType),p=[];for(const y of e){let v=y[l.key];v!=null&&!p.includes(v)&&!h._idCache.has(v+"")&&p.push(v)}p.length>0&&await s(h,p)}}async function s(l,c){let u=await l.find({where:l.metadata.idMetadata.getIdFilter(...c)},!0);for(const f of u)l._addToCache(f)}let o=await _t(e,async l=>await this._mapRawDataToResult(l,n));for(const l of this.metadata.fields){let c=re(l),u=l.options.defaultIncluded;if(((a=t==null?void 0:t.include)==null?void 0:a[l.key])!==void 0&&(u=t.include[l.key]),c&&u){const f=c.toRepo;for(const h of o){let{findOptions:p,returnNull:y}=this._findOptionsBasedOnRelation(c,l,u,h,f);if(y)h[l.key]=null;else{const v=c.toEntity,w=f;i.load({entityType:v,find:I=>w._rawFind(I,!1,i),metadata:w.metadata},p).then(I=>{I.length==0&&c.type=="toOne"||(h[l.key]=c.type!=="toMany"?I.length==0?null:I[0]:I)})}}}}return o}_findOptionsBasedOnRelation(e,t,i,n,s){let o=!1,a=!1,l=[],c={},u=[];typeof e.options.findOptions=="function"?u.push(e.options.findOptions(n)):typeof e.options.findOptions=="object"&&u.push(e.options.findOptions),typeof i=="object"&&u.push(i);for(const p of u){p.where&&l.push(p.where);for(const y of["limit","include","orderBy"])p[y]&&(c[y]=p[y])}const f=e.getFields(),h=p=>{let y=e.type==="reference"?te(n).fields.find(t.key).getId():n[p];return(e.type==="toOne"||e.type==="reference")&&(y===null?o=!0:y===void 0?a=!0:e.type==="reference"&&typeof y=="object"&&(y=s.metadata.idMetadata.getId(y))),y};f.compoundIdField&&(e.type==="toMany"?l.push({[f.compoundIdField]:this.metadata.idMetadata.getId(n)}):l.push(s.metadata.idMetadata.getIdFilter(h(f.compoundIdField))));for(const p in f.fields)Object.prototype.hasOwnProperty.call(f.fields,p)&&l.push({[p]:h(f.fields[p])});return c.where={$and:l},(e.type==="toOne"||e.type==="reference")&&c.orderBy&&(c.limit=1),{findOptions:c,returnNull:o,returnUndefined:a}}async _mapRawDataToResult(e,t){if(!e)return;let i=new this._entity(this._remult),n=new Nt(this._info,i,this,this._edp,this._remult,!1);return Object.defineProperty(i,He,{get:()=>n}),await n.loadDataFrom(e,t),n.saveOriginalData(),i}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(n=>this.fromJson(n,t));let i=new this._entity(this._remult);for(const n of this._fieldsOf(e))if(Ie(n.valueType,!1)){let o=e[n.key];typeof o=="string"||typeof o=="number"?i[n.key]=o:i[n.key]=this._remult.repo(n.valueType).fromJson(o)}else e[n.key]!==void 0&&(i[n.key]=n.valueConverter.fromJson(e[n.key]));if(this._fixTypes(i),t)return this.create(i);{let n=new Nt(this._info,i,this,this._edp,this._remult,!1);return Object.defineProperty(i,He,{get:()=>n}),n.saveOriginalData(),i}}async count(e){return this._edp.count(await this._translateWhereToFilter(e))}async deleteMany({where:e}){if(F.throwErrorIfFilterIsEmpty(e,"deleteMany"),this._dataProvider.isProxy)return this._edp.deleteMany(await this._translateWhereToFilter(e));{let t=0;for await(const i of this.query({where:e}))await te(i).delete(),t++;return t}}async findOne(e,t=!1){let i,n;if(e||(e={}),e.useCache){let s=Ui(e,this.metadata),o=JSON.stringify(s);if(n=this._cache.get(o),n!==void 0)if(n.value&&this.getEntityRef(n.value).wasDeleted())n=void 0,this._cache.delete(o);else return this._cache.get(o).promise;else n={value:void 0,promise:void 0},this._cache.set(o,n)}return i=this.find({...e,limit:1},t).then(async s=>{let o;return s.length>0&&(o=s[0]),!o&&e.createIfNotFound&&(o=this.create(),e.where&&await yr(this.metadata,e.where,o)),o}),n&&(n.promise=i=i.then(s=>(n.value=s,s))),i}async findFirst(e,t,i=!1){if(t||(t={}),e)if(t.where){let n=t.where;t.where={$and:[n,e]}}else t.where=e;return this.findOne(t,i)}_fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(i=>t.includes(i.key))}create(e){var i;let t=new this._entity(this._remult);if(e){for(const n of this._fieldsOf(e))t[n.key]=e[n.key];this._fixTypes(t)}return(i=this._defaultFindOptions)!=null&&i.where&&(yr(this.metadata,this._defaultFindOptions.where,t),this._fixTypes(t)),this.getEntityRef(t),t}async _fixTypes(e){for(const t of this._fieldsOf(e)){const i=e[t.key];if(i!=null)if(t.valueType===Date&&!(i instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(i));else for(const[n,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===n&&typeof i!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(i)))}return e}findId(e,t){if(e==null)return null;if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async _translateWhereToFilter(e){var i,n;e||(e={}),(i=this._defaultFindOptions)!=null&&i.where&&(e={$and:[e,(n=this._defaultFindOptions)==null?void 0:n.where]}),this._dataProvider.isProxy||(this.metadata.options.backendPreprocessFilter&&(e=await this.metadata.options.backendPreprocessFilter(e,{metadata:this.metadata,getFilterPreciseValues:s=>F.getPreciseValues(this.metadata,s||e)})),this.metadata.options.backendPrefilter&&(e={$and:[e,await F.resolve(this.metadata.options.backendPrefilter)]}));let t=await F.fromEntityFilter(this.metadata,e);return t&&!this._dataProvider.isProxy&&(t=await F.translateCustomWhere(t,this.metadata,this._remult)),t}}function Co(r,e){let t=S.columnsOfType.get(r);t||S.columnsOfType.set(r,t=[]);let i=Ie(r)(e),n=Hs(r),s=Object.getPrototypeOf(r);for(;s!=null;){let o=S.columnsOfType.get(s);o&&t.unshift(...o.filter(l=>!t.find(c=>c.key==l.key)));let a=Ie(s,!1);if(a){let l=a(e);i={...l,...i};let c=["saving","saved","deleting","deleted","validation"];for(const u of c)if(l[u]&&l[u]!==i[u]){let f=i[u];i[u]=async(h,p)=>{await f(h,p),await l[u](h,p)}}}s=Object.getPrototypeOf(s)}return new Fo(Qr(t,e),i,e,r,n)}class Wr{constructor(e,t,i,n){d(this,"fieldsMetadata");d(this,"instance");d(this,"remult");d(this,"isNewRow");d(this,"_error");d(this,"_subscribers");d(this,"_isLoading",!1);d(this,"lookups",new Map);d(this,"errors");d(this,"originalValues",{});var s;this.fieldsMetadata=e,this.instance=t,this.remult=i,this.isNewRow=n;{let o=i;o!=null&&o.iAmRemultProxy&&(i=S.remultFactory())}for(const o of e)if(Ie(o.valueType,!1)&&i){let l=new to(i.repo(o.valueType),!!re(o),o.allowNull);this.lookups.set(o.key,l);let c=t[o.key],u;Object.defineProperty(t,o.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),u||(u=this.fields.find(o.key),u._subscribers||(u._subscribers=new Lt)),u._subscribers.reportObserved()),l.item),set:f=>{var h;l.set(f),(h=this._subscribers)==null||h.reportChanged(),u||(u=this.fields.find(o.key),u._subscribers||(u._subscribers=new Lt)),u._subscribers.reportChanged()},enumerable:!0}),l.set(c)}else if(((s=re(o))==null?void 0:s.type)==="toOne"){let l=t.hasOwnProperty(o.key),c=t[o.key];n&&!c&&(l=!1),Object.defineProperty(t,o.key,{get:()=>c,set:u=>{if(c=u,u===void 0)return;const f=o.options;if(f.field&&(this.instance[f.field]=re(o).toRepo.metadata.idMetadata.getId(u)),f.fields){for(const h in f.fields)if(Object.prototype.hasOwnProperty.call(f.fields,h)){const p=f.fields[h];this.instance[p]=u==null?null:u[h]}}},enumerable:!0}),l&&(t[o.key]=c)}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new Lt;for(const e of this.fieldsMetadata){let t=Ie(e.valueType,!1),i=this.fields.find(e.key);if(i._subscribers=new Lt,!(t&&this.remult)){let n=this.instance[e.key];Object.defineProperty(this.instance,e.key,{get:()=>(this._subscribers.reportObserved(),i._subscribers.reportObserved(),n),set:s=>{n=s,this._subscribers.reportChanged(),i._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await _t([...this.lookups.values()],e=>e.waitLoad())}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const t of this.fieldsMetadata)if(this.errors[t.key]){e.message=this.fields[t.key].metadata.caption+": "+this.errors[t.key],this.error=e.message;break}}return e}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(n=>this.catchSaveErrors(n));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let i=t.modelState;throw i||(i=t.ModelState),i&&(this.errors=i),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const i of this.fieldsMetadata){let n=this.lookups.get(i.key),s;const o=re(i);n?s=n.id:s=this.instance[i.key],o&&e&&!i.allowNull&&s==null&&(o.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!o||o.type==="reference")&&(s!==void 0&&(s=i.valueConverter.toJson(s),s!=null&&(s=i.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[i.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let i={};for(const n of this.fieldsMetadata)if(t||!this.remult||n.includedInApi(this.instance)){let s,o=this.lookups.get(n.key),a=!1;o?e?(s=o.toJson(),a=!0,i[n.key]=s):s=o.id:re(n)&&!e?a=!0:(s=this.instance[n.key],this.remult||s&&Ie(s.constructor,!1)&&(s=te(s).getId())),a||(i[n.key]=n.valueConverter.toJson(s))}return i}async _updateEntityBasedOnApi(e,t=!1){let i=Object.keys(e);for(const n of this.fieldsMetadata)if(i.includes(n.key)&&n.includedInApi(this.instance)&&(!this.remult||t||n.apiUpdateAllowed(this.instance))){let s=this.lookups.get(n.key);s?s.id=e[n.key]:this.instance[n.key]=n.valueConverter.fromJson(e[n.key])}await _t([...this.fields].filter(n=>!re(n.metadata)),n=>n.load())}}class Nt extends Wr{constructor(t,i,n,s,o,a){super(t.fieldsMetadata,i,o,a);d(this,"info");d(this,"repository");d(this,"edp");d(this,"_isNew");d(this,"metadata");d(this,"_wasDeleted",!1);d(this,"_columns");d(this,"_saving",!1);d(this,"id");d(this,"originalId");if(this.info=t,this.repository=n,this.edp=s,this._isNew=a,this.metadata=t,a)for(const l of t.fieldsMetadata)l.options.defaultValue&&i[l.key]===void 0&&(typeof l.options.defaultValue=="function"?i[l.key]=l.options.defaultValue(i):i[l.key]||(i[l.key]=l.options.defaultValue));this.info.options.entityRefInit&&this.info.options.entityRefInit(this,i),Te.entityRefInit&&Te.entityRefInit(this,i)}clone(){const t=this.toApiJson(!0,!0);return this.repository.fromJson(t,this.isNew())}get relations(){return this.repository.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=i=>{let n=this.lookups.get(i.key);return n?n.id:this.instance[i.key]};return this.metadata.idMetadata.field instanceof Qe?this.metadata.idMetadata.field.getId(t):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:await this.getIdFilter()}).then(async t=>{if(t.length===0)throw this.repository._notFoundError(this.id);await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],i={find:n=>i[typeof n=="string"?n:n.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const n of this.info.fieldsMetadata)t.push(i[n.key]=new Wt(n.options,n,this.instance,this,this));this._columns=i}return this._columns}async save(t){var i;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let n=!1,s=this.buildLifeCycleEvent(()=>n=!0);if(!this.repository._dataProvider.isProxy){for(const u of this.fields)u.metadata.options.saving&&await u.metadata.options.saving(this.instance,u,s);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,s)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),a=[];for(const u of this.metadata.fields)if(u.dbReadOnly||t!==void 0&&!t.includes(u.key)){o[u.key]=void 0,a.push(u.key);let f=this.fields.find(u);f.value=f.originalValue}let l,c=this.isNew();try{if((i=this._subscribers)==null||i.reportChanged(),this.isNew())l=await this.edp.insert(o);else{let u={},f=!1;for(const h in o)if(Object.prototype.hasOwnProperty.call(o,h)){const p=o[h];this.fields.find(h).valueChanged()&&!a.includes(h)&&(u[h]=p,f=!0)}if(!f)return this.instance;n?l=(await this.edp.find({where:await this.getIdFilter()}))[0]:l=await this.edp.update(this.id,u)}if(await this.loadDataFrom(l),s.id=this.getId(),!this.repository._dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,s),this.repository.listeners))for(const u of this.repository.listeners.filter(f=>f.saved))await u.saved(this.instance,c);return await this.repository._remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(u){await this.catchSaveErrors(u)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}async processInsertResponseDto(t){return await this.loadDataFrom(t),this.saveOriginalData(),this._isNew=!1,this.instance}async buildDtoForInsert(){await this.__validateEntity(),this.__assertValidity();let t=this.copyDataToObject(this.isNew()),i=[];for(const n of this.metadata.fields)if(n.dbReadOnly){t[n.key]=void 0,i.push(n.key);let s=this.fields.find(n);s.value=s.originalValue}return t}buildLifeCycleEvent(t=()=>{}){const i=this;return{isNew:i.isNew(),fields:i.fields,id:i.getId(),originalId:i.getOriginalId(),metadata:i.repository.metadata,repository:i.repository,preventDefault:()=>t(),relations:i.repository.relations(i.instance)}}async getIdFilter(){return await this.repository._translateWhereToFilter(this.repository.metadata.idMetadata.getIdFilter(this.id))}async delete(){this.__clearErrorsAndReportChanged();let t=!0,i=this.buildLifeCycleEvent(()=>t=!1);this.repository._dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,i),this.__assertValidity();try{if(t&&await this.edp.delete(this.id),this.repository._dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,i),this.repository.listeners)for(const n of this.repository.listeners.filter(s=>s.deleted))await n.deleted(this.instance);await this.repository._remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(n){await this.catchSaveErrors(n)}}async loadDataFrom(t,i){for(const n of this.info.fields){let s=this.lookups.get(n.key);s?(s.id=t[n.key],i===void 0?!n.options.lazy&&!re(n)&&await s.waitLoad():i.includes(n)&&await s.waitLoad()):re(n)||(this.instance[n.key]=t[n.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(bi())for(const t of this.info.fieldsMetadata)t.options.serverExpression&&(this.instance[t.key]=await t.options.serverExpression(this.instance))}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const i of this.fields){const n=re(i.metadata);if((!n||n.type=="reference")&&i.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){for(const t of this.fieldsMetadata)t.options.validate&&await new Wt(t.options,t,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let t=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,t)}if(this.repository.listeners)for(const t of this.repository.listeners.filter(i=>i.validating))await t.validating(this.instance)}}const wr=Symbol.for("controllerColumns");function Qr(r,e){return r.map(t=>Hi(t.settings(e),e))}function gr(r,e){const t=e||Oe;let i=r[wr];if(i||(i=r[He]),!i){let n=S.columnsOfType.get(r.constructor);n||S.columnsOfType.set(r.constructor,n=[]);let s=Object.getPrototypeOf(r.constructor);for(;s!=null;){let o=S.columnsOfType.get(s);o&&n.unshift(...o.filter(a=>!n.find(l=>l.key==a.key))),s=Object.getPrototypeOf(s)}r[wr]=i=new To(Qr(n,t).map(o=>new Gr(o,void 0,t)),r,t)}return i}class To extends Wr{constructor(t,i,n){super(t,i,n,!1);d(this,"fields");let s=[],o={find:a=>o[typeof a=="string"?a:a.key],[Symbol.iterator]:()=>s[Symbol.iterator](),toArray:()=>s};for(const a of t)s.push(o[a.key]=new Wt(a.options,a,i,void 0,this));this.fields=o}async __performColumnAndEntityValidations(){for(const t of this.fields)t instanceof Wt&&await t.__performValidation()}}class Wt{constructor(e,t,i,n,s){d(this,"settings");d(this,"metadata");d(this,"container");d(this,"helper");d(this,"rowBase");d(this,"_subscribers");d(this,"target");d(this,"entityRef");this.settings=e,this.metadata=t,this.container=i,this.helper=n,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=re(this.metadata);if(t){if(t.type==="toMany")return this.container[this.metadata.key]=await this.helper.repository.relations(this.container)[this.metadata.key].find();{let i=await this.helper.repository.relations(this.container)[this.metadata.key].findOne();if(i)this.container[this.metadata.key]=i;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=i=>{i!==!0&&i!==void 0&&!this.error&&(typeof i=="string"&&i.length>0?this.error=i:this.error="invalid value")};if(this.settings.validate){let i=this,n={entityRef:this.entityRef,get error(){return i.error},set error(s){i.error=s},isNew:(e=this.entityRef)==null?void 0:e.isNew(),load:()=>i.load(),metadata:i.metadata,originalValue:i.originalValue,value:i.value,valueChanged:()=>i.valueChanged(),originalValueIsNull:()=>i.originalValueIsNull(),valueIsNull:()=>i.valueIsNull(),isBackend:()=>{var s,o,a;return!((a=(o=(s=i.rowBase)==null?void 0:s.remult)==null?void 0:o.dataProvider)!=null&&a.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,n));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,n))}}catch(t){typeof t=="string"?this.error=t:this.error=t.message}}async validate(){return await this.__performValidation(),!this.error}}let Ao={transformCaption:(r,e,t,i)=>t};const Po=S.captionTransformer||(S.captionTransformer=Ao);function xr(r,e,t,i){let n;return typeof r=="function"?t&&(n=r(t)):r&&(n=r),n=Po.transformCaption(t,e,n,i),n||(e?eo(e):"")}class Gr{constructor(e,t,i){d(this,"settings");d(this,"entityDefs");d(this,"remult");d(this,"options");d(this,"target");d(this,"readonly");d(this,"valueConverter");d(this,"allowNull");d(this,"caption");d(this,"dbName");d(this,"inputType");d(this,"key");d(this,"isServerExpression");d(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=i,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter,{get:(n,s)=>{let o=n[s];return typeof o=="function"?(...a)=>{try{return n[s](...a)}catch(l){const c=`${String(s)} failed for value ${a==null?void 0:a[0]}. Error: ${typeof l=="string"?l:l.message}`;throw{message:this.caption+": "+c,modelState:{[this.key]:c}}}}:o}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=xr(e.caption,e.key,i,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return Wi(this,this.entityDefs)}get dbReadOnly(){return this.settings.dbReadOnly}}class Fo{constructor(e,t,i,n,s){d(this,"entityInfo");d(this,"remult");d(this,"entityType");d(this,"key");d(this,"options");d(this,"fieldsMetadata",[]);d(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=te(e,!1);return t?t.getId():this.idMetadata.field instanceof Qe?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,get fields(){return this.field instanceof Qe?this.field.fields:[this.field]},createIdInFilter:e=>{if(e.length>0)return{$or:e.map(t=>this.idMetadata.getIdFilter(te(t).getId()))}},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof Qe){let t=this.idMetadata.field;return e.length==1?t.isEqualTo(e[0]):{$or:e.map(i=>t.isEqualTo(i))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});d(this,"fields");d(this,"dbName");d(this,"caption");if(this.entityInfo=t,this.remult=i,this.entityType=n,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let a;typeof this.options.allowApiCrud=="function"?a=(l,c)=>this.options.allowApiCrud(c):a=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.options.allowApiDelete=a),this.options.allowApiInsert===void 0&&(this.options.allowApiInsert=a),this.options.allowApiUpdate===void 0&&(this.options.allowApiUpdate=a),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=n.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let o={find:a=>o[typeof a=="string"?a:a.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const a of e)this.fieldsMetadata.push(o[a.key]=new Gr(a,this,i));if(this.fields=o,this.caption=xr(t.caption,this.key,i,this),t.id){let a=typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(a)?a.length>1?this.idMetadata.field=new Qe(...a):a.length==1&&(this.idMetadata.field=a[0]):this.idMetadata.field=a}this.idMetadata.field||(this.fields.id?this.idMetadata.field=this.fields.id:this.idMetadata.field=[...this.fields][0])}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=te(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return Yr(this)}}function Do(r){var e,t;return((t=(e=r.options)==null?void 0:e.valueConverter)==null?void 0:t.fieldTypeInDb)==="autoincrement"}const Ro=Symbol.for("storableMember"),fi=Symbol.for("fieldOptionalValues");function $r(r,e){let t={};for(const i of r)if(i)if(typeof i=="function")i(t,e);else{const{validate:n,...s}=i;t.validate=Ut(t.validate,n),Object.assign(t,s)}return t}function Hi(r,e){if(r.valueType){let t=r.valueType[Ro];t&&(r=$r([...t,r],e))}if(r.valueType==String){let t=r;r.valueConverter||(t.valueConverter=pe.String)}if(r.valueType==Number){let t=r;r.valueConverter||(t.valueConverter=pe.Number)}if(r.valueType==Date){let t=r;r.valueConverter||(t.valueConverter=pe.Date)}if(r.valueType==Boolean){let t=r;t.valueConverter||(t.valueConverter=pe.Boolean)}if(!r.valueConverter){if(Ie(r.valueType,!1)){let i;r.valueConverter={toDb:n=>n,fromDb:n=>n},r.valueConverter=new Proxy(r.valueConverter,{get(n,s){if(n[s]===void 0&&i===void 0){if(s==="inputType")return"";i=e.repo(r.valueType).metadata.idMetadata.field.valueType===Number;for(const o of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])n[o]=i?pe.Integer[o]:pe.String[o]}return n[s]},set(n,s,o,a){return n[s]=o,!0}})}else r.valueConverter=pe.Default;return r}return r.valueConverter.toJson||(r.valueConverter.toJson=t=>t),r.valueConverter.fromJson||(r.valueConverter.fromJson=t=>t),r.valueConverter.toDb||(r.valueConverter.toDb=t=>r.valueConverter.toJson(t)),r.valueConverter.fromDb||(r.valueConverter.fromDb=t=>r.valueConverter.fromJson(t)),r.valueConverter.toInput||(r.valueConverter.toInput=t=>r.valueConverter.toJson(t)),r.valueConverter.fromInput||(r.valueConverter.fromInput=t=>r.valueConverter.fromJson(t)),r}class zr{get _(){return te(this)}save(){return te(this).save()}assign(e){return _i(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class Mo{constructor(e,t){d(this,"options");d(this,"repo");d(this,"_count");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=_o.defaultPageSize)}async getPage(e){return e<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const i of this)await e(i),t++;return t}async paginator(e){this.options.orderBy=ke.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t=await this.repo.find({where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include}),i,n=t.length==this.options.pageSize;if(n){let s=await this.repo._createAfterFilter(this.options.orderBy,t[t.length-1]);i=()=>this.paginator(s)}return{count:()=>this.count(),hasNextPage:n,items:t,nextPage:i}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=ke.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,i,n,s=0;return n=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),i===void 0||t==i.items.length){if(i&&!i.hasNextPage)return{value:void 0,done:!0};let o=i;if(i?i=await i.nextPage():i=await this.paginator(),t=0,i.items.length==0)return{value:void 0,done:!0};if((o==null?void 0:o.items.length)>0&&this.repo.getEntityRef(o.items[0]).getId()==this.repo.getEntityRef(i.items[0]).getId())throw new Error("pagination failure, returned same first row")}if(t<i.items.length)return{value:i.items[t++],done:!1}},{next:async()=>n()}}}class Lt{constructor(){d(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(i=>i!=t)}}function No(r){return r.metadata?r.metadata:Ie(r,!1)?Oe.repo(r).metadata:r}function Lo(r){return Ie(r,!1)?Oe.repo(r):r}async function _t(r,e){const t=[];for(let i=0;i<r.length;i++){const n=r[i];t.push(await e(n,i))}return t}const nt=class nt{constructor(e){d(this,"sql");d(this,"wrapIdentifier",e=>e);d(this,"provideMigrationBuilder");d(this,"createdEntities",[]);d(this,"end");this.sql=e,e.wrapIdentifier&&(this.wrapIdentifier=t=>e.wrapIdentifier(t)),ui(e,"provideMigrationBuilder")&&(this.provideMigrationBuilder=t=>e.provideMigrationBuilder(t)),ui(e,"end")&&(this.end=()=>e.end())}static getDb(e){const t=e||Oe.dataProvider;if(ui(t,"createCommand"))return t;throw"the data provider is not an SqlCommandFactory"}createCommand(){return new qo(this.sql.createCommand(),nt.LogToConsole)}async execute(e){return await this.createCommand().execute(e)}_getSourceSql(){return this.sql}async ensureSchema(e){this.sql.ensureSchema&&await this.sql.ensureSchema(e)}getEntityDataProvider(e){if(!this.sql.supportsJsonColumnType)for(const t of e.fields.toArray())t.valueConverter.fieldTypeInDb==="json"&&(t.valueConverter={...t.valueConverter,toDb:pe.JsonString.toDb,fromDb:pe.JsonString.fromDb});return new Xr(e,this,async t=>{this.createdEntities.indexOf(t.$entityName)<0&&(this.createdEntities.push(t.$entityName),await this.sql.entityIsUsedForTheFirstTime(e))},this.sql)}transaction(e){return this.sql.transaction(async t=>{let i=!1;try{await e(new nt({createCommand:()=>{let n=t.createCommand();return{addParameterAndReturnSqlToken:s=>n.param(s),param:s=>n.param(s),execute:async s=>{if(i)throw"can't run a command after the transaction was completed";return n.execute(s)}}},getLimitSqlSyntax:this.sql.getLimitSqlSyntax,entityIsUsedForTheFirstTime:n=>t.entityIsUsedForTheFirstTime(n),transaction:n=>t.transaction(n),supportsJsonColumnType:this.sql.supportsJsonColumnType,wrapIdentifier:this.wrapIdentifier,end:this.end}))}finally{i=!0}})}static rawFilter(e){return{[qr]:{buildSql:e}}}static async filterToRaw(e,t,i,n,s){i||(i=new jo);const o=Lo(e);var a=new xe(i,n||await Zr(o.metadata,s));return a._addWhere=!1,await(await $e(o)._translateWhereToFilter(t)).__applyToConsumer(a),await a.resolveWhere()}};d(nt,"LogToConsole",!1),d(nt,"durationThreshold",0);let ot=nt;const Bo=new Map([["INSERT",""],["SELECT",""],["UPDATE",""],["DELETE",""],["CREATE",""],["ALTER",""],["DROP",""],["TRUNCATE",""],["GRANT",""],["REVOKE",""]]);class qo{constructor(e,t){d(this,"origin");d(this,"logToConsole");d(this,"args",{});this.origin=e,this.logToConsole=t}addParameterAndReturnSqlToken(e){return this.param(e)}param(e,t){let i=this.origin.param(e);return this.args[i]=e,i}async execute(e){try{let i=new Date,n=await this.origin.execute(e);if(this.logToConsole!==!1){var t=new Date().valueOf()-i.valueOf();if(t>ot.durationThreshold){const s=t/1e3;if(this.logToConsole==="oneLiner"){const o=e.replace(/(\r\n|\n|\r|\t)/gm," ").replace(/  +/g," ").trim(),a=o.split(" ")[0].toUpperCase();console.info(`${Bo.get(a)||""} (${s.toFixed(3)}) ${o} ${JSON.stringify(this.args)}`)}else typeof this.logToConsole=="function"?this.logToConsole(s,e,this.args):console.info(e+`
`,{arguments:this.args,duration:s})}}return n}catch(i){throw console.error((i.message||"Sql Error")+`:
`,e,{arguments:this.args,error:i}),i}}}class Xr{constructor(e,t,i,n){d(this,"entity");d(this,"sql");d(this,"iAmUsed");d(this,"strategy");this.entity=e,this.sql=t,this.iAmUsed=i,this.strategy=n}async init(){let e=await Zr(this.entity,t=>this.sql.wrapIdentifier(t));return await this.iAmUsed(e),e}async count(e){let t=await this.init(),i="select count(*) count from "+t.$entityName,n=this.sql.createCommand();if(e){let s=new xe(n,t);e.__applyToConsumer(s),i+=await s.resolveWhere()}return n.execute(i).then(s=>Number(s.rows[0].count))}async find(e){let t=await this.init(),{colKeys:i,select:n}=this.buildSelect(t);n="select "+n,n+=`
 from `+t.$entityName;let s=this.sql.createCommand();if(e){if(e.where){let o=new xe(s,t);e.where.__applyToConsumer(o),n+=await o.resolveWhere()}if(e.limit&&(e.orderBy=ke.createUniqueSort(this.entity,e.orderBy)),e.orderBy||(e.orderBy=ke.createUniqueSort(this.entity,new ke)),e.orderBy){let o=!0,a=[];for(const l of e.orderBy.Segments)a.push(l);for(const l of a)o?(n+=" Order By ",o=!1):n+=", ",n+=t.$dbNameOf(l.field),l.isDescending&&(n+=" desc"),this.sql._getSourceSql().orderByNullsFirst&&(l.isDescending?n+=" nulls last":n+=" nulls first")}if(e.limit){let o=1;e.page&&(o=e.page),o<1&&(o=1),n+=" "+this.strategy.getLimitSqlSyntax(e.limit,(o-1)*e.limit)}}return s.execute(n).then(o=>o.rows.map(a=>this.buildResultRow(i,a,o)))}buildResultRow(e,t,i){let n={};for(let s=0;s<e.length;s++){const o=e[s];try{n[o.key]=o.valueConverter.fromDb(t[i.getColumnKeyInResultForIndexInSelect(s)])}catch(a){throw new Error("Failed to load from db:"+o.key+`\r
`+a)}}return n}buildSelect(e){let t="",i=[];for(const n of this.entity.fields)n.isServerExpression||(i.length>0&&(t+=", "),t+=e.$dbNameOf(n),i.push(n));return{colKeys:i,select:t}}async update(e,t){let i=await this.init(),n=this.sql.createCommand(),s="update "+i.$entityName+" set ",o=!1;for(const f of this.entity.fields)if(!br(f,i)){if(t[f.key]!==void 0){let h=f.valueConverter.toDb(t[f.key]);h!==void 0&&(o?s+=", ":o=!0,s+=i.$dbNameOf(f)+" = "+n.param(h))}}const a=this.entity.idMetadata.getIdFilter(e);let l=new xe(n,i);F.fromEntityFilter(this.entity,a).__applyToConsumer(l),s+=await l.resolveWhere();let{colKeys:c,select:u}=this.buildSelect(i);return this.sql._getSourceSql().doesNotSupportReturningSyntax||(s+=" returning "+u),n.execute(s).then(f=>{var h,p;if((p=(h=this.sql._getSourceSql()).afterMutation)==null||p.call(h),this.sql._getSourceSql().doesNotSupportReturningSyntax)return vr(this.entity,this,t,e,"update");if(f.rows.length!=1)throw new Error("Failed to update row with id "+e+", rows updated: "+f.rows.length);return this.buildResultRow(c,f.rows[0],f)})}async delete(e){let t=await this.init(),i=this.sql.createCommand(),n=new xe(i,t);F.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(n);let s="delete from "+t.$entityName;return s+=await n.resolveWhere(),i.execute(s).then(()=>{var o,a;(a=(o=this.sql._getSourceSql()).afterMutation)==null||a.call(o)})}async insert(e){let t=await this.init(),i=this.sql.createCommand(),n="",s="",o=!1;for(const u of this.entity.fields)if(!br(u,t)){let f=u.valueConverter.toDb(e[u.key]);f!=null&&(o?(n+=", ",s+=", "):o=!0,n+=t.$dbNameOf(u),s+=i.param(f))}let a=`insert into ${t.$entityName} (${n}) values (${s})`,{colKeys:l,select:c}=this.buildSelect(t);return this.sql._getSourceSql().doesNotSupportReturningSyntax||(a+=" returning "+c),await i.execute(a).then(u=>{var f,h;if((h=(f=this.sql._getSourceSql()).afterMutation)==null||h.call(f),this.sql._getSourceSql().doesNotSupportReturningSyntax)if(Do(this.entity.idMetadata.field)){const p=u.rows[0];if(typeof p!="number")throw new Error("Auto increment, for a database that is does not support returning syntax, should return an array with the single last added id. Instead it returned: "+JSON.stringify(p));return this.find({where:new F(y=>y.isEqualTo(this.entity.idMetadata.field,p))}).then(y=>y[0])}else return vr(this.entity,this,e,void 0,"insert");return this.buildResultRow(l,u.rows[0],u)})}}d(Xr,"LogToConsole",!1);class jo{execute(e){throw new Error("Method not implemented.")}addParameterAndReturnSqlToken(e){return this.param(e)}param(e){return e===null?"null":(e instanceof Date&&(e=e.toISOString()),typeof e=="string"?(e==null&&(e=""),"'"+e.replace(/'/g,"''")+"'"):e.toString())}}function vr(r,e,t,i,n){const s=i!==void 0?r.idMetadata.getIdFilter(i):{};return e.find({where:new F(o=>{for(const a of r.idMetadata.fields)o.isEqualTo(a,t[a.key]??s[a.key])})}).then(o=>{if(o.length!=1)throw new Error(`Failed to ${n} row - result contained ${o.length} rows`);return o[0]})}class xe{constructor(e,t){d(this,"r");d(this,"nameProvider");d(this,"where","");d(this,"_addWhere",!0);d(this,"promises",[]);this.r=e,this.nameProvider=t}async resolveWhere(){for(;this.promises.length>0;){let e=this.promises;this.promises=[];for(const t of e)await t}return this.where}custom(e,t){throw new Error("Custom filter should be translated before it gets here")}or(e){let t="";this.promises.push((async()=>{for(const i of e){let n=new xe(this.r,this.nameProvider);n._addWhere=!1,i.__applyToConsumer(n);let s=await n.resolveWhere();if(!s)return;s.length>0&&(t.length>0&&(t+=" or "),e.length>1?t+="("+s+")":t+=s)}this.addToWhere("("+t+")")})())}isNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is null"))())}isNotNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is not null"))())}isIn(e,t){this.promises.push((async()=>{t&&t.length>0?this.addToWhere(this.nameProvider.$dbNameOf(e)+" in ("+t.map(i=>this.r.param(e.valueConverter.toDb(i))).join(",")+")"):this.addToWhere("1 = 0 /*isIn with no values*/")})())}isEqualTo(e,t){this.add(e,t,"=")}isDifferentFrom(e,t){this.add(e,t,"<>")}isGreaterOrEqualTo(e,t){this.add(e,t,">=")}isGreaterThan(e,t){this.add(e,t,">")}isLessOrEqualTo(e,t){this.add(e,t,"<=")}isLessThan(e,t){this.add(e,t,"<")}containsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}notContainsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("not lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}add(e,t,i){this.promises.push((async()=>{let n=this.nameProvider.$dbNameOf(e)+" "+i+" "+this.r.param(e.valueConverter.toDb(t));this.addToWhere(n)})())}addToWhere(e){this.where.length==0?this._addWhere&&(this.where+=" where "):this.where+=" and ",this.where+=e}databaseCustom(e){this.promises.push((async()=>{if(e!=null&&e.buildSql){let t=new Jo(this.r,this.nameProvider.wrapIdentifier),i=await e.buildSql(t);typeof i!="string"&&(i=t.sql),i&&this.addToWhere("("+i+")")}})())}}class Jo{constructor(e,t){d(this,"r");d(this,"wrapIdentifier");d(this,"sql","");d(this,"param",(e,t)=>(typeof t=="object"&&t.valueConverter.toDb&&(e=t.valueConverter.toDb(e)),this.r.param(e)));d(this,"filterToRaw",async(e,t)=>ot.filterToRaw(e,t,this,void 0,this.wrapIdentifier));this.r=e,this.wrapIdentifier=t,this.param.bind(this),this.filterToRaw.bind(this)}addParameterAndReturnSqlToken(e){return this.param(e)}}function br(r,e){return r.dbReadOnly||r.isServerExpression||r.options.sqlExpression&&r.dbName!=e.$dbNameOf(r)}async function Zr(r,e){let t=typeof e=="function"?{wrapIdentifier:e}:e||{};var i=No(r);t.wrapIdentifier||(t.wrapIdentifier=Oe.dataProvider.wrapIdentifier),t.wrapIdentifier||(t.wrapIdentifier=s=>s);const n={$entityName:await Yr(i,t.wrapIdentifier),toString:()=>n.$entityName,$dbNameOf:s=>{var o;return typeof s=="string"?o=s:o=s.key,n[o]},wrapIdentifier:t.wrapIdentifier};for(const s of i.fields){let o=await Wi(s,i,t.wrapIdentifier);s.options.sqlExpression||(typeof t.tableName=="string"?o=t.wrapIdentifier(t.tableName)+"."+o:t.tableName===!0&&(o=n.$entityName+"."+o)),n[s.key]=o}return n}async function Yr(r,e=t=>t){if(r.options.sqlExpression){if(typeof r.options.sqlExpression=="string")return r.options.sqlExpression;if(typeof r.options.sqlExpression=="function"){const t=r.options.sqlExpression;try{return r.options.sqlExpression="recursive sqlExpression call for entity '"+r.key+"'. ",await t(r)}finally{r.options.sqlExpression=t}}}return e(r.dbName)}async function Wi(r,e,t=i=>i){try{if(r.options.sqlExpression){let s;if(typeof r.options.sqlExpression=="function"){const o=r.options.sqlExpression;try{r.options.sqlExpression="recursive sqlExpression call for field '"+r.key+"'. ",s=await o(e),r.options.sqlExpression=()=>s}finally{}}else s=r.options.sqlExpression;return s||r.dbName}const i=re(r);let n=(i==null?void 0:i.type)==="toOne"&&r.options.field;if(n){let s=e.fields.find(n);if(s)return Wi(s,e,t)}return t(r.dbName)}finally{}}var Qt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qe={},X={},le={};Object.defineProperty(le,"__esModule",{value:!0});le.output=le.exists=le.hash=le.bytes=le.bool=le.number=le.isBytes=void 0;function xt(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}le.number=xt;function en(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}le.bool=en;function tn(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}le.isBytes=tn;function Qi(r,...e){if(!tn(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}le.bytes=Qi;function rn(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xt(r.outputLen),xt(r.blockLen)}le.hash=rn;function nn(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}le.exists=nn;function sn(r,e){Qi(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}le.output=sn;const Uo={number:xt,bool:en,bytes:Qi,hash:rn,exists:nn,output:sn};le.default=Uo;var A={};Object.defineProperty(A,"__esModule",{value:!0});A.add5L=A.add5H=A.add4H=A.add4L=A.add3H=A.add3L=A.add=A.rotlBL=A.rotlBH=A.rotlSL=A.rotlSH=A.rotr32L=A.rotr32H=A.rotrBL=A.rotrBH=A.rotrSL=A.rotrSH=A.shrSL=A.shrSH=A.toBig=A.split=A.fromBig=void 0;const Bt=BigInt(2**32-1),ki=BigInt(32);function xi(r,e=!1){return e?{h:Number(r&Bt),l:Number(r>>ki&Bt)}:{h:Number(r>>ki&Bt)|0,l:Number(r&Bt)|0}}A.fromBig=xi;function on(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let n=0;n<r.length;n++){const{h:s,l:o}=xi(r[n],e);[t[n],i[n]]=[s,o]}return[t,i]}A.split=on;const an=(r,e)=>BigInt(r>>>0)<<ki|BigInt(e>>>0);A.toBig=an;const ln=(r,e,t)=>r>>>t;A.shrSH=ln;const un=(r,e,t)=>r<<32-t|e>>>t;A.shrSL=un;const fn=(r,e,t)=>r>>>t|e<<32-t;A.rotrSH=fn;const cn=(r,e,t)=>r<<32-t|e>>>t;A.rotrSL=cn;const dn=(r,e,t)=>r<<64-t|e>>>t-32;A.rotrBH=dn;const hn=(r,e,t)=>r>>>t-32|e<<64-t;A.rotrBL=hn;const pn=(r,e)=>e;A.rotr32H=pn;const yn=(r,e)=>r;A.rotr32L=yn;const mn=(r,e,t)=>r<<t|e>>>32-t;A.rotlSH=mn;const wn=(r,e,t)=>e<<t|r>>>32-t;A.rotlSL=wn;const gn=(r,e,t)=>e<<t-32|r>>>64-t;A.rotlBH=gn;const vn=(r,e,t)=>r<<t-32|e>>>64-t;A.rotlBL=vn;function bn(r,e,t,i){const n=(e>>>0)+(i>>>0);return{h:r+t+(n/2**32|0)|0,l:n|0}}A.add=bn;const _n=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0);A.add3L=_n;const kn=(r,e,t,i)=>e+t+i+(r/2**32|0)|0;A.add3H=kn;const In=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0);A.add4L=In;const On=(r,e,t,i,n)=>e+t+i+n+(r/2**32|0)|0;A.add4H=On;const En=(r,e,t,i,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(n>>>0);A.add5L=En;const Sn=(r,e,t,i,n,s)=>e+t+i+n+s+(r/2**32|0)|0;A.add5H=Sn;const Vo={fromBig:xi,split:on,toBig:an,shrSH:ln,shrSL:un,rotrSH:fn,rotrSL:cn,rotrBH:dn,rotrBL:hn,rotr32H:pn,rotr32L:yn,rotlSH:mn,rotlSL:wn,rotlBH:gn,rotlBL:vn,add:bn,add3L:_n,add3H:kn,add4L:In,add4H:On,add5H:Sn,add5L:En};A.default=Vo;var Cn={},Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.crypto=void 0;Xt.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(r){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(r,"__esModule",{value:!0}),r.randomBytes=r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.checkOpts=r.Hash=r.concatBytes=r.toBytes=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.byteSwap32=r.byteSwapIfBE=r.byteSwap=r.isLE=r.rotl=r.rotr=r.createView=r.u32=r.u8=r.isBytes=void 0;const e=Xt,t=le;function i(b){return b instanceof Uint8Array||b!=null&&typeof b=="object"&&b.constructor.name==="Uint8Array"}r.isBytes=i;const n=b=>new Uint8Array(b.buffer,b.byteOffset,b.byteLength);r.u8=n;const s=b=>new Uint32Array(b.buffer,b.byteOffset,Math.floor(b.byteLength/4));r.u32=s;const o=b=>new DataView(b.buffer,b.byteOffset,b.byteLength);r.createView=o;const a=(b,P)=>b<<32-P|b>>>P;r.rotr=a;const l=(b,P)=>b<<P|b>>>32-P>>>0;r.rotl=l,r.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const c=b=>b<<24&4278190080|b<<8&16711680|b>>>8&65280|b>>>24&255;r.byteSwap=c,r.byteSwapIfBE=r.isLE?b=>b:b=>(0,r.byteSwap)(b);function u(b){for(let P=0;P<b.length;P++)b[P]=(0,r.byteSwap)(b[P])}r.byteSwap32=u;const f=Array.from({length:256},(b,P)=>P.toString(16).padStart(2,"0"));function h(b){(0,t.bytes)(b);let P="";for(let ee=0;ee<b.length;ee++)P+=f[b[ee]];return P}r.bytesToHex=h;const p={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function y(b){if(b>=p._0&&b<=p._9)return b-p._0;if(b>=p._A&&b<=p._F)return b-(p._A-10);if(b>=p._a&&b<=p._f)return b-(p._a-10)}function v(b){if(typeof b!="string")throw new Error("hex string expected, got "+typeof b);const P=b.length,ee=P/2;if(P%2)throw new Error("padded hex string expected, got unpadded hex of length "+P);const z=new Uint8Array(ee);for(let se=0,ce=0;se<ee;se++,ce+=2){const ct=y(b.charCodeAt(ce)),dt=y(b.charCodeAt(ce+1));if(ct===void 0||dt===void 0){const Pt=b[ce]+b[ce+1];throw new Error('hex string expected, got non-hex character "'+Pt+'" at index '+ce)}z[se]=ct*16+dt}return z}r.hexToBytes=v;const w=async()=>{};r.nextTick=w;async function I(b,P,ee){let z=Date.now();for(let se=0;se<b;se++){ee(se);const ce=Date.now()-z;ce>=0&&ce<P||(await(0,r.nextTick)(),z+=ce)}}r.asyncLoop=I;function k(b){if(typeof b!="string")throw new Error(`utf8ToBytes expected string, got ${typeof b}`);return new Uint8Array(new TextEncoder().encode(b))}r.utf8ToBytes=k;function G(b){return typeof b=="string"&&(b=k(b)),(0,t.bytes)(b),b}r.toBytes=G;function K(...b){let P=0;for(let z=0;z<b.length;z++){const se=b[z];(0,t.bytes)(se),P+=se.length}const ee=new Uint8Array(P);for(let z=0,se=0;z<b.length;z++){const ce=b[z];ee.set(ce,se),se+=ce.length}return ee}r.concatBytes=K;class H{clone(){return this._cloneInto()}}r.Hash=H;const B={}.toString;function Y(b,P){if(P!==void 0&&B.call(P)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(b,P)}r.checkOpts=Y;function De(b){const P=z=>b().update(G(z)).digest(),ee=b();return P.outputLen=ee.outputLen,P.blockLen=ee.blockLen,P.create=()=>b(),P}r.wrapConstructor=De;function Se(b){const P=(z,se)=>b(se).update(G(z)).digest(),ee=b({});return P.outputLen=ee.outputLen,P.blockLen=ee.blockLen,P.create=z=>b(z),P}r.wrapConstructorWithOpts=Se;function q(b){const P=(z,se)=>b(se).update(G(z)).digest(),ee=b({});return P.outputLen=ee.outputLen,P.blockLen=ee.blockLen,P.create=z=>b(z),P}r.wrapXOFConstructorWithOpts=q;function $(b=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(b));throw new Error("crypto.getRandomValues must be defined")}r.randomBytes=$})(Cn);Object.defineProperty(X,"__esModule",{value:!0});X.shake256=X.shake128=X.keccak_512=X.keccak_384=X.keccak_256=X.keccak_224=X.sha3_512=X.sha3_384=X.sha3_256=X.sha3_224=X.Keccak=X.keccakP=void 0;const it=le,Et=A,Me=Cn,Tn=[],An=[],Pn=[],Ko=BigInt(0),pt=BigInt(1),Ho=BigInt(2),Wo=BigInt(7),Qo=BigInt(256),xo=BigInt(113);for(let r=0,e=pt,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Tn.push(2*(5*i+t)),An.push((r+1)*(r+2)/2%64);let n=Ko;for(let s=0;s<7;s++)e=(e<<pt^(e>>Wo)*xo)%Qo,e&Ho&&(n^=pt<<(pt<<BigInt(s))-pt);Pn.push(n)}const[Go,$o]=(0,Et.split)(Pn,!0),_r=(r,e,t)=>t>32?(0,Et.rotlBH)(r,e,t):(0,Et.rotlSH)(r,e,t),kr=(r,e,t)=>t>32?(0,Et.rotlBL)(r,e,t):(0,Et.rotlSL)(r,e,t);function Fn(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=t[l],u=t[l+1],f=_r(c,u,1)^t[a],h=kr(c,u,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=f,r[o+p+1]^=h}let n=r[2],s=r[3];for(let o=0;o<24;o++){const a=An[o],l=_r(n,s,a),c=kr(n,s,a),u=Tn[o];n=r[u],s=r[u+1],r[u]=l,r[u+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Go[i],r[1]^=$o[i]}t.fill(0)}X.keccakP=Fn;class At extends Me.Hash{constructor(e,t,i,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,it.number)(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,Me.u32)(this.state)}keccak(){Me.isLE||(0,Me.byteSwap32)(this.state32),Fn(this.state32,this.rounds),Me.isLE||(0,Me.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,it.exists)(this);const{blockLen:t,state:i}=this;e=(0,Me.toBytes)(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(t-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:n}=this;e[i]^=t,t&128&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){(0,it.exists)(this,!1),(0,it.bytes)(e),this.finish();const t=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(t.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,it.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,it.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new At(t,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}X.Keccak=At;const je=(r,e,t)=>(0,Me.wrapConstructor)(()=>new At(e,r,t));X.sha3_224=je(6,144,224/8);X.sha3_256=je(6,136,256/8);X.sha3_384=je(6,104,384/8);X.sha3_512=je(6,72,512/8);X.keccak_224=je(1,144,224/8);X.keccak_256=je(1,136,256/8);X.keccak_384=je(1,104,384/8);X.keccak_512=je(1,72,512/8);const Dn=(r,e,t)=>(0,Me.wrapXOFConstructorWithOpts)((i={})=>new At(e,r,i.dkLen===void 0?t:i.dkLen,!0));X.shake128=Dn(31,168,128/8);X.shake256=Dn(31,136,256/8);const{sha3_512:zo}=X,Rn=24,kt=32,Ii=(r=4,e=Math.random)=>{let t="";for(;t.length<r;)t=t+Math.floor(e()*36).toString(36);return t};function Mn(r){let e=8n,t=0n;for(const i of r.values()){const n=BigInt(i);t=(t<<e)+n}return t}const Nn=(r="")=>Mn(zo(r)).toString(36).slice(1),Ir=Array.from({length:26},(r,e)=>String.fromCharCode(e+97)),Xo=r=>Ir[Math.floor(r()*Ir.length)],Ln=({globalObj:r=typeof Qt<"u"?Qt:typeof window<"u"?window:{},random:e=Math.random}={})=>{const t=Object.keys(r).toString(),i=t.length?t+Ii(kt,e):Ii(kt,e);return Nn(i).substring(0,kt)},Bn=r=>()=>r++,Zo=476782367,qn=({random:r=Math.random,counter:e=Bn(Math.floor(r()*Zo)),length:t=Rn,fingerprint:i=Ln({random:r})}={})=>function(){const s=Xo(r),o=Date.now().toString(36),a=e().toString(36),l=Ii(t,r),c=`${o+l+a+i}`;return`${s+Nn(c).substring(1,t)}`},Yo=qn(),ea=(r,{minLength:e=2,maxLength:t=kt}={})=>{const i=r.length,n=/^[0-9a-z]+$/;try{if(typeof r=="string"&&i>=e&&i<=t&&n.test(r))return!0}finally{}return!1};qe.getConstants=()=>({defaultLength:Rn,bigLength:kt});qe.init=qn;qe.createId=Yo;qe.bufToBigInt=Mn;qe.createCounter=Bn;qe.createFingerprint=Ln;qe.isCuid=ea;const{createId:ta,init:ma,getConstants:wa,isCuid:ga}=qe;var Or=ta;const Er=jt(r=>!isNaN(r)&&isFinite(r));class Gi{static object(...e){return be(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),be(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return be(()=>Date,{valueConverter:pe.DateOnly},...e)}static date(...e){return be(()=>Date,...e)}static integer(...e){return be(()=>Number,{valueConverter:pe.Integer,validate:Er},...e)}static autoIncrement(...e){return be(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...pe.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return be(()=>Number,{validate:Er},...e)}static createdAt(...e){return be(()=>Date,{allowApiUpdate:!1,saving:(t,i,{isNew:n})=>{n&&(i.value=new Date)}},...e)}static updatedAt(...e){return be(()=>Date,{allowApiUpdate:!1,saving:(t,i)=>{i.value=new Date}},...e)}static uuid(...e){return be(()=>String,{allowApiUpdate:!1,defaultValue:()=>gi(),saving:(t,i)=>{i.value||(i.value=gi())}},...e)}static cuid(...e){return be(()=>String,{allowApiUpdate:!1,defaultValue:()=>Or(),saving:(t,i)=>{i.value||(i.value=Or())}},...e)}static literal(e,...t){return Gi.string({validate:(i,n)=>Ne.in(e())(i,n),[fi]:e},...t)}static enum(e,...t){let i;return be(()=>e(),{validate:(n,s)=>Ne.enum(e())(n,s),[fi]:()=>Jt(e())},...t,n=>{if(n[fi]=()=>Jt(e()),i===void 0){let s=e();i=Jt(s).find(a=>typeof a=="string")?pe.String:pe.Integer}n.valueConverter?n.valueConverter.fieldTypeInDb||(n.valueConverter.fieldTypeInDb=i.fieldTypeInDb):n.valueConverter=i})}static string(...e){return be(()=>String,...e)}static boolean(...e){return be(()=>Boolean,...e)}}function be(r,...e){return(t,i,n)=>{const s=typeof i=="string"?i:i.name.toString();let o=c=>{let u=$r(e,c);u.required&&(u.validate=Ut(u.validate,Ne.required,!0)),u.maxLength&&(u.validate=Ut(u.validate,Ne.maxLength(u.maxLength))),u.minLength&&(u.validate=Ut(u.validate,Ne.minLength(u.minLength))),!u.valueType&&r&&(u.valueType=r()),u.key||(u.key=s),u.dbName||(u.dbName=u.key);let f=u.valueType;return f||(f=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],u.valueType=f),u.target||(u.target=t),u};jn(t);let a=S.columnsOfType.get(t.constructor);a||(a=[],S.columnsOfType.set(t.constructor,a));let l=a.find(c=>c.key==s);if(!l)a.push({key:s,settings:o});else{let c=l.settings;l.settings=u=>{let f=c(u),h=o(u);return Object.assign(f,h)}}}}function jn(r){if(!r)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function ia(r,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function ra(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}class na extends zr{constructor(){super(...arguments);d(this,"id")}}ia([Gi.uuid(),ra("design:type",String)],na.prototype,"id",void 0);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Sr;(function(r){(function(e){var t=typeof Qt=="object"?Qt:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),i=n(r);typeof t.Reflect>"u"?t.Reflect=r:i=n(t.Reflect,i),e(i);function n(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",n=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,c={create:o?function(){return ei(Object.create(null))}:a?function(){return ei({__proto__:null})}:function(){return ei({})},has:l?function(m,g){return t.call(m,g)}:function(m,g){return g in m},get:l?function(m,g){return t.call(m,g)?m[g]:void 0}:function(m,g){return m[g]}},u=Object.getPrototypeOf(Function),f=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!f&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:vs(),p=!f&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:bs(),y=!f&&typeof WeakMap=="function"?WeakMap:_s(),v=new y;function w(m,g,_,O){if(oe(_)){if(!$i(m))throw new TypeError;if(!zi(g))throw new TypeError;return q(m,g)}else{if(!$i(m))throw new TypeError;if(!de(g))throw new TypeError;if(!de(O)&&!oe(O)&&!Ye(O))throw new TypeError;return Ye(O)&&(O=void 0),_=Re(_),$(m,g,_,O)}}e("decorate",w);function I(m,g){function _(O,C){if(!de(O))throw new TypeError;if(!oe(C)&&!ps(C))throw new TypeError;ce(m,g,O,C)}return _}e("metadata",I);function k(m,g,_,O){if(!de(_))throw new TypeError;return oe(O)||(O=Re(O)),ce(m,g,_,O)}e("defineMetadata",k);function G(m,g,_){if(!de(g))throw new TypeError;return oe(_)||(_=Re(_)),P(m,g,_)}e("hasMetadata",G);function K(m,g,_){if(!de(g))throw new TypeError;return oe(_)||(_=Re(_)),ee(m,g,_)}e("hasOwnMetadata",K);function H(m,g,_){if(!de(g))throw new TypeError;return oe(_)||(_=Re(_)),z(m,g,_)}e("getMetadata",H);function B(m,g,_){if(!de(g))throw new TypeError;return oe(_)||(_=Re(_)),se(m,g,_)}e("getOwnMetadata",B);function Y(m,g){if(!de(m))throw new TypeError;return oe(g)||(g=Re(g)),ct(m,g)}e("getMetadataKeys",Y);function De(m,g){if(!de(m))throw new TypeError;return oe(g)||(g=Re(g)),dt(m,g)}e("getOwnMetadataKeys",De);function Se(m,g,_){if(!de(g))throw new TypeError;oe(_)||(_=Re(_));var O=b(g,_,!1);if(oe(O)||!O.delete(m))return!1;if(O.size>0)return!0;var C=v.get(g);return C.delete(_),C.size>0||v.delete(g),!0}e("deleteMetadata",Se);function q(m,g){for(var _=m.length-1;_>=0;--_){var O=m[_],C=O(g);if(!oe(C)&&!Ye(C)){if(!zi(C))throw new TypeError;g=C}}return g}function $(m,g,_,O){for(var C=m.length-1;C>=0;--C){var ve=m[C],D=ve(g,_,O);if(!oe(D)&&!Ye(D)){if(!de(D))throw new TypeError;O=D}}return O}function b(m,g,_){var O=v.get(m);if(oe(O)){if(!_)return;O=new h,v.set(m,O)}var C=O.get(g);if(oe(C)){if(!_)return;C=new h,O.set(g,C)}return C}function P(m,g,_){var O=ee(m,g,_);if(O)return!0;var C=Yt(g);return Ye(C)?!1:P(m,C,_)}function ee(m,g,_){var O=b(g,_,!1);return oe(O)?!1:ds(O.has(m))}function z(m,g,_){var O=ee(m,g,_);if(O)return se(m,g,_);var C=Yt(g);if(!Ye(C))return z(m,C,_)}function se(m,g,_){var O=b(g,_,!1);if(!oe(O))return O.get(m)}function ce(m,g,_,O){var C=b(_,O,!0);C.set(m,g)}function ct(m,g){var _=dt(m,g),O=Yt(m);if(O===null)return _;var C=ct(O,g);if(C.length<=0)return _;if(_.length<=0)return C;for(var ve=new p,D=[],M=0,T=_;M<T.length;M++){var J=T[M],U=ve.has(J);U||(ve.add(J),D.push(J))}for(var Le=0,Zi=C;Le<Zi.length;Le++){var J=Zi[Le],U=ve.has(J);U||(ve.add(J),D.push(J))}return D}function dt(m,g){var _=[],O=b(m,g,!1);if(oe(O))return _;for(var C=O.keys(),ve=ys(C),D=0;;){var M=ws(ve);if(!M)return _.length=D,_;var T=ms(M);try{_[D]=T}catch(J){try{gs(ve)}finally{throw J}}D++}}function Pt(m){if(m===null)return 1;switch(typeof m){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return m===null?1:6;default:return 6}}function oe(m){return m===void 0}function Ye(m){return m===null}function us(m){return typeof m=="symbol"}function de(m){return typeof m=="object"?m!==null:typeof m=="function"}function fs(m,g){switch(Pt(m)){case 0:return m;case 1:return m;case 2:return m;case 3:return m;case 4:return m;case 5:return m}var _="string",O=Xi(m,n);if(O!==void 0){var C=O.call(m,_);if(de(C))throw new TypeError;return C}return cs(m)}function cs(m,g){var _,O;{var C=m.toString;if(Ft(C)){var O=C.call(m);if(!de(O))return O}var _=m.valueOf;if(Ft(_)){var O=_.call(m);if(!de(O))return O}}throw new TypeError}function ds(m){return!!m}function hs(m){return""+m}function Re(m){var g=fs(m);return us(g)?g:hs(g)}function $i(m){return Array.isArray?Array.isArray(m):m instanceof Object?m instanceof Array:Object.prototype.toString.call(m)==="[object Array]"}function Ft(m){return typeof m=="function"}function zi(m){return typeof m=="function"}function ps(m){switch(Pt(m)){case 3:return!0;case 4:return!0;default:return!1}}function Xi(m,g){var _=m[g];if(_!=null){if(!Ft(_))throw new TypeError;return _}}function ys(m){var g=Xi(m,s);if(!Ft(g))throw new TypeError;var _=g.call(m);if(!de(_))throw new TypeError;return _}function ms(m){return m.value}function ws(m){var g=m.next();return g.done?!1:g}function gs(m){var g=m.return;g&&g.call(m)}function Yt(m){var g=Object.getPrototypeOf(m);if(typeof m!="function"||m===u||g!==u)return g;var _=m.prototype,O=_&&Object.getPrototypeOf(_);if(O==null||O===Object.prototype)return g;var C=O.constructor;return typeof C!="function"||C===m?g:C}function vs(){var m={},g=[],_=function(){function D(M,T,J){this._index=0,this._keys=M,this._values=T,this._selector=J}return D.prototype["@@iterator"]=function(){return this},D.prototype[s]=function(){return this},D.prototype.next=function(){var M=this._index;if(M>=0&&M<this._keys.length){var T=this._selector(this._keys[M],this._values[M]);return M+1>=this._keys.length?(this._index=-1,this._keys=g,this._values=g):this._index++,{value:T,done:!1}}return{value:void 0,done:!0}},D.prototype.throw=function(M){throw this._index>=0&&(this._index=-1,this._keys=g,this._values=g),M},D.prototype.return=function(M){return this._index>=0&&(this._index=-1,this._keys=g,this._values=g),{value:M,done:!0}},D}();return function(){function D(){this._keys=[],this._values=[],this._cacheKey=m,this._cacheIndex=-2}return Object.defineProperty(D.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),D.prototype.has=function(M){return this._find(M,!1)>=0},D.prototype.get=function(M){var T=this._find(M,!1);return T>=0?this._values[T]:void 0},D.prototype.set=function(M,T){var J=this._find(M,!0);return this._values[J]=T,this},D.prototype.delete=function(M){var T=this._find(M,!1);if(T>=0){for(var J=this._keys.length,U=T+1;U<J;U++)this._keys[U-1]=this._keys[U],this._values[U-1]=this._values[U];return this._keys.length--,this._values.length--,M===this._cacheKey&&(this._cacheKey=m,this._cacheIndex=-2),!0}return!1},D.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=m,this._cacheIndex=-2},D.prototype.keys=function(){return new _(this._keys,this._values,O)},D.prototype.values=function(){return new _(this._keys,this._values,C)},D.prototype.entries=function(){return new _(this._keys,this._values,ve)},D.prototype["@@iterator"]=function(){return this.entries()},D.prototype[s]=function(){return this.entries()},D.prototype._find=function(M,T){return this._cacheKey!==M&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=M)),this._cacheIndex<0&&T&&(this._cacheIndex=this._keys.length,this._keys.push(M),this._values.push(void 0)),this._cacheIndex},D}();function O(D,M){return D}function C(D,M){return M}function ve(D,M){return[D,M]}}function bs(){return function(){function m(){this._map=new h}return Object.defineProperty(m.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),m.prototype.has=function(g){return this._map.has(g)},m.prototype.add=function(g){return this._map.set(g,g),this},m.prototype.delete=function(g){return this._map.delete(g)},m.prototype.clear=function(){this._map.clear()},m.prototype.keys=function(){return this._map.keys()},m.prototype.values=function(){return this._map.values()},m.prototype.entries=function(){return this._map.entries()},m.prototype["@@iterator"]=function(){return this.keys()},m.prototype[s]=function(){return this.keys()},m}()}function _s(){var m=16,g=c.create(),_=O();return function(){function T(){this._key=O()}return T.prototype.has=function(J){var U=C(J,!1);return U!==void 0?c.has(U,this._key):!1},T.prototype.get=function(J){var U=C(J,!1);return U!==void 0?c.get(U,this._key):void 0},T.prototype.set=function(J,U){var Le=C(J,!0);return Le[this._key]=U,this},T.prototype.delete=function(J){var U=C(J,!1);return U!==void 0?delete U[this._key]:!1},T.prototype.clear=function(){this._key=O()},T}();function O(){var T;do T="@@WeakMap@@"+M();while(c.has(g,T));return g[T]=!0,T}function C(T,J){if(!t.call(T,_)){if(!J)return;Object.defineProperty(T,_,{value:c.create()})}return T[_]}function ve(T,J){for(var U=0;U<J;++U)T[U]=Math.random()*255|0;return T}function D(T){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(T)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(T)):ve(new Uint8Array(T),T):ve(new Array(T),T)}function M(){var T=D(m);T[6]=T[6]&79|64,T[8]=T[8]&191|128;for(var J="",U=0;U<m;++U){var Le=T[U];(U===4||U===6||U===8)&&(J+="-"),Le<16&&(J+="0"),J+=Le.toString(16).toLowerCase()}return J}}function ei(m){return m.__=void 0,delete m.__,m}})})(Sr||(Sr={}));const Gt=class Gt{constructor(e,t,i){d(this,"actionUrl");d(this,"queue");d(this,"allowed");d(this,"doWork");this.actionUrl=e,this.queue=t,this.allowed=i}async run(e,t,i){t===void 0&&(t=Oe.apiClient.url),i||(i=Tt(Oe.apiClient.httpClient));let n=await i.post(t+"/"+this.actionUrl,e),s=n;if(s&&s.queuedJobId){let o=S.actionInfo.startBusyWithProgress();try{let a;if(await S.actionInfo.runActionWithoutBlockingUI(async()=>{for(;!a||!a.done;)a&&await new Promise(l=>setTimeout(()=>{l(void 0)},200)),a=await i.post(t+"/"+Gt.apiUrlForJobStatus,{queuedJobId:n.queuedJobId}),a.progress&&o.progress(a.progress)}),a.error)throw a.error;return o.progress(1),a.result}finally{o.close()}}else return n}__register(e){e(this.actionUrl,this.queue,this.allowed,async(t,i,n)=>{try{var s=await this.execute(t,i,n);n.success(s)}catch(o){o.isForbiddenError?n.forbidden():n.error(o,void 0)}})}};d(Gt,"apiUrlForJobStatus","jobStatusInQueue");let St=Gt;class Oi extends Error{constructor(t="Forbidden"){super(t);d(this,"isForbiddenError",!0)}}class sa extends St{constructor(t,i,n,s){super(t,n.queue,n.allowed);d(this,"types");d(this,"options");d(this,"originalMethod");this.types=i,this.options=n,this.originalMethod=s}async execute(t,i,n){let s={data:{}},o=i.dataProvider;return await Hr(i,async()=>{if(!i.isAllowedForInstance(void 0,this.options.allowed))throw new Oi;t.args=await Un(this.types(),t.args,i,o,n);try{s.data=await this.originalMethod(t.args)}catch(a){throw a}}),s}}function Pe(r){return(e,t,i)=>{const n=typeof t=="string"?t:t.name.toString(),s=i?i.value:e;let o=s;jn(e);function a(){var u=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:paramtypes",e,n):[];return r.paramTypes&&(u=typeof r.paramTypes=="function"?r.paramTypes():r.paramTypes),u}if(e.prototype!==void 0){let u=new sa((r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+n,()=>a(),r,f=>s.apply(void 0,f));return u.doWork=async(f,h,p,y)=>(f=Ar(a(),f),r.blockUser===!1?await S.actionInfo.runActionWithoutBlockingUI(async()=>(await u.run({args:f},p,y)).data):(await u.run({args:f},p,y)).data),o=async function(...f){return bi()?await s.apply(this,f):await u.doWork(f,void 0)},Cr(e,o),o[vi]=u,i?(i.value=o,i):o}let l=S.classHelpers.get(e.constructor);l||(l=new bo,S.classHelpers.set(e.constructor,l));let c={__register(u){let f=new Te;for(const h of l.classes.keys()){let p=l.classes.get(h);p.key||(p.key=f.repo(h).metadata.key),u(p.key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+n,r?r.queue:!1,r.allowed,async(y,v,w)=>{y.args=y.args.map(k=>Jn(k)?void 0:k);let I=r.allowed;try{let k=v,G;await Hr(k,async()=>{if(y.args=await Un(a(),y.args,k,k.dataProvider,w),S.allEntities.includes(h)){let K=k.repo(h),H;if(y.rowInfo.isNewRow)H=K.create(),await K.getEntityRef(H)._updateEntityBasedOnApi(y.rowInfo.data);else{let Y=await K.find({where:{...K.metadata.idMetadata.getIdFilter(y.rowInfo.id),$and:[K.metadata.options.apiPrefilter]}});if(Y.length!=1)throw new Error("not found or too many matches");H=Y[0],await K.getEntityRef(H)._updateEntityBasedOnApi(y.rowInfo.data)}if(!k.isAllowedForInstance(H,I))throw new Oi;let B=te(H);await B.__validateEntity();try{G={result:await s.apply(H,y.args),rowInfo:{data:await B.toApiJson(),isNewRow:B.isNew(),wasChanged:B.wasChanged(),id:B.getOriginalId()}}}catch(Y){throw B.catchSaveErrors(Y)}}else{let K=new h(k,k.dataProvider),H=gr(K,k);if(await H._updateEntityBasedOnApi(y.fields),!k.isAllowedForInstance(K,I))throw new Oi;await H.__validateEntity();try{G={result:await s.apply(K,y.args),fields:await H.toApiJson()}}catch(B){throw H.catchSaveErrors(B)}}}),w.success(G)}catch(k){k.isForbiddenError?w.forbidden():w.error(k,void 0)}})}},doWork:async function(u,f,h,p){if(u=Ar(a(),u),S.allEntities.includes(e.constructor)){let y=te(f);await y.__validateEntity();let v=l.classes.get(f.constructor);v.key||(v.key=y.repository.metadata.key+"_methods");try{let w=await new class extends St{constructor(){super(...arguments);d(this,"execute")}}(v.key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+n,r?r.queue:!1,r.allowed).run({args:u,rowInfo:{data:await y.toApiJson(),isNewRow:y.isNew(),wasChanged:y.wasChanged(),id:y.getOriginalId()}},h,p);return await y._updateEntityBasedOnApi(w.rowInfo.data,!0),w.result}catch(w){throw y.catchSaveErrors(w)}}else{let y=gr(f,void 0);try{await y.__validateEntity();let v=await new class extends St{constructor(){super(...arguments);d(this,"execute")}}(l.classes.get(f.constructor).key+"/"+(r!=null&&r.apiPrefix?r.apiPrefix+"/":"")+n,r?r.queue:!1,r.allowed).run({args:u,fields:await y.toApiJson()},h,p);return await y._updateEntityBasedOnApi(v.fields),v.result}catch(v){throw y.catchSaveErrors(v)}}}};return o=async function(...u){if(bi())return await s.apply(this,u);{let f=this;return c.doWork(u,f)}},Cr(e.constructor,o),o[vi]=c,i?(i.value=o,i):o}}const oa={_isUndefined:!0};function Cr(r,e){(r[Pr]||(r[Pr]=[])).push(e),S.actionInfo.allActions.push(e)}function Jn(r){return r&&r._isUndefined}class Tr{constructor(e){d(this,"res");this.res=e}progress(e){this.res.progress(e)}}function Ar(r,e){if(r)for(let t=0;t<r.length;t++){const i=r[t];for(const n of[Te,ot])(e[t]instanceof n||i==n)&&(e[t]=void 0);if(e[t]!=null){let n={valueType:i};if(n=Hi(n,new Te),Ie(i,!1)!=null){let o=te(e[t]);e[t]=o.getId()}n.valueConverter&&(e[t]=n.valueConverter.toJson(e[t]))}}return e.map(t=>t!==void 0?t:oa)}async function Un(r,e,t,i,n){for(let s=0;s<e.length;s++){const o=e[s];Jn(o)&&(e[s]=void 0)}if(r)for(let s=0;s<r.length;s++)if(e.length<s&&e.push(void 0),r[s]==Te||r[s]==Te)e[s]=t;else if(r[s]==ot&&i)e[s]=i;else if(r[s]==Tr)e[s]=new Tr(n);else{let o={valueType:r[s]};o=Hi(o,t),o.valueConverter&&(e[s]=o.valueConverter.fromJson(e[s])),Ie(r[s],!1)!=null&&(e[s]===null||e[s]===void 0||(e[s]=await t.repo(r[s]).findId(e[s])))}return e}const Pr=Symbol.for("classBackendMethodsArray");S.actionInfo;function Zt(r){return r}var aa=Object.defineProperty,la=Object.getOwnPropertyDescriptor,Fe=(r,e,t,i)=>{for(var n=la(e,t),s=r.length-1,o;s>=0;s--)(o=r[s])&&(n=o(e,t,n)||n);return n&&aa(e,t,n),n};class ue{static async signOut(){}static async signInDemo(){}static async invite(){}static async signUpPassword(){}static async signInPassword(){}static async forgotPassword(){}static async resetPassword(){}static async signInOTP(){}static async verifyOtp(){}static async signInOAuthGetUrl(){}}Fe([Pe({})],ue,"signOut");Fe([Pe({})],ue,"signInDemo");Fe([Pe({})],ue,"invite");Fe([Pe({})],ue,"signUpPassword");Fe([Pe({})],ue,"signInPassword");Fe([Pe({})],ue,"forgotPassword");Fe([Pe({})],ue,"resetPassword");Fe([Pe({})],ue,"signInOTP");Fe([Pe({})],ue,"verifyOtp");Fe([Pe({})],ue,"signInOAuthGetUrl");function ft(r){r.focus()}const yt="src/lib/modules/auth/components/ForgotPassword.svelte";function Ei(r){let e,t,i,n,s,o,a,l,c,u,f=r[1].ui.providers.password.dico.send_password_reset_instructions+"",h,p,y;const v={c:function(){e=N("div"),t=N("p"),i=ne(r[2]),n=ne(r[3]),s=x(),o=N("form"),a=N("input"),c=x(),u=N("button"),h=ne(f),V(t,"class","message"),Be(t,"error",r[2]),L(t,yt,27,2,550),V(a,"type","text"),V(a,"placeholder",l=r[1].ui.providers.password.dico.email_placeholder),L(a,yt,29,4,666),L(u,yt,35,4,830),V(o,"class","svelte-wa5ykb"),L(o,yt,28,2,621),V(e,"class","login"),L(e,yt,26,0,528)},l:function(I){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(I,k){W(I,e,k),E(e,t),E(t,i),E(t,n),E(e,s),E(e,o),E(o,a),_e(a,r[0]),E(o,c),E(o,u),E(u,h),p||(y=[$t(ft.call(null,a)),Ee(a,"input",r[5]),Ee(o,"submit",zt(r[4]),!1,!0,!1,!1)],p=!0)},p:function(I,[k]){k&4&&ye(i,I[2]),k&4&&Be(t,"error",I[2]),k&2&&l!==(l=I[1].ui.providers.password.dico.email_placeholder)&&V(a,"placeholder",l),k&1&&a.value!==I[0]&&_e(a,I[0]),k&2&&f!==(f=I[1].ui.providers.password.dico.send_password_reset_instructions+"")&&ye(h,f)},i:ae,o:ae,d:function(I){I&&Q(e),p=!1,at(y)}};return j("SvelteRegisterBlock",{block:v,id:Ei.name,type:"component",source:"",ctx:r}),v}function ua(r,e,t){let{$$slots:i={},$$scope:n}=e;Ze("ForgotPassword",i,[]);let{remultKitDataAuth:s}=e,{email:o=""}=e,a="",l="";async function c(){try{await ue.forgotPassword(o),window.location.href="/kit/auth/sign-in"}catch(h){h&&t(2,a=h.message??"")}}r.$$.on_mount.push(function(){s===void 0&&!("remultKitDataAuth"in e||r.$$.bound[r.$$.props.remultKitDataAuth])&&console.warn("<ForgotPassword> was created without expected prop 'remultKitDataAuth'")});const u=["remultKitDataAuth","email"];Object.keys(e).forEach(h=>{!~u.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<ForgotPassword> was created with unknown prop '${h}'`)});function f(){o=this.value,t(0,o)}return r.$$set=h=>{"remultKitDataAuth"in h&&t(1,s=h.remultKitDataAuth),"email"in h&&t(0,o=h.email)},r.$capture_state=()=>({isError:Zt,AuthController:ue,autofocus:ft,remultKitDataAuth:s,email:o,msgError:a,msgSuccess:l,forgot:c}),r.$inject_state=h=>{"remultKitDataAuth"in h&&t(1,s=h.remultKitDataAuth),"email"in h&&t(0,o=h.email),"msgError"in h&&t(2,a=h.msgError),"msgSuccess"in h&&t(3,l=h.msgSuccess)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[o,s,a,l,c,f]}class Vn extends ze{constructor(e){super(e),Xe(this,e,ua,Ei,lt,{remultKitDataAuth:1,email:0}),j("SvelteRegisterComponent",{component:this,tagName:"ForgotPassword",options:e,id:Ei.name})}get remultKitDataAuth(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitDataAuth(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const rt="src/lib/modules/auth/components/ResetPassword.svelte";function Si(r){let e,t,i,n,s,o,a=r[2].ui.providers.password.dico.password+"",l,c,u,f,h=r[2].ui.providers.password.dico.password+"",p,y,v,w,I,k,G;const K={c:function(){e=N("div"),t=N("p"),i=ne(r[3]),n=ne(r[4]),s=x(),o=N("form"),l=ne(a),c=x(),u=N("input"),f=x(),p=ne(h),y=x(),v=N("input"),w=x(),I=N("button"),I.textContent="reset",V(t,"class","message"),Be(t,"error",r[3]),L(t,rt,28,2,642),V(u,"type","password"),L(u,rt,31,4,817),V(v,"type","password"),L(v,rt,33,4,930),L(I,rt,34,4,983),V(o,"class","svelte-wa5ykb"),L(o,rt,29,2,713),V(e,"class","login"),L(e,rt,27,0,620)},l:function(B){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(B,Y){W(B,e,Y),E(e,t),E(t,i),E(t,n),E(e,s),E(e,o),E(o,l),E(o,c),E(o,u),_e(u,r[0]),E(o,f),E(o,p),E(o,y),E(o,v),_e(v,r[1]),E(o,w),E(o,I),k||(G=[Ee(u,"input",r[6]),Ee(v,"input",r[7]),Ee(o,"submit",zt(r[5]),!1,!0,!1,!1)],k=!0)},p:function(B,[Y]){Y&8&&ye(i,B[3]),Y&16&&ye(n,B[4]),Y&8&&Be(t,"error",B[3]),Y&4&&a!==(a=B[2].ui.providers.password.dico.password+"")&&ye(l,a),Y&1&&u.value!==B[0]&&_e(u,B[0]),Y&4&&h!==(h=B[2].ui.providers.password.dico.password+"")&&ye(p,h),Y&2&&v.value!==B[1]&&_e(v,B[1])},i:ae,o:ae,d:function(B){B&&Q(e),k=!1,at(G)}};return j("SvelteRegisterBlock",{block:K,id:Si.name,type:"component",source:"",ctx:r}),K}function fa(r,e,t){let{$$slots:i={},$$scope:n}=e;Ze("ResetPassword",i,[]);let{remultKitDataAuth:s}=e,{password1:o=""}=e,{password2:a=""}=e,l="",c="";async function u(){t(3,l=""),t(4,c="");const y=new URL(location.href).searchParams.get("token");try{await ue.resetPassword(y??"",o),window.location.href="/"}catch(v){v&&t(3,l=v.message??"")}}r.$$.on_mount.push(function(){s===void 0&&!("remultKitDataAuth"in e||r.$$.bound[r.$$.props.remultKitDataAuth])&&console.warn("<ResetPassword> was created without expected prop 'remultKitDataAuth'")});const f=["remultKitDataAuth","password1","password2"];Object.keys(e).forEach(y=>{!~f.indexOf(y)&&y.slice(0,2)!=="$$"&&y!=="slot"&&console.warn(`<ResetPassword> was created with unknown prop '${y}'`)});function h(){o=this.value,t(0,o)}function p(){a=this.value,t(1,a)}return r.$$set=y=>{"remultKitDataAuth"in y&&t(2,s=y.remultKitDataAuth),"password1"in y&&t(0,o=y.password1),"password2"in y&&t(1,a=y.password2)},r.$capture_state=()=>({isError:Zt,AuthController:ue,remultKitDataAuth:s,password1:o,password2:a,msgError:l,msgSuccess:c,reset:u}),r.$inject_state=y=>{"remultKitDataAuth"in y&&t(2,s=y.remultKitDataAuth),"password1"in y&&t(0,o=y.password1),"password2"in y&&t(1,a=y.password2),"msgError"in y&&t(3,l=y.msgError),"msgSuccess"in y&&t(4,c=y.msgSuccess)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[o,a,s,l,c,u,h,p]}class Kn extends ze{constructor(e){super(e),Xe(this,e,fa,Si,lt,{remultKitDataAuth:2,password1:0,password2:1}),j("SvelteRegisterComponent",{component:this,tagName:"ResetPassword",options:e,id:Si.name})}get remultKitDataAuth(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitDataAuth(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password1(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password1(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password2(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password2(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:Ve}=Di,Je="src/lib/modules/auth/components/SignIn.svelte";function Ci(r){let e,t,i,n,s,o,a=r[1].ui.providers.password.dico.email+"",l,c,u,f,h,p,y=r[1].ui.providers.password.dico.password+"",v,w,I,k,G,K=r[1].ui.providers.password.dico.btn_sign_in+"",H,B,Y;const De={c:function(){e=N("form"),t=N("p"),i=ne(r[3]),n=ne(r[4]),s=x(),o=N("label"),l=ne(a),c=x(),u=N("input"),h=x(),p=N("label"),v=ne(y),w=x(),I=N("input"),k=x(),G=N("button"),H=ne(K),V(t,"class","message svelte-1rtdg09"),Be(t,"error",r[3]),L(t,Je,37,4,754),V(u,"type","text"),V(u,"placeholder",f=r[1].ui.providers.password.dico.email_placeholder),L(u,Je,40,6,900),L(o,Je,38,4,827),V(I,"type","password"),L(I,Je,49,6,1163),L(p,Je,47,4,1087),L(G,Je,51,4,1228),V(e,"class","svelte-1rtdg09"),L(e,Je,36,2,709)},m:function(q,$){W(q,e,$),E(e,t),E(t,i),E(t,n),E(e,s),E(e,o),E(o,l),E(o,c),E(o,u),_e(u,r[0]),E(e,h),E(e,p),E(p,v),E(p,w),E(p,I),_e(I,r[5]),E(e,k),E(e,G),E(G,H),B||(Y=[Ee(u,"input",r[7]),$t(ft.call(null,u)),Ee(I,"input",r[8]),Ee(e,"submit",zt(r[6]),!1,!0,!1,!1)],B=!0)},p:function(q,$){$&8&&ye(i,q[3]),$&16&&ye(n,q[4]),$&8&&Be(t,"error",q[3]),$&2&&a!==(a=q[1].ui.providers.password.dico.email+"")&&ye(l,a),$&2&&f!==(f=q[1].ui.providers.password.dico.email_placeholder)&&V(u,"placeholder",f),$&1&&u.value!==q[0]&&_e(u,q[0]),$&2&&y!==(y=q[1].ui.providers.password.dico.password+"")&&ye(v,y),$&32&&I.value!==q[5]&&_e(I,q[5]),$&2&&K!==(K=q[1].ui.providers.password.dico.btn_sign_in+"")&&ye(H,K)},d:function(q){q&&Q(e),B=!1,at(Y)}};return j("SvelteRegisterBlock",{block:De,id:Ci.name,type:"if",source:"(27:0) {#if view == 'login'}",ctx:r}),De}function Ti(r){let e,t=r[2]=="login"&&Ci(r);const i={c:function(){t&&t.c(),e=Ri()},l:function(s){throw new Ve("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,o){t&&t.m(s,o),W(s,e,o)},p:function(s,[o]){s[2]=="login"?t?t.p(s,o):(t=Ci(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ae,o:ae,d:function(s){s&&Q(e),t&&t.d(s)}};return j("SvelteRegisterBlock",{block:i,id:Ti.name,type:"component",source:"",ctx:r}),i}function ca(r,e,t){let{$$slots:i={},$$scope:n}=e;Ze("SignIn",i,[]);let{remultKitDataAuth:s}=e,{view:o="login"}=e,{email:a=""}=e,l="",c="",u;async function f(){t(3,l=""),t(4,c="");try{await ue.signInPassword(a,u),window.location.href="/"}catch(w){w&&t(3,l=w.message??"")}}const h=()=>{throw new Error("Not impl yet")};r.$$.on_mount.push(function(){s===void 0&&!("remultKitDataAuth"in e||r.$$.bound[r.$$.props.remultKitDataAuth])&&console.warn("<SignIn> was created without expected prop 'remultKitDataAuth'")});const p=["remultKitDataAuth","view","email"];Object.keys(e).forEach(w=>{!~p.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignIn> was created with unknown prop '${w}'`)});function y(){a=this.value,t(0,a)}function v(){u=this.value,t(5,u)}return r.$$set=w=>{"remultKitDataAuth"in w&&t(1,s=w.remultKitDataAuth),"view"in w&&t(2,o=w.view),"email"in w&&t(0,a=w.email)},r.$capture_state=()=>({AuthController:ue,isError:Zt,autofocus:ft,remultKitDataAuth:s,view:o,email:a,msgError:l,msgSuccess:c,password:u,signIn:f,handlePin:h}),r.$inject_state=w=>{"remultKitDataAuth"in w&&t(1,s=w.remultKitDataAuth),"view"in w&&t(2,o=w.view),"email"in w&&t(0,a=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,c=w.msgSuccess),"password"in w&&t(5,u=w.password)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[a,s,o,l,c,u,f,y,v]}class Hn extends ze{constructor(e){super(e),Xe(this,e,ca,Ti,lt,{remultKitDataAuth:1,view:2,email:0}),j("SvelteRegisterComponent",{component:this,tagName:"SignIn",options:e,id:Ti.name})}get remultKitDataAuth(){throw new Ve("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitDataAuth(e){throw new Ve("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new Ve("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new Ve("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new Ve("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new Ve("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:Ke}=Di,Ue="src/lib/modules/auth/components/SignUp.svelte";function Ai(r){let e,t,i,n,s,o,a=r[1].ui.providers.password.dico.email+"",l,c,u,f,h,p,y=r[1].ui.providers.password.dico.password+"",v,w,I,k,G,K=r[1].ui.providers.password.dico.btn_sign_up+"",H,B,Y;const De={c:function(){e=N("form"),t=N("p"),i=ne(r[3]),n=ne(r[4]),s=x(),o=N("label"),l=ne(a),c=x(),u=N("input"),h=x(),p=N("label"),v=ne(y),w=x(),I=N("input"),k=x(),G=N("button"),H=ne(K),V(t,"class","message svelte-1rtdg09"),Be(t,"error",r[3]),L(t,Ue,37,4,754),V(u,"type","text"),V(u,"placeholder",f=r[1].ui.providers.password.dico.email_placeholder),L(u,Ue,40,6,900),L(o,Ue,38,4,827),V(I,"type","password"),L(I,Ue,49,6,1163),L(p,Ue,47,4,1087),L(G,Ue,51,4,1228),V(e,"class","svelte-1rtdg09"),L(e,Ue,36,2,709)},m:function(q,$){W(q,e,$),E(e,t),E(t,i),E(t,n),E(e,s),E(e,o),E(o,l),E(o,c),E(o,u),_e(u,r[0]),E(e,h),E(e,p),E(p,v),E(p,w),E(p,I),_e(I,r[5]),E(e,k),E(e,G),E(G,H),B||(Y=[Ee(u,"input",r[7]),$t(ft.call(null,u)),Ee(I,"input",r[8]),Ee(e,"submit",zt(r[6]),!1,!0,!1,!1)],B=!0)},p:function(q,$){$&8&&ye(i,q[3]),$&16&&ye(n,q[4]),$&8&&Be(t,"error",q[3]),$&2&&a!==(a=q[1].ui.providers.password.dico.email+"")&&ye(l,a),$&2&&f!==(f=q[1].ui.providers.password.dico.email_placeholder)&&V(u,"placeholder",f),$&1&&u.value!==q[0]&&_e(u,q[0]),$&2&&y!==(y=q[1].ui.providers.password.dico.password+"")&&ye(v,y),$&32&&I.value!==q[5]&&_e(I,q[5]),$&2&&K!==(K=q[1].ui.providers.password.dico.btn_sign_up+"")&&ye(H,K)},d:function(q){q&&Q(e),B=!1,at(Y)}};return j("SvelteRegisterBlock",{block:De,id:Ai.name,type:"if",source:"(27:0) {#if view == 'login'}",ctx:r}),De}function Pi(r){let e,t=r[2]=="login"&&Ai(r);const i={c:function(){t&&t.c(),e=Ri()},l:function(s){throw new Ke("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,o){t&&t.m(s,o),W(s,e,o)},p:function(s,[o]){s[2]=="login"?t?t.p(s,o):(t=Ai(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ae,o:ae,d:function(s){s&&Q(e),t&&t.d(s)}};return j("SvelteRegisterBlock",{block:i,id:Pi.name,type:"component",source:"",ctx:r}),i}function da(r,e,t){let{$$slots:i={},$$scope:n}=e;Ze("SignUp",i,[]);let{remultKitDataAuth:s}=e,{view:o="login"}=e,{email:a=""}=e,l="",c="",u;async function f(){t(3,l=""),t(4,c="");try{await ue.signUpPassword(a,u),window.location.href="/"}catch(w){w&&t(3,l=w.message??"")}}const h=()=>{throw new Error("Not impl yet")};r.$$.on_mount.push(function(){s===void 0&&!("remultKitDataAuth"in e||r.$$.bound[r.$$.props.remultKitDataAuth])&&console.warn("<SignUp> was created without expected prop 'remultKitDataAuth'")});const p=["remultKitDataAuth","view","email"];Object.keys(e).forEach(w=>{!~p.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignUp> was created with unknown prop '${w}'`)});function y(){a=this.value,t(0,a)}function v(){u=this.value,t(5,u)}return r.$$set=w=>{"remultKitDataAuth"in w&&t(1,s=w.remultKitDataAuth),"view"in w&&t(2,o=w.view),"email"in w&&t(0,a=w.email)},r.$capture_state=()=>({AuthController:ue,isError:Zt,autofocus:ft,remultKitDataAuth:s,view:o,email:a,msgError:l,msgSuccess:c,password:u,signIn:f,handlePin:h}),r.$inject_state=w=>{"remultKitDataAuth"in w&&t(1,s=w.remultKitDataAuth),"view"in w&&t(2,o=w.view),"email"in w&&t(0,a=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,c=w.msgSuccess),"password"in w&&t(5,u=w.password)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[a,s,o,l,c,u,f,y,v]}class Wn extends ze{constructor(e){super(e),Xe(this,e,da,Pi,lt,{remultKitDataAuth:1,view:2,email:0}),j("SvelteRegisterComponent",{component:this,tagName:"SignUp",options:e,id:Pi.name})}get remultKitDataAuth(){throw new Ke("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitDataAuth(e){throw new Ke("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new Ke("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new Ke("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new Ke("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new Ke("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Ce="src/lib/modules/auth/Page.svelte";function Qn(r){let e,t;e=new We({props:{path:r[1].ui.providers.password.paths.sign_up,$$slots:{default:[$n]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&65&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:Qn.name,type:"if",source:"(14:6) {#if remultKitDataAuth.ui.providers.password.paths.sign_up}",ctx:r}),i}function xn(r){let e,t;e=new ut({props:{href:r[1].ui.providers.password.paths.sign_in,$$slots:{default:[Gn]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&64&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:xn.name,type:"if",source:"(19:12) {#if remultKitDataAuth.ui.providers.password.paths.sign_in}",ctx:r}),i}function Gn(r){let e=r[1].ui.providers.password.dico.back_to_sign_in+"",t;const i={c:function(){t=ne(e)},m:function(s,o){W(s,t,o)},p:ae,d:function(s){s&&Q(t)}};return j("SvelteRegisterBlock",{block:i,id:Gn.name,type:"slot",source:"(20:14) <Link href={remultKitDataAuth.ui.providers.password.paths.sign_in}>",ctx:r}),i}function $n(r){let e,t,i,n,s;function o(u){r[3](u)}let a={remultKitDataAuth:r[1]};r[0]!==void 0&&(a.email=r[0]),e=new Wn({props:a,$$inline:!0}),Mi.push(()=>Ni(e,"email",o));let l=r[1].ui.providers.password.paths.sign_in&&xn(r);const c={c:function(){me(e.$$.fragment),i=x(),n=N("div"),l&&l.c(),V(n,"class","form-footer svelte-15iffyp"),L(n,Ce,22,10,647)},m:function(f,h){we(e,f,h),W(f,i,h),W(f,n,h),l&&l.m(n,null),s=!0},p:function(f,h){const p={};!t&&h&1&&(t=!0,p.email=f[0],Li(()=>t=!1)),e.$set(p),f[1].ui.providers.password.paths.sign_in&&l.p(f,h)},i:function(f){s||(Z(e.$$.fragment,f),Z(l),s=!0)},o:function(f){ie(e.$$.fragment,f),ie(l),s=!1},d:function(f){f&&(Q(i),Q(n)),ge(e,f),l&&l.d()}};return j("SvelteRegisterBlock",{block:c,id:$n.name,type:"slot",source:"(15:8) <Route path={remultKitDataAuth.ui.providers.password.paths.sign_up}>",ctx:r}),c}function zn(r){let e,t;e=new ut({props:{href:r[1].ui.providers.password.paths.forgot_password,$$slots:{default:[Xn]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&64&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:zn.name,type:"if",source:"(32:10) {#if remultKitDataAuth.ui.providers.password.paths.forgot_password}",ctx:r}),i}function Xn(r){let e=r[1].ui.providers.password.dico.forgot_password+"",t;const i={c:function(){t=ne(e)},m:function(s,o){W(s,t,o)},p:ae,d:function(s){s&&Q(t)}};return j("SvelteRegisterBlock",{block:i,id:Xn.name,type:"slot",source:"(33:12) <Link href={remultKitDataAuth.ui.providers.password.paths.forgot_password}>",ctx:r}),i}function Zn(r){let e,t;e=new ut({props:{href:r[1].ui.providers.password.paths.sign_up,$$slots:{default:[Yn]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&64&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:Zn.name,type:"if",source:"(38:10) {#if remultKitDataAuth.ui.providers.password.paths.sign_up}",ctx:r}),i}function Yn(r){let e=r[1].ui.providers.password.dico.btn_sign_up+"",t;const i={c:function(){t=ne(e)},m:function(s,o){W(s,t,o)},p:ae,d:function(s){s&&Q(t)}};return j("SvelteRegisterBlock",{block:i,id:Yn.name,type:"slot",source:"(39:12) <Link href={remultKitDataAuth.ui.providers.password.paths.sign_up}>",ctx:r}),i}function es(r){let e,t,i,n,s,o,a,l;function c(y){r[4](y)}let u={remultKitDataAuth:r[1]};r[0]!==void 0&&(u.email=r[0]),e=new Hn({props:u,$$inline:!0}),Mi.push(()=>Ni(e,"email",c));let f=r[1].ui.providers.password.paths.forgot_password&&zn(r),h=r[1].ui.providers.password.paths.sign_up&&Zn(r);const p={c:function(){me(e.$$.fragment),i=x(),n=N("div"),f&&f.c(),s=x(),o=N("hr"),a=x(),h&&h.c(),L(o,Ce,41,10,1442),V(n,"class","form-footer svelte-15iffyp"),L(n,Ce,35,8,1127)},m:function(v,w){we(e,v,w),W(v,i,w),W(v,n,w),f&&f.m(n,null),E(n,s),E(n,o),E(n,a),h&&h.m(n,null),l=!0},p:function(v,w){const I={};!t&&w&1&&(t=!0,I.email=v[0],Li(()=>t=!1)),e.$set(I),v[1].ui.providers.password.paths.forgot_password&&f.p(v,w),v[1].ui.providers.password.paths.sign_up&&h.p(v,w)},i:function(v){l||(Z(e.$$.fragment,v),Z(f),Z(h),l=!0)},o:function(v){ie(e.$$.fragment,v),ie(f),ie(h),l=!1},d:function(v){v&&(Q(i),Q(n)),ge(e,v),f&&f.d(),h&&h.d()}};return j("SvelteRegisterBlock",{block:p,id:es.name,type:"slot",source:"(28:6) <Route path={remultKitDataAuth.ui.providers.password.paths.sign_in}>",ctx:r}),p}function ts(r){let e,t;e=new ut({props:{href:r[1].ui.providers.password.paths.sign_in,$$slots:{default:[is]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&64&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:ts.name,type:"if",source:"(50:10) {#if remultKitDataAuth.ui.providers.password.paths.sign_in}",ctx:r}),i}function is(r){let e=r[1].ui.providers.password.dico.back_to_sign_in+"",t;const i={c:function(){t=ne(e)},m:function(s,o){W(s,t,o)},p:ae,d:function(s){s&&Q(t)}};return j("SvelteRegisterBlock",{block:i,id:is.name,type:"slot",source:"(51:12) <Link href={remultKitDataAuth.ui.providers.password.paths.sign_in}>",ctx:r}),i}function rs(r){let e,t,i,n,s;function o(u){r[5](u)}let a={remultKitDataAuth:r[1]};r[0]!==void 0&&(a.email=r[0]),e=new Vn({props:a,$$inline:!0}),Mi.push(()=>Ni(e,"email",o));let l=r[1].ui.providers.password.paths.sign_in&&ts(r);const c={c:function(){me(e.$$.fragment),i=x(),n=N("div"),l&&l.c(),V(n,"class","form-footer svelte-15iffyp"),L(n,Ce,53,8,1889)},m:function(f,h){we(e,f,h),W(f,i,h),W(f,n,h),l&&l.m(n,null),s=!0},p:function(f,h){const p={};!t&&h&1&&(t=!0,p.email=f[0],Li(()=>t=!1)),e.$set(p),f[1].ui.providers.password.paths.sign_in&&l.p(f,h)},i:function(f){s||(Z(e.$$.fragment,f),Z(l),s=!0)},o:function(f){ie(e.$$.fragment,f),ie(l),s=!1},d:function(f){f&&(Q(i),Q(n)),ge(e,f),l&&l.d()}};return j("SvelteRegisterBlock",{block:c,id:rs.name,type:"slot",source:"(46:6) <Route path={remultKitDataAuth.ui.providers.password.paths.forgot_password}>",ctx:r}),c}function ns(r){let e,t;e=new ut({props:{href:r[1].ui.providers.password.paths.sign_in,$$slots:{default:[ss]},$$scope:{ctx:r}},$$inline:!0});const i={c:function(){me(e.$$.fragment)},m:function(s,o){we(e,s,o),t=!0},p:function(s,o){const a={};o&64&&(a.$$scope={dirty:o,ctx:s}),e.$set(a)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){ie(e.$$.fragment,s),t=!1},d:function(s){ge(e,s)}};return j("SvelteRegisterBlock",{block:i,id:ns.name,type:"if",source:"(62:10) {#if remultKitDataAuth.ui.providers.password.paths.sign_in}",ctx:r}),i}function ss(r){let e=r[1].ui.providers.password.dico.back_to_sign_in+"",t;const i={c:function(){t=ne(e)},m:function(s,o){W(s,t,o)},p:ae,d:function(s){s&&Q(t)}};return j("SvelteRegisterBlock",{block:i,id:ss.name,type:"slot",source:"(63:12) <Link href={remultKitDataAuth.ui.providers.password.paths.sign_in}>",ctx:r}),i}function os(r){let e,t,i,n;e=new Kn({props:{remultKitDataAuth:r[1]},$$inline:!0});let s=r[1].ui.providers.password.paths.sign_in&&ns(r);const o={c:function(){me(e.$$.fragment),t=x(),i=N("div"),s&&s.c(),V(i,"class","form-footer svelte-15iffyp"),L(i,Ce,65,8,2346)},m:function(l,c){we(e,l,c),W(l,t,c),W(l,i,c),s&&s.m(i,null),n=!0},p:function(l,c){l[1].ui.providers.password.paths.sign_in&&s.p(l,c)},i:function(l){n||(Z(e.$$.fragment,l),Z(s),n=!0)},o:function(l){ie(e.$$.fragment,l),ie(s),n=!1},d:function(l){l&&(Q(t),Q(i)),ge(e,l),s&&s.d()}};return j("SvelteRegisterBlock",{block:o,id:os.name,type:"slot",source:"(58:6) <Route path={remultKitDataAuth.ui.providers.password.paths.reset_password}>",ctx:r}),o}function as(r){let e,t,i,n,s;const o={c:function(){e=N("div"),t=N("small"),t.textContent="- 404 -",i=x(),n=N("div"),s=N("small"),s.textContent="Nothing to see here",L(t,Ce,76,10,2730),V(e,"class","fallback svelte-15iffyp"),L(e,Ce,75,8,2697),L(s,Ce,79,10,2809),V(n,"class","fallback svelte-15iffyp"),L(n,Ce,78,8,2776)},m:function(l,c){W(l,e,c),E(e,t),W(l,i,c),W(l,n,c),E(n,s)},p:ae,d:function(l){l&&(Q(e),Q(i),Q(n))}};return j("SvelteRegisterBlock",{block:o,id:as.name,type:"slot",source:"(70:6) <Route fallback>",ctx:r}),o}function ls(r){let e,t,i,n,s,o,a,l,c,u=r[1].ui.providers.password.paths.sign_up&&Qn(r);t=new We({props:{path:r[1].ui.providers.password.paths.sign_in,$$slots:{default:[es]},$$scope:{ctx:r}},$$inline:!0}),n=new We({props:{path:r[1].ui.providers.password.paths.forgot_password,$$slots:{default:[rs]},$$scope:{ctx:r}},$$inline:!0}),o=new We({props:{path:r[1].ui.providers.password.paths.reset_password,$$slots:{default:[os]},$$scope:{ctx:r}},$$inline:!0}),l=new We({props:{fallback:!0,$$slots:{default:[as]},$$scope:{ctx:r}},$$inline:!0});const f={c:function(){u&&u.c(),e=x(),me(t.$$.fragment),i=x(),me(n.$$.fragment),s=x(),me(o.$$.fragment),a=x(),me(l.$$.fragment)},m:function(p,y){u&&u.m(p,y),W(p,e,y),we(t,p,y),W(p,i,y),we(n,p,y),W(p,s,y),we(o,p,y),W(p,a,y),we(l,p,y),c=!0},p:function(p,y){p[1].ui.providers.password.paths.sign_up&&u.p(p,y);const v={};y&65&&(v.$$scope={dirty:y,ctx:p}),t.$set(v);const w={};y&65&&(w.$$scope={dirty:y,ctx:p}),n.$set(w);const I={};y&64&&(I.$$scope={dirty:y,ctx:p}),o.$set(I);const k={};y&64&&(k.$$scope={dirty:y,ctx:p}),l.$set(k)},i:function(p){c||(Z(u),Z(t.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(l.$$.fragment,p),c=!0)},o:function(p){ie(u),ie(t.$$.fragment,p),ie(n.$$.fragment,p),ie(o.$$.fragment,p),ie(l.$$.fragment,p),c=!1},d:function(p){p&&(Q(e),Q(i),Q(s),Q(a)),u&&u.d(p),ge(t,p),ge(n,p),ge(o,p),ge(l,p)}};return j("SvelteRegisterBlock",{block:f,id:ls.name,type:"slot",source:"(13:4) <Route>",ctx:r}),f}function Fi(r){let e,t,i,n;i=new We({props:{$$slots:{default:[ls]},$$scope:{ctx:r}},$$inline:!0});const s={c:function(){e=N("div"),t=N("div"),me(i.$$.fragment),V(t,"class","form svelte-15iffyp"),L(t,Ce,16,2,410),V(e,"class","wrapper svelte-15iffyp"),L(e,Ce,15,0,386)},l:function(a){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){W(a,e,l),E(e,t),we(i,t,null),n=!0},p:function(a,[l]){const c={};l&65&&(c.$$scope={dirty:l,ctx:a}),i.$set(c)},i:function(a){n||(Z(i.$$.fragment,a),n=!0)},o:function(a){ie(i.$$.fragment,a),n=!1},d:function(a){a&&Q(e),ge(i)}};return j("SvelteRegisterBlock",{block:s,id:Fi.name,type:"component",source:"",ctx:r}),s}function ha(r,e,t){let{$$slots:i={},$$scope:n}=e;Ze("Page",i,[]);let{remultKitData:s}=e,o=s.props,a="";r.$$.on_mount.push(function(){s===void 0&&!("remultKitData"in e||r.$$.bound[r.$$.props.remultKitData])&&console.warn("<Page> was created without expected prop 'remultKitData'")});const l=["remultKitData"];Object.keys(e).forEach(h=>{!~l.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<Page> was created with unknown prop '${h}'`)});function c(h){a=h,t(0,a)}function u(h){a=h,t(0,a)}function f(h){a=h,t(0,a)}return r.$$set=h=>{"remultKitData"in h&&t(2,s=h.remultKitData)},r.$capture_state=()=>({Link:ut,Route:We,ForgotPassword:Vn,ResetPassword:Kn,SignIn:Hn,SignUp:Wn,remultKitData:s,remultKitDataAuth:o,email:a}),r.$inject_state=h=>{"remultKitData"in h&&t(2,s=h.remultKitData),"remultKitDataAuth"in h&&t(1,o=h.remultKitDataAuth),"email"in h&&t(0,a=h.email)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[a,o,s,c,u,f]}class va extends ze{constructor(e){super(e),Xe(this,e,ha,Fi,lt,{remultKitData:2}),j("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:Fi.name})}get remultKitData(){throw new Error("<Page>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new Error("<Page>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{va as default};
