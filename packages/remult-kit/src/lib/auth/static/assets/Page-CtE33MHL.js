var Zi=Object.defineProperty;var es=(n,e,t)=>e in n?Zi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(es(n,typeof e!="symbol"?e+"":e,t),t);import{n as ye,s as ts,r as Dt,a as Lt,i as rs,g as ns,S as ct,b as dt,c as bn,d as Q,e as vn,v as Ze,f as et,h as ht,j as qr,k as jt,o as jr,l as Jt,m as is,p as kn,q as _n,t as Y,u as le,w as ss,x as he,y as os,z as Z,A as In,B as On,C as En,D as zt,E as Jr,F as as,G as x,H as xr,I as U,J as Mt,K as $e,L as ls,M as me,N as ne,O as B,P as Cn,Q as _e,R as Ur,T as He,U as Sn,V as Ct,W as Se,X as Te,Y as Ae}from"./index-NzWxEOyU.js";function us(n,e){const t={},r={},i={$$scope:1};let s=n.length;for(;s--;){const o=n[s],a=e[s];if(a){for(const l in o)l in a||(r[l]=1);for(const l in a)i[l]||(t[l]=a[l],i[l]=1);n[s]=a}else for(const l in o)i[l]=1}for(const o in r)o in t||(t[o]=void 0);return t}const Je=[];function wr(n,e){return{subscribe:at(n,e).subscribe}}function at(n,e=ye){let t;const r=new Set;function i(a){if(Lt(n,a)&&(n=a,t)){const l=!Je.length;for(const f of r)f[1](),Je.push(f,n);if(l){for(let f=0;f<Je.length;f+=2)Je[f][0](Je[f+1]);Je.length=0}}}function s(a){i(a(n))}function o(a,l=ye){const f=[a,l];return r.add(f),r.size===1&&(t=e(i,s)||ye),a(n),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:i,update:s,subscribe:o}}function pt(n,e,t){const r=!Array.isArray(n),i=r?[n]:n;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return wr(t,(o,a)=>{let l=!1;const f=[];let u=0,d=ye;const p=()=>{if(u)return;d();const g=e(r?f[0]:f,o,a);s?o(g):d=rs(g)?g:ye},m=i.map((g,k)=>ts(g,O=>{f[k]=O,u&=~(1<<k),l&&p()},()=>{u|=1<<k}));return l=!0,p(),function(){Dt(m),d(),l=!1}})}const fs=n=>{const{subscribe:e,update:t}=at(n);return{subscribe:e,set:(r={})=>{t(i=>Object.assign(i,r))}}},Ve=fs({mode:"window",basePath:null}),xt=(n=ns(Ve).mode)=>{let e="popstate";n==="window"&&(e="popstate"),n==="hash"&&(e="hashchange"),window.dispatchEvent(new Event(e))},Hr={go:(n=0)=>{history.go(n),xt()},push:(n,e=null)=>{history.pushState(e,"",n),xt()},replace:(n,e=null)=>{history.replaceState(e,"",n),xt()}},cs=(n,e)=>e===null?n:n.startsWith(e)?n.slice(e.length):n,ds=n=>{const e=n.match(/^(\/[^?#]*)?/),t=n.match(/\?([^#]*)?/),r=n.match(/#(.*)?/);return{path:(e==null?void 0:e[1])||"/",query:t!=null&&t[1]?`?${t==null?void 0:t[1]}`:"",hash:r!=null&&r[1]?`#${r==null?void 0:r[1]}`:""}},Wr=()=>{const{pathname:n,search:e,hash:t}=document.location;return{path:n,query:e,hash:t}},$r=()=>{let n=document.location.hash.substring(1);return n[0]!=="/"&&(n="/"+n),ds(n)},hs=wr(Wr(),n=>{const e=()=>n(Wr());return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),ps=wr($r(),n=>{const e=()=>n($r());return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),br=pt([Ve,hs,ps],([n,e,t],r)=>{n.mode==="window"&&r(e),n.mode==="hash"&&r(t)}),ys=pt(br,n=>n.path);pt(br,n=>n.query);pt(br,n=>n.hash);const Ut=pt([Ve,ys],([n,e])=>cs(e,n.basePath)),nt=n=>n.split(/(?=\/)/),Tn=()=>{let n=0;return()=>n++},{Error:tt}=vn;function Xt(n){let e;const t=n[10].default,r=kn(t,n,n[9],null),i={c:function(){r&&r.c()},m:function(o,a){r&&r.m(o,a),e=!0},p:function(o,a){r&&r.p&&(!e||a&512)&&In(r,t,o,o[9],e?En(t,o[9],a,null):On(o[9]),null)},i:function(o){e||(le(r,o),e=!0)},o:function(o){he(r,o),e=!1},d:function(o){r&&r.d(o)}};return Q("SvelteRegisterBlock",{block:i,id:Xt.name,type:"if",source:"(96:0) {#if isRouteActive($pathWithoutBase, $route, $contextChildRoutes)}",ctx:n}),i}function Yt(n){let e=Zt(n[1],n[0],n[2]),t,r,i=e&&Xt(n);const s={c:function(){i&&i.c(),t=_n()},l:function(a){throw new tt("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){i&&i.m(a,l),Y(a,t,l),r=!0},p:function(a,[l]){l&7&&(e=Zt(a[1],a[0],a[2])),e?i?(i.p(a,l),l&7&&le(i,1)):(i=Xt(a),i.c(),le(i,1),i.m(t.parentNode,t)):i&&(ss(),he(i,1,1,()=>{i=null}),os())},i:function(a){r||(le(i),r=!0)},o:function(a){he(i),r=!1},d:function(a){a&&Z(t),i&&i.d(a)}};return Q("SvelteRegisterBlock",{block:s,id:Yt.name,type:"component",source:"",ctx:n}),s}const Vr=(n,e,t,r,i)=>{const s=(f,u,d)=>{const p=nt(u).filter(m=>m!=="/").length;return(d??0)+(f?1:p)},o=(f,u)=>{const d={invalidPath:`<Route path="${f==null?void 0:f.path}" /> has invalid path. Path must start with '/'`,fallbackOutsideRoot:"<Route fallback /> cannot be outside root <Route />",pathOutsideRoot:`<Route path="${f==null?void 0:f.path}" /> cannot be outside root <Route />`,fallbackInsideFallback:"<Route fallback /> cannot be inside <Route fallback>",pathInsideFallback:`<Route path="${f==null?void 0:f.path}" /> cannot be inside <Route fallback>`};if(f.path[0]!=="/")throw new Error(d.invalidPath);if(f.root&&f.fallback)throw new Error(d.fallbackOutsideRoot);if(f.root&&f.path!=="/")throw new Error(d.pathOutsideRoot);if(u!=null&&u.fallback&&f.fallback)throw new Error(d.fallbackInsideFallback);if(u!=null&&u.fallback&&!f.fallback)throw new Error(d.pathInsideFallback)},a=s(t,r,i==null?void 0:i.depth),l={id:n,root:e,fallback:t,path:r,depth:a};return o(l,i),l},Kr=()=>{const{subscribe:n,update:e}=at([]);return{subscribe:n,update:t=>e(r=>[...r.filter(i=>t.id!==i.id),t]),remove:t=>e(r=>r.filter(i=>t.id!==i.id))}},Zt=(n,e,t)=>{const r=(f,u,d,p)=>{let m=nt(f).filter(O=>O!=="/"),g=nt(d).filter(O=>O!=="/"),k="";if(d==="/")return u||m.length===p;for(let O=p-g.length;O<p;O++)k=k+m[O];return d===k},i=(f,u,d)=>{var g,k,O,D;let p=nt(f).filter(w=>w!=="/"),m=!1;for(let w=0;w<(d==null?void 0:d.length)&&!m;w++)(g=d[w])!=null&&g.fallback||(m=r(f,((k=d[w])==null?void 0:k.root)??!1,((O=d[w])==null?void 0:O.path)??"",((D=d[w])==null?void 0:D.depth)??0));return p.length>=u&&!m},{root:s,fallback:o,path:a,depth:l}=e;return o?i(n,l,t):r(n,s,a,l)},Qr=Tn(),bt={},Ht={};function ms(n,e,t){let r,i,s,o;Ze(Ut,"pathWithoutBase"),et(n,Ut,w=>t(1,s=w));let{$$slots:a={},$$scope:l}=e;ht("Route",a,["default"]);const f=Qr(),u=!qr(bt);let{fallback:d=!1}=e,{path:p="/"}=e;const m=at();Ze(m,"route"),et(n,m,w=>t(0,r=w));const g=jt(bt);Ze(g,"contextRoute"),et(n,g,w=>t(8,i=w));const k=Kr(),O=jt(Ht);Ze(O,"contextChildRoutes"),et(n,O,w=>t(2,o=w)),jr(()=>O==null?void 0:O.remove(r)),Jt(bt,m),Jt(Ht,k);const D=["fallback","path"];return Object.keys(e).forEach(w=>{!~D.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<Route> was created with unknown prop '${w}'`)}),n.$$set=w=>{"fallback"in w&&t(6,d=w.fallback),"path"in w&&t(7,p=w.path),"$$scope"in w&&t(9,l=w.$$scope)},n.$capture_state=()=>({writable:at,createIdIssuer:Tn,getPathSegments:nt,getRoute:Vr,createChildRoutes:Kr,isRouteActive:Zt,getId:Qr,routeContextKey:bt,childRoutesContextKey:Ht,onDestroy:jr,getContext:jt,setContext:Jt,hasContext:qr,pathWithoutBase:Ut,id:f,root:u,fallback:d,path:p,route:m,contextRoute:g,childRoutes:k,contextChildRoutes:O,$route:r,$contextRoute:i,$pathWithoutBase:s,$contextChildRoutes:o}),n.$inject_state=w=>{"fallback"in w&&t(6,d=w.fallback),"path"in w&&t(7,p=w.path)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&448&&is(m,r=Vr(f,u,d,p,i),r),n.$$.dirty&1&&(O==null||O.update(r))},[r,s,o,m,g,O,d,p,i,l,a]}class it extends ct{constructor(e){super(e),dt(this,e,ms,Yt,bn,{fallback:6,path:7}),Q("SvelteRegisterComponent",{component:this,tagName:"Route",options:e,id:Yt.name})}get fallback(){throw new tt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fallback(e){throw new tt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get path(){throw new tt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set path(e){throw new tt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Gr=n=>{var a;const e=(a=n.target)==null?void 0:a.closest("a[href]"),t=e==null?void 0:e.href;if(e===null||t===null)return!0;const r=["","true"].includes(e.getAttribute("data-handle-ignore")??"false"),i=(e.getAttribute("target")??"_self")!=="_self",s=n.metaKey||n.ctrlKey||n.altKey||n.shiftKey,o=new URL(t).origin!==document.location.origin;if(r||i||s||o)return!0;t===document.location.href?Hr.replace(t):Hr.push(t),n.preventDefault()},An=n=>(n.addEventListener("click",Gr),{destroy:()=>{n.removeEventListener("click",Gr)}}),gs="Users/jycouet/mdev/gh/lib/remult-kit/node_modules/.pnpm/svelte-micro@2.5.6_svelte@4.2.12/node_modules/svelte-micro/dist/lib/components/Link.svelte";function er(n){let e,t,r,i;const s=n[5].default,o=kn(s,n,n[4],null);let a=[{href:n[0]},n[1]],l={};for(let u=0;u<a.length;u+=1)l=zt(l,a[u]);const f={c:function(){e=x("a"),o&&o.c(),xr(e,l),U(e,gs,15,0,417)},l:function(d){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(d,p){Y(d,e,p),o&&o.m(e,null),t=!0,r||(i=[Mt(An.call(null,e)),$e(e,"click",n[6],!1,!1,!1,!1)],r=!0)},p:function(d,[p]){o&&o.p&&(!t||p&16)&&In(o,s,d,d[4],t?En(s,d[4],p,null):On(d[4]),null),xr(e,l=us(a,[(!t||p&1)&&{href:d[0]},p&2&&d[1]]))},i:function(d){t||(le(o,d),t=!0)},o:function(d){he(o,d),t=!1},d:function(d){d&&Z(e),o&&o.d(d),r=!1,Dt(i)}};return Q("SvelteRegisterBlock",{block:f,id:er.name,type:"component",source:"",ctx:n}),f}const zr=(n,e,t)=>(n==="hash"?"#":"")+(e??"")+t;function ws(n,e,t){let r;const i=["href"];let s=Jr(e,i),o;Ze(Ve,"options"),et(n,Ve,d=>t(3,o=d));let{$$slots:a={},$$scope:l}=e;ht("Link",a,["default"]);let{href:f}=e;n.$$.on_mount.push(function(){f===void 0&&!("href"in e||n.$$.bound[n.$$.props.href])&&console.warn("<Link> was created without expected prop 'href'")});function u(d){ls.call(this,n,d)}return n.$$set=d=>{e=zt(zt({},e),as(d)),t(1,s=Jr(e,i)),"href"in d&&t(2,f=d.href),"$$scope"in d&&t(4,l=d.$$scope)},n.$capture_state=()=>({getFormatedHref:zr,options:Ve,linkHandle:An,href:f,formatedHref:r,$options:o}),n.$inject_state=d=>{"href"in e&&t(2,f=d.href),"formatedHref"in e&&t(0,r=d.formatedHref)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&12&&t(0,r=zr(o.mode,o.basePath,f))},[r,s,f,o,l,a,u]}class vr extends ct{constructor(e){super(e),dt(this,e,ws,er,bn,{href:2}),Q("SvelteRegisterComponent",{component:this,tagName:"Link",options:e,id:er.name})}get href(){throw new Error("<Link>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set href(e){throw new Error("<Link>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}function yt(n){n.focus()}const vt="src/lib/modules/auth/components/ForgottenPassword.svelte";function tr(n){let e,t,r,i,s,o,a;const l={c:function(){e=x("div"),t=x("form"),r=x("input"),i=me(),s=x("button"),s.textContent="Send password reset instructions",ne(r,"type","text"),ne(r,"placeholder","Your email address"),U(r,vt,21,8,437),U(s,vt,22,8,514),ne(t,"class","s-YGXJmi8diuJx"),U(t,vt,20,4,422),ne(e,"class","login"),U(e,vt,19,0,398)},l:function(u){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(u,d){Y(u,e,d),B(e,t),B(t,r),B(t,i),B(t,s),o||(a=Mt(yt.call(null,r)),o=!0)},p:ye,i:ye,o:ye,d:function(u){u&&Z(e),o=!1,a()}};return Q("SvelteRegisterBlock",{block:l,id:tr.name,type:"component",source:"",ctx:n}),l}function bs(n,e,t){let{$$slots:r={},$$scope:i}=e;ht("ForgottenPassword",r,[]);let{remultKitData:s}=e;n.$$.on_mount.push(function(){s===void 0&&!("remultKitData"in e||n.$$.bound[n.$$.props.remultKitData])&&console.warn("<ForgottenPassword> was created without expected prop 'remultKitData'")});const o=["remultKitData"];return Object.keys(e).forEach(a=>{!~o.indexOf(a)&&a.slice(0,2)!=="$$"&&a!=="slot"&&console.warn(`<ForgottenPassword> was created with unknown prop '${a}'`)}),n.$$set=a=>{"remultKitData"in a&&t(0,s=a.remultKitData)},n.$capture_state=()=>({autofocus:yt,remultKitData:s}),n.$inject_state=a=>{"remultKitData"in a&&t(0,s=a.remultKitData)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&(s||t(0,s={props:{paths:{base:"/kit/auth",login:"/login",forgottenPassword:"/forgotten-password"}}}))},[s]}class Pn extends ct{constructor(e){super(e),dt(this,e,bs,tr,Lt,{remultKitData:0}),Q("SvelteRegisterComponent",{component:this,tagName:"ForgottenPassword",options:e,id:tr.name})}get remultKitData(){throw new Error("<ForgottenPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new Error("<ForgottenPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class Ie{constructor(...e){c(this,"fields");c(this,"options");c(this,"target");c(this,"readonly");c(this,"allowNull");c(this,"dbReadOnly");c(this,"isServerExpression");c(this,"key");c(this,"caption");c(this,"inputType");c(this,"dbName");c(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t="";return this.fields.forEach(r=>{t.length>0&&(t+=","),t+=e[r.key]}),t}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},i=e.toString().split(",");return this.fields.forEach((s,o)=>{t[s.key]=i[o]}),t}}function W(n,e=!0){var r;let t=n[Re];if(!t&&e)throw new Error("item "+(((r=n.constructor)==null?void 0:r.name)||n)+" was not initialized using a context");return t}const Re=Symbol.for("entityMember"),vs=Symbol.for("entityInfo"),ks=Symbol.for("entityInfo_key");function ue(n,e=!0){if(n===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=n[vs];if(!t&&e)throw new Error(n.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function _s(n){return n[ks]}const Is=Symbol.for("relationInfo");function Os(n){return n==null?void 0:n[Is]}const rr=Symbol.for("fieldRelationInfo");function $(n){return n[rr]}function Es(n,e,t){for(const r of n.fields.toArray()){const i=Os(r.options);if(i&&!r[rr]){const s=i.toType(),o=e.repo(s,t),a=r.options;r[rr]={type:i.type,toEntity:s,options:a,toRepo:o,getFields:()=>{let l=a.field,f={fields:a.fields,compoundIdField:void 0};function u(m){return Error(`Error for relation: "${r.key}" to "${o.metadata.key}": `+m)}let d=()=>l||f.fields;if(i.type==="toMany"&&!d()){for(const m of o.fields.toArray())if(!d()){const g=$(m),k=m.options;if(g&&g.toEntity===n.metadata.entityType){if(g.type==="reference")l=m.key;else if(g.type==="toOne"){if(k.field)l=k.field;else if(k.fields){let O={};for(const D in k.fields)if(Object.prototype.hasOwnProperty.call(k.fields,D)){const w=k.fields[D];O[w]=D}f.fields=O}}}}if(!d())throw u("No matching field found on target. Please specify field/fields")}function p(m,g){const k=g.fields.find(m);if(!k)throw u(`Field "${m}" was not found in "${g.key}".`);return k}i.type==="reference"&&(l=r.key),l&&(i.type==="toOne"||i.type==="reference"?o.metadata.idMetadata.field instanceof Ie?f.compoundIdField=l:f.fields={[o.metadata.idMetadata.field.key]:l}:n.metadata.idMetadata.field instanceof Ie?f.compoundIdField=l:f.fields={[l]:n.metadata.idMetadata.field.key});for(const m in f.fields)Object.prototype.hasOwnProperty.call(f.fields,m)&&(p(m,o.metadata),p(f.fields[m],n.metadata));return f}}}}}class R{constructor(e){c(this,"apply");this.apply=e}static createCustom(e,t=""){let r={key:t,rawFilterTranslator:e};return Object.assign(i=>{if(i==null&&(i={}),!r.key)throw"Usage of custom filter before a key was assigned to it";return{[Le+r.key]:i}},{rawFilterInfo:r})}static entityFilterToJson(e,t){return R.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return Rn(e,{get:r=>t[r]})}static fromEntityFilter(e,t){let r=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let s=t[i];if(i=="$or")r.push(new Ts(...s.map(o=>R.fromEntityFilter(e,o))));else if(i=="$and")r.push(new Xr(...s.map(o=>R.fromEntityFilter(e,o))));else if(i.startsWith(Le))r.push(new R(o=>{o.custom(i.substring(Le.length),s)}));else if(i==Fn)r.push(new R(o=>o.databaseCustom(s)));else{const o=e.fields[i],a=$(o),l=o.options;let f=(a==null?void 0:a.type)==="toOne"?l.fields?new Ss(o,e.fields,l):new Cs(e.fields[l.field]):new St(o),u=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const d in s)if(Object.prototype.hasOwnProperty.call(s,d)){const p=s[d];switch(d){case"$gte":case">=":r.push(f.isGreaterOrEqualTo(p)),u=!0;break;case"$gt":case">":r.push(f.isGreaterThan(p)),u=!0;break;case"$lte":case"<=":r.push(f.isLessOrEqualTo(p)),u=!0;break;case"$lt":case"<":r.push(f.isLessThan(p)),u=!0;break;case"$ne":case"!=":case"$nin":u=!0,Array.isArray(p)?r.push(f.isNotIn(p)):r.push(f.isDifferentFrom(p));break;case"$in":u=!0,r.push(f.isIn(p));break;case"$contains":u=!0,r.push(f.contains(p));break;case"$notContains":u=!0,r.push(f.notContains(p));break}}Array.isArray(s)&&(u=!0,r.push(f.isIn(s)))}!u&&s!==void 0&&r.push(f.isEqualTo(s))}}return new Xr(...r)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new kr;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,r){let i=new _r(async(s,o)=>{let a=[];for(const l in t.entityType){const f=t.entityType[l];f&&f.rawFilterInfo&&f.rawFilterInfo.rawFilterTranslator&&f.rawFilterInfo.key==s&&a.push(await R.fromEntityFilter(t,await f.rawFilterInfo.rawFilterTranslator(o,r)))}return a});return e.__applyToConsumer(i),await i.resolve(),e=new R(s=>i.applyTo(s)),e}}class St{constructor(e){c(this,"metadata");this.metadata=e}processVal(e){if(ue(this.metadata.valueType,!1)){if(!e){if(e===null&&!this.metadata.allowNull){const r=$(this.metadata);if((r==null?void 0:r.type)==="reference")return r.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:W(e).getId()}return e}contains(e){return new R(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new R(t=>t.notContainsCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new R(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new R(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new R(t=>{for(const r of e)t.isDifferentFrom(this.metadata,this.processVal(r))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new R(t=>t.isNotNull(this.metadata)):new R(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new R(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new R(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new R(t=>t.isNull(this.metadata)):new R(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new R(t=>t.isEqualTo(this.metadata,e[0])):new R(t=>t.isIn(this.metadata,e))}}class Cs extends St{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:W(e).getId():null}}class Ss{constructor(e,t,r){c(this,"metadata");c(this,"fields");c(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=r}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new R(t=>{e.forEach(r=>this.isDifferentFrom(r).__applyToConsumer(t))})}isDifferentFrom(e){return new R(t=>{const r=[];for(const i in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,i)){const s=this.relationOptions.fields[i];r.push(new R(o=>new St(this.fields.find(s)).isDifferentFrom(e[i]).__applyToConsumer(o)))}t.or(r)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new R(t=>{for(const r in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,r)){const i=this.relationOptions.fields[r];new St(this.fields.find(i)).isEqualTo(e[r]).__applyToConsumer(t)}})}isIn(e){return new R(t=>{t.or(e.map(r=>this.isEqualTo(r)))})}}class Xr extends R{constructor(...t){super(r=>{for(const i of this.filters)i&&i.__applyToConsumer(r)});c(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class Ts extends R{constructor(...t){super(r=>{let i=this.filters.filter(s=>s!==void 0);i.length>1?r.or(i):i.length==1&&i[0].__applyToConsumer(r)});c(this,"filters");this.filters=t}}const Le="$custom$",Fn="$db$",nr="$an array";class kr{constructor(){c(this,"result",{});c(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[nr]:t}),this.add(Le+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let r=this.result;if(!r[e]){r[e]=t;return}let i=r[e];i instanceof Array?i.push(t):i=[i,t],r[e]=i}or(e){this.add("OR",e.map(t=>{let r=new kr;return t.__applyToConsumer(r),r.result}))}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(r=>e.valueConverter.toJson(r)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}}function Rn(n,e){let t=[];[...n.fields].forEach(s=>{function o(l,f,u=!1,d=!1){let p=e.get(s.key+l);if(p!==void 0){let m=g=>{let k=g;if(u){let D;typeof g=="string"?D=JSON.parse(g):D=g,k=D.map(w=>d?w:s.valueConverter.fromJson(w))}else k=d?k:s.valueConverter.fromJson(k);let O=f(k);O!==void 0&&t.push({[s.key]:O})};if(!u&&p instanceof Array)p.forEach(g=>{m(g)});else{u&&typeof p=="string"&&(p=JSON.parse(p));const g=i(p);for(const k of g)m(k)}}}o("",l=>l),o(".gt",l=>({$gt:l})),o(".gte",l=>({$gte:l})),o(".lt",l=>({$lt:l})),o(".lte",l=>({$lte:l})),o(".ne",l=>({$ne:l})),o(".in",l=>l,!0);var a=e.get(s.key+".null");if(a)switch(a=a.toString().trim().toLowerCase(),a){case"y":case"true":case"yes":t.push({[s.key]:null});break;default:t.push({[s.key]:{$ne:null}});break}o(".contains",l=>({$contains:l}),!1,!0),o(".notContains",l=>({$notContains:l}),!1,!0)});let r=e.get("OR");if(r){const o=i(r).map(a=>({$or:a.map(l=>Rn(n,{get:f=>l[f]}))}));o.length==1?t.push(o[0]):t.push({$and:o})}for(const s in n.entityType){const o=n.entityType[s];if(o&&o.rawFilterInfo&&o.rawFilterInfo.rawFilterTranslator){let a=e.get(Le+s);if(a!==void 0){const l=f=>{f[nr]!=null&&(f=f[nr]),t.push({[Le+s]:f})};Array.isArray(a)?a.forEach(f=>l(f)):l(a)}}}if(t.length==1)return t[0];return{$and:t};function i(s){if(!Array.isArray(s))return[s];const o=[],a=[];for(const l of s)Array.isArray(l)?a.push(l):o.push(l);return a.push(o),a}}class _r{constructor(e){c(this,"translateCustom");c(this,"commands",[]);c(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async r=>{let i=new _r(this.translateCustom);return r.__applyToConsumer(i),await i.resolve(),new R(s=>i.applyTo(s))})).then(r=>{t=r})),this.commands.push(r=>r.or(t))}isEqualTo(e,t){this.commands.push(r=>r.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(r=>r.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(r=>r.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(r=>r.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(r=>r.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(r=>r.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(r=>r.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(r=>r.notContainsCaseInsensitive(e,t))}isIn(e,t){this.commands.push(r=>r.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let r=await this.translateCustom(e,t);r&&(Array.isArray(r)?r.forEach(i=>i.__applyToConsumer(this)):r.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}var As={};const Wt=Symbol.for("remult-static1");let ir={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:n=>n(),startBusyWithProgress:()=>({progress:n=>{},close:()=>{}})},captionTransformer:void 0};typeof process<"u"&&As.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[Wt]>"u"?globalThis[Wt]=ir:ir=globalThis[Wt];const I=ir;function Ps(){return I.defaultRemult||(I.defaultRemult=I.defaultRemultFactory()),I.defaultRemult}function Dn(){I.remultFactory=()=>Ps()}Dn();function Me(n){const e=n;if(typeof e[lt]=="function")return e[lt]();throw Error("Error getting repository internal from "+n)}const lt=Symbol.for("getInternal");class Fs{constructor(){c(this,"iAmRemultProxy",!0);c(this,"repoCache",new Map);c(this,"repo",(...e)=>{let t=I,r=this.repoCache.get(e[0]);r||this.repoCache.set(e[0],r=new Map);let i=r.get(e[1]);return i||(i={get fields(){return I.remultFactory().repo(...e).metadata.fields},[lt](){return t.remultFactory().repo(...e)[lt]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...o)=>t.remultFactory().repo(...e).validate(s,...o),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),find:(...s)=>t.remultFactory().repo(...e).find(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,o)=>t.remultFactory().repo(...e).findId(s,o),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,o)=>t.remultFactory().repo(...e).fromJson(s,o),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return I.remultFactory().repo(...e).metadata},query:(...s)=>t.remultFactory().repo(...e).query(...s),save:s=>t.remultFactory().repo(...e).save(s),update:(s,o)=>t.remultFactory().repo(...e).update(s,o)},r.set(e[1],i),i)})}get liveQuerySubscriber(){return I.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){I.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return I.remultFactory().liveQueryStorage}set liveQueryStorage(e){I.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return I.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){I.remultFactory().liveQueryPublisher=e}call(e,t,...r){return I.remultFactory().call(e,t,...r)}get context(){return I.remultFactory().context}get dataProvider(){return I.remultFactory().dataProvider}set dataProvider(e){I.remultFactory().dataProvider=e}get repCache(){return I.remultFactory().repCache}authenticated(){return I.remultFactory().authenticated()}isAllowed(e){return I.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return I.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return I.remultFactory().clearAllCache()}get user(){return I.remultFactory().user}set user(e){I.remultFactory().user=e}get apiClient(){return I.remultFactory().apiClient}set apiClient(e){I.remultFactory().apiClient=e}get subscriptionServer(){return I.remultFactory().subscriptionServer}set subscriptionServer(e){I.remultFactory().subscriptionServer=e}}const de=new Fs;function Rs(n){return n.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail").replace(" I D"," ID")}class Ds{constructor(e,t,r){c(this,"repository");c(this,"isReferenceRelation");c(this,"allowNull");c(this,"storedItem");c(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=r}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:Me(this.repository).getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=Me(this.repository).getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=W(e,!1);t&&!this.isReferenceRelation?(Me(this.repository).addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class Yr{constructor(e){c(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var r in e){let i=e[r];this.add(r+t,i)}}}function mt(n){if(!n)return new Zr;let e;return e||Ln(n)&&(e=new Ls(n)),e||typeof n=="function"&&(e=new Zr(n)),e}function Ln(n){let e=n;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class Ls{constructor(e){c(this,"http");this.http=e}async post(e,t){return await Tt(()=>kt(this.http.post(e,t)))}delete(e){return kt(this.http.delete(e))}put(e,t){return kt(this.http.put(e,t))}async get(e){return await Tt(()=>kt(this.http.get(e)))}}async function Tt(n){var t,r,i,s;let e=0;for(;;)try{return await n()}catch(o){if(((t=o.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(r=o.message)!=null&&r.startsWith("Error occured while trying to proxy")||(i=o.message)!=null&&i.includes("http proxy error")||(s=o.message)!=null&&s.startsWith("Gateway Timeout")||o.status==500)&&e++<50){await new Promise((a,l)=>{setTimeout(()=>{a({})},250)});continue}throw o}}function kt(n){let e;return n.toPromise!==void 0?e=n.toPromise():e=n,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data?t.data:t).catch(async t=>{throw await Ms(t)})}async function Ms(n){var s,o,a;let e=await n;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(o=e==null?void 0:e.response)==null?void 0:o.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let r=e.status;r===void 0&&(r=(a=e.response)==null?void 0:a.status),r!=null&&(t.httpStatusCode=r);var i=Object.assign(t,{});return i}class Mn{constructor(e){c(this,"apiProvider");c(this,"isProxy",!0);this.apiProvider=e}getEntityDataProvider(e){return new Bs(()=>{var r;let t=(r=this.apiProvider())==null?void 0:r.url;return t==null&&(t="/api"),t+"/"+e.key},()=>mt(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function Ir(n,e){if(n.include){let t={};for(const r in n.include)if(Object.prototype.hasOwnProperty.call(n.include,r)){let i=n.include[r];if(typeof i=="object"){const s=$(e.fields.find(r));s&&(i=Ir(i,s.toRepo.metadata))}t[r]=i}n={...n,include:t}}return n.where&&(n={...n,where:R.entityFilterToJson(e,n.where)}),n.load&&(n={...n,load:n.load(e.fields).map(t=>t.key)}),n}class Bs{constructor(e,t,r){c(this,"url");c(this,"http");c(this,"entity");this.url=e,this.http=t,this.entity=r}translateFromJson(e){let t={};for(const r of this.entity.fields)t[r.key]=r.valueConverter.fromJson(e[r.key]);return t}translateToJson(e){let t={};for(const r of this.entity.fields)t[r.key]=r.valueConverter.toJson(e[r.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(r=>+r.count)}find(e){let{run:t}=this.buildFindRequest(e);return t().then(r=>r.map(i=>this.translateFromJson(i)))}buildFindRequest(e){let t=new Yr(this.url()),r;if(e){if(e.where&&(r=e.where.toJson(),qs(r,t)&&(r=void 0)),e.orderBy&&e.orderBy.Segments){let s="",o="",a=!1;e.orderBy.Segments.forEach(l=>{s.length>0&&(s+=",",o+=","),s+=l.field.key,o+=l.isDescending?"desc":"asc",l.isDescending&&(a=!0)}),s&&t.add("_sort",s),a&&t.add("_order",o)}e.limit&&t.add("_limit",e.limit),e.page&&t.add("_page",e.page)}const i=s=>{let o=new Yr(t.url);return!s&&r&&(s="get"),s&&o.add("__action",s),r?this.http().post(o.url,r):this.http().get(o.url)};return{createKey:()=>JSON.stringify({url:t,filterObject:r}),run:i,subscribe:async s=>({result:await i(js+s),unsubscribe:async()=>I.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:s}))})}}update(e,t){let r={},i=Object.keys(t);for(const s of this.entity.fields)i.includes(s.key)&&(r[s.key]=s.valueConverter.toJson(t[s.key]));return this.http().put(this.url()+"/"+encodeURIComponent(e),r).then(s=>this.translateFromJson(s))}delete(e){return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}}class Zr{constructor(e){c(this,"fetch");this.fetch=e}async get(e){return await Tt(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await Tt(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const r={};if(t!=null&&t.body&&(r["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const i of window.document.cookie.split(";"))i.trim().startsWith("XSRF-TOKEN=")&&(r["X-XSRF-TOKEN"]=i.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:r}).then(i=>Ns(i)).catch(async i=>{throw await i})}}function Ns(n){if(n.status!=204){if(n.status>=200&&n.status<300)return n.json();throw n.json().then(e=>({...e,message:e.message||n.statusText,url:n.url,status:n.status})).catch(()=>{throw{message:n.statusText,url:n.url,status:n.status}})}}function qs(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const r=n[t];if(Array.isArray(r)&&(r.length>0&&typeof r[0]=="object"||r.length>10))return!1}for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const r=n[t];Array.isArray(r)?t.endsWith(".in")?e.add(t,JSON.stringify(r)):r.forEach(i=>e.add(t,i)):t.startsWith(Le)?e.add(t,JSON.stringify(r)):e.add(t,r)}return!0}const js="liveQuery-";var _t,Js=new Uint8Array(16);function xs(){if(!_t&&(_t=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!_t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _t(Js)}const Us=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Hs(n){return typeof n=="string"&&Us.test(n)}var X=[];for(var $t=0;$t<256;++$t)X.push(($t+256).toString(16).substr(1));function Ws(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(X[n[e+0]]+X[n[e+1]]+X[n[e+2]]+X[n[e+3]]+"-"+X[n[e+4]]+X[n[e+5]]+"-"+X[n[e+6]]+X[n[e+7]]+"-"+X[n[e+8]]+X[n[e+9]]+"-"+X[n[e+10]]+X[n[e+11]]+X[n[e+12]]+X[n[e+13]]+X[n[e+14]]+X[n[e+15]]).toLowerCase();if(!Hs(t))throw TypeError("Stringified UUID is invalid");return t}function sr(n,e,t){n=n||{};var r=n.random||(n.rng||xs)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Ws(r)}class oe{constructor(...e){c(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new oe;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,r){r||(r=s=>s.key);let i=0;for(let s=0;s<this.Segments.length;s++){let o=this.Segments[s],a=en(e[r(o.field)]),l=en(t[r(o.field)]);if(a>l?i=1:a<l&&(i=-1),i!=0)return o.isDescending&&(i*=-1),i}return i}static translateOrderByToSort(e,t){if(!t)return;let r=new oe;if(t){for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];let o=e.fields.find(i);const a=l=>{switch(s){case"desc":r.Segments.push({field:l,isDescending:!0});break;case"asc":r.Segments.push({field:l})}};if(o){const l=$(o);if((l==null?void 0:l.type)==="toOne"){const f=l.options;if(typeof f.field=="string")a(e.fields.find(f.field));else if(f.fields){for(const u in f.fields)if(Object.prototype.hasOwnProperty.call(f.fields,u)){const d=f.fields[u];a(e.fields.find(d.toString()))}}}else a(o)}}}return r}static createUniqueSort(e,t){if((!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=oe.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new oe({field:e.idMetadata.field})),e.idMetadata.field instanceof Ie)for(const r of e.idMetadata.field.fields)t.Segments.find(i=>i.field==r)||t.Segments.push({field:r});else t.Segments.find(r=>r.field==e.idMetadata.field)||t.Segments.push({field:e.idMetadata.field});return t}static createUniqueEntityOrderBy(e,t){if((!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={[e.idMetadata.field.key]:"asc"},e.idMetadata.field instanceof Ie)for(const r of e.idMetadata.field.fields)t[r.key]||(t[r.key]="asc");else t[e.idMetadata.field.key]||(t[e.idMetadata.field.key]="asc");return t}}function en(n){return n==null||n==null?n:n.id!==void 0?n.id:n}const Vt="stream";class $s{constructor(e,t,r){c(this,"repo");c(this,"query");c(this,"queryChannel");c(this,"subscribeCode");c(this,"unsubscribe",()=>{});c(this,"defaultQueryState",[]);c(this,"listeners",[]);c(this,"id",sr());this.repo=e,this.query=t,this.queryChannel=`users:${r}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await Me(this.repo).fromJsonArray(e,this.query.options);this.forListeners(r=>{r(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(r=>{if(this.defaultQueryState=r(this.defaultQueryState),t.find(i=>i.type==="add"||i.type==="replace")&&this.query.options.orderBy){const i=oe.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,o)=>i.compare(s,o))}});for(const r of this.listeners)e(i=>{r.next(this.createReducerType(i,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:i})=>i=="add"||i=="replace"),r=await Me(this.repo).fromJsonArray(t.map(i=>i.data.item),this.query.options);for(let i=0;i<t.length;i++){const s=t[i];s.data.item=r[i]}}this.forListeners(t=>{t(r=>{r||(r=[]);for(const i of e)switch(i.type){case"all":this.setAllItems(i.data);break;case"replace":{r=r.map(s=>this.repo.metadata.idMetadata.getId(s)===i.data.oldId?i.data.item:s);break}case"add":r=r.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(i.data.item)),r.push(i.data.item);break;case"remove":r=r.filter(s=>this.repo.metadata.idMetadata.getId(s)!==i.data.id);break}return r})},e)}}const Vs="_liveQueryKeepAlive";class Ks{constructor(e,t){c(this,"apiProvider");c(this,"getUserId");c(this,"queries",new Map);c(this,"channels",new Map);c(this,"client");c(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let r=()=>{};const i=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new Qs);try{s.unsubscribe=await i.subscribe(e,o=>this.wrapMessageHandling(()=>s.handle(o)),o=>{t.error(o)})}catch(o){throw t.error(o),o}}s.listeners.push(t),r=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{r(),r=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,r){let i=!0,s=()=>{i=!1};return this.runPromise(Me(e).buildEntityDataProviderFindOptions(t).then(o=>{if(!i)return;const{createKey:a,subscribe:l}=new Mn(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(o),f=a();let u=this.queries.get(f);u?u.sendDefaultState(r.next):(this.queries.set(f,u=new $s(e,{entityKey:e.metadata.key,options:t},this.getUserId())),u.subscribeCode=()=>{u.unsubscribe&&(u.unsubscribe(),u.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(u.queryChannel,{next:d=>this.runPromise(u.handle(d)),complete:()=>{},error:d=>{u.listeners.forEach(p=>p.error(d))}}).then(d=>{if(u.listeners.length==0){d();return}this.runPromise(l(u.queryChannel).then(p=>{if(u.listeners.length===0){p.unsubscribe(),d();return}this.runPromise(u.setAllItems(p.result)),u.unsubscribe=()=>{u.unsubscribe=()=>{},d(),this.runPromise(p.unsubscribe())}}).catch(p=>{u.listeners.forEach(m=>m.error(p)),d(),this.queries.delete(f)}))})).catch(d=>{u.listeners.forEach(p=>p.error(d))})},u.subscribeCode()),u.listeners.push(r),s=()=>{u.listeners.splice(u.listeners.indexOf(r),1),r.complete(),u.listeners.length==0&&(this.queries.delete(f),u.unsubscribe()),this.closeIfNoListeners()}}).catch(o=>{r.error(o)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const r=await this.runPromise(await I.actionInfo.runActionWithoutBlockingUI(()=>mt(t.httpClient).post(t.url+"/"+Vs,e)));for(const i of r)for(const s of this.queries.values())s.queryChannel===i&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class Qs{constructor(){c(this,"id");c(this,"unsubscribe",()=>{});c(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class Or{openConnection(e){let t;const r=new Map,i=mt(de.apiClient.httpClient);let s=!1,o;const a={close(){o.close()},async subscribe(u,d){let p=r.get(u);return p||(r.set(u,p=[]),await f(u)),p.push(d),()=>{p.splice(p.indexOf(d,1)),p.length==0&&(I.actionInfo.runActionWithoutBlockingUI(()=>i.post(de.apiClient.url+"/"+Vt+"/unsubscribe",{channel:u,clientId:t})),r.delete(u))}}},l=()=>new Promise(u=>{d();function d(){o&&o.close(),o=Or.createEventSource(de.apiClient.url+"/"+Vt),o.onmessage=p=>{let m=JSON.parse(p.data);const g=r.get(m.channel);g&&g.forEach(k=>k(m.data))},o.onerror=p=>{console.error("Live Query Event Source Error",p),o.close(),setTimeout(()=>{d()},500)},o.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const m of r.keys())await f(m);e()}else s=!0,u(a)})}});return l();async function f(u){await I.actionInfo.runActionWithoutBlockingUI(()=>i.post(de.apiClient.url+"/"+Vt+"/subscribe",{channel:u,clientId:t}))===Gs&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const Gs="client connection not found",or=Symbol.for("serverActionField");class zs{constructor(e){c(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){I.remultFactory=()=>{const e=I.asyncContext.getRemult();if(e)return e;throw new Error("remult object was requested outside of a valid context, try running it within initApi or a remult request cycle")}}static disable(){Dn()}run(e,t){this.remultObjectStorage?this.remultObjectStorage.run(e,()=>t(e)):t(e)}getRemult(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}I.asyncContext||(I.asyncContext=new zs(void 0));function ar(){return I.actionInfo.runningOnServer||!de.dataProvider.isProxy}class ge{constructor(e){c(this,"user");c(this,"dataProvider",new Mn(()=>this.apiClient));c(this,"repCache",new Map);c(this,"liveQueryStorage");c(this,"subscriptionServer");c(this,"liveQueryPublisher",{itemChanged:async()=>{}});c(this,"liveQuerySubscriber",new Ks(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));c(this,"context",{});c(this,"apiClient",{url:"/api",subscriptionClient:new Or});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if(Ln(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}repo(e,t){t===void 0&&(t=this.dataProvider);let r=this.repCache.get(t);r||this.repCache.set(t,r=new Map);let i=r.get(e);return i||(r.set(e,i=new Er(e,this,t,no(e,this))),Es(i,this,t)),i}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,r;if(e!=null){if(e instanceof Array){for(const i of e)if(this.isAllowed(i)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(r=(t=this.user)==null?void 0:t.roles)!=null&&r.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const r of t)if(this.isAllowedForInstance(e,r))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}call(e,t,...r){const i=e[or];if(!i.doWork)throw Error("The method received is not a valid backend method");return i.doWork(r,t,this.apiClient.url,mt(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}c(ge,"onFind",(e,t)=>{}),c(ge,"entityRefInit");I.defaultRemultFactory=()=>new ge;class Xs{constructor(){c(this,"classes",new Map)}}const Ys={defaultPageSize:200};async function Bn(n,e){const t=new Zs(n.liveQueryPublisher);let r=!0;await n.dataProvider.transaction(async i=>{n.dataProvider=i,n.liveQueryPublisher=t,await e(),r=!0}),r&&await t.flush()}class Zs{constructor(e){c(this,"orig");c(this,"transactionItems",new Map);this.orig=e}async itemChanged(e,t){let r=this.transactionItems.get(e);r||this.transactionItems.set(e,r=[]);for(const i of t)if(i.oldId!==void 0){const s=r.find(o=>o.id===i.oldId);s!==void 0?(i.deleted&&(s.deleted=!0),i.id!=s.id&&(s.id=i.id)):r.push(i)}else r.push(i)}async flush(){for(const e of this.transactionItems.keys())await this.orig.itemChanged(e,this.transactionItems.get(e))}}function Nn(n,e){return e&&Object.assign(n,e),n}class be{}c(be,"number","number"),c(be,"date","date"),c(be,"checkbox","checkbox"),c(be,"password","password"),c(be,"email","email"),c(be,"tel","tel"),c(be,"time","time");const A=class A{};c(A,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>A.Date.fromJson(e),toInput:e=>A.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),c(A,"DateOnly",{fromInput:e=>A.DateOnly.fromJson(e),toInput:e=>A.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:be.date,toDb:e=>e?A.DateOnly.fromJson(A.DateOnly.toJson(e)):null,fromDb:e=>A.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),c(A,"DateOnlyString",{...A.DateOnly,toDb:e=>{let t=A.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),c(A,"Boolean",{toDb:e=>e,inputType:be.checkbox,fromDb:e=>A.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>A.Boolean.fromJson(e),toInput:e=>A.Boolean.toJson(e)}),c(A,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>A.Number.fromDb(e),toJson:e=>A.Number.toDb(e),fromInput:(e,t)=>{let r=+e;if(e)return r},toInput:(e,t)=>e==null?void 0:e.toString(),inputType:be.number}),c(A,"String",{fromDb:xe,toDb:xe,fromJson:xe,toJson:xe,fromInput:xe,toInput:xe}),c(A,"Integer",{...A.Number,toJson:e=>{let t=A.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>A.Integer.toJson(e),fieldTypeInDb:"integer"}),c(A,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>A.JsonString.fromDb(e),toDb:e=>A.JsonString.toDb(e),fromInput:e=>A.Default.fromJson(e),toInput:e=>A.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),c(A,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(A.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(A.JsonString.toJson(e)):void 0,fromInput:e=>A.JsonString.fromJson(e),toInput:e=>A.JsonString.toJson(e)}),c(A,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>A.JsonString.fromJson(e),toInput:e=>A.JsonString.toJson(e),fieldTypeInDb:"json"});let se=A;function xe(n){return n==null?n:typeof n!="string"?n.toString():n}function tn(n,e,t){let r=R.fromEntityFilter(n,e);const i=()=>{};r&&r.__applyToConsumer({custom:i,databaseCustom:i,containsCaseInsensitive:i,notContainsCaseInsensitive:i,isDifferentFrom:i,isEqualTo:(s,o)=>{t[s.key]=o},isGreaterOrEqualTo:i,isGreaterThan:i,isIn:i,isLessOrEqualTo:i,isLessThan:i,isNotNull:i,isNull:i,or:i})}class rn{constructor(){c(this,"entityLoaders",new Map);c(this,"promises",[])}load(e,t){let r=this.entityLoaders.get(e.entityType);r||this.entityLoaders.set(e.entityType,r=new eo(e));const i=r.find(t);return this.promises.push(i),i}async resolveAll(){for(const t of this.entityLoaders.values())for(const r of t.queries.values())r.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class eo{constructor(e){c(this,"rel");c(this,"queries",new Map);this.rel=e}find(e){const{where:t,...r}=Ir(e,this.rel.metadata),i=JSON.stringify(r);let s=this.queries.get(i);return s||this.queries.set(i,s=new to(this.rel)),s.find(e,t)}}class to{constructor(e){c(this,"rel");c(this,"pendingInStatements",new Map);c(this,"whereVariations",new Map);this.rel=e}find(e,t){const r=JSON.stringify(t);let i=this.whereVariations.get(r);if(!i){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let o=this.pendingInStatements.get(s[0]);o||this.pendingInStatements.set(s[0],o=new ro(this.rel,s[0],e)),this.whereVariations.set(r,i={result:o.find(t)})}else this.whereVariations.set(r,i={result:this.rel.find(e)})}return i.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class ro{constructor(e,t,r){c(this,"rel");c(this,"key");c(this,"options");c(this,"values",new Map);this.rel=e,this.key=t,this.options=r}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(i=>i.value)},t.limit=1e3,t.page=1;let r=[];try{for(;;){const i=await this.rel.find(t);if(r.push(...i),i.length<t.limit)break;t.page++}for(const i of this.values.values())i.resolve(r.filter(s=>{const a=W(s).fields.find(this.key),l=$(a.metadata),f=(l==null?void 0:l.type)==="reference"?a.getId():s[this.key];return i.value==f}))}catch(i){for(const s of this.values.values())s.reject(i)}}find(e){const t=e[this.key];let r=this.values.get(t);if(!r){let i,s,o=new Promise((a,l)=>{i=a,s=l});this.values.set(t,r={value:t,resolve:i,reject:s,result:o})}return r.result}}class Er{constructor(e,t,r,i,s){c(this,"entity");c(this,"remult");c(this,"dataProvider");c(this,"_info");c(this,"defaultFindOptions");c(this,"__edp");c(this,"idCache",new Map);c(this,"listeners");c(this,"cache",new Map);this.entity=e,this.remult=t,this.dataProvider=r,this._info=i,this.defaultFindOptions=s}[lt](){return this}async createAfterFilter(e,t){let r=new Map;for(const o of oe.translateOrderByToSort(this.metadata,e).Segments){let a=t[o.field.key];r.set(o.field.key,a)}let i={$or:[]},s=[];for(const o of oe.translateOrderByToSort(this.metadata,e).Segments){let a={};for(const l of s)a[l.key]=r.get(l.key);s.push(o.field),o.isDescending?a[o.field.key]={$lt:r.get(o.field.key)}:a[o.field.key]={$gt:r.get(o.field.key)},i.$or.push(a)}return i}relations(e){return new Proxy({},{get:(t,r)=>{const i=this.fields.find(r),s=$(i);if(!s)throw Error(r+" is not a relation");const{toRepo:o,returnNull:a,returnUndefined:l}=this.getFocusedRelationRepo(i,e);return s.type==="toMany"?o:{findOne:f=>a?Promise.resolve(null):l?Promise.resolve(void 0):o.findFirst({},f)}}})}getFocusedRelationRepo(e,t){const r=$(e);let i=r.toRepo,{findOptions:s,returnNull:o,returnUndefined:a}=this.findOptionsBasedOnRelation(r,e,void 0,t,i);return{toRepo:new Er(i.entity,i.remult,i.dataProvider,i._info,s),returnNull:o,returnUndefined:a}}get edp(){return this.__edp?this.__edp:this.__edp=this.dataProvider.getEntityDataProvider(this.metadata)}getCachedById(e,t){e=e+"",this.getCachedByIdAsync(e,t);let r=this.idCache.get(e);if(!(r instanceof Promise))return r}async getCachedByIdAsync(e,t){e=e+"";let r=this.idCache.get(e);if(r instanceof Promise)return await r;if(this.idCache.has(e))return r;if(t)return;this.idCache.set(e,void 0);let i=this.findId(e).then(s=>(s===void 0?r=null:r=s,this.idCache.set(e,r),r));return this.idCache.set(e,i),await i}addToCache(e){e&&this.idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new uo(e,this)}getEntityRef(e){let t=e[Re];return t||(this.fixTypes(e),t=new It(this._info,e,this,this.edp,this.remult,!0),Object.defineProperty(e,Re,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=W(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this.dataProvider.isProxy)return this.edp.delete(e);{let i=await this.findId(e);if(i)return await W(i).delete()}}let r=this.getRefForExistingRow(e,void 0);return this.dataProvider.isProxy||await r.reload(),r.delete()}async insert(e){if(Array.isArray(e)){let t=[];for(const r of e)t.push(await this.insert(r));return t}else{let t=W(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let r=W(e,!1);if(r||(r=this.getEntityRef({...e})),!t||t.length===0)return await r.validate();{r.__clearErrorsAndReportChanged();let i=!1;for(const s of t)await r.fields.find(s).validate()||(i=!0);return i?r.buildErrorInfoObject():void 0}}}async update(e,t){{let i=W(t,!1);if(i)return await i.save()}{let i=W(e,!1);if(i)return Nn(e,t),i.save()}let r;if(typeof e=="object"?(r=this.getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(r.instance,t)):r=this.getRefForExistingRow(t,e),this.dataProvider.isProxy)return await r.save(Object.keys(t));{const i=await r.reload();if(!i)throw new Error("Not Found");for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let o=r.fields[s];if(t[s]===void 0&&$(o.metadata))continue;o&&(i[s]=t[s])}return await this.fixTypes(i),await r.save()}}getRefForExistingRow(e,t){let r=W(e,!1);if(!r){const i=new this.entity(this.remult);for(const o of this.fieldsOf(e))i[o.key]=e[o.key];this.fixTypes(i);let s=new It(this._info,i,this,this.edp,this.remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),r=s,Object.defineProperty(i,Re,{get:()=>s})}return r}async save(e){if(Array.isArray(e))return Promise.all(e.map(t=>this.save(t)));{let t=W(e,!1);if(t)return await t.save();if(e instanceof Hn)return await this.getEntityRef(e).save();{let r=this.metadata.idMetadata.getId(e);return r===void 0?this.insert(e):this.update(r,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let r=t;return typeof t=="function"&&(r={next:t,complete:()=>{},error:()=>{}}),r.error??(r.error=()=>{}),r.complete??(r.complete=()=>{}),this.remult.liveQuerySubscriber.subscribe(this,e,r)}}}async rawFind(e,t=!1,r){e||(e={}),this.defaultFindOptions&&(e={...this.defaultFindOptions,...e});let i=await this.buildEntityDataProviderFindOptions(e);t&&(delete i.orderBy,delete i.limit),ge.onFind(this._info,e);const s=await this.edp.find(i);return await this.loadManyToOneForManyRows(s,e,r)}async find(e,t=!1){const r=new rn,i=await this.rawFind(e,t,r);return await r.resolveAll(),i}async buildEntityDataProviderFindOptions(e){let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(e.orderBy=this._info.entityInfo.defaultOrderBy),t.where=await this.translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=oe.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async fromJsonArray(e,t){const r=new rn,i=await this.loadManyToOneForManyRows(e.map(s=>{let o={};for(const a of this.metadata.fields.toArray())o[a.key]=a.valueConverter.fromJson(s[a.key]);return o}),t,r);return await r.resolveAll(),i}async loadManyToOneForManyRows(e,t,r){var a;let i;t!=null&&t.load&&(i=t.load(this.metadata.fields));for(const l of this.metadata.fields)if(ue(l.valueType,!1)&&!$(l)){let d=!l.options.lazy;if(i!==void 0&&(d=i.includes(l)),d){let p=this.remult.repo(l.valueType),m=[];for(const g of e){let k=g[l.key];k!=null&&!m.includes(k)&&!p.idCache.has(k+"")&&m.push(k)}m.length>0&&await s(p,m)}}async function s(l,f){let u=await l.find({where:l.metadata.idMetadata.getIdFilter(...f)},!0);for(const d of u)l.addToCache(d)}let o=await Promise.all(e.map(async l=>await this.mapRawDataToResult(l,i)));for(const l of this.metadata.fields){let f=$(l),u=l.options.defaultIncluded;if(((a=t==null?void 0:t.include)==null?void 0:a[l.key])!==void 0&&(u=t.include[l.key]),f&&u){const d=f.toRepo;for(const p of o){let{findOptions:m,returnNull:g}=this.findOptionsBasedOnRelation(f,l,u,p,d);if(g)p[l.key]=null;else{const k=f.toEntity,O=d;r.load({entityType:k,find:D=>O.rawFind(D,!1,r),metadata:O.metadata},m).then(D=>{D.length==0&&f.type=="toOne"||(p[l.key]=f.type!=="toMany"?D.length==0?null:D[0]:D)})}}}}return o}findOptionsBasedOnRelation(e,t,r,i,s){let o=!1,a=!1,l=[],f={},u=[];typeof e.options.findOptions=="function"?u.push(e.options.findOptions(i)):typeof e.options.findOptions=="object"&&u.push(e.options.findOptions),typeof r=="object"&&u.push(r);for(const m of u){m.where&&l.push(m.where);for(const g of["limit","include","orderBy"])m[g]&&(f[g]=m[g])}const d=e.getFields(),p=m=>{let g=e.type==="reference"?W(i).fields.find(t.key).getId():i[m];return(e.type==="toOne"||e.type==="reference")&&(g===null?o=!0:g===void 0?a=!0:e.type==="reference"&&typeof g=="object"&&(g=s.metadata.idMetadata.getId(g))),g};d.compoundIdField&&(e.type==="toMany"?l.push({[d.compoundIdField]:this.metadata.idMetadata.getId(i)}):l.push(s.metadata.idMetadata.getIdFilter(p(d.compoundIdField))));for(const m in d.fields)Object.prototype.hasOwnProperty.call(d.fields,m)&&l.push({[m]:p(d.fields[m])});return f.where={$and:l},(e.type==="toOne"||e.type==="reference")&&f.orderBy&&(f.limit=1),{findOptions:f,returnNull:o,returnUndefined:a}}async mapRawDataToResult(e,t){if(!e)return;let r=new this.entity(this.remult),i=new It(this._info,r,this,this.edp,this.remult,!1);return Object.defineProperty(r,Re,{get:()=>i}),await i.loadDataFrom(e,t),i.saveOriginalData(),r}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(i=>this.fromJson(i,t));let r=new this.entity(this.remult);for(const i of this.fieldsOf(e))if(ue(i.valueType,!1)){let o=e[i.key];typeof o=="string"||typeof o=="number"?r[i.key]=o:r[i.key]=this.remult.repo(i.valueType).fromJson(o)}else e[i.key]!==void 0&&(r[i.key]=i.valueConverter.fromJson(e[i.key]));if(this.fixTypes(r),t)return this.create(r);{let i=new It(this._info,r,this,this.edp,this.remult,!1);return Object.defineProperty(r,Re,{get:()=>i}),i.saveOriginalData(),r}}async count(e){return this.edp.count(await this.translateWhereToFilter(e))}async findOne(e,t=!1){let r,i;if(e||(e={}),e.useCache){let s=Ir(e,this.metadata),o=JSON.stringify(s);if(i=this.cache.get(o),i!==void 0)if(i.value&&this.getEntityRef(i.value).wasDeleted())i=void 0,this.cache.delete(o);else return this.cache.get(o).promise;else i={value:void 0,promise:void 0},this.cache.set(o,i)}return r=this.find({...e,limit:1},t).then(async s=>{let o;return s.length>0&&(o=s[0]),!o&&e.createIfNotFound&&(o=this.create(),e.where&&await tn(this.metadata,e.where,o)),o}),i&&(i.promise=r=r.then(s=>(i.value=s,s))),r}async findFirst(e,t,r=!1){if(t||(t={}),e)if(t.where){let i=t.where;t.where={$and:[i,e]}}else t.where=e;return this.findOne(t,r)}fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(r=>t.includes(r.key))}create(e){var r;let t=new this.entity(this.remult);if(e){for(const i of this.fieldsOf(e))t[i.key]=e[i.key];this.fixTypes(t)}return(r=this.defaultFindOptions)!=null&&r.where&&(tn(this.metadata,this.defaultFindOptions.where,t),this.fixTypes(t)),this.getEntityRef(t),t}async fixTypes(e){for(const t of this.fieldsOf(e)){const r=e[t.key];if(r!=null)if(t.valueType===Date&&!(r instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(r));else for(const[i,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===i&&typeof r!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(r)))}return e}findId(e,t){if(e==null)return null;if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async translateWhereToFilter(e){var r,i;e||(e={}),(r=this.defaultFindOptions)!=null&&r.where&&(e={$and:[e,(i=this.defaultFindOptions)==null?void 0:i.where]}),this.metadata.options.backendPrefilter&&!this.dataProvider.isProxy&&(e={$and:[e,await R.resolve(this.metadata.options.backendPrefilter)]});let t=await R.fromEntityFilter(this.metadata,e);return t&&!this.dataProvider.isProxy&&(t=await R.translateCustomWhere(t,this.metadata,this.remult)),t}}function no(n,e){let t=I.columnsOfType.get(n);t||I.columnsOfType.set(n,t=[]);let r=ue(n)(e),i=_s(n),s=Object.getPrototypeOf(n);for(;s!=null;){let o=I.columnsOfType.get(s);o&&t.unshift(...o.filter(l=>!t.find(f=>f.key==l.key)));let a=ue(s,!1);if(a){let l=a(e);r={...l,...r};let f=["saving","saved","deleting","deleted","validation"];for(const u of f)if(l[u]&&l[u]!==r[u]){let d=r[u];r[u]=async(p,m)=>{await d(p,m),await l[u](p,m)}}}s=Object.getPrototypeOf(s)}return new ao(jn(t,e),r,e,n,i)}class qn{constructor(e,t,r,i){c(this,"fieldsMetadata");c(this,"instance");c(this,"remult");c(this,"isNewRow");c(this,"_error");c(this,"_subscribers");c(this,"_isLoading",!1);c(this,"lookups",new Map);c(this,"errors");c(this,"originalValues",{});var s;this.fieldsMetadata=e,this.instance=t,this.remult=r,this.isNewRow=i;{let o=r;o!=null&&o.iAmRemultProxy&&(r=I.remultFactory())}for(const o of e)if(ue(o.valueType,!1)&&r){let l=new Ds(r.repo(o.valueType),!!$(o),o.allowNull);this.lookups.set(o.key,l);let f=t[o.key],u;Object.defineProperty(t,o.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),u||(u=this.fields.find(o.key),u._subscribers||(u._subscribers=new Ot)),u._subscribers.reportObserved()),l.item),set:d=>{var p;l.set(d),(p=this._subscribers)==null||p.reportChanged(),u||(u=this.fields.find(o.key),u._subscribers||(u._subscribers=new Ot)),u._subscribers.reportChanged()},enumerable:!0}),l.set(f)}else if(((s=$(o))==null?void 0:s.type)==="toOne"){let l=t.hasOwnProperty(o.key),f=t[o.key];i&&!f&&(l=!1),Object.defineProperty(t,o.key,{get:()=>f,set:u=>{if(f=u,u===void 0)return;const d=o.options;if(d.field&&(this.instance[d.field]=$(o).toRepo.metadata.idMetadata.getId(u)),d.fields){for(const p in d.fields)if(Object.prototype.hasOwnProperty.call(d.fields,p)){const m=d.fields[p];this.instance[m]=u==null?null:u[p]}}},enumerable:!0}),l&&(t[o.key]=f)}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new Ot;for(const e of this.fieldsMetadata){let t=ue(e.valueType,!1),r=this.fields.find(e.key);if(r._subscribers=new Ot,!(t&&this.remult)){let i=this.instance[e.key];Object.defineProperty(this.instance,e.key,{get:()=>(this._subscribers.reportObserved(),r._subscribers.reportObserved(),i),set:s=>{i=s,this._subscribers.reportChanged(),r._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await Promise.all([...this.lookups.values()].map(e=>e.waitLoad()))}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const t of this.fieldsMetadata)if(this.errors[t.key]){e.message=this.fields[t.key].metadata.caption+": "+this.errors[t.key],this.error=e.message;break}}return e}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(i=>this.catchSaveErrors(i));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let r=t.modelState;throw r||(r=t.ModelState),r&&(this.errors=r),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const r of this.fieldsMetadata){let i=this.lookups.get(r.key),s;const o=$(r);i?s=i.id:s=this.instance[r.key],o&&e&&!r.allowNull&&s==null&&(o.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!o||o.type==="reference")&&(s!==void 0&&(s=r.valueConverter.toJson(s),s!=null&&(s=r.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[r.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let r={};for(const i of this.fieldsMetadata)if(t||!this.remult||i.includedInApi(this.instance)){let s,o=this.lookups.get(i.key),a=!1;o?e?(s=o.toJson(),a=!0,r[i.key]=s):s=o.id:$(i)&&!e?a=!0:(s=this.instance[i.key],this.remult||s&&ue(s.constructor,!1)&&(s=W(s).getId())),a||(r[i.key]=i.valueConverter.toJson(s))}return r}async _updateEntityBasedOnApi(e,t=!1){let r=Object.keys(e);for(const i of this.fieldsMetadata)if(r.includes(i.key)&&i.includedInApi(this.instance)&&(!this.remult||t||i.apiUpdateAllowed(this.instance))){let s=this.lookups.get(i.key);s?s.id=e[i.key]:this.instance[i.key]=i.valueConverter.fromJson(e[i.key])}await Promise.all([...this.fields].map(i=>i.load()))}}class It extends qn{constructor(t,r,i,s,o,a){super(t.fieldsMetadata,r,o,a);c(this,"info");c(this,"repository");c(this,"edp");c(this,"_isNew");c(this,"metadata");c(this,"_wasDeleted",!1);c(this,"_columns");c(this,"_saving",!1);c(this,"id");c(this,"originalId");if(this.info=t,this.repository=i,this.edp=s,this._isNew=a,this.metadata=t,a)for(const l of t.fieldsMetadata)l.options.defaultValue&&r[l.key]===void 0&&(typeof l.options.defaultValue=="function"?r[l.key]=l.options.defaultValue(r):r[l.key]||(r[l.key]=l.options.defaultValue));this.info.options.entityRefInit&&this.info.options.entityRefInit(this,r),ge.entityRefInit&&ge.entityRefInit(this,r)}clone(){const t=this.toApiJson(!0,!0);return this.repository.fromJson(t,this.isNew())}get relations(){return this.repository.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=r=>{let i=this.lookups.get(r.key);return i?i.id:this.instance[r.key]};return this.metadata.idMetadata.field instanceof Ie?this.metadata.idMetadata.field.fields.map(t).join(","):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:this.getIdFilter()}).then(async t=>{await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],r={find:i=>r[typeof i=="string"?i:i.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const i of this.info.fieldsMetadata)t.push(r[i.key]=new At(i.options,i,this.instance,this,this));this._columns=r}return this._columns}async save(t){var r;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let i=!1,s=this.buildLifeCycleEvent(()=>i=!0);if(!this.remult.dataProvider.isProxy){for(const u of this.fields)u.metadata.options.saving&&await u.metadata.options.saving(this.instance,u,s);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,s)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),a=[];for(const u of this.metadata.fields)if(u.dbReadOnly||t!==void 0&&!t.includes(u.key)){o[u.key]=void 0,a.push(u.key);let d=this.fields.find(u);d.value=d.originalValue}let l,f=this.isNew();try{if((r=this._subscribers)==null||r.reportChanged(),this.isNew())l=await this.edp.insert(o);else{let u={},d=!1;for(const p in o)if(Object.prototype.hasOwnProperty.call(o,p)){const m=o[p];this.fields.find(p).valueChanged()&&!a.includes(p)&&(u[p]=m,d=!0)}if(!d)return this.instance;i?l=(await this.edp.find({where:this.getIdFilter()}))[0]:l=await this.edp.update(this.id,u)}if(await this.loadDataFrom(l),!this.remult.dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,s),this.repository.listeners))for(const u of this.repository.listeners.filter(d=>d.saved))await u.saved(this.instance,f);return await this.repository.remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(u){await this.catchSaveErrors(u)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}buildLifeCycleEvent(t=()=>{}){const r=this;return{isNew:r.isNew(),fields:r.fields,id:r.getId(),originalId:r.getOriginalId(),metadata:r.repository.metadata,repository:r.repository,preventDefault:()=>t(),relations:r.repository.relations(r.instance)}}getIdFilter(){return R.fromEntityFilter(this.metadata,this.repository.metadata.idMetadata.getIdFilter(this.id))}async delete(){this.__clearErrorsAndReportChanged();let t=this.buildLifeCycleEvent();this.remult.dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,t),this.__assertValidity();try{if(await this.edp.delete(this.id),this.remult.dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,t),this.repository.listeners)for(const r of this.repository.listeners.filter(i=>i.deleted))await r.deleted(this.instance);await this.repository.remult.liveQueryPublisher.itemChanged(this.repository.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(r){await this.catchSaveErrors(r)}}async loadDataFrom(t,r){for(const i of this.info.fields){let s=this.lookups.get(i.key);s?(s.id=t[i.key],r===void 0?!i.options.lazy&&!$(i)&&await s.waitLoad():r.includes(i)&&await s.waitLoad()):$(i)||(this.instance[i.key]=t[i.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(ar())for(const t of this.info.fieldsMetadata)t.options.serverExpression&&(this.instance[t.key]=await t.options.serverExpression(this.instance))}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const r of this.fields){const i=$(r.metadata);if((!i||i.type=="reference")&&r.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){for(const t of this.fieldsMetadata)t.options.validate&&await new At(t.options,t,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let t=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,t)}if(this.repository.listeners)for(const t of this.repository.listeners.filter(r=>r.validating))await t.validating(this.instance)}}const nn=Symbol.for("controllerColumns");function jn(n,e){return n.map(t=>Cr(t.settings(e),e))}function sn(n,e){const t=e||de;let r=n[nn];if(r||(r=n[Re]),!r){let i=I.columnsOfType.get(n.constructor);i||I.columnsOfType.set(n.constructor,i=[]);let s=Object.getPrototypeOf(n.constructor);for(;s!=null;){let o=I.columnsOfType.get(s);o&&i.unshift(...o.filter(a=>!i.find(l=>l.key==a.key))),s=Object.getPrototypeOf(s)}n[nn]=r=new io(jn(i,t).map(o=>new xn(o,void 0,t)),n,t)}return r}class io extends qn{constructor(t,r,i){super(t,r,i,!1);c(this,"fields");let s=[],o={find:a=>o[typeof a=="string"?a:a.key],[Symbol.iterator]:()=>s[Symbol.iterator](),toArray:()=>s};for(const a of t)s.push(o[a.key]=new At(a.options,a,r,void 0,this));this.fields=o}async __performColumnAndEntityValidations(){for(const t of this.fields)t instanceof At&&await t.__performValidation()}}class At{constructor(e,t,r,i,s){c(this,"settings");c(this,"metadata");c(this,"container");c(this,"helper");c(this,"rowBase");c(this,"_subscribers");c(this,"target");c(this,"entityRef");this.settings=e,this.metadata=t,this.container=r,this.helper=i,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=$(this.metadata);if(t){if(t.type==="toMany")return this.container[this.metadata.key]=await this.helper.repository.relations(this.container)[this.metadata.key].find();{let r=await this.helper.repository.relations(this.container)[this.metadata.key].findOne();if(r)this.container[this.metadata.key]=r;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=r=>{r!==!0&&r!==void 0&&!this.error&&(typeof r=="string"&&r.length>0?this.error=r:this.error="invalid value")};if(this.settings.validate){let r=this,i={entityRef:this.entityRef,get error(){return r.error},set error(s){r.error=s},isNew:(e=this.entityRef)==null?void 0:e.isNew(),load:()=>r.load(),metadata:r.metadata,originalValue:r.originalValue,value:r.value,valueChanged:()=>r.valueChanged(),originalValueIsNull:()=>r.originalValueIsNull(),valueIsNull:()=>r.valueIsNull(),isBackend:()=>{var s,o,a;return!((a=(o=(s=r.rowBase)==null?void 0:s.remult)==null?void 0:o.dataProvider)!=null&&a.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,i));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,i))}}catch(t){typeof t=="string"?this.error=t:this.error=t.message}}async validate(){return await this.__performValidation(),!this.error}}let so={transformCaption:(n,e,t,r)=>t};const oo=I.captionTransformer||(I.captionTransformer=so);function Jn(n,e,t,r){let i;return typeof n=="function"?t&&(i=n(t)):n&&(i=n),i=oo.transformCaption(t,e,i,r),i||(e?Rs(e):"")}class xn{constructor(e,t,r){c(this,"settings");c(this,"entityDefs");c(this,"remult");c(this,"options");c(this,"target");c(this,"readonly");c(this,"valueConverter");c(this,"allowNull");c(this,"caption");c(this,"dbName");c(this,"inputType");c(this,"key");c(this,"isServerExpression");c(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=r,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter,{get:(i,s)=>{let o=i[s];return typeof o=="function"?(...a)=>{try{return i[s](...a)}catch(l){const f=`${String(s)} failed for value ${a==null?void 0:a[0]}. Error: ${typeof l=="string"?l:l.message}`;throw{message:this.caption+": "+f,modelState:{[this.key]:f}}}}:o}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=Jn(e.caption,e.key,r,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return Sr(this,this.entityDefs)}get dbReadOnly(){return this.settings.dbReadOnly}}class ao{constructor(e,t,r,i,s){c(this,"entityInfo");c(this,"remult");c(this,"entityType");c(this,"key");c(this,"options");c(this,"fieldsMetadata",[]);c(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=W(e,!1);return t?t.getId():this.idMetadata.field instanceof Ie?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,createIdInFilter:e=>{if(e.length>0)return{$or:e.map(t=>this.idMetadata.getIdFilter(W(t).getId()))}},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof Ie){let t=this.idMetadata.field;return{$or:e.map(r=>t.isEqualTo(r))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});c(this,"fields");c(this,"dbName");c(this,"caption");if(this.entityInfo=t,this.remult=r,this.entityType=i,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let a;typeof this.options.allowApiCrud=="function"?a=(l,f)=>this.options.allowApiCrud(f):a=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.options.allowApiDelete=a),this.options.allowApiInsert===void 0&&(this.options.allowApiInsert=a),this.options.allowApiUpdate===void 0&&(this.options.allowApiUpdate=a),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=i.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let o={find:a=>o[typeof a=="string"?a:a.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const a of e)this.fieldsMetadata.push(o[a.key]=new xn(a,this,r));if(this.fields=o,this.caption=Jn(t.caption,this.key,r,this),t.id){let a=typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(a)?a.length>1?this.idMetadata.field=new Ie(...a):a.length==1&&(this.idMetadata.field=a[0]):this.idMetadata.field=a}this.idMetadata.field||(this.fields.id?this.idMetadata.field=this.fields.id:this.idMetadata.field=[...this.fields][0])}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=W(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return Vn(this)}}const lo=Symbol.for("storableMember");function Un(n,e){let t={};for(const r of n)r&&(typeof r=="function"?r(t,e):Object.assign(t,r));return t}function Cr(n,e){if(n.valueType){let t=n.valueType[lo];t&&(n={...Un(t,e),...n})}if(n.valueType==String){let t=n;n.valueConverter||(t.valueConverter=se.String)}if(n.valueType==Number){let t=n;n.valueConverter||(t.valueConverter=se.Number)}if(n.valueType==Date){let t=n;n.valueConverter||(t.valueConverter=se.Date)}if(n.valueType==Boolean){let t=n;t.valueConverter||(t.valueConverter=se.Boolean)}if(!n.valueConverter){if(ue(n.valueType,!1)){let r;n.valueConverter={toDb:i=>i,fromDb:i=>i},n.valueConverter=new Proxy(n.valueConverter,{get(i,s){if(i[s]===void 0&&r===void 0){if(s==="inputType")return"";r=e.repo(n.valueType).metadata.idMetadata.field.valueType===Number;for(const o of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])i[o]=r?se.Integer[o]:se.String[o]}return i[s]},set(i,s,o,a){return i[s]=o,!0}})}else n.valueConverter=se.Default;return n}return n.valueConverter.toJson||(n.valueConverter.toJson=t=>t),n.valueConverter.fromJson||(n.valueConverter.fromJson=t=>t),n.valueConverter.toDb||(n.valueConverter.toDb=t=>n.valueConverter.toJson(t)),n.valueConverter.fromDb||(n.valueConverter.fromDb=t=>n.valueConverter.fromJson(t)),n.valueConverter.toInput||(n.valueConverter.toInput=t=>n.valueConverter.toJson(t)),n.valueConverter.fromInput||(n.valueConverter.fromInput=t=>n.valueConverter.fromJson(t)),n}class Hn{get _(){return W(this)}save(){return W(this).save()}assign(e){return Nn(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class uo{constructor(e,t){c(this,"options");c(this,"repo");c(this,"_count");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=Ys.defaultPageSize)}async getPage(e){return e<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const r of this)await e(r),t++;return t}async paginator(e){this.options.orderBy=oe.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t=await this.repo.find({where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include}),r,i=t.length==this.options.pageSize;if(i){let s=await this.repo.createAfterFilter(this.options.orderBy,t[t.length-1]);r=()=>this.paginator(s)}return{count:()=>this.count(),hasNextPage:i,items:t,nextPage:r}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=oe.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,r,i,s=0;return i=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),r===void 0||t==r.items.length){if(r&&!r.hasNextPage)return{value:void 0,done:!0};let o=r;if(r?r=await r.nextPage():r=await this.paginator(),t=0,r.items.length==0)return{value:void 0,done:!0};if((o==null?void 0:o.items.length)>0&&this.repo.getEntityRef(o.items[0]).getId()==this.repo.getEntityRef(r.items[0]).getId())throw new Error("pagination failure, returned same first row")}if(t<r.items.length)return{value:r.items[t++],done:!1}},{next:async()=>i()}}}class Ot{constructor(){c(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(r=>r!=t)}}function fo(n){return n.metadata?n.metadata:ue(n,!1)?de.repo(n).metadata:n}function co(n){return ue(n,!1)?de.repo(n):n}const We=class We{constructor(e){c(this,"sql");c(this,"wrapIdentifier",e=>e);c(this,"createdEntities",[]);this.sql=e,e.wrapIdentifier&&(this.wrapIdentifier=t=>e.wrapIdentifier(t))}static getDb(e){const t=(e||de).dataProvider;if(!t.createCommand)throw"the data provider is not an SqlDatabase";return t}createCommand(){return new po(this.sql.createCommand(),We.LogToConsole)}async execute(e){return await this.createCommand().execute(e)}_getSourceSql(){return this.sql}async ensureSchema(e){this.sql.ensureSchema&&await this.sql.ensureSchema(e)}getEntityDataProvider(e){if(!this.sql.supportsJsonColumnType)for(const t of e.fields.toArray())t.valueConverter.fieldTypeInDb==="json"&&(t.valueConverter={...t.valueConverter,toDb:se.JsonString.toDb,fromDb:se.JsonString.fromDb});return new Wn(e,this,async t=>{this.createdEntities.indexOf(t.$entityName)<0&&(this.createdEntities.push(t.$entityName),await this.sql.entityIsUsedForTheFirstTime(e))},this.sql)}transaction(e){return this.sql.transaction(async t=>{let r=!1;try{await e(new We({createCommand:()=>{let i=t.createCommand();return{addParameterAndReturnSqlToken:s=>i.addParameterAndReturnSqlToken(s),execute:async s=>{if(r)throw"can't run a command after the transaction was completed";return i.execute(s)}}},getLimitSqlSyntax:this.sql.getLimitSqlSyntax,entityIsUsedForTheFirstTime:i=>t.entityIsUsedForTheFirstTime(i),transaction:i=>t.transaction(i),supportsJsonColumnType:this.sql.supportsJsonColumnType,wrapIdentifier:this.wrapIdentifier}))}finally{r=!0}})}static rawFilter(e){return{[Fn]:{buildSql:e}}}static async filterToRaw(e,t,r,i){r||(r=new yo);const s=co(e);var o=new De(r,i||await $n(s.metadata));return o._addWhere=!1,await(await Me(s).translateWhereToFilter(t)).__applyToConsumer(o),await o.resolveWhere()}};c(We,"LogToConsole",!1),c(We,"durationThreshold",0);let Ke=We;const ho=new Map([["INSERT",""],["SELECT",""],["UPDATE",""],["DELETE",""],["CREATE",""],["ALTER",""],["DROP",""],["TRUNCATE",""],["GRANT",""],["REVOKE",""]]);class po{constructor(e,t){c(this,"origin");c(this,"logToConsole");c(this,"args",{});this.origin=e,this.logToConsole=t}addParameterAndReturnSqlToken(e){let t=this.origin.addParameterAndReturnSqlToken(e);return this.args[t]=e,t}async execute(e){try{let r=new Date,i=await this.origin.execute(e);if(this.logToConsole!==!1){var t=new Date().valueOf()-r.valueOf();if(t>Ke.durationThreshold){const s=t/1e3;if(this.logToConsole==="oneLiner"){const o=e.replace(/(\r\n|\n|\r|\t)/gm," ").replace(/  +/g," ").trim(),a=o.split(" ")[0].toUpperCase();console.info(`${ho.get(a)||""} (${s.toFixed(3)}) ${o} ${JSON.stringify(this.args)}`)}else typeof this.logToConsole=="function"?this.logToConsole(s,e,this.args):console.info(e+`
`,{arguments:this.args,duration:s})}}return i}catch(r){throw console.error((r.message||"Sql Error")+`:
`,e,{arguments:this.args,error:r}),r}}}class Wn{constructor(e,t,r,i){c(this,"entity");c(this,"sql");c(this,"iAmUsed");c(this,"strategy");this.entity=e,this.sql=t,this.iAmUsed=r,this.strategy=i}async init(){let e=await $n(this.entity,t=>this.sql.wrapIdentifier(t));return await this.iAmUsed(e),e}async count(e){let t=await this.init(),r="select count(*) count from "+t.$entityName,i=this.sql.createCommand();if(e){let s=new De(i,t);e.__applyToConsumer(s),r+=await s.resolveWhere()}return i.execute(r).then(s=>Number(s.rows[0].count))}async find(e){let t=await this.init(),{colKeys:r,select:i}=this.buildSelect(t);i="select "+i,i+=`
 from `+t.$entityName;let s=this.sql.createCommand();if(e){if(e.where){let o=new De(s,t);e.where.__applyToConsumer(o),i+=await o.resolveWhere()}if(e.limit&&(e.orderBy=oe.createUniqueSort(this.entity,e.orderBy)),e.orderBy||(e.orderBy=oe.createUniqueSort(this.entity,new oe)),e.orderBy){let o=!0,a=[];for(const l of e.orderBy.Segments)l.field instanceof Ie?a.push(...l.field.fields.map(f=>({field:f,isDescending:l.isDescending}))):a.push(l);for(const l of a)o?(i+=" Order By ",o=!1):i+=", ",i+=t.$dbNameOf(l.field),l.isDescending&&(i+=" desc"),this.sql._getSourceSql().orderByNullsFirst&&(l.isDescending?i+=" nulls last":i+=" nulls first")}if(e.limit){let o=1;e.page&&(o=e.page),o<1&&(o=1),i+=" "+this.strategy.getLimitSqlSyntax(e.limit,(o-1)*e.limit)}}return s.execute(i).then(o=>o.rows.map(a=>this.buildResultRow(r,a,o)))}buildResultRow(e,t,r){let i={};for(let s=0;s<e.length;s++){const o=e[s];try{i[o.key]=o.valueConverter.fromDb(t[r.getColumnKeyInResultForIndexInSelect(s)])}catch(a){throw new Error("Failed to load from db:"+o.key+`\r
`+a)}}return i}buildSelect(e){let t="",r=[];for(const i of this.entity.fields)i.isServerExpression||(r.length>0&&(t+=", "),t+=e.$dbNameOf(i),r.push(i));return{colKeys:r,select:t}}async update(e,t){let r=await this.init(),i=this.sql.createCommand(),s=new De(i,r);R.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(s);let o="update "+r.$entityName+" set ",a=!1;for(const u of this.entity.fields)if(!on(u,r)){if(t[u.key]!==void 0){let d=u.valueConverter.toDb(t[u.key]);d!==void 0&&(a?o+=", ":a=!0,o+=r.$dbNameOf(u)+" = "+i.addParameterAndReturnSqlToken(d))}}o+=await s.resolveWhere();let{colKeys:l,select:f}=this.buildSelect(r);return o+=" returning "+f,i.execute(o).then(u=>{var d,p;return(p=(d=this.sql._getSourceSql()).afterMutation)==null||p.call(d),this.buildResultRow(l,u.rows[0],u)})}async delete(e){let t=await this.init(),r=this.sql.createCommand(),i=new De(r,t);R.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(i);let s="delete from "+t.$entityName;return s+=await i.resolveWhere(),r.execute(s).then(()=>{var o,a;(a=(o=this.sql._getSourceSql()).afterMutation)==null||a.call(o)})}async insert(e){let t=await this.init(),r=this.sql.createCommand(),i="",s="",o=!1;for(const u of this.entity.fields)if(!on(u,t)){let d=u.valueConverter.toDb(e[u.key]);d!=null&&(o?(i+=", ",s+=", "):o=!0,i+=t.$dbNameOf(u),s+=r.addParameterAndReturnSqlToken(d))}let a=`insert into ${t.$entityName} (${i}) values (${s})`,{colKeys:l,select:f}=this.buildSelect(t);return a+=" returning "+f,await r.execute(a).then(u=>{var d,p;return(p=(d=this.sql._getSourceSql()).afterMutation)==null||p.call(d),this.buildResultRow(l,u.rows[0],u)})}}c(Wn,"LogToConsole",!1);class yo{execute(e){throw new Error("Method not implemented.")}addParameterAndReturnSqlToken(e){return e===null?"null":(e instanceof Date&&(e=e.toISOString()),typeof e=="string"?(e==null&&(e=""),"'"+e.replace(/'/g,"''")+"'"):e.toString())}}class De{constructor(e,t){c(this,"r");c(this,"nameProvider");c(this,"where","");c(this,"_addWhere",!0);c(this,"promises",[]);this.r=e,this.nameProvider=t}async resolveWhere(){for(;this.promises.length>0;){let e=this.promises;this.promises=[];for(const t of e)await t}return this.where}custom(e,t){throw new Error("Custom filter should be translated before it gets here")}or(e){let t="";this.promises.push((async()=>{for(const r of e){let i=new De(this.r,this.nameProvider);i._addWhere=!1,r.__applyToConsumer(i);let s=await i.resolveWhere();if(!s)return;s.length>0&&(t.length>0&&(t+=" or "),e.length>1?t+="("+s+")":t+=s)}this.addToWhere("("+t+")")})())}isNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is null"))())}isNotNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is not null"))())}isIn(e,t){this.promises.push((async()=>{t&&t.length>0?this.addToWhere(this.nameProvider.$dbNameOf(e)+" in ("+t.map(r=>this.r.addParameterAndReturnSqlToken(e.valueConverter.toDb(r))).join(",")+")"):this.addToWhere("1 = 0 /*isIn with no values*/")})())}isEqualTo(e,t){this.add(e,t,"=")}isDifferentFrom(e,t){this.add(e,t,"<>")}isGreaterOrEqualTo(e,t){this.add(e,t,">=")}isGreaterThan(e,t){this.add(e,t,">")}isLessOrEqualTo(e,t){this.add(e,t,"<=")}isLessThan(e,t){this.add(e,t,"<")}containsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}notContainsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("not lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}add(e,t,r){this.promises.push((async()=>{let i=this.nameProvider.$dbNameOf(e)+" "+r+" "+this.r.addParameterAndReturnSqlToken(e.valueConverter.toDb(t));this.addToWhere(i)})())}addToWhere(e){this.where.length==0?this._addWhere&&(this.where+=" where "):this.where+=" and ",this.where+=e}databaseCustom(e){this.promises.push((async()=>{if(e!=null&&e.buildSql){let t=new mo(this.r);await e.buildSql(t),t.sql&&this.addToWhere("("+t.sql+")")}})())}}class mo{constructor(e){c(this,"r");c(this,"sql","");this.r=e}addParameterAndReturnSqlToken(e,t){return t&&(e=t.valueConverter.toDb(e)),this.r.addParameterAndReturnSqlToken(e)}async filterToRaw(e,t){return Ke.filterToRaw(e,t,this)}}function on(n,e){return n.dbReadOnly||n.isServerExpression||n.options.sqlExpression&&n.dbName!=e.$dbNameOf(n)}async function $n(n,e){let t=typeof e=="function"?{wrapIdentifier:e}:e||{};var r=fo(n);t.wrapIdentifier||(t.wrapIdentifier=de.dataProvider.wrapIdentifier),t.wrapIdentifier||(t.wrapIdentifier=s=>s);const i={$entityName:await Vn(r,t.wrapIdentifier),toString:()=>i.$entityName,$dbNameOf:s=>{var o;return typeof s=="string"?o=s:o=s.key,i[o]}};for(const s of r.fields){let o=await Sr(s,r,t.wrapIdentifier);s.options.sqlExpression||(typeof t.tableName=="string"?o=t.wrapIdentifier(t.tableName)+"."+o:t.tableName===!0&&(o=i.$entityName+"."+o)),i[s.key]=o}return i}async function Vn(n,e=t=>t){if(n.options.sqlExpression){if(typeof n.options.sqlExpression=="string")return n.options.sqlExpression;if(typeof n.options.sqlExpression=="function")return await n.options.sqlExpression(n)}return e(n.dbName)}async function Sr(n,e,t=r=>r){try{if(n.options.sqlExpression){let s;if(typeof n.options.sqlExpression=="function"){const o=n.options.sqlExpression;try{n.options.sqlExpression="recursive sqlExpression call for field '"+n.key+"'. ",s=await o(e),n.options.sqlExpression=()=>s}finally{}}else s=n.options.sqlExpression;return s||n.dbName}const r=$(n);let i=(r==null?void 0:r.type)==="toOne"&&n.options.field;if(i){let s=e.fields.find(i);if(s)return Sr(s,e,t)}return t(n.dbName)}finally{}}var Pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pe={},N={},ie={};Object.defineProperty(ie,"__esModule",{value:!0});ie.output=ie.exists=ie.hash=ie.bytes=ie.bool=ie.number=void 0;function Ft(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}ie.number=Ft;function Kn(n){if(typeof n!="boolean")throw new Error(`Expected boolean, not ${n}`)}ie.bool=Kn;function go(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function Tr(n,...e){if(!go(n))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}ie.bytes=Tr;function Qn(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ft(n.outputLen),Ft(n.blockLen)}ie.hash=Qn;function Gn(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}ie.exists=Gn;function zn(n,e){Tr(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}ie.output=zn;const wo={number:Ft,bool:Kn,bytes:Tr,hash:Qn,exists:Gn,output:zn};ie.default=wo;var S={};Object.defineProperty(S,"__esModule",{value:!0});S.add5L=S.add5H=S.add4H=S.add4L=S.add3H=S.add3L=S.add=S.rotlBL=S.rotlBH=S.rotlSL=S.rotlSH=S.rotr32L=S.rotr32H=S.rotrBL=S.rotrBH=S.rotrSL=S.rotrSH=S.shrSL=S.shrSH=S.toBig=S.split=S.fromBig=void 0;const Et=BigInt(2**32-1),lr=BigInt(32);function Ar(n,e=!1){return e?{h:Number(n&Et),l:Number(n>>lr&Et)}:{h:Number(n>>lr&Et)|0,l:Number(n&Et)|0}}S.fromBig=Ar;function Xn(n,e=!1){let t=new Uint32Array(n.length),r=new Uint32Array(n.length);for(let i=0;i<n.length;i++){const{h:s,l:o}=Ar(n[i],e);[t[i],r[i]]=[s,o]}return[t,r]}S.split=Xn;const Yn=(n,e)=>BigInt(n>>>0)<<lr|BigInt(e>>>0);S.toBig=Yn;const Zn=(n,e,t)=>n>>>t;S.shrSH=Zn;const ei=(n,e,t)=>n<<32-t|e>>>t;S.shrSL=ei;const ti=(n,e,t)=>n>>>t|e<<32-t;S.rotrSH=ti;const ri=(n,e,t)=>n<<32-t|e>>>t;S.rotrSL=ri;const ni=(n,e,t)=>n<<64-t|e>>>t-32;S.rotrBH=ni;const ii=(n,e,t)=>n>>>t-32|e<<64-t;S.rotrBL=ii;const si=(n,e)=>e;S.rotr32H=si;const oi=(n,e)=>n;S.rotr32L=oi;const ai=(n,e,t)=>n<<t|e>>>32-t;S.rotlSH=ai;const li=(n,e,t)=>e<<t|n>>>32-t;S.rotlSL=li;const ui=(n,e,t)=>e<<t-32|n>>>64-t;S.rotlBH=ui;const fi=(n,e,t)=>n<<t-32|e>>>64-t;S.rotlBL=fi;function ci(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:i|0}}S.add=ci;const di=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0);S.add3L=di;const hi=(n,e,t,r)=>e+t+r+(n/2**32|0)|0;S.add3H=hi;const pi=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0);S.add4L=pi;const yi=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0;S.add4H=yi;const mi=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0);S.add5L=mi;const gi=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0;S.add5H=gi;const bo={fromBig:Ar,split:Xn,toBig:Yn,shrSH:Zn,shrSL:ei,rotrSH:ti,rotrSL:ri,rotrBH:ni,rotrBL:ii,rotr32H:si,rotr32L:oi,rotlSH:ai,rotlSL:li,rotlBH:ui,rotlBL:fi,add:ci,add3L:di,add3H:hi,add4L:pi,add4H:yi,add5H:gi,add5L:mi};S.default=bo;var wi={},Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.crypto=void 0;Bt.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(n){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.randomBytes=n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.checkOpts=n.Hash=n.concatBytes=n.toBytes=n.utf8ToBytes=n.asyncLoop=n.nextTick=n.hexToBytes=n.bytesToHex=n.isLE=n.rotr=n.createView=n.u32=n.u8=void 0;const e=Bt,t=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);n.u8=t;const r=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));n.u32=r;function i(v){return v instanceof Uint8Array||v!=null&&typeof v=="object"&&v.constructor.name==="Uint8Array"}const s=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);n.createView=s;const o=(v,F)=>v<<32-F|v>>>F;if(n.rotr=o,n.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!n.isLE)throw new Error("Non little-endian hardware is not supported");const a=Array.from({length:256},(v,F)=>F.toString(16).padStart(2,"0"));function l(v){if(!i(v))throw new Error("Uint8Array expected");let F="";for(let j=0;j<v.length;j++)F+=a[v[j]];return F}n.bytesToHex=l;const f={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function u(v){if(v>=f._0&&v<=f._9)return v-f._0;if(v>=f._A&&v<=f._F)return v-(f._A-10);if(v>=f._a&&v<=f._f)return v-(f._a-10)}function d(v){if(typeof v!="string")throw new Error("hex string expected, got "+typeof v);const F=v.length,j=F/2;if(F%2)throw new Error("padded hex string expected, got unpadded hex of length "+F);const q=new Uint8Array(j);for(let J=0,te=0;J<j;J++,te+=2){const Ne=u(v.charCodeAt(te)),ze=u(v.charCodeAt(te+1));if(Ne===void 0||ze===void 0){const wt=v[te]+v[te+1];throw new Error('hex string expected, got non-hex character "'+wt+'" at index '+te)}q[J]=Ne*16+ze}return q}n.hexToBytes=d;const p=async()=>{};n.nextTick=p;async function m(v,F,j){let q=Date.now();for(let J=0;J<v;J++){j(J);const te=Date.now()-q;te>=0&&te<F||(await(0,n.nextTick)(),q+=te)}}n.asyncLoop=m;function g(v){if(typeof v!="string")throw new Error(`utf8ToBytes expected string, got ${typeof v}`);return new Uint8Array(new TextEncoder().encode(v))}n.utf8ToBytes=g;function k(v){if(typeof v=="string"&&(v=g(v)),!i(v))throw new Error(`expected Uint8Array, got ${typeof v}`);return v}n.toBytes=k;function O(...v){let F=0;for(let q=0;q<v.length;q++){const J=v[q];if(!i(J))throw new Error("Uint8Array expected");F+=J.length}const j=new Uint8Array(F);for(let q=0,J=0;q<v.length;q++){const te=v[q];j.set(te,J),J+=te.length}return j}n.concatBytes=O;class D{clone(){return this._cloneInto()}}n.Hash=D;const w={}.toString;function V(v,F){if(F!==void 0&&w.call(F)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(v,F)}n.checkOpts=V;function H(v){const F=q=>v().update(k(q)).digest(),j=v();return F.outputLen=j.outputLen,F.blockLen=j.blockLen,F.create=()=>v(),F}n.wrapConstructor=H;function ee(v){const F=(q,J)=>v(J).update(k(q)).digest(),j=v({});return F.outputLen=j.outputLen,F.blockLen=j.blockLen,F.create=q=>v(q),F}n.wrapConstructorWithOpts=ee;function fe(v){const F=(q,J)=>v(J).update(k(q)).digest(),j=v({});return F.outputLen=j.outputLen,F.blockLen=j.blockLen,F.create=q=>v(q),F}n.wrapXOFConstructorWithOpts=fe;function ve(v=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(v));throw new Error("crypto.getRandomValues must be defined")}n.randomBytes=ve})(wi);Object.defineProperty(N,"__esModule",{value:!0});N.shake256=N.shake128=N.keccak_512=N.keccak_384=N.keccak_256=N.keccak_224=N.sha3_512=N.sha3_384=N.sha3_256=N.sha3_224=N.Keccak=N.keccakP=void 0;const Ue=ie,ut=S,st=wi,[bi,vi,ki]=[[],[],[]],vo=BigInt(0),Xe=BigInt(1),ko=BigInt(2),_o=BigInt(7),Io=BigInt(256),Oo=BigInt(113);for(let n=0,e=Xe,t=1,r=0;n<24;n++){[t,r]=[r,(2*t+3*r)%5],bi.push(2*(5*r+t)),vi.push((n+1)*(n+2)/2%64);let i=vo;for(let s=0;s<7;s++)e=(e<<Xe^(e>>_o)*Oo)%Io,e&ko&&(i^=Xe<<(Xe<<BigInt(s))-Xe);ki.push(i)}const[Eo,Co]=(0,ut.split)(ki,!0),an=(n,e,t)=>t>32?(0,ut.rotlBH)(n,e,t):(0,ut.rotlSH)(n,e,t),ln=(n,e,t)=>t>32?(0,ut.rotlBL)(n,e,t):(0,ut.rotlSL)(n,e,t);function _i(n,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=n[o]^n[o+10]^n[o+20]^n[o+30]^n[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,f=t[l],u=t[l+1],d=an(f,u,1)^t[a],p=ln(f,u,1)^t[a+1];for(let m=0;m<50;m+=10)n[o+m]^=d,n[o+m+1]^=p}let i=n[2],s=n[3];for(let o=0;o<24;o++){const a=vi[o],l=an(i,s,a),f=ln(i,s,a),u=bi[o];i=n[u],s=n[u+1],n[u]=l,n[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=n[o+a];for(let a=0;a<10;a++)n[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}n[0]^=Eo[r],n[1]^=Co[r]}t.fill(0)}N.keccakP=_i;class gt extends st.Hash{constructor(e,t,r,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,Ue.number)(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,st.u32)(this.state)}keccak(){_i(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){(0,Ue.exists)(this);const{blockLen:t,state:r}=this;e=(0,st.toBytes)(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,t&128&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,Ue.exists)(this,!1),(0,Ue.bytes)(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,Ue.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,Ue.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new gt(t,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}N.Keccak=gt;const Fe=(n,e,t)=>(0,st.wrapConstructor)(()=>new gt(e,n,t));N.sha3_224=Fe(6,144,224/8);N.sha3_256=Fe(6,136,256/8);N.sha3_384=Fe(6,104,384/8);N.sha3_512=Fe(6,72,512/8);N.keccak_224=Fe(1,144,224/8);N.keccak_256=Fe(1,136,256/8);N.keccak_384=Fe(1,104,384/8);N.keccak_512=Fe(1,72,512/8);const Ii=(n,e,t)=>(0,st.wrapXOFConstructorWithOpts)((r={})=>new gt(e,n,r.dkLen===void 0?t:r.dkLen,!0));N.shake128=Ii(31,168,128/8);N.shake256=Ii(31,136,256/8);const{sha3_512:So}=N,Oi=24,ot=32,ur=(n=4,e=Math.random)=>{let t="";for(;t.length<n;)t=t+Math.floor(e()*36).toString(36);return t};function Ei(n){let e=8n,t=0n;for(const r of n.values()){const i=BigInt(r);t=(t<<e)+i}return t}const Ci=(n="")=>Ei(So(n)).toString(36).slice(1),un=Array.from({length:26},(n,e)=>String.fromCharCode(e+97)),To=n=>un[Math.floor(n()*un.length)],Si=({globalObj:n=typeof Pt<"u"?Pt:typeof window<"u"?window:{},random:e=Math.random}={})=>{const t=Object.keys(n).toString(),r=t.length?t+ur(ot,e):ur(ot,e);return Ci(r).substring(0,ot)},Ti=n=>()=>n++,Ao=476782367,Ai=({random:n=Math.random,counter:e=Ti(Math.floor(n()*Ao)),length:t=Oi,fingerprint:r=Si({random:n})}={})=>function(){const s=To(n),o=Date.now().toString(36),a=e().toString(36),l=ur(t,n),f=`${o+l+a+r}`;return`${s+Ci(f).substring(1,t)}`},Po=Ai(),Fo=(n,{minLength:e=2,maxLength:t=ot}={})=>{const r=n.length,i=/^[0-9a-z]+$/;try{if(typeof n=="string"&&r>=e&&r<=t&&i.test(n))return!0}finally{}return!1};Pe.getConstants=()=>({defaultLength:Oi,bigLength:ot});Pe.init=Ai;Pe.createId=Po;Pe.bufToBigInt=Ei;Pe.createCounter=Ti;Pe.createFingerprint=Si;Pe.isCuid=Fo;const{createId:Ro,init:Ha,getConstants:Wa,isCuid:$a}=Pe;var fn=Ro;const re=class re{};c(re,"required",rt(async(e,t)=>t.value!=null&&t.value!=null&&t.value!==""&&t.value!=0,"Should not be empty")),c(re,"unique",rt(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),c(re,"uniqueOnBackend",rt(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,re.unique.defaultMessage)),c(re,"regex",Ye((e,t)=>t.test(e))),c(re,"email",Kt(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),c(re,"url",Kt(e=>!!new URL(e),"Invalid Url")),c(re,"in",Ye((e,t)=>t.includes(e),e=>`Value must be one of ${e.join(", ")}`)),c(re,"notNull",Kt(e=>e!=null,"Should not be null")),c(re,"enum",Ye((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${Object.values(e).filter(t=>typeof e[t]!="number").join(", ")}`)),c(re,"relationExists",rt(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),c(re,"maxLength",Ye((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),c(re,"minLength",Ye((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),c(re,"defaultMessage","Invalid value");let Be=re;function rt(n,e){const t=async(i,s,o)=>{const a=await n(i,s);typeof a=="string"&&a.length>0?s.error=a:a||(s.error=typeof o=="function"&&o(i,s,void 0)||o||typeof e=="function"&&e(i,s,void 0)||e||Be.defaultMessage)},r=(i,s,o)=>typeof i=="string"||i==="function"||i===void 0&&s===void 0?async(a,l,f)=>await t(a,l,i||f):t(i,s,o);return Object.defineProperty(r,"defaultMessage",{get:()=>e,set:i=>{e=i},enumerable:!0}),Object.assign(r,{withMessage:i=>async(s,o)=>r(s,o,i)})}function Kt(n,e){return rt((t,r)=>r.value===void 0||r.value===null?!0:n(r.value),e)}function Ye(n,e){const t=Do((r,i,s)=>i.value===void 0||i.value===null?!0:n(i.value,s),(r,i,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((r,i)=>t(r,i),{get defaultMessage(){return e},set defaultMessage(r){e=r}})}function Do(n,e,t=!1){return Object.assign((i,s)=>async(o,a)=>{const l=await n(o,a,i);typeof l=="string"?a.error=l:l||(a.error=s?typeof s=="function"?t?s(i):s(o,a,i):s:e?typeof e=="function"?e(o,a,i):e:Be.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(i){e=i}})}class Lo{static object(...e){return ae(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),ae(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return ae(()=>Date,{valueConverter:se.DateOnly},...e)}static date(...e){return ae(()=>Date,...e)}static integer(...e){return ae(()=>Number,{valueConverter:se.Integer},...e)}static autoIncrement(...e){return ae(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...se.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return ae(()=>Number,...e)}static createdAt(...e){return ae(()=>Date,{allowApiUpdate:!1,saving:(t,r,{isNew:i})=>{i&&(r.value=new Date)}},...e)}static updatedAt(...e){return ae(()=>Date,{allowApiUpdate:!1,saving:(t,r)=>{r.value=new Date}},...e)}static uuid(...e){return ae(()=>String,{allowApiUpdate:!1,defaultValue:()=>sr(),saving:(t,r)=>{r.value||(r.value=sr())}},...e)}static cuid(...e){return ae(()=>String,{allowApiUpdate:!1,defaultValue:()=>fn(),saving:(t,r)=>{r.value||(r.value=fn())}},...e)}static string(...e){return ae(()=>String,...e)}static boolean(...e){return ae(()=>Boolean,...e)}}function ae(n,...e){return(t,r,i)=>{const s=typeof r=="string"?r:r.name.toString();let o=f=>{let u=Un(e,f);u.required&&(u.validate=Qt(u.validate,Be.required)),u.maxLength&&(u.validate=Qt(u.validate,Be.maxLength(u.maxLength))),u.minLength&&(u.validate=Qt(u.validate,Be.minLength(u.minLength))),!u.valueType&&n&&(u.valueType=n()),u.key||(u.key=s),u.dbName||(u.dbName=u.key);let d=u.valueType;return d||(d=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],u.valueType=d),u.target||(u.target=t),u};Pi(t);let a=I.columnsOfType.get(t.constructor);a||(a=[],I.columnsOfType.set(t.constructor,a));let l=a.find(f=>f.key==s);if(!l)a.push({key:s,settings:o});else{let f=l.settings;l.settings=u=>{let d=f(u),p=o(u);return Object.assign(d,p)}}}}function Pi(n){if(!n)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function Qt(n,e,t=!1){if(!e)return;const r=Array.isArray(e)?e:[e],i=Array.isArray(n)?n:n?[n]:[];return t?[...r,...i]:[...i,...r]}function Mo(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Bo(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}class No extends Hn{constructor(){super(...arguments);c(this,"id")}}Mo([Lo.uuid(),Bo("design:type",String)],No.prototype,"id",void 0);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var cn;(function(n){(function(e){var t=typeof Pt=="object"?Pt:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect>"u"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,f={create:o?function(){return qt(Object.create(null))}:a?function(){return qt({__proto__:null})}:function(){return qt({})},has:l?function(h,y){return t.call(h,y)}:function(h,y){return y in h},get:l?function(h,y){return t.call(h,y)?h[y]:void 0}:function(h,y){return h[y]}},u=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:zi(),m=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Xi(),g=!d&&typeof WeakMap=="function"?WeakMap:Yi(),k=new g;function O(h,y,b,_){if(K(b)){if(!Lr(h))throw new TypeError;if(!Mr(y))throw new TypeError;return j(h,y)}else{if(!Lr(h))throw new TypeError;if(!G(y))throw new TypeError;if(!G(_)&&!K(_)&&!qe(_))throw new TypeError;return qe(_)&&(_=void 0),b=ke(b),q(h,y,b,_)}}e("decorate",O);function D(h,y){function b(_,E){if(!G(_))throw new TypeError;if(!K(E)&&!$i(E))throw new TypeError;Pr(h,y,_,E)}return b}e("metadata",D);function w(h,y,b,_){if(!G(b))throw new TypeError;return K(_)||(_=ke(_)),Pr(h,y,b,_)}e("defineMetadata",w);function V(h,y,b){if(!G(y))throw new TypeError;return K(b)||(b=ke(b)),te(h,y,b)}e("hasMetadata",V);function H(h,y,b){if(!G(y))throw new TypeError;return K(b)||(b=ke(b)),Ne(h,y,b)}e("hasOwnMetadata",H);function ee(h,y,b){if(!G(y))throw new TypeError;return K(b)||(b=ke(b)),ze(h,y,b)}e("getMetadata",ee);function fe(h,y,b){if(!G(y))throw new TypeError;return K(b)||(b=ke(b)),wt(h,y,b)}e("getOwnMetadata",fe);function ve(h,y){if(!G(h))throw new TypeError;return K(y)||(y=ke(y)),Fr(h,y)}e("getMetadataKeys",ve);function v(h,y){if(!G(h))throw new TypeError;return K(y)||(y=ke(y)),Rr(h,y)}e("getOwnMetadataKeys",v);function F(h,y,b){if(!G(y))throw new TypeError;K(b)||(b=ke(b));var _=J(y,b,!1);if(K(_)||!_.delete(h))return!1;if(_.size>0)return!0;var E=k.get(y);return E.delete(b),E.size>0||k.delete(y),!0}e("deleteMetadata",F);function j(h,y){for(var b=h.length-1;b>=0;--b){var _=h[b],E=_(y);if(!K(E)&&!qe(E)){if(!Mr(E))throw new TypeError;y=E}}return y}function q(h,y,b,_){for(var E=h.length-1;E>=0;--E){var z=h[E],T=z(y,b,_);if(!K(T)&&!qe(T)){if(!G(T))throw new TypeError;_=T}}return _}function J(h,y,b){var _=k.get(h);if(K(_)){if(!b)return;_=new p,k.set(h,_)}var E=_.get(y);if(K(E)){if(!b)return;E=new p,_.set(y,E)}return E}function te(h,y,b){var _=Ne(h,y,b);if(_)return!0;var E=Nt(y);return qe(E)?!1:te(h,E,b)}function Ne(h,y,b){var _=J(y,b,!1);return K(_)?!1:Hi(_.has(h))}function ze(h,y,b){var _=Ne(h,y,b);if(_)return wt(h,y,b);var E=Nt(y);if(!qe(E))return ze(h,E,b)}function wt(h,y,b){var _=J(y,b,!1);if(!K(_))return _.get(h)}function Pr(h,y,b,_){var E=J(b,_,!0);E.set(h,y)}function Fr(h,y){var b=Rr(h,y),_=Nt(h);if(_===null)return b;var E=Fr(_,y);if(E.length<=0)return b;if(b.length<=0)return E;for(var z=new m,T=[],P=0,C=b;P<C.length;P++){var L=C[P],M=z.has(L);M||(z.add(L),T.push(L))}for(var Ce=0,Nr=E;Ce<Nr.length;Ce++){var L=Nr[Ce],M=z.has(L);M||(z.add(L),T.push(L))}return T}function Rr(h,y){var b=[],_=J(h,y,!1);if(K(_))return b;for(var E=_.keys(),z=Vi(E),T=0;;){var P=Qi(z);if(!P)return b.length=T,b;var C=Ki(P);try{b[T]=C}catch(L){try{Gi(z)}finally{throw L}}T++}}function Dr(h){if(h===null)return 1;switch(typeof h){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return h===null?1:6;default:return 6}}function K(h){return h===void 0}function qe(h){return h===null}function Ji(h){return typeof h=="symbol"}function G(h){return typeof h=="object"?h!==null:typeof h=="function"}function xi(h,y){switch(Dr(h)){case 0:return h;case 1:return h;case 2:return h;case 3:return h;case 4:return h;case 5:return h}var b=y===3?"string":y===5?"number":"default",_=Br(h,i);if(_!==void 0){var E=_.call(h,b);if(G(E))throw new TypeError;return E}return Ui(h,b==="default"?"number":b)}function Ui(h,y){if(y==="string"){var b=h.toString;if(je(b)){var _=b.call(h);if(!G(_))return _}var E=h.valueOf;if(je(E)){var _=E.call(h);if(!G(_))return _}}else{var E=h.valueOf;if(je(E)){var _=E.call(h);if(!G(_))return _}var z=h.toString;if(je(z)){var _=z.call(h);if(!G(_))return _}}throw new TypeError}function Hi(h){return!!h}function Wi(h){return""+h}function ke(h){var y=xi(h,3);return Ji(y)?y:Wi(y)}function Lr(h){return Array.isArray?Array.isArray(h):h instanceof Object?h instanceof Array:Object.prototype.toString.call(h)==="[object Array]"}function je(h){return typeof h=="function"}function Mr(h){return typeof h=="function"}function $i(h){switch(Dr(h)){case 3:return!0;case 4:return!0;default:return!1}}function Br(h,y){var b=h[y];if(b!=null){if(!je(b))throw new TypeError;return b}}function Vi(h){var y=Br(h,s);if(!je(y))throw new TypeError;var b=y.call(h);if(!G(b))throw new TypeError;return b}function Ki(h){return h.value}function Qi(h){var y=h.next();return y.done?!1:y}function Gi(h){var y=h.return;y&&y.call(h)}function Nt(h){var y=Object.getPrototypeOf(h);if(typeof h!="function"||h===u||y!==u)return y;var b=h.prototype,_=b&&Object.getPrototypeOf(b);if(_==null||_===Object.prototype)return y;var E=_.constructor;return typeof E!="function"||E===h?y:E}function zi(){var h={},y=[],b=function(){function T(P,C,L){this._index=0,this._keys=P,this._values=C,this._selector=L}return T.prototype["@@iterator"]=function(){return this},T.prototype[s]=function(){return this},T.prototype.next=function(){var P=this._index;if(P>=0&&P<this._keys.length){var C=this._selector(this._keys[P],this._values[P]);return P+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:C,done:!1}}return{value:void 0,done:!0}},T.prototype.throw=function(P){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),P},T.prototype.return=function(P){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:P,done:!0}},T}();return function(){function T(){this._keys=[],this._values=[],this._cacheKey=h,this._cacheIndex=-2}return Object.defineProperty(T.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),T.prototype.has=function(P){return this._find(P,!1)>=0},T.prototype.get=function(P){var C=this._find(P,!1);return C>=0?this._values[C]:void 0},T.prototype.set=function(P,C){var L=this._find(P,!0);return this._values[L]=C,this},T.prototype.delete=function(P){var C=this._find(P,!1);if(C>=0){for(var L=this._keys.length,M=C+1;M<L;M++)this._keys[M-1]=this._keys[M],this._values[M-1]=this._values[M];return this._keys.length--,this._values.length--,P===this._cacheKey&&(this._cacheKey=h,this._cacheIndex=-2),!0}return!1},T.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=h,this._cacheIndex=-2},T.prototype.keys=function(){return new b(this._keys,this._values,_)},T.prototype.values=function(){return new b(this._keys,this._values,E)},T.prototype.entries=function(){return new b(this._keys,this._values,z)},T.prototype["@@iterator"]=function(){return this.entries()},T.prototype[s]=function(){return this.entries()},T.prototype._find=function(P,C){return this._cacheKey!==P&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=P)),this._cacheIndex<0&&C&&(this._cacheIndex=this._keys.length,this._keys.push(P),this._values.push(void 0)),this._cacheIndex},T}();function _(T,P){return T}function E(T,P){return P}function z(T,P){return[T,P]}}function Xi(){return function(){function h(){this._map=new p}return Object.defineProperty(h.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),h.prototype.has=function(y){return this._map.has(y)},h.prototype.add=function(y){return this._map.set(y,y),this},h.prototype.delete=function(y){return this._map.delete(y)},h.prototype.clear=function(){this._map.clear()},h.prototype.keys=function(){return this._map.keys()},h.prototype.values=function(){return this._map.values()},h.prototype.entries=function(){return this._map.entries()},h.prototype["@@iterator"]=function(){return this.keys()},h.prototype[s]=function(){return this.keys()},h}()}function Yi(){var h=16,y=f.create(),b=_();return function(){function C(){this._key=_()}return C.prototype.has=function(L){var M=E(L,!1);return M!==void 0?f.has(M,this._key):!1},C.prototype.get=function(L){var M=E(L,!1);return M!==void 0?f.get(M,this._key):void 0},C.prototype.set=function(L,M){var Ce=E(L,!0);return Ce[this._key]=M,this},C.prototype.delete=function(L){var M=E(L,!1);return M!==void 0?delete M[this._key]:!1},C.prototype.clear=function(){this._key=_()},C}();function _(){var C;do C="@@WeakMap@@"+P();while(f.has(y,C));return y[C]=!0,C}function E(C,L){if(!t.call(C,b)){if(!L)return;Object.defineProperty(C,b,{value:f.create()})}return C[b]}function z(C,L){for(var M=0;M<L;++M)C[M]=Math.random()*255|0;return C}function T(C){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(C)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(C)):z(new Uint8Array(C),C):z(new Array(C),C)}function P(){var C=T(h);C[6]=C[6]&79|64,C[8]=C[8]&191|128;for(var L="",M=0;M<h;++M){var Ce=C[M];(M===4||M===6||M===8)&&(L+="-"),Ce<16&&(L+="0"),L+=Ce.toString(16).toLowerCase()}return L}}function qt(h){return h.__=void 0,delete h.__,h}})})(cn||(cn={}));const Rt=class Rt{constructor(e,t,r){c(this,"actionUrl");c(this,"queue");c(this,"allowed");c(this,"doWork");this.actionUrl=e,this.queue=t,this.allowed=r}async run(e,t,r){t===void 0&&(t=de.apiClient.url),r||(r=mt(de.apiClient.httpClient));let i=await r.post(t+"/"+this.actionUrl,e),s=i;if(s&&s.queuedJobId){let o=I.actionInfo.startBusyWithProgress();try{let a;if(await I.actionInfo.runActionWithoutBlockingUI(async()=>{for(;!a||!a.done;)a&&await new Promise(l=>setTimeout(()=>{l(void 0)},200)),a=await r.post(t+"/"+Rt.apiUrlForJobStatus,{queuedJobId:i.queuedJobId}),a.progress&&o.progress(a.progress)}),a.error)throw a.error;return o.progress(1),a.result}finally{o.close()}}else return i}__register(e){e(this.actionUrl,this.queue,this.allowed,async(t,r,i)=>{try{var s=await this.execute(t,r,i);i.success(s)}catch(o){o.isForbiddenError?i.forbidden():i.error(o)}})}};c(Rt,"apiUrlForJobStatus","jobStatusInQueue");let ft=Rt;class fr extends Error{constructor(){super("Forbidden");c(this,"isForbiddenError",!0)}}class qo extends ft{constructor(t,r,i,s){super(t,i.queue,i.allowed);c(this,"types");c(this,"options");c(this,"originalMethod");this.types=r,this.options=i,this.originalMethod=s}async execute(t,r,i){let s={data:{}},o=r.dataProvider;return await Bn(r,async()=>{if(!r.isAllowedForInstance(void 0,this.options.allowed))throw new fr;t.args=await Ri(this.types(),t.args,r,o,i);try{s.data=await this.originalMethod(t.args)}catch(a){throw a}}),s}}function Oe(n){return(e,t,r)=>{const i=typeof t=="string"?t:t.name.toString(),s=r?r.value:e;let o=s;Pi(e);function a(){var u=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:paramtypes",e,i):[];return n.paramTypes&&(u=typeof n.paramTypes=="function"?n.paramTypes():n.paramTypes),u}if(e.prototype!==void 0){let u=new qo((n!=null&&n.apiPrefix?n.apiPrefix+"/":"")+i,()=>a(),n,d=>s.apply(void 0,d));return u.doWork=async(d,p,m,g)=>(d=pn(a(),d),n.blockUser===!1?await I.actionInfo.runActionWithoutBlockingUI(async()=>(await u.run({args:d},m,g)).data):(await u.run({args:d},m,g)).data),o=async function(...d){return ar()?await s.apply(this,d):await u.doWork(d,void 0)},dn(e,o),o[or]=u,r?(r.value=o,r):o}let l=I.classHelpers.get(e.constructor);l||(l=new Xs,I.classHelpers.set(e.constructor,l));let f={__register(u){let d=new ge;for(const p of l.classes.keys()){let m=l.classes.get(p);m.key||(m.key=d.repo(p).metadata.key),u(m.key+"/"+(n!=null&&n.apiPrefix?n.apiPrefix+"/":"")+i,n?n.queue:!1,n.allowed,async(g,k,O)=>{g.args=g.args.map(w=>Fi(w)?void 0:w);let D=n.allowed;try{let w=k,V;await Bn(w,async()=>{if(g.args=await Ri(a(),g.args,w,w.dataProvider,O),I.allEntities.includes(p)){let H=w.repo(p),ee;if(g.rowInfo.isNewRow)ee=H.create(),await H.getEntityRef(ee)._updateEntityBasedOnApi(g.rowInfo.data);else{let ve=await H.find({where:{...H.metadata.idMetadata.getIdFilter(g.rowInfo.id),$and:[H.metadata.options.apiPrefilter]}});if(ve.length!=1)throw new Error("not found or too many matches");ee=ve[0],await H.getEntityRef(ee)._updateEntityBasedOnApi(g.rowInfo.data)}if(!w.isAllowedForInstance(ee,D))throw new fr;let fe=W(ee);await fe.__validateEntity();try{V={result:await s.apply(ee,g.args),rowInfo:{data:await fe.toApiJson(),isNewRow:fe.isNew(),wasChanged:fe.wasChanged(),id:fe.getOriginalId()}}}catch(ve){throw fe.catchSaveErrors(ve)}}else{let H=new p(w,w.dataProvider),ee=sn(H,w);if(await ee._updateEntityBasedOnApi(g.fields),!w.isAllowedForInstance(H,D))throw new fr;await ee.__validateEntity();try{V={result:await s.apply(H,g.args),fields:await ee.toApiJson()}}catch(fe){throw ee.catchSaveErrors(fe)}}}),O.success(V)}catch(w){w.isForbiddenError?O.forbidden():O.error(w)}})}},doWork:async function(u,d,p,m){if(u=pn(a(),u),I.allEntities.includes(e.constructor)){let g=W(d);await g.__validateEntity();let k=l.classes.get(d.constructor);k.key||(k.key=g.repository.metadata.key+"_methods");try{let O=await new class extends ft{constructor(){super(...arguments);c(this,"execute")}}(k.key+"/"+(n!=null&&n.apiPrefix?n.apiPrefix+"/":"")+i,n?n.queue:!1,n.allowed).run({args:u,rowInfo:{data:await g.toApiJson(),isNewRow:g.isNew(),wasChanged:g.wasChanged(),id:g.getOriginalId()}},p,m);return await g._updateEntityBasedOnApi(O.rowInfo.data,!0),O.result}catch(O){throw g.catchSaveErrors(O)}}else{let g=sn(d,void 0);try{await g.__validateEntity();let k=await new class extends ft{constructor(){super(...arguments);c(this,"execute")}}(l.classes.get(d.constructor).key+"/"+(n!=null&&n.apiPrefix?n.apiPrefix+"/":"")+i,n?n.queue:!1,n.allowed).run({args:u,fields:await g.toApiJson()},p,m);return await g._updateEntityBasedOnApi(k.fields),k.result}catch(k){throw g.catchSaveErrors(k)}}}};return o=async function(...u){if(ar())return await s.apply(this,u);{let d=this;return f.doWork(u,d)}},dn(e.constructor,o),o[or]=f,r?(r.value=o,r):o}}const jo={_isUndefined:!0};function dn(n,e){(n[yn]||(n[yn]=[])).push(e),I.actionInfo.allActions.push(e)}function Fi(n){return n&&n._isUndefined}class hn{constructor(e){c(this,"res");this.res=e}progress(e){this.res.progress(e)}}function pn(n,e){if(n)for(let t=0;t<n.length;t++){const r=n[t];for(const i of[ge,Ke])(e[t]instanceof i||r==i)&&(e[t]=void 0);if(e[t]!=null){let i={valueType:r};if(i=Cr(i,new ge),ue(r,!1)!=null){let o=W(e[t]);e[t]=o.getId()}i.valueConverter&&(e[t]=i.valueConverter.toJson(e[t]))}}return e.map(t=>t!==void 0?t:jo)}async function Ri(n,e,t,r,i){for(let s=0;s<e.length;s++){const o=e[s];Fi(o)&&(e[s]=void 0)}if(n)for(let s=0;s<n.length;s++)if(e.length<s&&e.push(void 0),n[s]==ge||n[s]==ge)e[s]=t;else if(n[s]==Ke&&r)e[s]=r;else if(n[s]==hn)e[s]=new hn(i);else{let o={valueType:n[s]};o=Cr(o,t),o.valueConverter&&(e[s]=o.valueConverter.fromJson(e[s])),ue(n[s],!1)!=null&&(e[s]===null||e[s]===void 0||(e[s]=await t.repo(n[s]).findId(e[s])))}return e}const yn=Symbol.for("classBackendMethodsArray");var Jo=Object.defineProperty,xo=Object.getOwnPropertyDescriptor,Ee=(n,e,t,r)=>{for(var i=r>1?void 0:r?xo(e,t):e,s=n.length-1,o;s>=0;s--)(o=n[s])&&(i=(r?o(e,t,i):o(i))||i);return r&&i&&Jo(e,t,i),i};class we{static async signOut(){}static async signInDemo(){}static async signUpPassword(){}static async signInPassword(){}static async forgotPassword(){}static async resetPassword(){}static async signInOTP(){}static async verifyOtp(){}static async signInOAuthGetUrl(){}}Ee([Oe({})],we,"signOut",1);Ee([Oe({})],we,"signInDemo",1);Ee([Oe({})],we,"signUpPassword",1);Ee([Oe({})],we,"signInPassword",1);Ee([Oe({})],we,"forgotPassword",1);Ee([Oe({})],we,"resetPassword",1);Ee([Oe({})],we,"signInOTP",1);Ee([Oe({})],we,"verifyOtp",1);Ee([Oe({})],we,"signInOAuthGetUrl",1);I.actionInfo;const Uo="",Ho="font-weight: bold",Wo="opacity: 0.5",$o="font-style: italic",Vo="text-decoration: underline",Ko="filter: invert(1)",Qo="visibility: hidden",Go="text-decoration: line-through",zo="color: black",Xo="color: red",Yo="color: green",Zo="color: yellow",ea="color: blue",ta="color: #ff00ff",ra="color: cyan",na="color: white",ia="color: gray",sa="background-color: black",oa="background-color: red",aa="background-color: green",la="background-color: yellow",ua="background-color: blue",fa="background-color: #ff00ff",ca="background-color: cyan",da="background-color: white",ha="color: #a9a9a9",pa="color: #ff4500",ya="color: #7fff00",ma="color: #ffd700",ga="color: #1e90ff",wa="color: #ff69b4",ba="color: #00ffff",va="color: #ffffff",ka="background-color: #a9a9a9",_a="background-color: #ff4500",Ia="background-color: #7fff00",Oa="background-color: #ffd700",Ea="background-color: #1e90ff",Ca="background-color: #ff69b4",Sa="background-color: #00ffff",Ta="background-color: #ffffff",Aa=Object.freeze(Object.defineProperty({__proto__:null,bgBlack:sa,bgBlackBright:ka,bgBlue:ua,bgBlueBright:Ea,bgCyan:ca,bgCyanBright:Sa,bgGreen:aa,bgGreenBright:Ia,bgMagenta:fa,bgMagentaBright:Ca,bgRed:oa,bgRedBright:_a,bgWhite:da,bgWhiteBright:Ta,bgYellow:la,bgYellowBright:Oa,black:zo,blackBright:ha,blue:ea,blueBright:ga,bold:Ho,cyan:ra,cyanBright:ba,dim:Wo,gray:ia,green:Yo,greenBright:ya,hidden:Qo,inverse:Ko,italic:$o,magenta:ta,magentaBright:wa,red:Xo,redBright:pa,reset:Uo,strikethrough:Go,underline:Vo,white:na,whiteBright:va,yellow:Zo,yellowBright:ma},Symbol.toStringTag,{value:"Module"})),Pa=n=>Aa[n]??void 0,Ge=(n,e)=>Fa(n,e),cr="$$KitQL_",dr="_KitQL$$",hr="$$KitQLEND$$",Fa=(n,e)=>`${cr}${n}${dr}${e}${hr}`;function Ra(n){const e=/\$\$KitQL_(.*?)_KitQL\$\$/g;let t;const r=[];for(;(t=e.exec(n))!==null;)r.push(t[1]);return r}const mn=(n,e)=>{let t=0;const r=[];for(;t!==-1;)t=n.indexOf(e,t),t!==-1&&(r.push(t),t+=e.length);return r},gn=(...n)=>{const e=[...n],t=[],r=[],i=[];for(let s=0;s<e.length;s++){let o=e[s];if(typeof o!="string")i.push(o);else{const a=o,l=[],f=[...new Set(Ra(a))];for(const d of f){const p=mn(a,`${cr}${d}${dr}`);for(const m of p)l.push({index:m,browser:Pa(d)});o=o.replaceAll(`${cr}${d}${dr}`,"%c")}const u=mn(a,hr);for(const d of u)l.push({index:d,browser:""});o=o.replaceAll(hr,"%c");for(const d of l.sort((p,m)=>p.index-m.index))r.push(d.browser);t.push(o)}}return[t.join(" "),...r,...i]},wn=n=>Ge("bold",n),Da=n=>Ge("bgGreen",n),La=n=>Ge("redBright",n),Ma=n=>Ge("greenBright",n),Ba=n=>Ge("bgRedBright",n),Gt=n=>Ge("bgBlueBright",n);class Na{constructor(e,t){c(this,"toolName");c(this,"levelsToShow");c(this,"withDate");c(this,"prefixEmoji");this.toolName=e,this.levelsToShow=(t==null?void 0:t.levelsToShow)??3,this.withDate=(t==null?void 0:t.withDate)??null,this.prefixEmoji=(t==null?void 0:t.prefixEmoji)??""}buildStr(e,t,r,...i){const s=[];if(this.toolName){const o=` ${this.toolName} `;e?s.push(Ba(o)):t?s.push(Da(o)):s.push(Gt(o))}if(this.withDate==="dateTime"?s.push(String(Gt(`${new Date().toISOString()} `))):this.withDate==="time"&&s.push(String(Gt(`${new Date().toISOString().split("T")[1]} `))),e?s.push(wn(La(" "))):t?s.push(wn(Ma(" "))):s.push(""+this.prefixEmoji),r>0){const o=" ".repeat(r);s.push(o)}return s.length===0||s.length===1&&s[0]===""?gn(...i.flatMap(o=>o)):gn(s.join(""),...i.flatMap(o=>o))}infoO(e,...t){const r=this.buildStr(!1,!1,e.level,...t);return console.info(...r.flatMap(i=>i)),r}info(...e){const t=this.buildStr(!1,!1,0,...e);return console.info(...t.flatMap(r=>r)),t}successO(e,...t){const r=this.buildStr(!1,!0,e.level,t);return console.info(...r.flatMap(i=>i)),r}success(...e){const t=this.buildStr(!1,!0,0,e);return console.info(...t.flatMap(r=>r)),t}error(...e){const t=this.buildStr(!0,!1,0,e);return console.error(...t.flatMap(r=>r)),t}}new Na("remult-kit");function qa(n){return n}const{Error:pe}=vn,ce="src/lib/modules/auth/components/Login.svelte";function pr(n){let e,t,r,i,s,o,a,l,f,u,d,p,m,g,k,O;const D={c:function(){e=x("form"),t=x("p"),r=_e(n[1]),i=_e(n[2]),s=me(),o=x("label"),a=_e(`Username
      `),l=x("input"),f=me(),u=x("label"),d=_e(`Password
      `),p=x("input"),m=me(),g=x("button"),g.textContent="Login",ne(t,"class","message s-W59Gs1JvsTvT"),Ur(t,"error",n[1]),U(t,ce,36,4,757),ne(l,"type","text"),U(l,ce,39,6,859),U(o,ce,37,4,830),ne(p,"type","password"),U(p,ce,43,6,966),U(u,ce,41,4,937),U(g,ce,45,4,1031),ne(e,"class","s-W59Gs1JvsTvT"),U(e,ce,35,2,712)},m:function(V,H){Y(V,e,H),B(e,t),B(t,r),B(t,i),B(e,s),B(e,o),B(o,a),B(o,l),He(l,n[0]),B(e,f),B(e,u),B(u,d),B(u,p),He(p,n[4]),B(e,m),B(e,g),k||(O=[$e(l,"input",n[9]),Mt(yt.call(null,l)),$e(p,"input",n[10]),$e(e,"submit",Sn(n[6]),!1,!0,!1,!1)],k=!0)},p:function(V,H){H&2&&Ct(r,V[1]),H&4&&Ct(i,V[2]),H&2&&Ur(t,"error",V[1]),H&1&&l.value!==V[0]&&He(l,V[0]),H&16&&p.value!==V[4]&&He(p,V[4])},d:function(V){V&&Z(e),k=!1,Dt(O)}};return Q("SvelteRegisterBlock",{block:D,id:pr.name,type:"if",source:"(27:0) {#if view == 'login'}",ctx:n}),D}function yr(n){let e,t,r,i,s,o,a,l,f,u,d,p;const m={c:function(){e=x("form"),t=x("p"),r=_e(n[1]),i=_e(n[2]),s=me(),o=x("label"),a=_e(`PIN
      `),l=x("input"),f=me(),u=x("button"),u.textContent="Confirm",U(t,ce,51,4,1141),ne(l,"type","number"),ne(l,"placeholder","556775"),U(l,ce,54,6,1199),U(o,ce,52,4,1175),U(u,ce,56,4,1296),ne(e,"class","s-W59Gs1JvsTvT"),U(e,ce,50,2,1093)},m:function(k,O){Y(k,e,O),B(e,t),B(t,r),B(t,i),B(e,s),B(e,o),B(o,a),B(o,l),He(l,n[5]),B(e,f),B(e,u),d||(p=[$e(l,"input",n[11]),Mt(yt.call(null,l)),$e(e,"submit",Sn(n[7]),!1,!0,!1,!1)],d=!0)},p:function(k,O){O&2&&Ct(r,k[1]),O&4&&Ct(i,k[2]),O&32&&Cn(l.value)!==k[5]&&He(l,k[5])},d:function(k){k&&Z(e),d=!1,Dt(p)}};return Q("SvelteRegisterBlock",{block:m,id:yr.name,type:"if",source:"(42:0) {#if view == 'pin'}",ctx:n}),m}function mr(n){let e,t,r=n[3]=="login"&&pr(n),i=n[3]=="pin"&&yr(n);const s={c:function(){r&&r.c(),e=me(),i&&i.c(),t=_n()},l:function(a){throw new pe("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){r&&r.m(a,l),Y(a,e,l),i&&i.m(a,l),Y(a,t,l)},p:function(a,[l]){a[3]=="login"?r?r.p(a,l):(r=pr(a),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),a[3]=="pin"?i?i.p(a,l):(i=yr(a),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:ye,o:ye,d:function(a){a&&(Z(e),Z(t)),r&&r.d(a),i&&i.d(a)}};return Q("SvelteRegisterBlock",{block:s,id:mr.name,type:"component",source:"",ctx:n}),s}function ja(n,e,t){let{$$slots:r={},$$scope:i}=e;ht("Login",r,[]);let{remultKitData:s}=e,{view:o="login"}=e,{indentifier:a=""}=e,{msgError:l=""}=e,{msgSuccess:f=""}=e,u,d;async function p(){t(1,l=""),t(2,f="");try{await we.signInPassword(a,u)}catch(w){w&&t(1,l=w.message??"")}}const m=()=>{throw new Error("Not impl yet")};n.$$.on_mount.push(function(){s===void 0&&!("remultKitData"in e||n.$$.bound[n.$$.props.remultKitData])&&console.warn("<Login> was created without expected prop 'remultKitData'")});const g=["remultKitData","view","indentifier","msgError","msgSuccess"];Object.keys(e).forEach(w=>{!~g.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<Login> was created with unknown prop '${w}'`)});function k(){a=this.value,t(0,a)}function O(){u=this.value,t(4,u)}function D(){d=Cn(this.value),t(5,d)}return n.$$set=w=>{"remultKitData"in w&&t(8,s=w.remultKitData),"view"in w&&t(3,o=w.view),"indentifier"in w&&t(0,a=w.indentifier),"msgError"in w&&t(1,l=w.msgError),"msgSuccess"in w&&t(2,f=w.msgSuccess)},n.$capture_state=()=>({AuthController:we,isError:qa,autofocus:yt,remultKitData:s,view:o,indentifier:a,msgError:l,msgSuccess:f,password:u,pincode:d,signIn:p,handlePin:m}),n.$inject_state=w=>{"remultKitData"in w&&t(8,s=w.remultKitData),"view"in w&&t(3,o=w.view),"indentifier"in w&&t(0,a=w.indentifier),"msgError"in w&&t(1,l=w.msgError),"msgSuccess"in w&&t(2,f=w.msgSuccess),"password"in w&&t(4,u=w.password),"pincode"in w&&t(5,d=w.pincode)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),[a,l,f,o,u,d,p,m,s,k,O,D]}class Di extends ct{constructor(e){super(e),dt(this,e,ja,mr,Lt,{remultKitData:8,view:3,indentifier:0,msgError:1,msgSuccess:2}),Q("SvelteRegisterComponent",{component:this,tagName:"Login",options:e,id:mr.name})}get remultKitData(){throw new pe("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new pe("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new pe("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new pe("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get indentifier(){throw new pe("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set indentifier(e){throw new pe("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get msgError(){throw new pe("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set msgError(e){throw new pe("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get msgSuccess(){throw new pe("<Login>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set msgSuccess(e){throw new pe("<Login>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Qe="src/lib/modules/auth/Page.svelte";function Li(n){let e;const t={c:function(){e=_e("Forgot your password?")},m:function(i,s){Y(i,e,s)},d:function(i){i&&Z(e)}};return Q("SvelteRegisterBlock",{block:t,id:Li.name,type:"slot",source:"(18:10) <Link href={forgottenPasswordPath}>",ctx:n}),t}function Mi(n){let e,t,r,i,s;e=new Di({props:{remultKitData:n[0]},$$inline:!0}),i=new vr({props:{href:n[2],$$slots:{default:[Li]},$$scope:{ctx:n}},$$inline:!0});const o={c:function(){Se(e.$$.fragment),t=me(),r=x("div"),Se(i.$$.fragment),ne(r,"class","form-footer s-NO-a_LAEXXH5"),U(r,Qe,20,8,536)},m:function(l,f){Te(e,l,f),Y(l,t,f),Y(l,r,f),Te(i,r,null),s=!0},p:function(l,f){const u={};f&1&&(u.remultKitData=l[0]),e.$set(u);const d={};f&4&&(d.href=l[2]),f&8&&(d.$$scope={dirty:f,ctx:l}),i.$set(d)},i:function(l){s||(le(e.$$.fragment,l),le(i.$$.fragment,l),s=!0)},o:function(l){he(e.$$.fragment,l),he(i.$$.fragment,l),s=!1},d:function(l){l&&(Z(t),Z(r)),Ae(e,l),Ae(i)}};return Q("SvelteRegisterBlock",{block:o,id:Mi.name,type:"slot",source:"(14:6) <Route path={loginPath}>",ctx:n}),o}function Bi(n){let e;const t={c:function(){e=_e("Back to login")},m:function(i,s){Y(i,e,s)},d:function(i){i&&Z(e)}};return Q("SvelteRegisterBlock",{block:t,id:Bi.name,type:"slot",source:"(26:10) <Link href={loginPath}>",ctx:n}),t}function Ni(n){let e,t,r,i,s;e=new Pn({props:{remultKitData:n[0]},$$inline:!0}),i=new vr({props:{href:n[1],$$slots:{default:[Bi]},$$scope:{ctx:n}},$$inline:!0});const o={c:function(){Se(e.$$.fragment),t=me(),r=x("div"),Se(i.$$.fragment),ne(r,"class","form-footer s-NO-a_LAEXXH5"),U(r,Qe,28,8,765)},m:function(l,f){Te(e,l,f),Y(l,t,f),Y(l,r,f),Te(i,r,null),s=!0},p:function(l,f){const u={};f&1&&(u.remultKitData=l[0]),e.$set(u);const d={};f&2&&(d.href=l[1]),f&8&&(d.$$scope={dirty:f,ctx:l}),i.$set(d)},i:function(l){s||(le(e.$$.fragment,l),le(i.$$.fragment,l),s=!0)},o:function(l){he(e.$$.fragment,l),he(i.$$.fragment,l),s=!1},d:function(l){l&&(Z(t),Z(r)),Ae(e,l),Ae(i)}};return Q("SvelteRegisterBlock",{block:o,id:Ni.name,type:"slot",source:"(22:6) <Route path={forgottenPasswordPath}>",ctx:n}),o}function qi(n){let e,t;const r={c:function(){e=x("div"),t=x("small"),t.textContent="Nothing to see here",U(t,Qe,35,10,940),ne(e,"class","fallback s-NO-a_LAEXXH5"),U(e,Qe,34,8,907)},m:function(s,o){Y(s,e,o),B(e,t)},p:ye,d:function(s){s&&Z(e)}};return Q("SvelteRegisterBlock",{block:r,id:qi.name,type:"slot",source:"(30:6) <Route fallback>",ctx:n}),r}function ji(n){let e,t,r,i,s,o;e=new it({props:{path:n[1],$$slots:{default:[Mi]},$$scope:{ctx:n}},$$inline:!0}),r=new it({props:{path:n[2],$$slots:{default:[Ni]},$$scope:{ctx:n}},$$inline:!0}),s=new it({props:{fallback:!0,$$slots:{default:[qi]},$$scope:{ctx:n}},$$inline:!0});const a={c:function(){Se(e.$$.fragment),t=me(),Se(r.$$.fragment),i=me(),Se(s.$$.fragment)},m:function(f,u){Te(e,f,u),Y(f,t,u),Te(r,f,u),Y(f,i,u),Te(s,f,u),o=!0},p:function(f,u){const d={};u&2&&(d.path=f[1]),u&13&&(d.$$scope={dirty:u,ctx:f}),e.$set(d);const p={};u&4&&(p.path=f[2]),u&11&&(p.$$scope={dirty:u,ctx:f}),r.$set(p);const m={};u&8&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i:function(f){o||(le(e.$$.fragment,f),le(r.$$.fragment,f),le(s.$$.fragment,f),o=!0)},o:function(f){he(e.$$.fragment,f),he(r.$$.fragment,f),he(s.$$.fragment,f),o=!1},d:function(f){f&&(Z(t),Z(i)),Ae(e,f),Ae(r,f),Ae(s,f)}};return Q("SvelteRegisterBlock",{block:a,id:ji.name,type:"slot",source:"(13:4) <Route>",ctx:n}),a}function gr(n){let e,t,r,i;r=new it({props:{$$slots:{default:[ji]},$$scope:{ctx:n}},$$inline:!0});const s={c:function(){e=x("div"),t=x("div"),Se(r.$$.fragment),ne(t,"class","form s-NO-a_LAEXXH5"),U(t,Qe,15,2,431),ne(e,"class","wrapper s-NO-a_LAEXXH5"),U(e,Qe,14,0,407)},l:function(a){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,l){Y(a,e,l),B(e,t),Te(r,t,null),i=!0},p:function(a,[l]){const f={};l&15&&(f.$$scope={dirty:l,ctx:a}),r.$set(f)},i:function(a){i||(le(r.$$.fragment,a),i=!0)},o:function(a){he(r.$$.fragment,a),i=!1},d:function(a){a&&Z(e),Ae(r)}};return Q("SvelteRegisterBlock",{block:s,id:gr.name,type:"component",source:"",ctx:n}),s}function Ja(n,e,t){let r,i,{$$slots:s={},$$scope:o}=e;ht("Page",s,[]);let{remultKitData:a}=e;n.$$.on_mount.push(function(){a===void 0&&!("remultKitData"in e||n.$$.bound[n.$$.props.remultKitData])&&console.warn("<Page> was created without expected prop 'remultKitData'")});const l=["remultKitData"];return Object.keys(e).forEach(f=>{!~l.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&console.warn(`<Page> was created with unknown prop '${f}'`)}),n.$$set=f=>{"remultKitData"in f&&t(0,a=f.remultKitData)},n.$capture_state=()=>({Link:vr,Route:it,ForgottenPassword:Pn,Login:Di,remultKitData:a,loginPath:i,forgottenPasswordPath:r}),n.$inject_state=f=>{"remultKitData"in f&&t(0,a=f.remultKitData),"loginPath"in f&&t(1,i=f.loginPath),"forgottenPasswordPath"in f&&t(2,r=f.forgottenPasswordPath)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&t(2,r=a.props.paths.base+a.props.paths.forgottenPassword),n.$$.dirty&1&&t(1,i=a.props.paths.base+a.props.paths.login)},[a,i,r]}class Va extends ct{constructor(e){super(e),dt(this,e,Ja,gr,Lt,{remultKitData:0}),Q("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:gr.name})}get remultKitData(){throw new Error("<Page>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set remultKitData(e){throw new Error("<Page>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{Va as default};
