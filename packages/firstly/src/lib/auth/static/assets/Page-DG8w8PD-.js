var _a=Object.defineProperty;var ji=i=>{throw TypeError(i)};var ka=(i,e,t)=>e in i?_a(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>ka(i,typeof e!="symbol"?e+"":e,t),Ji=(i,e,t)=>e.has(i)||ji("Cannot "+t);var Ne=(i,e,t)=>(Ji(i,e,"read from private field"),t?t.call(i):e.get(i)),Be=(i,e,t)=>e.has(i)?ji("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Le=(i,e,t,r)=>(Ji(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);import{n as fe,s as Ia,r as Ft,a as Tt,i as Oa,g as Aa,S as ht,b as pt,c as bn,d as V,e as gi,v as kt,f as It,h as yt,j as Ui,k as Lr,o as Vi,l as qr,m as Sa,p as vn,q as bi,t as G,u as z,w as Ca,x as Y,y as Ea,z as Q,A as _n,B as kn,C as In,D as Kr,E as Wi,F as Fa,G as J,H as Hi,I as U,J as Cr,K as Pe,L as Ta,M as oe,N as K,O as W,P as Ye,Q as E,R as Se,T as Er,U as we,V as ke,W as Ie,X as Oe,Y as vi,Z as _i,_ as ki}from"./index-D3Jb0PbU.js";function Pa(i,e){const t={},r={},n={$$scope:1};let s=i.length;for(;s--;){const a=i[s],o=e[s];if(o){for(const l in a)l in o||(r[l]=1);for(const l in o)n[l]||(t[l]=o[l],n[l]=1);i[s]=o}else for(const l in a)n[l]=1}for(const a in r)a in t||(t[a]=void 0);return t}const gt=[];function Ii(i,e){return{subscribe:Vt(i,e).subscribe}}function Vt(i,e=fe){let t;const r=new Set;function n(o){if(Tt(i,o)&&(i=o,t)){const l=!gt.length;for(const f of r)f[1](),gt.push(f,i);if(l){for(let f=0;f<gt.length;f+=2)gt[f][0](gt[f+1]);gt.length=0}}}function s(o){n(o(i))}function a(o,l=fe){const f=[o,l];return r.add(f),r.size===1&&(t=e(n,s)||fe),o(i),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:a}}function Fr(i,e,t){const r=!Array.isArray(i),n=r?[i]:i;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Ii(t,(a,o)=>{let l=!1;const f=[];let u=0,c=fe;const h=()=>{if(u)return;c();const y=e(r?f[0]:f,a,o);s?a(y):c=Oa(y)?y:fe},p=n.map((y,g)=>Ia(y,w=>{f[g]=w,u&=~(1<<g),l&&h()},()=>{u|=1<<g}));return l=!0,h(),function(){Ft(p),c(),l=!1}})}const Da=i=>{const{subscribe:e,update:t}=Vt(i);return{subscribe:e,set:(r={})=>{t(n=>Object.assign(n,r))}}},Ze=Da({mode:"window",basePath:null}),jr=(i=Aa(Ze).mode)=>{let e="popstate";i==="window"&&(e="popstate"),i==="hash"&&(e="hashchange"),window.dispatchEvent(new Event(e))},$i={go:(i=0)=>{history.go(i),jr()},push:(i,e=null)=>{history.pushState(e,"",i),jr()},replace:(i,e=null)=>{history.replaceState(e,"",i),jr()}},Ra=i=>{const e=i.match(/^(\/[^?#]*)?/),t=i.match(/\?([^#]*)?/),r=i.match(/#(.*)?/);return{path:(e==null?void 0:e[1])||"/",query:t!=null&&t[1]?`?${t==null?void 0:t[1]}`:"",hash:r!=null&&r[1]?`#${r==null?void 0:r[1]}`:""}},xi=()=>{const{pathname:i,search:e,hash:t}=document.location;return{path:i,query:e,hash:t}},Gi=()=>{let i=document.location.hash.substring(1);return i[0]!=="/"&&(i="/"+i),Ra(i)},Ma=Ii(xi(),i=>{const e=()=>i(xi());return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),Na=Ii(Gi(),i=>{const e=()=>i(Gi());return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),Oi=Fr([Ze,Ma,Na],([i,e,t],r)=>{i.mode==="window"&&r(e),i.mode==="hash"&&r(t)}),Jr=Fr(Oi,i=>i.path);Fr(Oi,i=>i.query);Fr(Oi,i=>i.hash);const Jt=i=>i.split(/(?=\/)/),On=()=>{let i=0;return()=>i++},Xr=(i,e)=>e===null?i:i.startsWith(e)?i.slice(e.length):i,{Error:Bt}=gi;function Zr(i){let e;const t=i[11].default,r=vn(t,i,i[10],null),n={c:function(){r&&r.c()},m:function(a,o){r&&r.m(a,o),e=!0},p:function(a,o){r&&r.p&&(!e||o&1024)&&_n(r,t,a,a[10],e?In(t,a[10],o,null):kn(a[10]),null)},i:function(a){e||(z(r,a),e=!0)},o:function(a){Y(r,a),e=!1},d:function(a){r&&r.d(a)}};return V("SvelteRegisterBlock",{block:n,id:Zr.name,type:"if",source:"(98:0) {#if isRouteActive(getPathWithoutBase($globalPath, $options.basePath), $route, $contextChildRoutes)}",ctx:i}),n}function Yr(i){let e=ei(Xr(i[1],i[2].basePath),i[0],i[3]),t,r,n=e&&Zr(i);const s={c:function(){n&&n.c(),t=bi()},l:function(o){throw new Bt("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(o,l){n&&n.m(o,l),G(o,t,l),r=!0},p:function(o,[l]){l&15&&(e=ei(Xr(o[1],o[2].basePath),o[0],o[3])),e?n?(n.p(o,l),l&15&&z(n,1)):(n=Zr(o),n.c(),z(n,1),n.m(t.parentNode,t)):n&&(Ca(),Y(n,1,1,()=>{n=null}),Ea())},i:function(o){r||(z(n),r=!0)},o:function(o){Y(n),r=!1},d:function(o){o&&Q(t),n&&n.d(o)}};return V("SvelteRegisterBlock",{block:s,id:Yr.name,type:"component",source:"",ctx:i}),s}const Qi=(i,e,t,r,n)=>{const s=(f,u,c)=>{const h=Jt(u).filter(p=>p!=="/").length;return(c??0)+(f?1:h)},a=(f,u)=>{const c={invalidPath:`<Route path="${f==null?void 0:f.path}" /> has invalid path. Path must start with '/'`,fallbackOutsideRoot:"<Route fallback /> cannot be outside root <Route />",pathOutsideRoot:`<Route path="${f==null?void 0:f.path}" /> cannot be outside root <Route />`,fallbackInsideFallback:"<Route fallback /> cannot be inside <Route fallback>",pathInsideFallback:`<Route path="${f==null?void 0:f.path}" /> cannot be inside <Route fallback>`};if(f.path[0]!=="/")throw new Error(c.invalidPath);if(f.root&&f.fallback)throw new Error(c.fallbackOutsideRoot);if(f.root&&f.path!=="/")throw new Error(c.pathOutsideRoot);if(u!=null&&u.fallback&&f.fallback)throw new Error(c.fallbackInsideFallback);if(u!=null&&u.fallback&&!f.fallback)throw new Error(c.pathInsideFallback)},o=s(t,r,n==null?void 0:n.depth),l={id:i,root:e,fallback:t,path:r,depth:o};return a(l,n),l},zi=()=>{const{subscribe:i,update:e}=Vt([]);return{subscribe:i,update:t=>e(r=>[...r.filter(n=>t.id!==n.id),t]),remove:t=>e(r=>r.filter(n=>t.id!==n.id))}},ei=(i,e,t)=>{const r=(f,u,c,h)=>{let p=Jt(f).filter(w=>w!=="/"),y=Jt(c).filter(w=>w!=="/"),g="";if(c==="/")return u||p.length===h;for(let w=h-y.length;w<h;w++)g=g+p[w];return c===g},n=(f,u,c)=>{var y,g,w,O;let h=Jt(f).filter(I=>I!=="/"),p=!1;for(let I=0;I<(c==null?void 0:c.length)&&!p;I++)(y=c[I])!=null&&y.fallback||(p=r(f,((g=c[I])==null?void 0:g.root)??!1,((w=c[I])==null?void 0:w.path)??"",((O=c[I])==null?void 0:O.depth)??0));return h.length>=u&&!p},{root:s,fallback:a,path:o,depth:l}=e;return a?n(i,l,t):r(i,s,o,l)},Ki=On(),sr={},Ur={};function Ba(i,e,t){let r,n,s,a,o;kt(Jr,"globalPath"),It(i,Jr,S=>t(1,s=S)),kt(Ze,"options"),It(i,Ze,S=>t(2,a=S));let{$$slots:l={},$$scope:f}=e;yt("Route",l,["default"]);const u=Ki(),c=!Ui(sr);let{fallback:h=!1}=e,{path:p="/"}=e;const y=Vt();kt(y,"route"),It(i,y,S=>t(0,r=S));const g=Lr(sr);kt(g,"contextRoute"),It(i,g,S=>t(9,n=S));const w=zi(),O=Lr(Ur);kt(O,"contextChildRoutes"),It(i,O,S=>t(3,o=S)),Vi(()=>O==null?void 0:O.remove(r)),qr(sr,y),qr(Ur,w);const I=["fallback","path"];return Object.keys(e).forEach(S=>{!~I.indexOf(S)&&S.slice(0,2)!=="$$"&&S!=="slot"&&console.warn(`<Route> was created with unknown prop '${S}'`)}),i.$$set=S=>{"fallback"in S&&t(7,h=S.fallback),"path"in S&&t(8,p=S.path),"$$scope"in S&&t(10,f=S.$$scope)},i.$capture_state=()=>({writable:Vt,createIdIssuer:On,getPathSegments:Jt,getRoute:Qi,createChildRoutes:zi,isRouteActive:ei,getId:Ki,routeContextKey:sr,childRoutesContextKey:Ur,onDestroy:Vi,getContext:Lr,setContext:qr,hasContext:Ui,globalPath:Jr,options:Ze,getPathWithoutBase:Xr,id:u,root:c,fallback:h,path:p,route:y,contextRoute:g,childRoutes:w,contextChildRoutes:O,$route:r,$contextRoute:n,$globalPath:s,$options:a,$contextChildRoutes:o}),i.$inject_state=S=>{"fallback"in S&&t(7,h=S.fallback),"path"in S&&t(8,p=S.path)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&896&&Sa(y,r=Qi(u,c,h,p,n),r),i.$$.dirty&1&&(O==null||O.update(r))},[r,s,a,o,y,g,O,h,p,n,f,l]}class mt extends ht{constructor(e){super(e),pt(this,e,Ba,Yr,bn,{fallback:7,path:8}),V("SvelteRegisterComponent",{component:this,tagName:"Route",options:e,id:Yr.name})}get fallback(){throw new Bt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fallback(e){throw new Bt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get path(){throw new Bt("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set path(e){throw new Bt("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Xi=i=>{var o;const e=(o=i.target)==null?void 0:o.closest("a[href]"),t=e==null?void 0:e.href;if(e===null||t===null)return!0;const r=["","true"].includes(e.getAttribute("data-handle-ignore")??"false"),n=(e.getAttribute("target")??"_self")!=="_self",s=i.metaKey||i.ctrlKey||i.altKey||i.shiftKey,a=new URL(t).origin!==document.location.origin;if(r||n||s||a)return!0;t===document.location.href?$i.replace(t):$i.push(t),i.preventDefault()},An=i=>(i.addEventListener("click",Xi),{destroy:()=>{i.removeEventListener("click",Xi)}}),La="home/jycouet/udev/gh/dp/my-minion-mr/packages/firstly/node_modules/.pnpm/svelte-micro@2.5.7_svelte@4.2.18/node_modules/svelte-micro/dist/lib/components/Link.svelte";function ti(i){let e,t,r,n;const s=i[5].default,a=vn(s,i,i[4],null);let o=[{href:i[0]},i[1]],l={};for(let u=0;u<o.length;u+=1)l=Kr(l,o[u]);const f={c:function(){e=J("a"),a&&a.c(),Hi(e,l),U(e,La,15,0,417)},l:function(c){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(c,h){G(c,e,h),a&&a.m(e,null),t=!0,r||(n=[Cr(An.call(null,e)),Pe(e,"click",i[6],!1,!1,!1,!1)],r=!0)},p:function(c,[h]){a&&a.p&&(!t||h&16)&&_n(a,s,c,c[4],t?In(s,c[4],h,null):kn(c[4]),null),Hi(e,l=Pa(o,[(!t||h&1)&&{href:c[0]},h&2&&c[1]]))},i:function(c){t||(z(a,c),t=!0)},o:function(c){Y(a,c),t=!1},d:function(c){c&&Q(e),a&&a.d(c),r=!1,Ft(n)}};return V("SvelteRegisterBlock",{block:f,id:ti.name,type:"component",source:"",ctx:i}),f}const Zi=(i,e,t)=>(i==="hash"?"#":"")+(e??"")+t;function qa(i,e,t){let r;const n=["href"];let s=Wi(e,n),a;kt(Ze,"options"),It(i,Ze,c=>t(3,a=c));let{$$slots:o={},$$scope:l}=e;yt("Link",o,["default"]);let{href:f}=e;i.$$.on_mount.push(function(){f===void 0&&!("href"in e||i.$$.bound[i.$$.props.href])&&console.warn("<Link> was created without expected prop 'href'")});function u(c){Ta.call(this,i,c)}return i.$$set=c=>{e=Kr(Kr({},e),Fa(c)),t(1,s=Wi(e,n)),"href"in c&&t(2,f=c.href),"$$scope"in c&&t(4,l=c.$$scope)},i.$capture_state=()=>({getFormatedHref:Zi,options:Ze,linkHandle:An,href:f,formatedHref:r,$options:a}),i.$inject_state=c=>{"href"in e&&t(2,f=c.href),"formatedHref"in e&&t(0,r=c.formatedHref)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&12&&t(0,r=Zi(a.mode,a.basePath,f))},[r,s,f,a,l,o,u]}class Pt extends ht{constructor(e){super(e),pt(this,e,qa,ti,bn,{href:2}),V("SvelteRegisterComponent",{component:this,tagName:"Link",options:e,id:ti.name})}get href(){throw new Error("<Link>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set href(e){throw new Error("<Link>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class ut{constructor(...e){d(this,"fields");d(this,"options",{});d(this,"target");d(this,"readonly",!0);d(this,"allowNull",!1);d(this,"dbReadOnly",!1);d(this,"isServerExpression",!1);d(this,"key","");d(this,"caption","");d(this,"inputType","");d(this,"dbName","");d(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t=n=>e[n.key];typeof e=="function"&&(t=e);let r="";return this.fields.forEach(n=>{r.length>0&&(r+=","),r+=n.valueConverter.toJson(t(n))}),r}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},n=e.toString().split(",");return this.fields.forEach((s,a)=>{t[s.key]=s.valueConverter.fromJson(n[a])}),t}}function ee(i,e=!0){var r;if(i===void 0)throw new Error("entity is undefined");let t=i[lt];if(!t&&e)throw new Error("item "+(((r=i.constructor)==null?void 0:r.name)||i)+" was not initialized using a context");return t}const lt=Symbol.for("entityMember"),Sn=Symbol.for("entityInfo"),Cn=Symbol.for("entityInfo_key");function Ee(i,e=!0){if(i===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=i[Sn];if(!t&&e)throw new Error(i.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function ja(i){return i[Cn]}function Vr(i,e){return{[En]:{toType:i,type:e}}}const En=Symbol.for("relationInfo");function Ja(i){return i==null?void 0:i[En]}const ri=Symbol.for("fieldRelationInfo");function ie(i){if(i)return i[ri]}function Ua(i,e,t){for(const r of i.fields.toArray()){const n=Ja(r.options);if(n&&!r[ri]){const s=n.toType(),a=e.repo(s,t),o=r.options;r[ri]={type:n.type,toEntity:s,options:o,toRepo:a,getFields:()=>{let l=o.field,f={fields:o.fields,compoundIdField:void 0};function u(p){return Error(`Error for relation: "${i.metadata.key}.${r.key}", `+p)}let c=()=>l||f.fields;if(n.type==="toMany"&&!c()){for(const p of a.fields.toArray())if(!c()){const y=ie(p),g=p.options;if(y&&y.toEntity===i.metadata.entityType){if(y.type==="reference")l=p.key;else if(y.type==="toOne"){if(g.field)l=g.field;else if(g.fields){let w={};for(const O in g.fields)if(Object.prototype.hasOwnProperty.call(g.fields,O)){const I=g.fields[O];w[I]=O}f.fields=w}}}}if(!c())throw u(`No matching field found on target "${a.metadata.key}". Please specify field/fields`)}function h(p,y){const g=y.fields.find(p);if(!g)throw u(`Field "${p}" was not found in "${y.key}".`);return g}n.type==="reference"&&(l=r.key),l&&(n.type==="toOne"||n.type==="reference"?a.metadata.idMetadata.field instanceof ut?f.compoundIdField=l:f.fields={[a.metadata.idMetadata.field.key]:l}:i.metadata.idMetadata.field instanceof ut?f.compoundIdField=l:f.fields={[l]:i.metadata.idMetadata.field.key});for(const p in f.fields)Object.prototype.hasOwnProperty.call(f.fields,p)&&(h(p,a.metadata),h(f.fields[p],i.metadata));return f}}}}}class D{constructor(e){d(this,"apply");this.apply=e}static throwErrorIfFilterIsEmpty(e,t){if(D.isFilterEmpty(e))throw{message:`${t}: requires a filter to protect against accidental delete/update of all rows`,httpStatusCode:400}}static isFilterEmpty(e){if(e.$and){for(const t of e.$and)if(!D.isFilterEmpty(t))return!1}if(e.$or){for(const t of e.$or)if(D.isFilterEmpty(t))return!0;return!1}return Object.keys(e).filter(t=>!["$or","$and"].includes(t)).length==0}static async getPreciseValues(e,t){const r=new br;return await D.fromEntityFilter(e,t).__applyToConsumer(r),r.preciseValues}async getPreciseValues(){const e=new br;return await this.__applyToConsumer(e),e.preciseValues}static createCustom(e,t=""){let r={key:t,rawFilterTranslator:e};return Object.assign(n=>{if(n==null&&(n={}),!r.key)throw"Usage of custom filter before a key was assigned to it";return{[ft+r.key]:n}},{rawFilterInfo:r})}static entityFilterToJson(e,t){return D.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return cr(e,{get:r=>t[r]})}static fromEntityFilter(e,t){let r=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let s=t[n];if(n=="$or")r.push(new Ha(...s.map(a=>D.fromEntityFilter(e,a))));else if(n=="$not")r.push(new $a(D.fromEntityFilter(e,s)));else if(n=="$and")r.push(new Yi(...s.map(a=>D.fromEntityFilter(e,a))));else if(n.startsWith(ft))r.push(new D(a=>{a.custom(n.substring(ft.length),s)}));else if(n==Fn)r.push(new D(a=>a.databaseCustom(s)));else{const a=e.fields[n],o=ie(a),l=a.options;let f=(o==null?void 0:o.type)==="toOne"?l.fields?new Wa(a,e.fields,l):new Va(e.fields[l.field]):new mr(a),u=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const h=s[c];switch(c){case"$gte":case">=":r.push(f.isGreaterOrEqualTo(h)),u=!0;break;case"$gt":case">":r.push(f.isGreaterThan(h)),u=!0;break;case"$lte":case"<=":r.push(f.isLessOrEqualTo(h)),u=!0;break;case"$lt":case"<":r.push(f.isLessThan(h)),u=!0;break;case"$ne":case"$not":case"!=":case"$nin":u=!0,Array.isArray(h)?r.push(f.isNotIn(h)):r.push(f.isDifferentFrom(h));break;case"$in":u=!0,r.push(f.isIn(h));break;case"$contains":u=!0,r.push(f.contains(h));break;case"$startsWith":u=!0,r.push(f.startsWith(h));break;case"$endsWith":u=!0,r.push(f.endsWith(h));break;case"$notContains":u=!0,r.push(f.notContains(h));break}}Array.isArray(s)&&(u=!0,r.push(f.isIn(s)))}!u&&s!==void 0&&r.push(f.isEqualTo(s))}}return new Yi(...r)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new wr;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,r){let n=new gr(async(s,a)=>{let o=[];for(const l in t.entityType){const f=t.entityType[l];f&&f.rawFilterInfo&&f.rawFilterInfo.rawFilterTranslator&&f.rawFilterInfo.key==s&&o.push(await D.fromEntityFilter(t,await f.rawFilterInfo.rawFilterTranslator(a,r)))}return o});return e.__applyToConsumer(n),await n.resolve(),e=new D(s=>n.applyTo(s)),e}}class mr{constructor(e){d(this,"metadata");this.metadata=e}processVal(e){if(Ee(this.metadata.valueType,!1)){if(e==null){if(e===null&&!this.metadata.allowNull){const r=ie(this.metadata);if((r==null?void 0:r.type)==="reference")return r.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:ee(e).getId()}return e}contains(e){return new D(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new D(t=>t.notContainsCaseInsensitive(this.metadata,e))}startsWith(e){return new D(t=>t.startsWithCaseInsensitive(this.metadata,e))}endsWith(e){return new D(t=>t.endsWithCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new D(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new D(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new D(t=>{for(const r of e)t.isDifferentFrom(this.metadata,this.processVal(r))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new D(t=>t.isNotNull(this.metadata)):new D(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new D(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new D(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new D(t=>t.isNull(this.metadata)):new D(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new D(t=>t.isEqualTo(this.metadata,e[0])):new D(t=>t.isIn(this.metadata,e))}}class Va extends mr{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:ee(e).getId():null}}class Wa{constructor(e,t,r){d(this,"metadata");d(this,"fields");d(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=r}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}endsWith(e){throw new Error("Invalid for Many To One Relation Field")}startsWith(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new D(t=>{e.forEach(r=>this.isDifferentFrom(r).__applyToConsumer(t))})}isDifferentFrom(e){return new D(t=>{const r=[];for(const n in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,n)){const s=this.relationOptions.fields[n];r.push(new D(a=>new mr(this.fields.find(s)).isDifferentFrom(e[n]).__applyToConsumer(a)))}t.or(r)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new D(t=>{for(const r in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,r)){const n=this.relationOptions.fields[r];new mr(this.fields.find(n)).isEqualTo(e[r]).__applyToConsumer(t)}})}isIn(e){return new D(t=>{t.or(e.map(r=>this.isEqualTo(r)))})}}class Yi extends D{constructor(...t){super(r=>{for(const n of this.filters)n&&n.__applyToConsumer(r)});d(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class Ha extends D{constructor(...t){super(r=>{let n=this.filters.filter(s=>s!==void 0);n.length>1?r.or(n):n.length==1&&n[0].__applyToConsumer(r)});d(this,"filters");this.filters=t}}class $a extends D{constructor(t){super(r=>{r.not(t)});d(this,"filter");this.filter=t}}const ft="$custom$",Fn="$db$",ii="$an array";class wr{constructor(){d(this,"result",{});d(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[ii]:t}),this.add(ft+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let r=this.result;if(!r[e]){r[e]=t;return}let n=r[e];n instanceof Array?n.push(t):n=[n,t],r[e]=n}or(e){this.add("OR",e.map(t=>{let r=new wr;return t.__applyToConsumer(r),r.result}))}not(e){let t=new wr;e.__applyToConsumer(t),this.add("NOT",t.result)}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(r=>e.valueConverter.toJson(r)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}startsWithCaseInsensitive(e,t){this.add(e.key+".startsWith",t)}endsWithCaseInsensitive(e,t){this.add(e.key+".endsWith",t)}}function cr(i,e){let t={};function r(o){t.$and||(t.$and=[]),t.$and.push(o)}function n(o,l){t[o]===void 0?t[o]=l:r({[o]:l})}[...i.fields].forEach(o=>{function l(u,c,h=!1,p=!1){let y=e.get(o.key+u);if(y!==void 0){let g=w=>{let O=w;if(h){let S;typeof w=="string"?S=JSON.parse(w):S=w,O=S.map(B=>p?B:o.valueConverter.fromJson(B))}else O=p?O:o.valueConverter.fromJson(O);let I=c(O);I!==void 0&&n(o.key,I)};if(!h&&y instanceof Array)y.forEach(w=>{g(w)});else{h&&typeof y=="string"&&(y=JSON.parse(y));const w=a(y);for(const O of w)g(O)}}}l("",u=>u),l(".gt",u=>({$gt:u})),l(".gte",u=>({$gte:u})),l(".lt",u=>({$lt:u})),l(".lte",u=>({$lte:u})),l(".ne",u=>({$ne:u})),l(".in",u=>u,!0);var f=e.get(o.key+".null");if(f)switch(f=f.toString().trim().toLowerCase(),f){case"y":case"true":case"yes":n(o.key,null);break;default:n(o.key,{$ne:null});break}l(".contains",u=>({$contains:u}),!1,!0),l(".notContains",u=>({$notContains:u}),!1,!0),l(".startsWith",u=>({$startsWith:u}),!1,!0),l(".endsWith",u=>({$endsWith:u}),!1,!0)});let s=e.get("OR");if(s){const l=a(s).map(f=>({$or:f.map(u=>cr(i,{get:c=>u[c]}))}));l.length==1?t.$or?t.$or.push(l[0].$or):t.$or=l[0].$or:r({$and:l})}if(s=e.get("NOT"),s){let o=a(s);const l=[];for(const f of o)if(Array.isArray(f))for(const u of f)l.push({$not:cr(i,{get:c=>u[c]})});else l.push({$not:cr(i,{get:u=>f[u]})});l.length==1&&!t.$not?t=l[0]:r({$and:l})}for(const o in i.entityType){const l=i.entityType[o];if(l&&l.rawFilterInfo&&l.rawFilterInfo.rawFilterTranslator){let f=e.get(ft+o);if(f!==void 0){const u=c=>{c[ii]!=null&&(c=c[ii]),n(ft+o,c)};Array.isArray(f)?f.forEach(c=>u(c)):u(f)}}}return t;function a(o){if(!Array.isArray(o))return[o];const l=[],f=[];for(const u of o)Array.isArray(u)?f.push(u):l.push(u);return f.push(l),f}}class gr{constructor(e){d(this,"translateCustom");d(this,"commands",[]);d(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async r=>{let n=new gr(this.translateCustom);return r.__applyToConsumer(n),await n.resolve(),new D(s=>n.applyTo(s))})).then(r=>{t=r})),this.commands.push(r=>r.or(t))}not(e){let t;this.promises.push((async()=>{let r=new gr(this.translateCustom);e.__applyToConsumer(r),await r.resolve(),t=new D(n=>r.applyTo(n))})()),this.commands.push(r=>r.not(t))}isEqualTo(e,t){this.commands.push(r=>r.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(r=>r.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(r=>r.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(r=>r.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(r=>r.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(r=>r.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(r=>r.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(r=>r.notContainsCaseInsensitive(e,t))}startsWithCaseInsensitive(e,t){this.commands.push(r=>r.startsWithCaseInsensitive(e,t))}endsWithCaseInsensitive(e,t){this.commands.push(r=>r.endsWithCaseInsensitive(e,t))}isIn(e,t){this.commands.push(r=>r.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let r=await this.translateCustom(e,t);r&&(Array.isArray(r)?r.forEach(n=>n.__applyToConsumer(this)):r.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}class br{constructor(){d(this,"rawValues",{});d(this,"preciseValues",new Proxy(this.rawValues,{get:(e,t)=>{if(t in e){let r=e[t];if(r.bad)return;if(r.values.length>0){const n=ie(r.field);if(n){if(n.type==="reference")return r.values.map(s=>n.toRepo.metadata.idMetadata.getIdFilter(s));throw new Error("Only relations toOne without field are supported.")}return r.values}}}}))}ok(e,...t){let r=this.rawValues[e.key];r?r.values.push(...t.filter(n=>!r.values.includes(n))):this.rawValues[e.key]={field:e,bad:!1,values:[...t]}}notOk(e){let t=this.rawValues[e.key];t?t.bad=!0:this.rawValues[e.key]={field:e,bad:!0,values:[]}}not(e){}or(e){const t=e.map(r=>{let n=new br;return r.__applyToConsumer(n),n});for(const r of t)for(const n in r.rawValues)if(Object.prototype.hasOwnProperty.call(r.rawValues,n)){const s=r.rawValues[n];s&&(s.bad?this.notOk(s.field):this.ok(s.field,...s.values))}for(const r in this.rawValues)if(Object.prototype.hasOwnProperty.call(this.rawValues,r))for(const n of t)n.rawValues[r]||this.notOk(this.rawValues[r].field)}isEqualTo(e,t){this.ok(e,t)}isDifferentFrom(e,t){this.notOk(e)}isNull(e){this.ok(e,null)}isNotNull(e){this.notOk(e)}isGreaterOrEqualTo(e,t){this.notOk(e)}isGreaterThan(e,t){this.notOk(e)}isLessOrEqualTo(e,t){this.notOk(e)}isLessThan(e,t){this.notOk(e)}containsCaseInsensitive(e,t){this.notOk(e)}notContainsCaseInsensitive(e,t){this.notOk(e)}startsWithCaseInsensitive(e,t){this.notOk(e)}endsWithCaseInsensitive(e,t){this.notOk(e)}isIn(e,t){this.ok(e,...t)}custom(e,t){}databaseCustom(e){}}var xa={};const Wr=Symbol.for("remult-static1");let dr={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:i=>i(),startBusyWithProgress:()=>({progress:i=>{},close:()=>{}})},fieldOptionsEnricher:void 0,captionTransformer:void 0,defaultDataProvider:()=>{}};typeof process<"u"&&xa.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[Wr]>"u"?(globalThis[Wr]=dr,dr.remultFactory=()=>Tn()):dr=globalThis[Wr];const C=dr;function Tn(){return C.defaultRemult||(C.defaultRemult=C.defaultRemultFactory()),C.defaultRemult}function Ga(){C.remultFactory=()=>Tn()}function ct(i){const e=i;if(typeof e[Wt]=="function")return e[Wt]();throw Error("Error getting repository internal from "+i)}const Wt=Symbol.for("getInternal");class Qa{constructor(){d(this,"iAmRemultProxy",!0);d(this,"repoCache",new Map);d(this,"repo",(...e)=>{let t=C,r=this.repoCache.get(e[0]);r||this.repoCache.set(e[0],r=new Map);let n=r.get(e[1]);return n||(n={get fields(){return C.remultFactory().repo(...e).metadata.fields},[Wt](){return t.remultFactory().repo(...e)[Wt]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...a)=>t.remultFactory().repo(...e).validate(s,...a),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),deleteMany:s=>t.remultFactory().repo(...e).deleteMany(s),updateMany:(...s)=>t.remultFactory().repo(...e).updateMany(...s),find:(...s)=>t.remultFactory().repo(...e).find(...s),groupBy:(...s)=>t.remultFactory().repo(...e).groupBy(...s),aggregate:(...s)=>t.remultFactory().repo(...e).aggregate(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,a)=>t.remultFactory().repo(...e).findId(s,a),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,a)=>t.remultFactory().repo(...e).fromJson(s,a),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return C.remultFactory().repo(...e).metadata},query:s=>t.remultFactory().repo(...e).query(s),save:s=>t.remultFactory().repo(...e).save(s),upsert:s=>t.remultFactory().repo(...e).upsert(s),update:(s,a)=>t.remultFactory().repo(...e).update(s,a)},r.set(e[1],n),n)})}get liveQuerySubscriber(){return C.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){C.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return C.remultFactory().liveQueryStorage}set liveQueryStorage(e){C.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return C.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){C.remultFactory().liveQueryPublisher=e}initUser(){return C.remultFactory().initUser()}call(e,t,...r){return C.remultFactory().call(e,t,...r)}get context(){return C.remultFactory().context}get dataProvider(){return C.remultFactory().dataProvider}set dataProvider(e){C.remultFactory().dataProvider=e}get repCache(){return C.remultFactory().repCache}authenticated(){return C.remultFactory().authenticated()}isAllowed(e){return C.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return C.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return C.remultFactory().clearAllCache()}useFetch(e){return C.remultFactory().useFetch(e)}get user(){return C.remultFactory().user}set user(e){C.remultFactory().user=e}get apiClient(){return C.remultFactory().apiClient}set apiClient(e){C.remultFactory().apiClient=e}get subscriptionServer(){return C.remultFactory().subscriptionServer}set subscriptionServer(e){C.remultFactory().subscriptionServer=e}}const _e=new Qa,za="$count",Ka=Symbol.for("GroupByForApiKey"),Xa=["sum","avg","min","max","distinctCount"],Pn={error500RetryCount:4};function ni(i){return i.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail")}class Za{constructor(e,t,r){d(this,"repository");d(this,"isReferenceRelation");d(this,"allowNull");d(this,"storedItem");d(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=r}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:ct(this.repository)._getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=ct(this.repository)._getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=ee(e,!1);t&&!this.isReferenceRelation?(ct(this.repository)._addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class en{constructor(e){d(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var r in e){let n=e[r];this.add(r+t,n)}}}function Ct(i){if(!i)return new tn;let e;return e||Dn(i)&&(e=new Ya(i)),e||typeof i=="function"&&(e=new tn(i)),e}function Dn(i){let e=i;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class Ya{constructor(e){d(this,"http");this.http=e}async post(e,t){return await vr(()=>ar(this.http.post(e,t)))}delete(e){return ar(this.http.delete(e))}put(e,t){return ar(this.http.put(e,t))}async get(e){return await vr(()=>ar(this.http.get(e)))}}async function vr(i){var t,r,n,s;let e=0;for(;;)try{return await i()}catch(a){if(((t=a.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(r=a.message)!=null&&r.startsWith("Error occured while trying to proxy")||(n=a.message)!=null&&n.includes("http proxy error")||(s=a.message)!=null&&s.startsWith("Gateway Timeout")||a.status==500)&&e++<Pn.error500RetryCount){await new Promise((o,l)=>{setTimeout(()=>{o({})},500)});continue}throw a}}function ar(i){let e;return i.toPromise!==void 0?e=i.toPromise():e=i,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data!==void 0?t.data:t).catch(async t=>{throw await eo(t)})}async function eo(i){var s,a,o;let e=await i;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(a=e==null?void 0:e.response)==null?void 0:a.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let r=e.status;r===void 0&&(r=(o=e.response)==null?void 0:o.status),r!=null&&(t.httpStatusCode=r);var n=Object.assign(t??{},{});return n}class si{constructor(e,t){d(this,"apiProvider");d(this,"entityRequested");d(this,"isProxy",!0);this.apiProvider=e,this.entityRequested=t}getEntityDataProvider(e){var t;return(t=this.entityRequested)==null||t.call(this,e),new to(()=>{var r;return Rn((r=this.apiProvider())==null?void 0:r.url,e.key)},()=>Ct(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function Rn(i,e){return i==null&&(i="/api"),i+"/"+e}function Ai(i,e){if(i.include){let t={};for(const r in i.include)if(Object.prototype.hasOwnProperty.call(i.include,r)){let n=i.include[r];if(typeof n=="object"){const s=ie(e.fields.find(r));s&&(n=Ai(n,s.toRepo.metadata))}t[r]=n}i={...i,include:t}}return i.where&&(i={...i,where:D.entityFilterToJson(e,i.where)}),i.load&&(i={...i,load:i.load(e.fields).map(t=>t.key)}),i}class to{constructor(e,t,r){d(this,"url");d(this,"http");d(this,"entity");this.url=e,this.http=t,this.entity=r}query(e,t){return this.buildFindRequest(e).run("query",{aggregate:this.buildAggregateOptions(t)}).then(({items:n,aggregates:s})=>({items:n.map(a=>this.translateFromJson(a)),aggregates:s}))}async groupBy(e){const{run:t}=this.buildFindRequest({where:e==null?void 0:e.where,limit:e==null?void 0:e.limit,page:e==null?void 0:e.page}),r=this.buildAggregateOptions(e),n=await t("groupBy",Object.keys(r).length>0?r:void 0);return e!=null&&e.group&&n.forEach(s=>{for(const a of e.group)s[a.key]=a.valueConverter.fromJson(s[a.key])}),n}buildAggregateOptions(e){var t,r,n,s,a,o,l;return{groupBy:(t=e==null?void 0:e.group)==null?void 0:t.map(f=>f.key),sum:(r=e==null?void 0:e.sum)==null?void 0:r.map(f=>f.key),avg:(n=e==null?void 0:e.avg)==null?void 0:n.map(f=>f.key),min:(s=e==null?void 0:e.min)==null?void 0:s.map(f=>f.key),max:(a=e==null?void 0:e.max)==null?void 0:a.map(f=>f.key),distinctCount:(o=e==null?void 0:e.distinctCount)==null?void 0:o.map(f=>f.key),orderBy:(l=e==null?void 0:e.orderBy)==null?void 0:l.map(f=>{var u;return{...f,field:(u=f.field)==null?void 0:u.key}})}}translateFromJson(e){let t={};for(const r of this.entity.fields)t[r.key]=r.valueConverter.fromJson(e[r.key]);return t}translateToJson(e){let t={};for(const r of this.entity.fields)t[r.key]=r.valueConverter.toJson(e[r.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(r=>+r.count)}async deleteMany(e){const{run:t}=this.buildFindRequest({where:e},"delete");return t("deleteMany").then(r=>+r.deleted)}async updateMany(e,t){const{run:r}=this.buildFindRequest({where:e},"put");return r("updateMany",this.toJsonOfIncludedKeys(t)).then(n=>+n.updated)}async upsertMany(e){const{run:t}=this.buildFindRequest(void 0);return t("upsertMany",e.map(r=>({where:this.toJsonOfIncludedKeys(r.where),set:r.set!==void 0?this.toJsonOfIncludedKeys(r.set):void 0}))).then(r=>r.map(n=>this.translateFromJson(n)))}find(e){let{run:t}=this.buildFindRequest(e);return t().then(r=>r.map(n=>this.translateFromJson(n)))}buildFindRequest(e,t){t||(t="get");let r=new en(this.url()),n;if(e){if(e.where&&(n=e.where.toJson(),io(n,r)&&(n=void 0)),e.orderBy&&e.orderBy.Segments){let a="",o="",l=!1;e.orderBy.Segments.forEach(f=>{a.length>0&&(a+=",",o+=","),a+=f.field.key,o+=f.isDescending?"desc":"asc",f.isDescending&&(l=!0)}),a&&r.add("_sort",a),l&&r.add("_order",o)}e.limit&&r.add("_limit",e.limit),e.page&&r.add("_page",e.page)}const s=(a,o)=>{let l=new en(r.url);if(!a&&n&&(a="get"),a&&l.add("__action",a),n){if(t==="put")return this.http().post(l.url,{set:o,where:n});o={...o,where:n}}return o&&t!="put"?this.http().post(l.url,o):this.http()[t](l.url,o)};return{createKey:()=>JSON.stringify({url:r,filterObject:n}),run:s,subscribe:async a=>({result:await s(no+a),unsubscribe:async()=>C.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:a}))})}}update(e,t){return this.http().put(this.url()+(e!=""?"/"+encodeURIComponent(e):"?__action=emptyId"),this.toJsonOfIncludedKeys(t)).then(r=>this.translateFromJson(r))}toJsonOfIncludedKeys(e){let t={},r=Object.keys(e);for(const n of this.entity.fields)r.includes(n.key)&&(t[n.key]=n.valueConverter.toJson(e[n.key]));return t}async delete(e){if(e=="")await this.deleteMany(D.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)));else return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}insertMany(e){return this.http().post(this.url(),e.map(t=>this.translateToJson(t))).then(t=>t.map(r=>this.translateFromJson(r)))}}class tn{constructor(e){d(this,"fetch");this.fetch=e}async get(e){return await vr(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await vr(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const r={};if(t!=null&&t.body&&(r["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const n of window.document.cookie.split(";"))n.trim().startsWith("XSRF-TOKEN=")&&(r["X-XSRF-TOKEN"]=n.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:r}).then(n=>ro(n)).catch(async n=>{throw await n})}}function ro(i){if(i.status!=204){if(i.status>=200&&i.status<300)return i.json();throw i.json().then(e=>({...e,message:e.message||i.statusText,url:i.url,status:i.status})).catch(()=>{throw{message:i.statusText,url:i.url,status:i.status}})}}function io(i,e){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const r=i[t];if(Array.isArray(r)&&(r.length>0&&typeof r[0]=="object"||r.length>10)||t==="NOT")return!1}for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const r=i[t];Array.isArray(r)?t.endsWith(".in")?e.add(t,JSON.stringify(r)):r.forEach(n=>e.add(t,n)):t.startsWith(ft)?e.add(t,JSON.stringify(r)):e.add(t,r)}return!0}const no="liveQuery-";var or,so=new Uint8Array(16);function ao(){if(!or&&(or=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!or))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return or(so)}const oo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function lo(i){return typeof i=="string"&&oo.test(i)}var ye=[];for(var Hr=0;Hr<256;++Hr)ye.push((Hr+256).toString(16).substr(1));function uo(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(ye[i[e+0]]+ye[i[e+1]]+ye[i[e+2]]+ye[i[e+3]]+"-"+ye[i[e+4]]+ye[i[e+5]]+"-"+ye[i[e+6]]+ye[i[e+7]]+"-"+ye[i[e+8]]+ye[i[e+9]]+"-"+ye[i[e+10]]+ye[i[e+11]]+ye[i[e+12]]+ye[i[e+13]]+ye[i[e+14]]+ye[i[e+15]]).toLowerCase();if(!lo(t))throw TypeError("Stringified UUID is invalid");return t}function ai(i,e,t){i=i||{};var r=i.random||(i.rng||ao)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,uo(r)}class Ce{constructor(...e){d(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new Ce;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,r){r||(r=n=>n.key);for(let n=0;n<this.Segments.length;n++){let s=this.Segments[n],a=e[r(s.field)],o=t[r(s.field)],l=s.isDescending,f=fo(a,o,l);if(f!=0)return f}return 0}static translateOrderByToSort(e,t){let r=new Ce;if(t){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];let a=e.fields.find(n);const o=l=>{switch(s){case"desc":r.Segments.push({field:l,isDescending:!0});break;case"asc":r.Segments.push({field:l})}};if(a){const l=ie(a);if((l==null?void 0:l.type)==="toOne"){const f=l.options;if(typeof f.field=="string")o(e.fields.find(f.field));else if(f.fields){for(const u in f.fields)if(Object.prototype.hasOwnProperty.call(f.fields,u)){const c=f.fields[u];o(e.fields.find(c.toString()))}}}else o(a)}}}return r}static createUniqueSort(e,t){(!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=Ce.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new Ce);for(const r of e.idMetadata.fields)t.Segments.find(n=>n.field==r)||t.Segments.push({field:r});return t}static createUniqueEntityOrderBy(e,t){(!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={};for(const r of e.idMetadata.fields)t[r.key]||(t[r.key]="asc");return t}}function fo(i,e,t){i=rn(i),e=rn(e);let r=0;return i>e?r=1:i<e&&(r=-1),t&&(r*=-1),r}function rn(i){return i==null||i==null?i:i.id!==void 0?i.id:i}const $r="stream";class co{constructor(e,t,r){d(this,"repo");d(this,"query");d(this,"queryChannel");d(this,"subscribeCode");d(this,"unsubscribe",()=>{});d(this,"defaultQueryState",[]);d(this,"listeners",[]);d(this,"id",ai());this.repo=e,this.query=t,this.queryChannel=`users:${r}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await ct(this.repo)._fromJsonArray(e,this.query.options);this.forListeners(r=>{r(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(r=>{if(this.defaultQueryState=r(this.defaultQueryState),t.find(n=>n.type==="add"||n.type==="replace")&&this.query.options.orderBy){const n=Ce.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,a)=>n.compare(s,a))}});for(const r of this.listeners)e(n=>{r.next(this.createReducerType(n,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:n})=>n=="add"||n=="replace"),r=await ct(this.repo)._fromJsonArray(t.map(n=>n.data.item),this.query.options);for(let n=0;n<t.length;n++){const s=t[n];s.data.item=r[n]}}this.forListeners(t=>{t(r=>{r||(r=[]);for(const n of e)switch(n.type){case"all":this.setAllItems(n.data);break;case"replace":{r=r.map(s=>this.repo.metadata.idMetadata.getId(s)===n.data.oldId?n.data.item:s);break}case"add":r=r.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(n.data.item)),r.push(n.data.item);break;case"remove":r=r.filter(s=>this.repo.metadata.idMetadata.getId(s)!==n.data.id);break}return r})},e)}}const ho="_liveQueryKeepAlive";class po{constructor(e,t){d(this,"apiProvider");d(this,"getUserId");d(this,"queries",new Map);d(this,"channels",new Map);d(this,"client");d(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let r=()=>{};const n=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new yo);try{s.unsubscribe=await n.subscribe(e,a=>this.wrapMessageHandling(()=>s.handle(a)),a=>{t.error(a)})}catch(a){throw t.error(a),a}}s.listeners.push(t),r=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{r(),r=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,r){let n=!0,s=()=>{n=!1};return this.runPromise(ct(e)._buildEntityDataProviderFindOptions(t).then(a=>{if(!n)return;const{createKey:o,subscribe:l}=new si(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(a),f=o();let u=this.queries.get(f);u?u.sendDefaultState(r.next):(this.queries.set(f,u=new co(e,{entityKey:e.metadata.key,options:t},this.getUserId())),u.subscribeCode=()=>{u.unsubscribe&&(u.unsubscribe(),u.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(u.queryChannel,{next:c=>this.runPromise(u.handle(c)),complete:()=>{},error:c=>{u.listeners.forEach(h=>h.error(c))}}).then(c=>{if(u.listeners.length==0){c();return}this.runPromise(l(u.queryChannel).then(h=>{if(u.listeners.length===0){h.unsubscribe(),c();return}this.runPromise(u.setAllItems(h.result)),u.unsubscribe=()=>{u.unsubscribe=()=>{},c(),this.runPromise(h.unsubscribe())}}).catch(h=>{u.listeners.forEach(p=>p.error(h)),c(),this.queries.delete(f)}))})).catch(c=>{u.listeners.forEach(h=>h.error(c))})},u.subscribeCode()),u.listeners.push(r),s=()=>{u.listeners.splice(u.listeners.indexOf(r),1),r.complete(),u.listeners.length==0&&(this.queries.delete(f),u.unsubscribe()),this.closeIfNoListeners()}}).catch(a=>{r.error(a)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const r=await this.runPromise(await C.actionInfo.runActionWithoutBlockingUI(()=>Ct(t.httpClient).post(t.url+"/"+ho,e)));for(const n of r)for(const s of this.queries.values())s.queryChannel===n&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class yo{constructor(){d(this,"unsubscribe",()=>{});d(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class Si{openConnection(e){let t;const r=new Map,n=Ct(_e.apiClient.httpClient);let s=!1,a;const o={close(){a.close()},async subscribe(u,c){let h=r.get(u);return h||(r.set(u,h=[]),await f(u)),h.push(c),()=>{h.splice(h.indexOf(c,1)),h.length==0&&(C.actionInfo.runActionWithoutBlockingUI(()=>n.post(_e.apiClient.url+"/"+$r+"/unsubscribe",{channel:u,clientId:t})),r.delete(u))}}},l=()=>new Promise(u=>{h();let c=0;function h(){a&&a.close(),a=Si.createEventSource(_e.apiClient.url+"/"+$r),a.onmessage=p=>{let y=JSON.parse(p.data);const g=r.get(y.channel);g&&g.forEach(w=>w(y.data))},a.onerror=p=>{console.error("Live Query Event Source Error",p),a.close(),c++<Pn.error500RetryCount&&setTimeout(()=>{h()},500)},a.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const y of r.keys())await f(y);e()}else s=!0,u(o)})}});return l();async function f(u){await C.actionInfo.runActionWithoutBlockingUI(()=>n.post(_e.apiClient.url+"/"+$r+"/subscribe",{channel:u,clientId:t}))===mo&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const mo="client connection not found",oi=Symbol.for("serverActionField");class wo{constructor(e){d(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){C.remultFactory=()=>{const e=C.asyncContext.getStore();if(e)return e.remult;throw new Error("remult object was requested outside of a valid request cycle.valid context, try running `withRemult` or run  within initApi or a remult request cycle")}}static disable(){Ga()}async run(e,t){return this.remultObjectStorage?this.remultObjectStorage.run({remult:e},()=>t(e)):t(e)}isInInitRequest(){var e,t;return(t=(e=this.remultObjectStorage)==null?void 0:e.getStore())==null?void 0:t.inInitRequest}setInInitRequest(e){var r,n;const t=(r=this.remultObjectStorage)==null?void 0:r.getStore();t&&(e||(n=this.remultObjectStorage)!=null&&n.isStub)&&(t.inInitRequest=e)}getStore(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}C.asyncContext||(C.asyncContext=new wo(void 0));function Ht(){return C.actionInfo.runningOnServer||!_e.dataProvider.isProxy}class qe{constructor(e){d(this,"repo",(e,t)=>{t===void 0&&(t=this.dataProvider);let r=this.repCache.get(t);r||this.repCache.set(t,r=new Map);let n=r.get(e);return n||(r.set(e,n=new Ci(e,this,t,Co(e,this))),Ua(n,this,t)),n});d(this,"user");d(this,"dataProvider",new si(()=>this.apiClient));d(this,"repCache",new Map);d(this,"liveQueryStorage");d(this,"subscriptionServer");d(this,"liveQueryPublisher",{itemChanged:async()=>{}});d(this,"liveQuerySubscriber",new po(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));d(this,"context",{});d(this,"apiClient",{url:"/api",subscriptionClient:new Si});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if(Dn(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}async initUser(){const t=await Ct(this.apiClient.httpClient).get(Rn(this.apiClient.url,"me"));return this.user=(t==null?void 0:t.id)!=null?t:void 0,this.user}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,r;if(e!=null){if(e instanceof Array){for(const n of e)if(this.isAllowed(n)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(r=(t=this.user)==null?void 0:t.roles)!=null&&r.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const r of t)if(this.isAllowedForInstance(e,r))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}useFetch(e){this.dataProvider=new si(()=>({httpClient:e}))}call(e,t,...r){const n=e[oi];if(!n.doWork)throw Error("The method received is not a valid backend method");return n.doWork(r,t,this.apiClient.url,Ct(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}d(qe,"onFind",(e,t)=>{}),d(qe,"entityRefInit");C.defaultRemultFactory=()=>new qe;class Mn{constructor(){d(this,"classes",new Map)}}function go(i,e){let t=i;for(;;){let r=C.classHelpers.get(t);r||C.classHelpers.set(t,r=new Mn),r.classes.set(i,e);let n=Object.getPrototypeOf(t.prototype);if(n==null)break;t=n.constructor}}const bo={defaultPageSize:200};async function vo(i,e){const t=new _o(i.liveQueryPublisher);let r=!0;const n=i.dataProvider;try{await i.dataProvider.transaction(async s=>{i.dataProvider=s,i.liveQueryPublisher=t,await e(s),r=!0}),r&&await t.flush()}finally{i.dataProvider=n}}class _o{constructor(e){d(this,"orig");d(this,"transactionItems",new Map);this.orig=e}async itemChanged(e,t){let r=this.transactionItems.get(e);r||this.transactionItems.set(e,r=[]);for(const n of t)if(n.oldId!==void 0){const s=r.find(a=>a.id===n.oldId);s!==void 0?(n.deleted&&(s.deleted=!0),n.id!=s.id&&(s.id=n.id)):r.push(n)}else r.push(n)}async flush(){for(const e of this.transactionItems.keys())await this.orig.itemChanged(e,this.transactionItems.get(e))}}function Lt(i,e){return e&&Object.assign(i,e),i}class Nn extends Error{constructor(t){super(t.message);d(this,"modelState");d(this,"stack");d(this,"exception");d(this,"httpStatusCode");Object.assign(this,t)}}class Ve{}d(Ve,"number","number"),d(Ve,"date","date"),d(Ve,"checkbox","checkbox"),d(Ve,"password","password"),d(Ve,"email","email"),d(Ve,"tel","tel"),d(Ve,"time","time");const q=class q{};d(q,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>q.Date.fromJson(e),toInput:e=>q.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),d(q,"DateOnly",{fromInput:e=>q.DateOnly.fromJson(e),toInput:e=>q.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:Ve.date,toDb:e=>e?q.DateOnly.fromJson(q.DateOnly.toJson(e)):null,fromDb:e=>q.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),d(q,"DateOnlyString",{...q.DateOnly,toDb:e=>{let t=q.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),d(q,"Boolean",{toDb:e=>e,inputType:Ve.checkbox,fromDb:e=>q.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>q.Boolean.fromJson(e),toInput:e=>q.Boolean.toJson(e)}),d(q,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>q.Number.fromDb(e),toJson:e=>q.Number.toDb(e),fromInput:(e,t)=>{let r=+e;if(e!=null)return r},toInput:(e,t)=>(e==null?void 0:e.toString())??"",inputType:Ve.number}),d(q,"String",{fromDb:bt,toDb:bt,fromJson:bt,toJson:bt,fromInput:bt,toInput:bt}),d(q,"Integer",{...q.Number,toJson:e=>{let t=q.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>q.Integer.toJson(e),fieldTypeInDb:"integer"}),d(q,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>q.JsonString.fromDb(e),toDb:e=>q.JsonString.toDb(e),fromInput:e=>q.Default.fromJson(e),toInput:e=>q.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),d(q,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(q.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(q.JsonString.toJson(e)):void 0,fromInput:e=>q.JsonString.fromJson(e),toInput:e=>q.JsonString.toJson(e)}),d(q,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>q.JsonString.fromJson(e),toInput:e=>q.JsonString.toJson(e),fieldTypeInDb:"json"});let be=q;function bt(i){return i==null?i:typeof i!="string"?i.toString():i}function xr(i,e,t){let r=D.fromEntityFilter(i,e);const n=()=>{};r&&r.__applyToConsumer({custom:n,databaseCustom:n,containsCaseInsensitive:n,notContainsCaseInsensitive:n,startsWithCaseInsensitive:n,endsWithCaseInsensitive:n,isDifferentFrom:n,isEqualTo:(s,a)=>{t[s.key]=a},isGreaterOrEqualTo:n,isGreaterThan:n,isIn:n,isLessOrEqualTo:n,isLessThan:n,isNotNull:n,isNull:n,not:n,or:n})}class qt{constructor(){d(this,"entityLoaders",new Map);d(this,"promises",[])}load(e,t){let r=this.entityLoaders.get(e.entityType);r||this.entityLoaders.set(e.entityType,r=new ko(e));const n=r.find(t);return this.promises.push(n),n}async resolveAll(){for(const t of this.entityLoaders.values())for(const r of t.queries.values())r.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class ko{constructor(e){d(this,"rel");d(this,"queries",new Map);this.rel=e}find(e){const{where:t,...r}=Ai(e,this.rel.metadata),n=JSON.stringify(r);let s=this.queries.get(n);return s||this.queries.set(n,s=new Io(this.rel)),s.find(e,t)}}class Io{constructor(e){d(this,"rel");d(this,"pendingInStatements",new Map);d(this,"whereVariations",new Map);this.rel=e}find(e,t){const r=JSON.stringify(t);let n=this.whereVariations.get(r);if(!n){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let a=this.pendingInStatements.get(s[0]);a||this.pendingInStatements.set(s[0],a=new Oo(this.rel,s[0],e)),this.whereVariations.set(r,n={result:a.find(t)})}else this.whereVariations.set(r,n={result:this.rel.find(e)})}return n.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class Oo{constructor(e,t,r){d(this,"rel");d(this,"key");d(this,"options");d(this,"values",new Map);this.rel=e,this.key=t,this.options=r}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(n=>n.value)},t.limit=1e3,t.page=1;let r=[];try{for(;;){const n=await this.rel.find(t);if(r.push(...n),n.length<t.limit)break;t.page++}for(const n of this.values.values())n.resolve(r.filter(s=>{const o=ee(s).fields.find(this.key),l=ie(o.metadata),f=(l==null?void 0:l.type)==="reference"?o.getId():s[this.key];return n.value==f}))}catch(n){for(const s of this.values.values())s.reject(n)}}find(e){const t=e[this.key];let r=this.values.get(t);if(!r){let n,s,a=new Promise((o,l)=>{n=o,s=l});this.values.set(t,r={value:t,resolve:n,reject:s,result:a})}return r.result}}C.actionInfo;const de=class de{};d(de,"required",jt(async(e,t)=>!t.valueIsNull()&&t.value!==""&&(t.value!==void 0||ie(t.metadata)!==void 0),"Should not be empty")),d(de,"unique",jt(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),d(de,"uniqueOnBackend",jt(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,de.unique.defaultMessage)),d(de,"regex",Xe((e,t)=>t.test(e))),d(de,"email",hr(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),d(de,"url",hr(e=>!!new URL(e),"Invalid Url")),d(de,"in",Xe((e,t)=>t.includes(e),e=>`Value must be one of: ${e.map(t=>typeof t=="object"?(t==null?void 0:t.id)!==void 0?t==null?void 0:t.id:t==null?void 0:t.toString():t).join(", ")}`)),d(de,"notNull",hr(e=>e!=null,"Should not be null")),d(de,"enum",Xe((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${pr(e).join(", ")}`)),d(de,"relationExists",jt(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),d(de,"min",Xe((e,t)=>e>=t,e=>`Value must be bigger than or equal to ${e}`)),d(de,"max",Xe((e,t)=>e<=t,e=>`Value must be smaller than or equal to ${e}`)),d(de,"maxLength",Xe((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),d(de,"minLength",Xe((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),d(de,"range",Xe((e,[t,r])=>e>=t&&e<=r,([e,t])=>`Value must be between ${e} and ${t}`)),d(de,"defaultMessage","Invalid value");let De=de;function jt(i,e){const t=async(n,s,a)=>{const o=await i(n,s);typeof o=="string"&&o.length>0?s.error=o:o||(s.error=typeof a=="function"&&a(n,s,void 0)||a||typeof e=="function"&&e(n,s,void 0)||e||De.defaultMessage)},r=(n,s,a)=>typeof n=="string"||n==="function"||n===void 0&&s===void 0?async(o,l,f)=>await t(o,l,n||f):t(n,s,a);return Object.defineProperty(r,"defaultMessage",{get:()=>e,set:n=>{e=n},enumerable:!0}),Object.assign(r,{withMessage:n=>async(s,a)=>r(s,a,n)})}function hr(i,e){return jt((t,r)=>r.value===void 0||r.value===null?!0:i(r.value),e)}function Xe(i,e){const t=Ao((r,n,s)=>n.value===void 0||n.value===null?!0:i(n.value,s),(r,n,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((r,n)=>t(r,n),{get defaultMessage(){return e},set defaultMessage(r){e=r}})}function Ao(i,e,t=!1){return Object.assign((n,s)=>async(a,o)=>{const l=await i(a,o,n);typeof l=="string"?o.error=l:l||(o.error=s?typeof s=="function"?t?s(n):s(a,o,n):s:e?typeof e=="function"?e(a,o,n):e:De.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(n){e=n}})}function pr(i){return Object.values(i).filter(e=>typeof i[e]!="number")}function yr(i,e,t=!1){if(!e)return i;const r=Array.isArray(e)?e:[e],n=Array.isArray(i)?i:i?[i]:[];return t?[...r,...n]:[...n,...r]}function St(i,e){return typeof i[e]<"u"}class So{constructor(e,t){d(this,"options");d(this,"repo");d(this,"_count");d(this,"_aggregates");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=bo.defaultPageSize)}async getPage(e){return(e??0)<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const r of this)await e(r),t++;return t}async paginator(e){this.options.orderBy=Ce.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t={where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include},r=()=>this.repo.find(t);if(this._aggregates===void 0&&St(this.options,"aggregate")){let o=this.options.aggregate;if(this.repo._dataProvider.isProxy){const l=new qt;r=()=>this.repo._rawFind(t,!1,l,async f=>{const u=await this.repo._edp.query(f,await this.repo.__buildGroupByOptions(o));return this._aggregates=u.aggregates,u.items}).then(async f=>(await l.resolveAll(),f))}else{let l=r();r=async()=>(this._aggregates=await this.repo.aggregate({...o,where:this.options.where}),this._count=this._aggregates.$count,l)}}let n=await r(),s=()=>{throw new Error("no more pages")},a=n.length==this.options.pageSize;if(a){let o=await this.repo._createAfterFilter(this.options.orderBy,n[n.length-1]);s=()=>this.paginator(o)}return{count:()=>this.count(),hasNextPage:a,items:n,nextPage:s,aggregates:this._aggregates}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=Ce.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,r,n,s=0;return n=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),r===void 0||t==r.items.length){if(r&&!r.hasNextPage)return{value:void 0,done:!0};let a=r;if(r?r=await r.nextPage():r=await this.paginator(),t=0,r.items.length==0)return{value:void 0,done:!0};if(((a==null?void 0:a.items.length)??!1)&&this.repo.getEntityRef(a.items[0]).getId()==this.repo.getEntityRef(r.items[0]).getId())throw new Error("pagination failure, returned same first row")}return t<r.items.length?{value:r.items[t++],done:!1}:{done:!0,value:void 0}},{next:async()=>n()}}}class Ci{constructor(e,t,r,n,s){d(this,"_entity");d(this,"_remult");d(this,"_dataProvider");d(this,"_info");d(this,"_defaultFindOptions");d(this,"__edp");d(this,"_idCache",new Map);d(this,"listeners");d(this,"_cache",new Map);this._entity=e,this._remult=t,this._dataProvider=r,this._info=n,this._defaultFindOptions=s}_notFoundError(e){return{message:`id ${e} not found in entity ${this.metadata.key}`,httpStatusCode:404}}[Wt](){return this}async _createAfterFilter(e,t){let r=new Map;for(const a of Ce.translateOrderByToSort(this.metadata,e).Segments){let o=t[a.field.key];r.set(a.field.key,o)}let n={$or:[]},s=[];for(const a of Ce.translateOrderByToSort(this.metadata,e).Segments){let o={};for(const l of s)o[l.key]=r.get(l.key);s.push(a.field),a.isDescending?o[a.field.key]={$lt:r.get(a.field.key)}:o[a.field.key]={$gt:r.get(a.field.key)},n.$or.push(o)}return n}relations(e){return new Proxy({},{get:(t,r)=>{const n=this.fields.find(r),s=ie(n);if(!s)throw Error(r+" is not a relation");const{toRepo:a,returnNull:o,returnUndefined:l}=this._getFocusedRelationRepo(n,e);return s.type==="toMany"?a:{findOne:f=>o?Promise.resolve(null):l?Promise.resolve(void 0):a.findFirst({},f)}}})}_getFocusedRelationRepo(e,t){const r=ie(e);let n=r.toRepo,{findOptions:s,returnNull:a,returnUndefined:o}=this._findOptionsBasedOnRelation(r,e,void 0,t,n);return{toRepo:new Ci(n._entity,n._remult,n._dataProvider,n._info,s),returnNull:a,returnUndefined:o}}get _edp(){return this.__edp?this.__edp:this.__edp=this._dataProvider.getEntityDataProvider(this.metadata)}async aggregate(e){return(await this.groupBy(e))[0]}async groupBy(e){var t=await this.__buildGroupByOptions(e);const r=await this._edp.groupBy(t);if(!(e!=null&&e[Ka])&&e.group){const n={include:{}};for(const a of e.group)n.include[a]=!0;const s=new qt;await this._populateRelationsForFields(t.group,n,r,s),await s.resolveAll()}return r}async __buildGroupByOptions(e){var a,o,l,f,u,c;let t=await this._buildEntityDataProviderFindOptions({...e});const r=h=>{const p=this.metadata.fields.find(h);if(p===void 0)throw Error(`key "${h}" not found in entity`);return p},n=h=>{var p;if((p=e==null?void 0:e.group)!=null&&p.includes(h))throw Error(`field "${h}" cannot be used both in an aggregate and in group by`);return r(h)};var s={where:t.where,limit:t.limit,page:t.page,group:(a=e==null?void 0:e.group)==null?void 0:a.map(r),sum:(o=e==null?void 0:e.sum)==null?void 0:o.map(n),avg:(l=e==null?void 0:e.avg)==null?void 0:l.map(n),min:(f=e==null?void 0:e.min)==null?void 0:f.map(n),max:(u=e==null?void 0:e.max)==null?void 0:u.map(n),distinctCount:(c=e==null?void 0:e.distinctCount)==null?void 0:c.map(n)};if(e!=null&&e.orderBy){s.orderBy=[];for(const h in e.orderBy)if(Object.prototype.hasOwnProperty.call(e==null?void 0:e.orderBy,h)){const p=e.orderBy[h];if(p){if(typeof p=="string")s.orderBy.push({field:h==="$count"?void 0:r(h),isDescending:p==="desc",operation:h==="$count"?"count":void 0});else for(const y in p)if(Object.prototype.hasOwnProperty.call(p,y)){const g=p[y];s.orderBy.push({field:this.metadata.fields.find(h),isDescending:g==="desc",operation:y})}}}}return s}_getCachedById(e,t){e=e+"",this._getCachedByIdAsync(e,t);let r=this._idCache.get(e);if(!(r instanceof Promise))return r}async _getCachedByIdAsync(e,t){e=e+"";let r=this._idCache.get(e);if(r instanceof Promise)return await r;if(this._idCache.has(e))return r;if(t)return;this._idCache.set(e,void 0);let n=this.findId(e).then(s=>(s===void 0?r=null:r=s,this._idCache.set(e,r),r));return this._idCache.set(e,n),await n}_addToCache(e){e&&this._idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new So(e,this)}getEntityRef(e){let t=e[lt];return t||(this._fixTypes(e),t=new lr(this._info,e,this,this._edp,this._remult,!0),Object.defineProperty(e,lt,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=ee(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this._dataProvider.isProxy)return this._edp.delete(e);{let n=await this.findId(e);if(!n)throw this._notFoundError(e);return await ee(n).delete()}}let r=this._getRefForExistingRow(e,void 0);return this._dataProvider.isProxy||await r.reload(),r.delete()}__cleanupPartialObject(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r],s=this.fields[n];if(s){const a=ie(s);a&&a.type==="toOne"&&a.options.field&&t.indexOf(a.options.field)>r&&a.toRepo.getEntityRef(e[n]).getId()!==e[a.options.field]&&delete e[n]}}for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r],ie(this.fields[r]));for(const r of this.fields);}async insert(e){if(Array.isArray(e))if(this._dataProvider.isProxy){let t=[],r=[];for(const n of e){this.__cleanupPartialObject(n);let s=ee(e,!1);if(s){if(!s.isNew())throw"Item is not new"}else s=await this.getEntityRef(this.create(n));t.push(s),r.push(await s.buildDtoForInsert())}return Ot(await this._edp.insertMany(r),(n,s)=>t[s].processInsertResponseDto(n))}else{let t=[];for(const r of e)t.push(await this.insert(r));return t}else{let t=ee(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return this.__cleanupPartialObject(e),await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let r=ee(e,!1);if(r||(r=this.getEntityRef({...e})),!t||t.length===0)return await r.validate();{r.__clearErrorsAndReportChanged();let n=!1;for(const s of t)await r.fields.find(s).validate()||(n=!0);return n?r.buildErrorInfoObject():void 0}}}__createDto(e){this.__cleanupPartialObject(e);const r=this.getEntityRef({...e}).copyDataToObject(!1),n=Object.keys(e);for(const s of this.fields)(s.dbReadOnly||!n.includes(s.key))&&delete r[s.key];return r}async updateMany({where:e,set:t}){if(this.__cleanupPartialObject(t),D.throwErrorIfFilterIsEmpty(e,"updateMany"),this._dataProvider.isProxy)return this._edp.updateMany(await this._translateWhereToFilter(e),this.__createDto({...t}));{let r=0;for await(const n of this.query({where:e,aggregate:void 0}))Lt(n,t),await ee(n).save(),r++;return r}}async update(e,t){{let n=ee(t,!1);if(n)return await n.save()}{let n=ee(e,!1);if(n)return Lt(e,t),n.save()}this.__cleanupPartialObject(t);let r;if(typeof e=="object"?(r=this._getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(r.instance,t)):r=this._getRefForExistingRow(t,e),this._dataProvider.isProxy)return await r.save(Object.keys(t));{const n=await r.reload();if(!n)throw this._notFoundError(r.id);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let a=r.fields[s];if(t[s]===void 0&&ie(a.metadata))continue;a&&(n[s]=t[s])}return await this._fixTypes(n),await r.save()}}async upsert(e){if(this._dataProvider.isProxy){let s=await this._edp.upsertMany((Array.isArray(e)?e:[e]).map(l=>{var f;return(f=this._defaultFindOptions)!=null&&f.where&&(xr(this.metadata,this._defaultFindOptions.where,l.where),this._fixTypes(l)),{where:this.__createDto(l.where),set:l.set?this.__createDto(l.set):void 0}}));const a=new qt,o=await this._loadManyToOneForManyRows(s,{},a);return await a.resolveAll(),Array.isArray(e)?o:o[0]}if(Array.isArray(e))return Ot(e,s=>this.upsert(s));let t=e;var r=await this.findFirst(t.where,{createIfNotFound:!0}),n=ee(r,!1);return n.isNew()?(t.set&&Lt(r,t.set),await n.save()):t.set?(Lt(r,t.set),await n.save()):r}_getRefForExistingRow(e,t){let r=ee(e,!1);if(!r){const n=new this._entity(this._remult);for(const a of this._fieldsOf(e)){const o=a.key;n[o]=e[o]}this._fixTypes(n);let s=new lr(this._info,n,this,this._edp,this._remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),r=s,Object.defineProperty(n,lt,{get:()=>s})}return r}async save(e){if(Array.isArray(e))return Ot(e,t=>this.save(t));{let t=ee(e,!1);if(t)return await t.save();if(e instanceof Un)return await this.getEntityRef(e).save();{let r=this.metadata.idMetadata.getId(e);return r===void 0?this.insert(e):this.update(r,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let r=t;return typeof t=="function"&&(r={next:t,complete:()=>{},error:()=>{}}),r.error??(r.error=()=>{}),r.complete??(r.complete=()=>{}),this._remult.liveQuerySubscriber.subscribe(this,e,r)}}}async _rawFind(e,t=!1,r,n){e||(e={}),this._defaultFindOptions&&(e={...this._defaultFindOptions,...e});let s=await this._buildEntityDataProviderFindOptions(e);t&&(delete s.orderBy,delete s.limit),qe.onFind(this._info,e);const a=await n(s);return await this._loadManyToOneForManyRows(a,e,r)}async find(e,t=!1){const r=new qt,n=await this._rawFind(e,t,r,s=>this._edp.find(s));return await r.resolveAll(),n}async _buildEntityDataProviderFindOptions(e){e={...e};let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(this._dataProvider.isProxy||(e.orderBy=this._info.entityInfo.defaultOrderBy)),t.where=await this._translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=Ce.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async _fromJsonArray(e,t){const r=new qt,n=await this._loadManyToOneForManyRows(e.map(s=>{let a={};for(const o of this.metadata.fields.toArray())a[o.key]=o.valueConverter.fromJson(s[o.key]);return a}),t,r);return await r.resolveAll(),n}async _loadManyToOneForManyRows(e,t,r){let n;t!=null&&t.load&&(n=t.load(this.metadata.fields));for(const f of this.metadata.fields)if(Ee(f.valueType,!1)&&!ie(f)){let h=!f.options.lazy;if(n!==void 0&&(h=n.includes(f)),h){let p=this._remult.repo(f.valueType),y=[];for(const g of e){let w=g[f.key];w!=null&&!y.includes(w)&&!p._idCache.has(w+"")&&y.push(w)}y.length>0&&await s(p,y)}}async function s(f,u){let c=await f.find({where:f.metadata.idMetadata.getIdFilter(...u)},!0);for(const h of c)f._addToCache(h)}const a=new Set(this.fields.toArray().map(f=>{const u=this.__getRelationAndInclude(f,t);if(u.rel&&!u.incl)return f.key}).filter(f=>f!==void 0));let o=await Ot(e,async f=>await this._mapRawDataToResult(f,n,a));const l=this.metadata.fields.toArray();return this._populateRelationsForFields(l,t,o,r),o}_populateRelationsForFields(e,t,r,n){for(const s of e){let{rel:a,incl:o}=this.__getRelationAndInclude(s,t);if(a)if(o){const l=a.toRepo;for(const f of r){let{findOptions:u,returnNull:c}=this._findOptionsBasedOnRelation(a,s,o,f,l);const h=s.key;if(c)f[h]=null;else{const p=a.toEntity,y=l;n.load({entityType:p,find:g=>y._rawFind(g,!1,n,w=>y._edp.find(w)),metadata:y.metadata},u).then(g=>{g.length==0&&a.type=="toOne"||(f[h]=a.type!=="toMany"?g.length==0?null:g[0]:g)})}}}else for(const l of r)Reflect.deleteProperty(l,s.key)}}__getRelationAndInclude(e,t){var a;let r=ie(e),n=e.options.defaultIncluded;const s=(a=t==null?void 0:t.include)==null?void 0:a[e.key];return s!==void 0&&(n=s),{rel:r,incl:n}}_findOptionsBasedOnRelation(e,t,r,n,s){let a=!1,o=!1,l=[],f={},u=[];typeof e.options.findOptions=="function"?u.push(e.options.findOptions(n)):typeof e.options.findOptions=="object"&&u.push(e.options.findOptions),typeof r=="object"&&u.push(r);for(const p of u){p.where&&l.push(p.where);for(const y of["limit","include","orderBy"])p[y]&&(f[y]=p[y])}const c=e.getFields(),h=p=>{const y=ee(n,!1);let g=e.type==="reference"&&y?y.fields.find(t.key).getId():n[p];return(e.type==="toOne"||e.type==="reference")&&(g===null?a=!0:g===void 0?o=!0:e.type==="reference"&&typeof g=="object"&&(g=s.metadata.idMetadata.getId(g))),g};c.compoundIdField&&(e.type==="toMany"?l.push({[c.compoundIdField]:this.metadata.idMetadata.getId(n)}):l.push(s.metadata.idMetadata.getIdFilter(h(c.compoundIdField))));for(const p in c.fields)Object.prototype.hasOwnProperty.call(c.fields,p)&&l.push({[p]:h(c.fields[p])});return f.where={$and:l},(e.type==="toOne"||e.type==="reference")&&f.orderBy&&(f.limit=1),{findOptions:f,returnNull:a,returnUndefined:o}}async _mapRawDataToResult(e,t,r){let n=new this._entity(this._remult),s=new lr(this._info,n,this,this._edp,this._remult,!1,r);return Object.defineProperty(n,lt,{get:()=>s}),await s.loadDataFrom(e,t),s.saveOriginalData(),n}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(n=>this.fromJson(n,t));let r=new this._entity(this._remult);for(const n of this._fieldsOf(e)){const s=n.key;if(Ee(n.valueType,!1)){let o=e[n.key];typeof o=="string"||typeof o=="number"?r[s]=o:r[s]=this._remult.repo(n.valueType).fromJson(o)}else e[s]!==void 0&&(r[s]=n.valueConverter.fromJson(e[n.key]))}if(this._fixTypes(r),t)return this.create(r);{let n=new lr(this._info,r,this,this._edp,this._remult,!1);return Object.defineProperty(r,lt,{get:()=>n}),n.id=n.getId(),n.saveOriginalData(),n.originalId=n.id,r}}async count(e){return this._edp.count(await this._translateWhereToFilter(e))}async deleteMany({where:e}){if(D.throwErrorIfFilterIsEmpty(e,"deleteMany"),this._dataProvider.isProxy)return this._edp.deleteMany(await this._translateWhereToFilter(e));{let t=0;for await(const r of this.query({where:e,aggregate:void 0}))await ee(r).delete(),t++;return t}}async findOne(e,t=!1){let r,n,s=e??{};if(s.useCache){let a=Ai(s,this.metadata),o=JSON.stringify(a);if(n=this._cache.get(o),n!==void 0)if(n.value&&this.getEntityRef(n.value).wasDeleted())n=void 0,this._cache.delete(o);else return n.promise;else n={value:void 0,promise:void 0},this._cache.set(o,n)}return r=this.find({...s,limit:1},t).then(async a=>{let o;return a.length>0&&(o=a[0]),!o&&s.createIfNotFound&&(o=this.create(),s.where&&await xr(this.metadata,s.where,o)),o}),n&&(n.promise=r=r.then(a=>(n.value=a,a))),r}async findFirst(e,t,r=!1){if(t||(t={}),e)if(t.where){let n=t.where;t.where={$and:[n,e]}}else t.where=e;return this.findOne(t,r)}_fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(r=>t.includes(r.key))}create(e){var r;let t=new this._entity(this._remult);if(e){for(const n of this._fieldsOf(e)){const s=n.key;t[s]=e[s]}this._fixTypes(t)}return(r=this._defaultFindOptions)!=null&&r.where&&(xr(this.metadata,this._defaultFindOptions.where,t),this._fixTypes(t)),this.getEntityRef(t),t}async _fixTypes(e){for(const t of this._fieldsOf(e)){const r=e[t.key];if(r!=null)if(t.valueType===Date&&!(r instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(r));else for(const[n,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===n&&typeof r!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(r)))}return e}findId(e,t){if(e==null)return Promise.resolve(null);if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async _translateWhereToFilter(e){var n,s;let t=e??{};(n=this._defaultFindOptions)!=null&&n.where&&(t={$and:[t,(s=this._defaultFindOptions)==null?void 0:s.where]}),this._dataProvider.isProxy||(this.metadata.options.backendPreprocessFilter&&(t=await this.metadata.options.backendPreprocessFilter(t,{metadata:this.metadata,getFilterPreciseValues:a=>D.getPreciseValues(this.metadata,a||t)})),this.metadata.options.backendPrefilter&&(t={$and:[t,await D.resolve(this.metadata.options.backendPrefilter)]}));let r=await D.fromEntityFilter(this.metadata,t);return r&&!this._dataProvider.isProxy&&(r=await D.translateCustomWhere(r,this.metadata,this._remult)),r}}function Co(i,e){let t=C.columnsOfType.get(i);t||C.columnsOfType.set(i,t=[]);let r=Ee(i)(e),n=ja(i),s=Object.getPrototypeOf(i);for(;s!=null;){let a=C.columnsOfType.get(s);a&&t.unshift(...a.filter(l=>!t.find(f=>f.key==l.key)));let o=Ee(s,!1);if(o){let l=o(e);r={...l,...r};let f=["saving","saved","deleting","deleted","validation"];for(const u of f)if(l[u]&&l[u]!==r[u]){let c=r[u];r[u]=async(h,p)=>{await c(h,p),await l[u](h,p)}}}s=Object.getPrototypeOf(s)}return new Po(Ln(t,e),r,e,i,n)}class Bn{constructor(e,t,r,n,s){d(this,"fieldsMetadata");d(this,"instance");d(this,"remult");d(this,"isNewRow");d(this,"_error");d(this,"_subscribers");d(this,"_isLoading",!1);d(this,"lookups",new Map);d(this,"errors");d(this,"originalValues",{});this.fieldsMetadata=e,this.instance=t,this.remult=r,this.isNewRow=n;{let a=r;a!=null&&a.iAmRemultProxy&&(r=C.remultFactory())}for(const a of e)if(Ee(a.valueType,!1)&&r){let l=new Za(r.repo(a.valueType),!!ie(a),a.allowNull);this.lookups.set(a.key,l);let f=t[a.key],u;Object.defineProperty(t,a.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),u||(u=this.fields.find(a.key),u._subscribers||(u._subscribers=new ur)),u._subscribers.reportObserved()),l.item),set:c=>{var h;l.set(c),(h=this._subscribers)==null||h.reportChanged(),u||(u=this.fields.find(a.key),u._subscribers||(u._subscribers=new ur)),u._subscribers.reportChanged()},enumerable:!(s!=null&&s.has(a.key))}),l.set(f)}else{const l=ie(a);if((l==null?void 0:l.type)==="toOne"){let f=t.hasOwnProperty(a.key),u=t[a.key];n&&!u&&(f=!1),Object.defineProperty(t,a.key,{get:()=>u,set:c=>{if(u=c,c===void 0)return;const h=a.options;if(h.field&&(this.instance[h.field]=l.toRepo.metadata.idMetadata.getId(c)),h.fields){for(const p in h.fields)if(Object.prototype.hasOwnProperty.call(h.fields,p)){const y=h.fields[p];this.instance[y]=c==null?null:c[p]}}},enumerable:!(s!=null&&s.has(a.key))}),f&&(t[a.key]=u)}}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new ur;const e=this._subscribers;for(const t of this.fieldsMetadata){let r=Ee(t.valueType,!1),n=this.fields.find(t.key);if(n._subscribers=new ur,!(r&&this.remult||ie(t))){let s=this.instance[t.key];Object.defineProperty(this.instance,t.key,{get:()=>(e.reportObserved(),n._subscribers.reportObserved(),s),set:a=>{s=a,e.reportChanged(),n._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await Ot([...this.lookups.values()],e=>e.waitLoad())}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){var t;let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const r of this.fieldsMetadata)if((t=this.errors)!=null&&t[r.key]){e.message=this.fields[r.key].metadata.caption+": "+this.errors[r.key],this.error=e.message;break}}return new Nn(e)}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(n=>this.catchSaveErrors(n));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let r=t.modelState;throw r||(r=t.ModelState),r&&(this.errors=r),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const r of this.fieldsMetadata){let n=this.lookups.get(r.key),s;const a=ie(r);n?s=n.id:s=this.instance[r.key],a&&e&&!r.allowNull&&s==null&&(a.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!a||a.type==="reference")&&(s!==void 0&&(s=r.valueConverter.toJson(s),s!=null&&(s=r.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[r.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let r={};for(const n of this.fieldsMetadata)if(t||!this.remult||n.includedInApi(this.instance)){let s,a=this.lookups.get(n.key),o=!1;a?e?(s=a.toJson(),o=!0,r[n.key]=s):s=a.id:ie(n)&&!e?o=!0:(s=this.instance[n.key],this.remult||s&&Ee(s.constructor,!1)&&(s=ee(s).getId())),o||(r[n.key]=n.valueConverter.toJson(s))}return r}async _updateEntityBasedOnApi(e,t=!1){let r=Object.keys(e);for(const n of this.fieldsMetadata)if(r.includes(n.key)&&n.includedInApi(this.instance)&&(!this.remult||t||n.apiUpdateAllowed(this.instance))){let s=this.lookups.get(n.key);s?s.id=e[n.key]:this.instance[n.key]=n.valueConverter.fromJson(e[n.key])}await Ot([...this.fields].filter(n=>!ie(n.metadata)),n=>n.load())}}class lr extends Bn{constructor(t,r,n,s,a,o,l){super(t.fieldsMetadata,r,a,o,l);d(this,"info");d(this,"repo");d(this,"edp");d(this,"_isNew");d(this,"repository");d(this,"metadata");d(this,"_wasDeleted",!1);d(this,"_columns");d(this,"_saving",!1);d(this,"id");d(this,"originalId");if(this.info=t,this.repo=n,this.edp=s,this._isNew=o,this.repository=n,this.metadata=t,o)for(const f of t.fieldsMetadata){const u=f.key;f.options.defaultValue&&r[u]===void 0&&(typeof f.options.defaultValue=="function"?r[u]=f.options.defaultValue(r):r[u]||(r[u]=f.options.defaultValue))}this.info.entityInfo.entityRefInit&&this.info.entityInfo.entityRefInit(this,r),qe.entityRefInit&&qe.entityRefInit(this,r)}clone(){const t=this.toApiJson(!0,!0);return this.repo.fromJson(t,this.isNew())}get relations(){return this.repo.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=r=>{let n=this.lookups.get(r.key);return n?n.id:this.instance[r.key]};return this.metadata.idMetadata.field instanceof ut?this.metadata.idMetadata.field.getId(t):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:await this.getIdFilter()}).then(async t=>{if(t.length===0)throw this.repo._notFoundError(this.id);await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],r={find:n=>r[typeof n=="string"?n:n.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const n of this.info.fieldsMetadata)t.push(r[n.key]=new _r(n.options,n,this.instance,this,this));this._columns=r}return this._columns}async save(t){var r,n;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let s=!1,a=this.buildLifeCycleEvent(()=>s=!0);if(!this.repo._dataProvider.isProxy){for(const c of this.fields)c.metadata.options.saving&&await c.metadata.options.saving(this.instance,c,a);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,a)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),l=[];for(const c of this.metadata.fields)if(c.dbReadOnly||t!==void 0&&!t.includes(c.key)){o[c.key]=void 0,l.push(c.key);let h=this.fields.find(c);h.value=h.originalValue}let f,u=this.isNew();try{if((r=this._subscribers)==null||r.reportChanged(),this.isNew())s?f=(f=await this.edp.find({where:await this.getIdFilter()}))[0]:f=await this.edp.insert(o);else{let c={},h=!1;for(const p in o)if(Object.prototype.hasOwnProperty.call(o,p)){const y=o[p];this.fields.find(p).valueChanged()&&!l.includes(p)&&y!==void 0&&(c[p]=y,h=!0)}if(!h)return this.instance;if(s)f=(await this.edp.find({where:await this.getIdFilter()}))[0];else{if(this.id===void 0)throw new Error("Invalid operation, id is undefined");f=await this.edp.update(this.id,c)}}if(f&&await this.loadDataFrom(f),a.id=this.getId(),!this.repo._dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,a),this.repo.listeners))for(const c of this.repo.listeners)await((n=c.saved)==null?void 0:n.call(c,this.instance,u));return this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(c){throw await this.catchSaveErrors(c)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}async processInsertResponseDto(t){return await this.loadDataFrom(t),this.saveOriginalData(),this._isNew=!1,this.instance}async buildDtoForInsert(){await this.__validateEntity(),this.__assertValidity();let t=this.copyDataToObject(this.isNew());for(const r of this.metadata.fields)if(r.dbReadOnly){t[r.key]=void 0;let n=this.fields.find(r);n.value=n.originalValue}return t}buildLifeCycleEvent(t=()=>{}){const r=this;return{isNew:r.isNew(),fields:r.fields,id:r.getId(),originalId:r.getOriginalId(),metadata:r.repo.metadata,repository:r.repo,preventDefault:()=>t(),relations:r.repo.relations(r.instance)}}async getIdFilter(){return await this.repo._translateWhereToFilter(this.repo.metadata.idMetadata.getIdFilter(this.id))}async delete(){var n;this.__clearErrorsAndReportChanged();let t=!0,r=this.buildLifeCycleEvent(()=>t=!1);this.repo._dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,r),this.__assertValidity();try{if(t){if(this.id===void 0)throw new Error("Invalid operation, id is undefined");await this.edp.delete(this.id)}if(this.repo._dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,r),this.repo.listeners)for(const s of this.repo.listeners)await((n=s.deleted)==null?void 0:n.call(s,this.instance));this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(s){throw await this.catchSaveErrors(s)}}async loadDataFrom(t,r){for(const n of this.info.fields){let s=this.lookups.get(n.key);s?(s.id=t[n.key],r===void 0?!n.options.lazy&&!ie(n)&&await s.waitLoad():r.includes(n)&&await s.waitLoad()):ie(n)||(t[n.key]===void 0?delete this.instance[n.key]:this.instance[n.key]=t[n.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(!this.repo._dataProvider.isProxy){for(const t of this.info.fieldsMetadata)if(t.options.serverExpression){const r=await t.options.serverExpression(this.instance);r!==void 0&&(this.instance[t.key]=r)}}}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const r of this.fields){const n=ie(r.metadata);if((!n||n.type=="reference")&&r.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){var t;for(const r of this.fieldsMetadata)r.options.validate&&await new _r(r.options,r,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let r=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,r)}if(this.repo.listeners)for(const r of this.repo.listeners)await((t=r.validating)==null?void 0:t.call(r,this.instance))}}const nn=Symbol.for("controllerColumns");function Ln(i,e){return i.map(t=>Fi(t.settings(e),e))}function sn(i,e){const t=e||_e;let r=i[nn];if(r||(r=i[lt]),!r){let n=C.columnsOfType.get(i.constructor);n||C.columnsOfType.set(i.constructor,n=[]);let s=Object.getPrototypeOf(i.constructor);for(;s!=null;){let a=C.columnsOfType.get(s);a&&n.unshift(...a.filter(o=>!n.find(l=>l.key==o.key))),s=Object.getPrototypeOf(s)}i[nn]=r=new Eo(Ln(n,t).map(a=>new jn(a,void 0,t)),i,t)}return r}class Eo extends Bn{constructor(t,r,n){super(t,r,n,!1);d(this,"fields");let s=[],a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>s[Symbol.iterator](),toArray:()=>s};for(const o of t)s.push(a[o.key]=new _r(o.options,o,r,void 0,this));this.fields=a}async __performColumnAndEntityValidations(){for(const t of this.fields)t instanceof _r&&await t.__performValidation()}}class _r{constructor(e,t,r,n,s){d(this,"settings");d(this,"metadata");d(this,"container");d(this,"helper");d(this,"rowBase");d(this,"_subscribers");d(this,"target");d(this,"entityRef");this.settings=e,this.metadata=t,this.container=r,this.helper=n,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}get key(){return this.metadata.key}get repo(){var e;return(e=this.helper)==null?void 0:e.repository}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=ie(this.metadata);if(t&&this.helper){if(t.type==="toMany")return this.container[this.metadata.key]=await this.repo.relations(this.container)[this.key].find();{let r=await this.repo.relations(this.container)[this.metadata.key].findOne();if(r)this.container[this.metadata.key]=r;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=r=>{r!==!0&&r!==void 0&&!this.error&&(typeof r=="string"&&r.length>0?this.error=r:this.error="invalid value")};if(this.settings.validate){let r=this,n={entityRef:this.entityRef,get error(){return r.error},set error(s){r.error=s},isNew:((e=this.entityRef)==null?void 0:e.isNew())??!1,load:()=>r.load(),metadata:r.metadata,originalValue:r.originalValue,value:r.value,valueChanged:()=>r.valueChanged(),originalValueIsNull:()=>r.originalValueIsNull(),valueIsNull:()=>r.valueIsNull(),isBackend:()=>{var s,a,o;return!((o=(a=(s=r.rowBase)==null?void 0:s.remult)==null?void 0:a.dataProvider)!=null&&o.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,n));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,n))}}catch(t){typeof t=="string"?this.error=t:this.error=t==null?void 0:t.message}}async validate(){return await this.__performValidation(),!this.error}}let Fo={transformCaption:(i,e,t,r)=>t};const Gr=C.fieldOptionsEnricher||{enrichFieldOptions:i=>i},To=C.captionTransformer||(C.captionTransformer=Fo);function qn(i,e,t,r){let n;return typeof i=="function"?t&&(n=i(t)):i&&(n=i),n=To.transformCaption(t,e,n??"",r),n||(e?ni(e):"")}class jn{constructor(e,t,r){d(this,"settings");d(this,"entityDefs");d(this,"remult");d(this,"options");d(this,"target");d(this,"readonly",!1);d(this,"valueConverter");d(this,"allowNull");d(this,"caption");d(this,"dbName");d(this,"inputType");d(this,"key");d(this,"isServerExpression",!1);d(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=r,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter??{},{get:(n,s)=>{let a=n[s];return typeof a=="function"?(...o)=>{try{return n[s](...o)}catch(l){const f=`${String(s)} failed for value ${o==null?void 0:o[0]}. Error: ${typeof l=="string"?l:l.message}`;throw new Nn({message:this.caption+": "+f,modelState:{[this.key]:f}})}}:a}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=qn(e.caption,e.key,r,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return Ti(this,this.entityDefs)}get dbReadOnly(){return!!this.settings.dbReadOnly}}class Po{constructor(e,t,r,n,s){d(this,"entityInfo");d(this,"remult");d(this,"entityType");d(this,"key");d(this,"options");d(this,"fieldsMetadata",[]);d(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=ee(e,!1);return t?t.getId():this.idMetadata.field instanceof ut?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,get fields(){return this.field instanceof ut?this.field.fields:[this.field]},createIdInFilter:e=>e.length>0?{$or:e.map(t=>this.idMetadata.getIdFilter(ee(t).getId()))}:{[this.fields.toArray()[0].key]:[]},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof ut){let t=this.idMetadata.field;return e.length==1?t.isEqualTo(e[0]):{$or:e.map(r=>t.isEqualTo(r))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});d(this,"fields");d(this,"dbName");d(this,"caption");if(this.entityInfo=t,this.remult=r,this.entityType=n,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let o;typeof this.options.allowApiCrud=="function"?o=(l,f)=>this.options.allowApiCrud(f):o=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.entityInfo.allowApiDelete=o),this.options.allowApiInsert===void 0&&(this.entityInfo.allowApiInsert=o),this.options.allowApiUpdate===void 0&&(this.entityInfo.allowApiUpdate=o),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=n.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const o of e)this.fieldsMetadata.push(a[o.key]=new jn(o,this,r));if(this.fields=a,this.caption=qn(t.caption,this.key,r,this),t.id){let o=typeof t.id=="string"?this.fields.find(t.id):Array.isArray(t.id)?t.id.map(l=>this.fields.find(l)):typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(o)?o.length>1?this.idMetadata.field=new ut(...o):o.length==1&&(this.idMetadata.field=o[0]):this.idMetadata.field=o}if(!this.idMetadata.field){const o=this.fields.id;o?this.idMetadata.field=o:this.idMetadata.field=[...this.fields][0]}}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=ee(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return Hn(this)}}function Do(...i){return(e,t)=>(i||(i=[]),i.splice(0,0,{valueType:e}),e[Ei]=i,e)}function Ro(i){var e,t;return((t=(e=i.options)==null?void 0:e.valueConverter)==null?void 0:t.fieldTypeInDb)==="autoincrement"}function Mo(...i){return(e,t)=>{Do(r=>{r.valueConverter=kr.get(e),r.displayValue=(n,s)=>s==null?void 0:s.caption,r.validate=(n,s)=>{const a=kr.get(e).getValues();return s.value&&!a.find(o=>o===s.value)&&(s.value=a.find(o=>o.id===s.value.id)||s.value),De.in(a)(n,s)}},...i)(e)}}class kr{constructor(e){d(this,"valueListType");d(this,"byIdMap",new Map);d(this,"values",[]);d(this,"isNumeric",!1);d(this,"fieldTypeInDb");d(this,"inputType");this.valueListType=e;for(let r in this.valueListType){let n=this.valueListType[r];n instanceof this.valueListType&&(n.id===void 0&&(n.id=r),typeof n.id=="number"&&(this.isNumeric=!0),n.caption===void 0&&(n.caption=ni(n.id!==void 0?n.id.toString():r)),this.byIdMap.set(n.id,n),this.values.push(n))}this.isNumeric&&(this.fieldTypeInDb="integer");var t=this.valueListType[Ei];if(t){for(const r of t)r!=null&&r.getValues&&(this.values.splice(0,this.values.length,...r.getValues()),this.byIdMap.clear(),this.values.forEach(n=>{n.caption===void 0&&n.id!==void 0&&(n.caption=ni(n.id)),this.byIdMap.set(n.id,n)}));if(this.values.find(r=>r.id===void 0))throw new Error(`ValueType ${this.valueListType} has values without an id`)}else throw new Error("ValueType not yet initialized, did you forget to call @ValueListFieldType on "+e)}static get(e){let t=an.get(e);return t||(t=new kr(e),an.set(e,t)),t}getValues(){return this.values}byId(e){return this.isNumeric&&(e=+e),this.byIdMap.get(e)}fromJson(e){return this.byId(e)}toJson(e){if(e)return e.id}fromDb(e){return this.fromJson(e)}toDb(e){return this.toJson(e)}toInput(e,t){return this.toJson(e)}fromInput(e,t){return this.fromJson(e)}displayValue(e){return e?e.caption:""}}const an=new Map,Ei=Symbol.for("storableMember"),Qr=Symbol.for("fieldOptionalValues");function Jn(i,e){var r;let t={};for(const n of i)if(n)if(typeof n=="function")n(t,e);else{const{validate:s,...a}=n;t.validate=yr(t.validate,s),Object.assign(t,a)}return(r=Gr.enrichFieldOptions)==null||r.call(Gr,t),t}function Fi(i,e){if(i.valueType){let n=i.valueType[Ei];n&&(i=Jn([...n,i],e))}if(i.valueType==String){let n=i;i.valueConverter||(n.valueConverter=be.String)}if(i.valueType==Number){let n=i;i.valueConverter||(n.valueConverter=be.Number)}if(i.valueType==Date){let n=i;i.valueConverter||(n.valueConverter=be.Date)}if(i.valueType==Boolean){let n=i;n.valueConverter||(n.valueConverter=be.Boolean)}if(!i.valueConverter){if(Ee(i.valueType,!1)){let s;i.valueConverter={toDb:a=>a,fromDb:a=>a},i.valueConverter=new Proxy(i.valueConverter,{get(a,o){if(a[o]===void 0&&s===void 0){if(o==="inputType")return"";s=e.repo(i.valueType).metadata.idMetadata.field.valueType===Number;for(const l of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])a[l]=s?be.Integer[l]:be.String[l]}return a[o]},set(a,o,l,f){return a[o]=l,!0}})}else i.valueConverter=be.Default;return i}i.valueConverter.toJson||(i.valueConverter.toJson=n=>n),i.valueConverter.fromJson||(i.valueConverter.fromJson=n=>n);const t=i.valueConverter.fromJson,r=i.valueConverter.toJson;return i.valueConverter.toDb||(i.valueConverter.toDb=n=>r(n)),i.valueConverter.fromDb||(i.valueConverter.fromDb=n=>t(n)),i.valueConverter.toInput||(i.valueConverter.toInput=n=>r(n)),i.valueConverter.fromInput||(i.valueConverter.fromInput=n=>t(n)),i}class Un{get _(){return ee(this)}save(){return ee(this).save()}assign(e){return Lt(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class ur{constructor(){d(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(r=>r!=t)}}function No(i){return i.metadata?i.metadata:Ee(i,!1)?_e.repo(i).metadata:i}function Bo(i){return Ee(i,!1)?_e.repo(i):i}async function Ot(i,e){const t=[];for(let r=0;r<i.length;r++){const n=i[r];t.push(await e(n,r))}return t}const At=class At{constructor(e){d(this,"sql");d(this,"wrapIdentifier",e=>e);d(this,"provideMigrationBuilder");d(this,"createdEntities",[]);d(this,"end");this.sql=e,e.wrapIdentifier&&(this.wrapIdentifier=t=>e.wrapIdentifier(t)),St(e,"provideMigrationBuilder")&&(this.provideMigrationBuilder=t=>e.provideMigrationBuilder(t)),St(e,"end")&&(this.end=()=>e.end())}static getDb(e){const t=e||_e.dataProvider;if(St(t,"createCommand"))return t;throw"the data provider is not an SqlCommandFactory"}createCommand(){return new qo(this.sql.createCommand(),At.LogToConsole)}async execute(e){return await this.createCommand().execute(e)}_getSourceSql(){return this.sql}async ensureSchema(e){this.sql.ensureSchema&&await this.sql.ensureSchema(e)}getEntityDataProvider(e){if(!this.sql.supportsJsonColumnType)for(const t of e.fields.toArray())t.valueConverter.fieldTypeInDb==="json"&&(t.valueConverter={...t.valueConverter,toDb:be.JsonString.toDb,fromDb:be.JsonString.fromDb});return new Vn(e,this,async t=>{this.createdEntities.indexOf(t.$entityName)<0&&(this.createdEntities.push(t.$entityName),await this.sql.entityIsUsedForTheFirstTime(e))},this.sql)}transaction(e){return this.sql.transaction(async t=>{let r=!1;try{await e(new At({createCommand:()=>{let n=t.createCommand();return{addParameterAndReturnSqlToken:s=>n.param(s),param:s=>n.param(s),execute:async s=>{if(r)throw"can't run a command after the transaction was completed";return n.execute(s)}}},getLimitSqlSyntax:this.sql.getLimitSqlSyntax,entityIsUsedForTheFirstTime:n=>t.entityIsUsedForTheFirstTime(n),transaction:n=>t.transaction(n),supportsJsonColumnType:this.sql.supportsJsonColumnType,wrapIdentifier:this.wrapIdentifier,end:this.end,doesNotSupportReturningSyntax:this.sql.doesNotSupportReturningSyntax,doesNotSupportReturningSyntaxOnlyForUpdate:this.sql.doesNotSupportReturningSyntaxOnlyForUpdate,orderByNullsFirst:this.sql.orderByNullsFirst}))}finally{r=!0}})}static rawFilter(e){return{[Fn]:{buildSql:e}}}static async filterToRaw(e,t,r,n,s){r||(r=new jo);const a=Bo(e);var o=new Ge(r,n||await Wn(a.metadata,s));return o._addWhere=!1,await(await ct(a)._translateWhereToFilter(t)).__applyToConsumer(o),await o.resolveWhere()}};d(At,"LogToConsole",!1),d(At,"durationThreshold",0);let Et=At;const Lo=new Map([["INSERT","⚪"],["SELECT","🔵"],["UPDATE","🟣"],["DELETE","🟤"],["CREATE","🟩"],["ALTER","🟨"],["DROP","🟥"],["TRUNCATE","⬛"],["GRANT","🟪"],["REVOKE","🟫"]]);class qo{constructor(e,t){d(this,"origin");d(this,"logToConsole");d(this,"args",{});this.origin=e,this.logToConsole=t}addParameterAndReturnSqlToken(e){return this.param(e)}param(e,t){let r=this.origin.param(e);return this.args[r]=e,r}async execute(e){try{let r=new Date,n=await this.origin.execute(e);if(this.logToConsole!==!1){var t=new Date().valueOf()-r.valueOf();if(t>=Et.durationThreshold){const s=t/1e3;if(this.logToConsole==="oneLiner"){const a=e.replace(/(\r\n|\n|\r|\t)/gm," ").replace(/  +/g," ").trim(),o=a.split(" ")[0].toUpperCase();console.info(`${Lo.get(o)||"💢"} (${s.toFixed(3)}) ${a} ${JSON.stringify(this.args)}`)}else typeof this.logToConsole=="function"?this.logToConsole(s,e,this.args):console.info(e+`
`,{arguments:this.args,duration:s})}}return n}catch(r){throw console.error((r.message||"Sql Error")+`:
`,e,{arguments:this.args,error:r}),r}}}class Vn{constructor(e,t,r,n){d(this,"entity");d(this,"sql");d(this,"iAmUsed");d(this,"strategy");this.entity=e,this.sql=t,this.iAmUsed=r,this.strategy=n}async init(){let e=await Wn(this.entity,t=>this.sql.wrapIdentifier(t));return await this.iAmUsed(e),e}async count(e){let t=await this.init(),r="select count(*) count from "+t.$entityName,n=this.sql.createCommand();if(e){let s=new Ge(n,t);e.__applyToConsumer(s),r+=await s.resolveWhere()}return n.execute(r).then(s=>Number(s.rows[0].count))}async groupBy(e){return await Jo(e,await this.init(),this.sql.createCommand(),this.sql._getSourceSql().orderByNullsFirst,this.sql._getSourceSql().getLimitSqlSyntax)}async find(e){let t=await this.init(),{colKeys:r,select:n}=this.buildSelect(t);n="select "+n,n+=`
 from `+t.$entityName;let s=this.sql.createCommand();if(e){if(e.where){let a=new Ge(s,t);e.where.__applyToConsumer(a),n+=await a.resolveWhere()}if(e.limit&&(e.orderBy=Ce.createUniqueSort(this.entity,e.orderBy)),e.orderBy||(e.orderBy=Ce.createUniqueSort(this.entity,new Ce)),e.orderBy){let a=!0,o=[];for(const l of e.orderBy.Segments)o.push(l);for(const l of o)a?(n+=" Order By ",a=!1):n+=", ",n+=t.$dbNameOf(l.field),l.isDescending&&(n+=" desc"),this.sql._getSourceSql().orderByNullsFirst&&(l.isDescending?n+=" nulls last":n+=" nulls first")}if(e.limit){let a=1;e.page&&(a=e.page),a<1&&(a=1),n+=" "+this.strategy.getLimitSqlSyntax(e.limit,(a-1)*e.limit)}}return s.execute(n).then(a=>a.rows.map(o=>this.buildResultRow(r,o,a)))}buildResultRow(e,t,r){let n={};for(let s=0;s<e.length;s++){const a=e[s];try{n[a.key]=a.valueConverter.fromDb(t[r.getColumnKeyInResultForIndexInSelect(s)])}catch(o){throw new Error("Failed to load from db:"+a.key+`\r
`+o)}}return n}buildSelect(e){let t="",r=[];for(const n of this.entity.fields)n.isServerExpression||(r.length>0&&(t+=", "),t+=e.$dbNameOf(n),n.options.sqlExpression&&(t+=" as "+n.key),r.push(n));return{colKeys:r,select:t}}async update(e,t){let r=await this.init(),n=this.sql.createCommand(),s="update "+r.$entityName+" set ",a=!1;for(const h of this.entity.fields)if(!ln(h,r)){if(t[h.key]!==void 0){let p=h.valueConverter.toDb(t[h.key]);p!==void 0&&(a?s+=", ":a=!0,s+=r.$dbNameOf(h)+" = "+n.param(p))}}const o=this.entity.idMetadata.getIdFilter(e);let l=new Ge(n,r);D.fromEntityFilter(this.entity,o).__applyToConsumer(l),s+=await l.resolveWhere();let{colKeys:f,select:u}=this.buildSelect(r),c=!0;return this.sql._getSourceSql().doesNotSupportReturningSyntax&&(c=!1),c&&this.sql._getSourceSql().doesNotSupportReturningSyntaxOnlyForUpdate&&(c=!1),c&&(s+=" returning "+u),n.execute(s).then(h=>{var p,y;if((y=(p=this.sql._getSourceSql()).afterMutation)==null||y.call(p),!c)return on(this.entity,this,t,e,"update");if(h.rows.length!=1)throw new Error("Failed to update row with id "+e+", rows updated: "+h.rows.length);return this.buildResultRow(f,h.rows[0],h)})}async delete(e){let t=await this.init(),r=this.sql.createCommand(),n=new Ge(r,t);D.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(n);let s="delete from "+t.$entityName;return s+=await n.resolveWhere(),r.execute(s).then(()=>{var a,o;(o=(a=this.sql._getSourceSql()).afterMutation)==null||o.call(a)})}async insert(e){let t=await this.init(),r=this.sql.createCommand(),n="",s="",a=!1;for(const u of this.entity.fields)if(!ln(u,t)){let c=u.valueConverter.toDb(e[u.key]);c!=null&&(a?(n+=", ",s+=", "):a=!0,n+=t.$dbNameOf(u),s+=r.param(c))}let o=`insert into ${t.$entityName} (${n}) values (${s})`,{colKeys:l,select:f}=this.buildSelect(t);return this.sql._getSourceSql().doesNotSupportReturningSyntax||(o+=" returning "+f),await r.execute(o).then(u=>{var c,h;if((h=(c=this.sql._getSourceSql()).afterMutation)==null||h.call(c),this.sql._getSourceSql().doesNotSupportReturningSyntax)if(Ro(this.entity.idMetadata.field)){const p=u.rows[0];if(typeof p!="number")throw new Error("Auto increment, for a database that is does not support returning syntax, should return an array with the single last added id. Instead it returned: "+JSON.stringify(p));return this.find({where:new D(y=>y.isEqualTo(this.entity.idMetadata.field,p))}).then(y=>y[0])}else return on(this.entity,this,e,void 0,"insert");return this.buildResultRow(l,u.rows[0],u)})}}d(Vn,"LogToConsole",!1);class jo{execute(e){throw new Error("Method not implemented.")}addParameterAndReturnSqlToken(e){return this.param(e)}param(e){return e===null?"null":(e instanceof Date&&(e=e.toISOString()),typeof e=="string"?(e==null&&(e=""),"'"+e.replace(/'/g,"''")+"'"):e.toString())}}function on(i,e,t,r,n){const s=r!==void 0?i.idMetadata.getIdFilter(r):{};return e.find({where:new D(a=>{for(const o of i.idMetadata.fields)a.isEqualTo(o,t[o.key]??s[o.key])})}).then(a=>{if(a.length!=1)throw new Error(`Failed to ${n} row - result contained ${a.length} rows`);return a[0]})}async function Jo(i,e,t,r,n){let s="select count(*) as count",a="";const o=[];if(o.push((c,h)=>{h[za]=Number(c)}),i!=null&&i.group)for(const c of i==null?void 0:i.group)c.isServerExpression||(s+=", "+e.$dbNameOf(c),c.options.sqlExpression&&(s+=" as "+c.key),a==""?a=" group by ":a+=", ",a+=e.$dbNameOf(c)),o.push((h,p)=>{p[c.key]=c.valueConverter.fromDb(h)});for(const c of Xa){const h=i==null?void 0:i[c];if(h)for(const p of h){if(!p.isServerExpression){const g=await e.$dbNameOf(p);s+=`, ${u(c,g)} as ${p.key}_${c}`}const y=p.valueType===Number||c=="distinctCount";o.push((g,w)=>{y&&(g=Number(g)),w[p.key]={...w[p.key],[c]:g}})}}if(s+=`
 from `+e.$entityName,i!=null&&i.where){let c=new Ge(t,e);i==null||i.where.__applyToConsumer(c),s+=await c.resolveWhere()}a&&(s+=a);let l="";if(i!=null&&i.orderBy){for(const c of i==null?void 0:i.orderBy){l==""?l=" order by ":l+=", ";let h=c.field&&await e.$dbNameOf(c.field);switch(c.operation){case"count":h=c.operation+"(*)";break;case void 0:break;default:h=u(c.operation,h)}l+=h,c.isDescending&&(l+=" desc"),r&&(c.isDescending?l+=" nulls last":l+=" nulls first")}l&&(s+=l)}if(i!=null&&i.limit){let c=1;i.page&&(c=i.page),c<1&&(c=1),s+=" "+n(i.limit,(c-1)*i.limit)}const f=await t.execute(s);return f.rows.map(c=>{let h={};return o.forEach((p,y)=>p(c[f.getColumnKeyInResultForIndexInSelect(y)],h)),h});function u(c,h){return c==="distinctCount"?`count (distinct ${h})`:`${c}( ${h} )`}}class Ge{constructor(e,t){d(this,"r");d(this,"nameProvider");d(this,"where","");d(this,"_addWhere",!0);d(this,"promises",[]);this.r=e,this.nameProvider=t}async resolveWhere(){for(;this.promises.length>0;){let e=this.promises;this.promises=[];for(const t of e)await t}return this.where}custom(e,t){throw new Error("Custom filter should be translated before it gets here")}or(e){let t="";this.promises.push((async()=>{for(const r of e){let n=new Ge(this.r,this.nameProvider);n._addWhere=!1,r.__applyToConsumer(n);let s=await n.resolveWhere();if(!s)return;s.length>0&&(t.length>0&&(t+=" or "),e.length>1?t+="("+s+")":t+=s)}this.addToWhere("("+t+")")})())}not(e){this.promises.push((async()=>{let t=new Ge(this.r,this.nameProvider);t._addWhere=!1,e.__applyToConsumer(t);let r=await t.resolveWhere();r&&this.addToWhere("not ("+r+")")})())}isNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is null"))())}isNotNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is not null"))())}isIn(e,t){this.promises.push((async()=>{t&&t.length>0?this.addToWhere(this.nameProvider.$dbNameOf(e)+" in ("+t.map(r=>this.r.param(e.valueConverter.toDb(r))).join(",")+")"):this.addToWhere("1 = 0 /*isIn with no values*/")})())}isEqualTo(e,t){this.add(e,t,"=")}isDifferentFrom(e,t){this.add(e,t,"<>")}isGreaterOrEqualTo(e,t){this.add(e,t,">=")}isGreaterThan(e,t){this.add(e,t,">")}isLessOrEqualTo(e,t){this.add(e,t,"<=")}isLessThan(e,t){this.add(e,t,"<")}containsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}notContainsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("not lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}startsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('"+t.replace(/'/g,"''")+"%')")})())}endsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"')")})())}add(e,t,r){this.promises.push((async()=>{let n=this.nameProvider.$dbNameOf(e)+" "+r+" "+this.r.param(e.valueConverter.toDb(t));this.addToWhere(n)})())}addToWhere(e){this.where.length==0?this._addWhere&&(this.where+=" where "):this.where+=" and ",this.where+=e}databaseCustom(e){this.promises.push((async()=>{if(e!=null&&e.buildSql){let t=new Uo(this.r,this.nameProvider.wrapIdentifier),r=await e.buildSql(t);typeof r!="string"&&(r=t.sql),r&&this.addToWhere("("+r+")")}})())}}class Uo{constructor(e,t){d(this,"r");d(this,"wrapIdentifier");d(this,"sql","");d(this,"param",(e,t)=>(typeof t=="object"&&t.valueConverter.toDb&&(e=t.valueConverter.toDb(e)),this.r.param(e)));d(this,"filterToRaw",async(e,t)=>Et.filterToRaw(e,t,this,void 0,this.wrapIdentifier));this.r=e,this.wrapIdentifier=t,this.param.bind(this),this.filterToRaw.bind(this)}addParameterAndReturnSqlToken(e){return this.param(e)}}function ln(i,e){return i.dbReadOnly||i.isServerExpression||i.options.sqlExpression&&i.dbName!=e.$dbNameOf(i)}async function Wn(i,e){return Vo(i,e,!0)}async function Vo(i,e,t=!1){let r=typeof e=="function"?{wrapIdentifier:e}:e||{};var n=No(i);r.wrapIdentifier||(r.wrapIdentifier=_e.dataProvider.wrapIdentifier),r.wrapIdentifier||(r.wrapIdentifier=a=>a);const s={$entityName:await Hn(n,r.wrapIdentifier),toString:()=>s.$entityName,$dbNameOf:a=>{var o;return typeof a=="string"?o=a:o=a.key,s[o]},wrapIdentifier:r.wrapIdentifier};for(const a of n.fields){let o=await Ti(a,n,r.wrapIdentifier,t);a.options.sqlExpression||(typeof r.tableName=="string"?o=r.wrapIdentifier(r.tableName)+"."+o:r.tableName===!0&&(o=s.$entityName+"."+o)),s[a.key]=o}return s}async function Hn(i,e=t=>t){if(i.options.sqlExpression){if(typeof i.options.sqlExpression=="string")return i.options.sqlExpression;if(typeof i.options.sqlExpression=="function"){const t=i.options.sqlExpression;try{return i.options.sqlExpression="recursive sqlExpression call for entity '"+i.key+"'. ",await t(i)}finally{i.options.sqlExpression=t}}}return e(i.dbName)}const zr=Symbol.for("sqlExpressionInProgressKey");async function Ti(i,e,t=n=>n,r=!1){try{if(i.options.sqlExpression){let a;if(typeof i.options.sqlExpression=="function"){if(i[zr]&&!r)return"recursive sqlExpression call for field '"+i.key+"'. \0";try{i[zr]=!0,a=await i.options.sqlExpression(e),a.includes("\0")||(i.options.sqlExpression=()=>a)}finally{delete i[zr]}}else a=i.options.sqlExpression;return a||i.dbName}const n=ie(i);let s=(n==null?void 0:n.type)==="toOne"&&i.options.field;if(s){let a=e.fields.find(s);if(a)return Ti(a,e,t,r)}return t(i.dbName)}finally{}}function $n(i,...e){return(t,r)=>{let n=t;for(;n!=null;){for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=t[a];o!=null&&o.rawFilterInfo&&(o.rawFilterInfo.key||(o.rawFilterInfo.key=a))}n=Object.getPrototypeOf(n)}let s=a=>{let o={};for(const f of e)f&&(typeof f=="function"?f(o,a):Object.assign(o,f));let l=Object.getPrototypeOf(t);if(l){let f=Ee(l,!1);if(f){let u=f(a);u&&(o={...u,...o})}}return o};return C.allEntities.push(t),go(t,{key:i}),t[Sn]=s,t[Cn]=i,t}}var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},tt={},re={},he={};Object.defineProperty(he,"__esModule",{value:!0});he.output=he.exists=he.hash=he.bytes=he.bool=he.number=he.isBytes=void 0;function Or(i){if(!Number.isSafeInteger(i)||i<0)throw new Error(`positive integer expected, not ${i}`)}he.number=Or;function xn(i){if(typeof i!="boolean")throw new Error(`boolean expected, not ${i}`)}he.bool=xn;function Gn(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}he.isBytes=Gn;function Pi(i,...e){if(!Gn(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}he.bytes=Pi;function Qn(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Or(i.outputLen),Or(i.blockLen)}he.hash=Qn;function zn(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}he.exists=zn;function Kn(i,e){Pi(i);const t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}he.output=Kn;const Wo={number:Or,bool:xn,bytes:Pi,hash:Qn,exists:zn,output:Kn};he.default=Wo;var N={};Object.defineProperty(N,"__esModule",{value:!0});N.add5L=N.add5H=N.add4H=N.add4L=N.add3H=N.add3L=N.add=N.rotlBL=N.rotlBH=N.rotlSL=N.rotlSH=N.rotr32L=N.rotr32H=N.rotrBL=N.rotrBH=N.rotrSL=N.rotrSH=N.shrSL=N.shrSH=N.toBig=N.split=N.fromBig=void 0;const fr=BigInt(2**32-1),li=BigInt(32);function Di(i,e=!1){return e?{h:Number(i&fr),l:Number(i>>li&fr)}:{h:Number(i>>li&fr)|0,l:Number(i&fr)|0}}N.fromBig=Di;function Xn(i,e=!1){let t=new Uint32Array(i.length),r=new Uint32Array(i.length);for(let n=0;n<i.length;n++){const{h:s,l:a}=Di(i[n],e);[t[n],r[n]]=[s,a]}return[t,r]}N.split=Xn;const Zn=(i,e)=>BigInt(i>>>0)<<li|BigInt(e>>>0);N.toBig=Zn;const Yn=(i,e,t)=>i>>>t;N.shrSH=Yn;const es=(i,e,t)=>i<<32-t|e>>>t;N.shrSL=es;const ts=(i,e,t)=>i>>>t|e<<32-t;N.rotrSH=ts;const rs=(i,e,t)=>i<<32-t|e>>>t;N.rotrSL=rs;const is=(i,e,t)=>i<<64-t|e>>>t-32;N.rotrBH=is;const ns=(i,e,t)=>i>>>t-32|e<<64-t;N.rotrBL=ns;const ss=(i,e)=>e;N.rotr32H=ss;const as=(i,e)=>i;N.rotr32L=as;const os=(i,e,t)=>i<<t|e>>>32-t;N.rotlSH=os;const ls=(i,e,t)=>e<<t|i>>>32-t;N.rotlSL=ls;const us=(i,e,t)=>e<<t-32|i>>>64-t;N.rotlBH=us;const fs=(i,e,t)=>i<<t-32|e>>>64-t;N.rotlBL=fs;function cs(i,e,t,r){const n=(e>>>0)+(r>>>0);return{h:i+t+(n/2**32|0)|0,l:n|0}}N.add=cs;const ds=(i,e,t)=>(i>>>0)+(e>>>0)+(t>>>0);N.add3L=ds;const hs=(i,e,t,r)=>e+t+r+(i/2**32|0)|0;N.add3H=hs;const ps=(i,e,t,r)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0);N.add4L=ps;const ys=(i,e,t,r,n)=>e+t+r+n+(i/2**32|0)|0;N.add4H=ys;const ms=(i,e,t,r,n)=>(i>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0);N.add5L=ms;const ws=(i,e,t,r,n,s)=>e+t+r+n+s+(i/2**32|0)|0;N.add5H=ws;const Ho={fromBig:Di,split:Xn,toBig:Zn,shrSH:Yn,shrSL:es,rotrSH:ts,rotrSL:rs,rotrBH:is,rotrBL:ns,rotr32H:ss,rotr32L:as,rotlSH:os,rotlSL:ls,rotlBH:us,rotlBL:fs,add:cs,add3L:ds,add3H:hs,add4L:ps,add4H:ys,add5H:ws,add5L:ms};N.default=Ho;var gs={},Tr={};Object.defineProperty(Tr,"__esModule",{value:!0});Tr.crypto=void 0;Tr.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(i){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(i,"__esModule",{value:!0}),i.randomBytes=i.wrapXOFConstructorWithOpts=i.wrapConstructorWithOpts=i.wrapConstructor=i.checkOpts=i.Hash=i.concatBytes=i.toBytes=i.utf8ToBytes=i.asyncLoop=i.nextTick=i.hexToBytes=i.bytesToHex=i.byteSwap32=i.byteSwapIfBE=i.byteSwap=i.isLE=i.rotl=i.rotr=i.createView=i.u32=i.u8=i.isBytes=void 0;const e=Tr,t=he;function r(b){return b instanceof Uint8Array||b!=null&&typeof b=="object"&&b.constructor.name==="Uint8Array"}i.isBytes=r;const n=b=>new Uint8Array(b.buffer,b.byteOffset,b.byteLength);i.u8=n;const s=b=>new Uint32Array(b.buffer,b.byteOffset,Math.floor(b.byteLength/4));i.u32=s;const a=b=>new DataView(b.buffer,b.byteOffset,b.byteLength);i.createView=a;const o=(b,k)=>b<<32-k|b>>>k;i.rotr=o;const l=(b,k)=>b<<k|b>>>32-k>>>0;i.rotl=l,i.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const f=b=>b<<24&4278190080|b<<8&16711680|b>>>8&65280|b>>>24&255;i.byteSwap=f,i.byteSwapIfBE=i.isLE?b=>b:b=>(0,i.byteSwap)(b);function u(b){for(let k=0;k<b.length;k++)b[k]=(0,i.byteSwap)(b[k])}i.byteSwap32=u;const c=Array.from({length:256},(b,k)=>k.toString(16).padStart(2,"0"));function h(b){(0,t.bytes)(b);let k="";for(let F=0;F<b.length;F++)k+=c[b[F]];return k}i.bytesToHex=h;const p={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function y(b){if(b>=p._0&&b<=p._9)return b-p._0;if(b>=p._A&&b<=p._F)return b-(p._A-10);if(b>=p._a&&b<=p._f)return b-(p._a-10)}function g(b){if(typeof b!="string")throw new Error("hex string expected, got "+typeof b);const k=b.length,F=k/2;if(k%2)throw new Error("padded hex string expected, got unpadded hex of length "+k);const M=new Uint8Array(F);for(let te=0,le=0;te<F;te++,le+=2){const Me=y(b.charCodeAt(le)),ze=y(b.charCodeAt(le+1));if(Me===void 0||ze===void 0){const it=b[le]+b[le+1];throw new Error('hex string expected, got non-hex character "'+it+'" at index '+le)}M[te]=Me*16+ze}return M}i.hexToBytes=g;const w=async()=>{};i.nextTick=w;async function O(b,k,F){let M=Date.now();for(let te=0;te<b;te++){F(te);const le=Date.now()-M;le>=0&&le<k||(await(0,i.nextTick)(),M+=le)}}i.asyncLoop=O;function I(b){if(typeof b!="string")throw new Error(`utf8ToBytes expected string, got ${typeof b}`);return new Uint8Array(new TextEncoder().encode(b))}i.utf8ToBytes=I;function S(b){return typeof b=="string"&&(b=I(b)),(0,t.bytes)(b),b}i.toBytes=S;function B(...b){let k=0;for(let M=0;M<b.length;M++){const te=b[M];(0,t.bytes)(te),k+=te.length}const F=new Uint8Array(k);for(let M=0,te=0;M<b.length;M++){const le=b[M];F.set(le,te),te+=le.length}return F}i.concatBytes=B;class T{clone(){return this._cloneInto()}}i.Hash=T;const H={}.toString;function ae(b,k){if(k!==void 0&&H.call(k)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(b,k)}i.checkOpts=ae;function ue(b){const k=M=>b().update(S(M)).digest(),F=b();return k.outputLen=F.outputLen,k.blockLen=F.blockLen,k.create=()=>b(),k}i.wrapConstructor=ue;function ve(b){const k=(M,te)=>b(te).update(S(M)).digest(),F=b({});return k.outputLen=F.outputLen,k.blockLen=F.blockLen,k.create=M=>b(M),k}i.wrapConstructorWithOpts=ve;function pe(b){const k=(M,te)=>b(te).update(S(M)).digest(),F=b({});return k.outputLen=F.outputLen,k.blockLen=F.blockLen,k.create=M=>b(M),k}i.wrapXOFConstructorWithOpts=pe;function Z(b=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(b));throw new Error("crypto.getRandomValues must be defined")}i.randomBytes=Z})(gs);Object.defineProperty(re,"__esModule",{value:!0});re.shake256=re.shake128=re.keccak_512=re.keccak_384=re.keccak_256=re.keccak_224=re.sha3_512=re.sha3_384=re.sha3_256=re.sha3_224=re.Keccak=re.keccakP=void 0;const vt=he,$t=N,xe=gs,bs=[],vs=[],_s=[],$o=BigInt(0),Rt=BigInt(1),xo=BigInt(2),Go=BigInt(7),Qo=BigInt(256),zo=BigInt(113);for(let i=0,e=Rt,t=1,r=0;i<24;i++){[t,r]=[r,(2*t+3*r)%5],bs.push(2*(5*r+t)),vs.push((i+1)*(i+2)/2%64);let n=$o;for(let s=0;s<7;s++)e=(e<<Rt^(e>>Go)*zo)%Qo,e&xo&&(n^=Rt<<(Rt<<BigInt(s))-Rt);_s.push(n)}const[Ko,Xo]=(0,$t.split)(_s,!0),un=(i,e,t)=>t>32?(0,$t.rotlBH)(i,e,t):(0,$t.rotlSH)(i,e,t),fn=(i,e,t)=>t>32?(0,$t.rotlBL)(i,e,t):(0,$t.rotlSL)(i,e,t);function ks(i,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let a=0;a<10;a++)t[a]=i[a]^i[a+10]^i[a+20]^i[a+30]^i[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,l=(a+2)%10,f=t[l],u=t[l+1],c=un(f,u,1)^t[o],h=fn(f,u,1)^t[o+1];for(let p=0;p<50;p+=10)i[a+p]^=c,i[a+p+1]^=h}let n=i[2],s=i[3];for(let a=0;a<24;a++){const o=vs[a],l=un(n,s,o),f=fn(n,s,o),u=bs[a];n=i[u],s=i[u+1],i[u]=l,i[u+1]=f}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=i[a+o];for(let o=0;o<10;o++)i[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}i[0]^=Ko[r],i[1]^=Xo[r]}t.fill(0)}re.keccakP=ks;class ir extends xe.Hash{constructor(e,t,r,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,vt.number)(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,xe.u32)(this.state)}keccak(){xe.isLE||(0,xe.byteSwap32)(this.state32),ks(this.state32,this.rounds),xe.isLE||(0,xe.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,vt.exists)(this);const{blockLen:t,state:r}=this;e=(0,xe.toBytes)(e);const n=e.length;for(let s=0;s<n;){const a=Math.min(t-this.pos,n-s);for(let o=0;o<a;o++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:n}=this;e[r]^=t,t&128&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){(0,vt.exists)(this,!1),(0,vt.bytes)(e),this.finish();const t=this.state,{blockLen:r}=this;for(let n=0,s=e.length;n<s;){this.posOut>=r&&this.keccak();const a=Math.min(r-this.posOut,s-n);e.set(t.subarray(this.posOut,this.posOut+a),n),this.posOut+=a,n+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,vt.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,vt.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:n,rounds:s,enableXOF:a}=this;return e||(e=new ir(t,r,n,a,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=n,e.enableXOF=a,e.destroyed=this.destroyed,e}}re.Keccak=ir;const rt=(i,e,t)=>(0,xe.wrapConstructor)(()=>new ir(e,i,t));re.sha3_224=rt(6,144,224/8);re.sha3_256=rt(6,136,256/8);re.sha3_384=rt(6,104,384/8);re.sha3_512=rt(6,72,512/8);re.keccak_224=rt(1,144,224/8);re.keccak_256=rt(1,136,256/8);re.keccak_384=rt(1,104,384/8);re.keccak_512=rt(1,72,512/8);const Is=(i,e,t)=>(0,xe.wrapXOFConstructorWithOpts)((r={})=>new ir(e,i,r.dkLen===void 0?t:r.dkLen,!0));re.shake128=Is(31,168,128/8);re.shake256=Is(31,136,256/8);const{sha3_512:Zo}=re,Os=24,Ut=32,ui=(i=4,e=Math.random)=>{let t="";for(;t.length<i;)t=t+Math.floor(e()*36).toString(36);return t};function As(i){let e=8n,t=0n;for(const r of i.values()){const n=BigInt(r);t=(t<<e)+n}return t}const Ss=(i="")=>As(Zo(i)).toString(36).slice(1),cn=Array.from({length:26},(i,e)=>String.fromCharCode(e+97)),Yo=i=>cn[Math.floor(i()*cn.length)],Cs=({globalObj:i=typeof Ir<"u"?Ir:typeof window<"u"?window:{},random:e=Math.random}={})=>{const t=Object.keys(i).toString(),r=t.length?t+ui(Ut,e):ui(Ut,e);return Ss(r).substring(0,Ut)},Es=i=>()=>i++,el=476782367,Fs=({random:i=Math.random,counter:e=Es(Math.floor(i()*el)),length:t=Os,fingerprint:r=Cs({random:i})}={})=>function(){const s=Yo(i),a=Date.now().toString(36),o=e().toString(36),l=ui(t,i),f=`${a+l+o+r}`;return`${s+Ss(f).substring(1,t)}`},tl=Fs(),rl=(i,{minLength:e=2,maxLength:t=Ut}={})=>{const r=i.length,n=/^[0-9a-z]+$/;try{if(typeof i=="string"&&r>=e&&r<=t&&n.test(i))return!0}finally{}return!1};tt.getConstants=()=>({defaultLength:Os,bigLength:Ut});tt.init=Fs;tt.createId=tl;tt.bufToBigInt=As;tt.createCounter=Es;tt.createFingerprint=Cs;tt.isCuid=rl;const{createId:il,init:Ol,getConstants:Al,isCuid:Sl}=tt;var dn=il;const hn=hr(i=>!isNaN(i)&&isFinite(i));class X{static object(...e){return me(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),me(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return me(()=>Date,{valueConverter:be.DateOnly},...e)}static date(...e){return me(()=>Date,...e)}static integer(...e){return me(()=>Number,{valueConverter:be.Integer,validate:hn},...e)}static autoIncrement(...e){return me(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...be.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return me(()=>Number,{validate:hn},...e)}static createdAt(...e){return me(()=>Date,{allowApiUpdate:!1,saving:(t,r,{isNew:n})=>{n&&(r.value=new Date)}},...e)}static updatedAt(...e){return me(()=>Date,{allowApiUpdate:!1,saving:(t,r)=>{r.value=new Date}},...e)}static uuid(...e){return me(()=>String,{allowApiUpdate:!1,defaultValue:()=>ai(),saving:(t,r)=>{r.value||(r.value=ai())}},...e)}static cuid(...e){return me(()=>String,{allowApiUpdate:!1,defaultValue:()=>dn(),saving:(t,r)=>{r.value||(r.value=dn())}},...e)}static literal(e,...t){return X.string({validate:(r,n)=>De.in(e())(r,n),[Qr]:e},...t)}static enum(e,...t){let r;return me(()=>e(),{validate:(n,s)=>De.enum(e())(n,s),[Qr]:()=>pr(e())},...t,n=>{if(n[Qr]=()=>pr(e()),r===void 0){let s=e();r=pr(s).find(o=>typeof o=="string")?be.String:be.Integer}n.valueConverter?n.valueConverter.fieldTypeInDb||(n.valueConverter.fieldTypeInDb=r.fieldTypeInDb):n.valueConverter=r})}static string(...e){return me(()=>String,...e)}static boolean(...e){return me(()=>Boolean,...e)}}class Pr{static toOne(e,t){let r=typeof t=="string"?{field:t}:t||{};return!r.field&&!r.fields&&!r.findOptions?me(e,{...r,...Vr(e,"reference")}):me(()=>{},{...r,serverExpression:()=>{},...Vr(e,"toOne")})}static toMany(e,t){return me(()=>{},{...typeof t=="string"?{field:t}:t,serverExpression:()=>{},...Vr(e,"toMany")})}}function me(i,...e){return(t,r,n)=>{const s=typeof r=="string"?r:r.name.toString();let a=f=>{let u=Jn(e,f);if(u.required&&(u.validate=yr(u.validate,De.required,!0)),St(u,"maxLength")){let h=u;h.maxLength&&(h.validate=yr(h.validate,De.maxLength(h.maxLength)))}if(St(u,"minLength")){let h=u;h.minLength&&(h.validate=yr(h.validate,De.minLength(h.minLength)))}!u.valueType&&i&&(u.valueType=i()),u.key||(u.key=s),u.dbName||(u.dbName=u.key);let c=u.valueType;return c||(c=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],u.valueType=c),u.target||(u.target=t),u};Ts(t);let o=C.columnsOfType.get(t.constructor);o||(o=[],C.columnsOfType.set(t.constructor,o));let l=o.find(f=>f.key==s);if(!l)o.push({key:s,settings:a});else{let f=l.settings;l.settings=u=>{let c=f(u),h=a(u);return Object.assign(c,h)}}}}function Ts(i){if(!i)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function nl(i,e,t,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(i,e,t,r);else for(var o=i.length-1;o>=0;o--)(a=i[o])&&(s=(n<3?a(s):n>3?a(e,t,s):a(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function sl(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}class Ar extends Un{constructor(){super(...arguments);d(this,"id")}}nl([X.uuid(),sl("design:type",String)],Ar.prototype,"id",void 0);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var pn;(function(i){(function(e){var t=typeof Ir=="object"?Ir:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=n(i);typeof t.Reflect>"u"?t.Reflect=i:r=n(t.Reflect,r),e(r);function n(s,a){return function(o,l){typeof s[o]!="function"&&Object.defineProperty(s,o,{configurable:!0,writable:!0,value:l}),a&&a(o,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",n=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",o={__proto__:[]}instanceof Array,l=!a&&!o,f={create:a?function(){return Br(Object.create(null))}:o?function(){return Br({__proto__:null})}:function(){return Br({})},has:l?function(m,v){return t.call(m,v)}:function(m,v){return v in m},get:l?function(m,v){return t.call(m,v)?m[v]:void 0}:function(m,v){return m[v]}},u=Object.getPrototypeOf(Function),c=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!c&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ga(),p=!c&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ba(),y=!c&&typeof WeakMap=="function"?WeakMap:va(),g=new y;function w(m,v,_,A){if(ce(_)){if(!Ni(m))throw new TypeError;if(!Bi(v))throw new TypeError;return pe(m,v)}else{if(!Ni(m))throw new TypeError;if(!ge(v))throw new TypeError;if(!ge(A)&&!ce(A)&&!wt(A))throw new TypeError;return wt(A)&&(A=void 0),_=$e(_),Z(m,v,_,A)}}e("decorate",w);function O(m,v){function _(A,P){if(!ge(A))throw new TypeError;if(!ce(P)&&!ha(P))throw new TypeError;le(m,v,A,P)}return _}e("metadata",O);function I(m,v,_,A){if(!ge(_))throw new TypeError;return ce(A)||(A=$e(A)),le(m,v,_,A)}e("defineMetadata",I);function S(m,v,_){if(!ge(v))throw new TypeError;return ce(_)||(_=$e(_)),k(m,v,_)}e("hasMetadata",S);function B(m,v,_){if(!ge(v))throw new TypeError;return ce(_)||(_=$e(_)),F(m,v,_)}e("hasOwnMetadata",B);function T(m,v,_){if(!ge(v))throw new TypeError;return ce(_)||(_=$e(_)),M(m,v,_)}e("getMetadata",T);function H(m,v,_){if(!ge(v))throw new TypeError;return ce(_)||(_=$e(_)),te(m,v,_)}e("getOwnMetadata",H);function ae(m,v){if(!ge(m))throw new TypeError;return ce(v)||(v=$e(v)),Me(m,v)}e("getMetadataKeys",ae);function ue(m,v){if(!ge(m))throw new TypeError;return ce(v)||(v=$e(v)),ze(m,v)}e("getOwnMetadataKeys",ue);function ve(m,v,_){if(!ge(v))throw new TypeError;ce(_)||(_=$e(_));var A=b(v,_,!1);if(ce(A)||!A.delete(m))return!1;if(A.size>0)return!0;var P=g.get(v);return P.delete(_),P.size>0||g.delete(v),!0}e("deleteMetadata",ve);function pe(m,v){for(var _=m.length-1;_>=0;--_){var A=m[_],P=A(v);if(!ce(P)&&!wt(P)){if(!Bi(P))throw new TypeError;v=P}}return v}function Z(m,v,_,A){for(var P=m.length-1;P>=0;--P){var Ae=m[P],L=Ae(v,_,A);if(!ce(L)&&!wt(L)){if(!ge(L))throw new TypeError;A=L}}return A}function b(m,v,_){var A=g.get(m);if(ce(A)){if(!_)return;A=new h,g.set(m,A)}var P=A.get(v);if(ce(P)){if(!_)return;P=new h,A.set(v,P)}return P}function k(m,v,_){var A=F(m,v,_);if(A)return!0;var P=Nr(v);return wt(P)?!1:k(m,P,_)}function F(m,v,_){var A=b(v,_,!1);return ce(A)?!1:ca(A.has(m))}function M(m,v,_){var A=F(m,v,_);if(A)return te(m,v,_);var P=Nr(v);if(!wt(P))return M(m,P,_)}function te(m,v,_){var A=b(v,_,!1);if(!ce(A))return A.get(m)}function le(m,v,_,A){var P=b(_,A,!0);P.set(m,v)}function Me(m,v){var _=ze(m,v),A=Nr(m);if(A===null)return _;var P=Me(A,v);if(P.length<=0)return _;if(_.length<=0)return P;for(var Ae=new p,L=[],j=0,R=_;j<R.length;j++){var $=R[j],x=Ae.has($);x||(Ae.add($),L.push($))}for(var Ke=0,qi=P;Ke<qi.length;Ke++){var $=qi[Ke],x=Ae.has($);x||(Ae.add($),L.push($))}return L}function ze(m,v){var _=[],A=b(m,v,!1);if(ce(A))return _;for(var P=A.keys(),Ae=pa(P),L=0;;){var j=ma(Ae);if(!j)return _.length=L,_;var R=ya(j);try{_[L]=R}catch($){try{wa(Ae)}finally{throw $}}L++}}function it(m){if(m===null)return 1;switch(typeof m){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return m===null?1:6;default:return 6}}function ce(m){return m===void 0}function wt(m){return m===null}function la(m){return typeof m=="symbol"}function ge(m){return typeof m=="object"?m!==null:typeof m=="function"}function ua(m,v){switch(it(m)){case 0:return m;case 1:return m;case 2:return m;case 3:return m;case 4:return m;case 5:return m}var _="string",A=Li(m,n);if(A!==void 0){var P=A.call(m,_);if(ge(P))throw new TypeError;return P}return fa(m)}function fa(m,v){var _,A;{var P=m.toString;if(nr(P)){var A=P.call(m);if(!ge(A))return A}var _=m.valueOf;if(nr(_)){var A=_.call(m);if(!ge(A))return A}}throw new TypeError}function ca(m){return!!m}function da(m){return""+m}function $e(m){var v=ua(m);return la(v)?v:da(v)}function Ni(m){return Array.isArray?Array.isArray(m):m instanceof Object?m instanceof Array:Object.prototype.toString.call(m)==="[object Array]"}function nr(m){return typeof m=="function"}function Bi(m){return typeof m=="function"}function ha(m){switch(it(m)){case 3:return!0;case 4:return!0;default:return!1}}function Li(m,v){var _=m[v];if(_!=null){if(!nr(_))throw new TypeError;return _}}function pa(m){var v=Li(m,s);if(!nr(v))throw new TypeError;var _=v.call(m);if(!ge(_))throw new TypeError;return _}function ya(m){return m.value}function ma(m){var v=m.next();return v.done?!1:v}function wa(m){var v=m.return;v&&v.call(m)}function Nr(m){var v=Object.getPrototypeOf(m);if(typeof m!="function"||m===u||v!==u)return v;var _=m.prototype,A=_&&Object.getPrototypeOf(_);if(A==null||A===Object.prototype)return v;var P=A.constructor;return typeof P!="function"||P===m?v:P}function ga(){var m={},v=[],_=function(){function L(j,R,$){this._index=0,this._keys=j,this._values=R,this._selector=$}return L.prototype["@@iterator"]=function(){return this},L.prototype[s]=function(){return this},L.prototype.next=function(){var j=this._index;if(j>=0&&j<this._keys.length){var R=this._selector(this._keys[j],this._values[j]);return j+1>=this._keys.length?(this._index=-1,this._keys=v,this._values=v):this._index++,{value:R,done:!1}}return{value:void 0,done:!0}},L.prototype.throw=function(j){throw this._index>=0&&(this._index=-1,this._keys=v,this._values=v),j},L.prototype.return=function(j){return this._index>=0&&(this._index=-1,this._keys=v,this._values=v),{value:j,done:!0}},L}();return function(){function L(){this._keys=[],this._values=[],this._cacheKey=m,this._cacheIndex=-2}return Object.defineProperty(L.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),L.prototype.has=function(j){return this._find(j,!1)>=0},L.prototype.get=function(j){var R=this._find(j,!1);return R>=0?this._values[R]:void 0},L.prototype.set=function(j,R){var $=this._find(j,!0);return this._values[$]=R,this},L.prototype.delete=function(j){var R=this._find(j,!1);if(R>=0){for(var $=this._keys.length,x=R+1;x<$;x++)this._keys[x-1]=this._keys[x],this._values[x-1]=this._values[x];return this._keys.length--,this._values.length--,j===this._cacheKey&&(this._cacheKey=m,this._cacheIndex=-2),!0}return!1},L.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=m,this._cacheIndex=-2},L.prototype.keys=function(){return new _(this._keys,this._values,A)},L.prototype.values=function(){return new _(this._keys,this._values,P)},L.prototype.entries=function(){return new _(this._keys,this._values,Ae)},L.prototype["@@iterator"]=function(){return this.entries()},L.prototype[s]=function(){return this.entries()},L.prototype._find=function(j,R){return this._cacheKey!==j&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=j)),this._cacheIndex<0&&R&&(this._cacheIndex=this._keys.length,this._keys.push(j),this._values.push(void 0)),this._cacheIndex},L}();function A(L,j){return L}function P(L,j){return j}function Ae(L,j){return[L,j]}}function ba(){return function(){function m(){this._map=new h}return Object.defineProperty(m.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),m.prototype.has=function(v){return this._map.has(v)},m.prototype.add=function(v){return this._map.set(v,v),this},m.prototype.delete=function(v){return this._map.delete(v)},m.prototype.clear=function(){this._map.clear()},m.prototype.keys=function(){return this._map.keys()},m.prototype.values=function(){return this._map.values()},m.prototype.entries=function(){return this._map.entries()},m.prototype["@@iterator"]=function(){return this.keys()},m.prototype[s]=function(){return this.keys()},m}()}function va(){var m=16,v=f.create(),_=A();return function(){function R(){this._key=A()}return R.prototype.has=function($){var x=P($,!1);return x!==void 0?f.has(x,this._key):!1},R.prototype.get=function($){var x=P($,!1);return x!==void 0?f.get(x,this._key):void 0},R.prototype.set=function($,x){var Ke=P($,!0);return Ke[this._key]=x,this},R.prototype.delete=function($){var x=P($,!1);return x!==void 0?delete x[this._key]:!1},R.prototype.clear=function(){this._key=A()},R}();function A(){var R;do R="@@WeakMap@@"+j();while(f.has(v,R));return v[R]=!0,R}function P(R,$){if(!t.call(R,_)){if(!$)return;Object.defineProperty(R,_,{value:f.create()})}return R[_]}function Ae(R,$){for(var x=0;x<$;++x)R[x]=Math.random()*255|0;return R}function L(R){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(R)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(R)):Ae(new Uint8Array(R),R):Ae(new Array(R),R)}function j(){var R=L(m);R[6]=R[6]&79|64,R[8]=R[8]&191|128;for(var $="",x=0;x<m;++x){var Ke=R[x];(x===4||x===6||x===8)&&($+="-"),Ke<16&&($+="0"),$+=Ke.toString(16).toLowerCase()}return $}}function Br(m){return m.__=void 0,delete m.__,m}})})(pn||(pn={}));const Sr=class Sr{constructor(e,t,r){d(this,"actionUrl");d(this,"queue");d(this,"allowed");d(this,"doWork");this.actionUrl=e,this.queue=t,this.allowed=r}async run(e,t,r){t===void 0&&(t=_e.apiClient.url),r||(r=Ct(_e.apiClient.httpClient));let n=await r.post(t+"/"+this.actionUrl,e),s=n;if(s&&s.queuedJobId){let a=C.actionInfo.startBusyWithProgress();try{let o;if(await C.actionInfo.runActionWithoutBlockingUI(async()=>{for(;!o||!o.done;)o&&await new Promise(l=>setTimeout(()=>{l(void 0)},200)),o=await r.post(t+"/"+Sr.apiUrlForJobStatus,{queuedJobId:n.queuedJobId}),o.progress&&a.progress(o.progress)}),o.error)throw o.error;return a.progress(1),o.result}finally{a.close()}}else return n}__register(e){e(this.actionUrl,this.queue,this.allowed,async(t,r,n)=>{try{var s=await this.execute(t,r,n);n.success(s)}catch(a){a.isForbiddenError?n.forbidden():n.error(a,void 0)}})}};d(Sr,"apiUrlForJobStatus","jobStatusInQueue");let xt=Sr;class fi extends Error{constructor(t="Forbidden"){super(t);d(this,"isForbiddenError",!0)}}class al extends xt{constructor(t,r,n,s){super(t,n.queue??!1,n.allowed);d(this,"types");d(this,"options");d(this,"originalMethod");this.types=r,this.options=n,this.originalMethod=s}async execute(t,r,n){let s={data:{}},a=r.dataProvider;return await Rs(r,this.options,async()=>{if(!r.isAllowedForInstance(void 0,this.options.allowed))throw new fi;t.args=await Ds(this.types(),t.args,r,a,n);try{s.data=await this.originalMethod(t.args)}catch(o){throw o}}),s}}function We(i){return(e,t,r)=>{const n=typeof t=="string"?t:t.name.toString(),s=r?r.value:e;let a=s;Ts(e);function o(){var u=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:paramtypes",e,n):[];return i.paramTypes&&(u=typeof i.paramTypes=="function"?i.paramTypes():i.paramTypes),u}if(e.prototype!==void 0){let u=new al((i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+n,()=>o(),i,c=>s.apply(void 0,c));return u.doWork=async(c,h,p,y)=>(c=wn(o(),c),i.blockUser===!1?await C.actionInfo.runActionWithoutBlockingUI(async()=>(await u.run({args:c},p,y)).data):(await u.run({args:c},p,y)).data),a=async function(...c){return Ht()?await s.apply(this,c):await u.doWork(c,void 0)},yn(e,a),a[oi]=u,r?(r.value=a,r):a}let l=C.classHelpers.get(e.constructor);l||(l=new Mn,C.classHelpers.set(e.constructor,l));let f={__register(u){let c=new qe;for(const h of l.classes.keys()){let p=l.classes.get(h);p.key||(p.key=c.repo(h).metadata.key),u(p.key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+n,i?i.queue??!1:!1,i.allowed,async(y,g,w)=>{y.args=y.args.map(I=>Ps(I)?void 0:I);let O=i.allowed;try{let I=g,S;await Rs(I,i,async()=>{if(y.args=await Ds(o(),y.args,I,I.dataProvider,w),C.allEntities.includes(h)){let B=I.repo(h),T;const H=y.rowInfo;if(H.isNewRow)T=B.create(),await B.getEntityRef(T)._updateEntityBasedOnApi(H.data);else{let ue=await B.find({where:{...B.metadata.idMetadata.getIdFilter(H.id),$and:[B.metadata.options.apiPrefilter??{}]}});if(ue.length!=1)throw new Error("not found or too many matches");T=ue[0],await B.getEntityRef(T)._updateEntityBasedOnApi(H.data)}if(!I.isAllowedForInstance(T,O))throw new fi;let ae=ee(T);await ae.__validateEntity();try{S={result:await s.apply(T,y.args),rowInfo:{data:await ae.toApiJson(),isNewRow:ae.isNew(),wasChanged:ae.wasChanged(),id:ae.getOriginalId()}}}catch(ue){throw ae.catchSaveErrors(ue)}}else{let B=new h(I,I.dataProvider),T=sn(B,I);if(await T._updateEntityBasedOnApi(y.fields),!I.isAllowedForInstance(B,O))throw new fi;await T.__validateEntity();try{S={result:await s.apply(B,y.args),fields:await T.toApiJson()}}catch(H){throw T.catchSaveErrors(H)}}}),w.success(S)}catch(I){I.isForbiddenError?w.forbidden():w.error(I,void 0)}})}},doWork:async function(u,c,h,p){if(u=wn(o(),u),C.allEntities.includes(e.constructor)){let y=ee(c);await y.__validateEntity();let g=l.classes.get(c.constructor);g.key||(g.key=y.repository.metadata.key+"_methods");try{let w=await new class extends xt{constructor(){super(...arguments);d(this,"execute")}}(g.key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+n,(i==null?void 0:i.queue)??!1,i.allowed).run({args:u,rowInfo:{data:await y.toApiJson(),isNewRow:y.isNew(),wasChanged:y.wasChanged(),id:y.getOriginalId()}},h,p);return await y._updateEntityBasedOnApi(w.rowInfo.data,!0),w.result}catch(w){throw y.catchSaveErrors(w)}}else{let y=sn(c,void 0);try{await y.__validateEntity();let g=await new class extends xt{constructor(){super(...arguments);d(this,"execute")}}(l.classes.get(c.constructor).key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+n,(i==null?void 0:i.queue)??!1,i.allowed).run({args:u,fields:await y.toApiJson()},h,p);return await y._updateEntityBasedOnApi(g.fields),g.result}catch(g){throw y.catchSaveErrors(g)}}}};return a=async function(...u){let c=this;return Ht()?await s.apply(c,u):f.doWork(u,c)},yn(e.constructor,a),a[oi]=f,r?(r.value=a,r):a}}const ol={_isUndefined:!0};function yn(i,e){(i[gn]||(i[gn]=[])).push(e),C.actionInfo.allActions.push(e)}function Ps(i){return i&&i._isUndefined}class mn{constructor(e){d(this,"res");this.res=e}progress(e){this.res.progress(e)}}function wn(i,e){if(i)for(let t=0;t<i.length;t++){const r=i[t];for(const n of[qe,Et])(e[t]instanceof n||r==n)&&(e[t]=void 0);if(e[t]!=null){let n={valueType:r};if(n=Fi(n,new qe),Ee(r,!1)!=null){let a=ee(e[t]);e[t]=a.getId()}n.valueConverter&&(e[t]=n.valueConverter.toJson(e[t]))}}return e.map(t=>t!==void 0?t:ol)}async function Ds(i,e,t,r,n){for(let s=0;s<e.length;s++){const a=e[s];Ps(a)&&(e[s]=void 0)}if(i)for(let s=0;s<i.length;s++)if(e.length<s&&e.push(void 0),i[s]==qe||i[s]==qe)e[s]=t;else if(i[s]==Et&&r)e[s]=r;else if(i[s]==mn)e[s]=new mn(n);else{let a={valueType:i[s]};a=Fi(a,t),a.valueConverter&&(e[s]=a.valueConverter.fromJson(e[s])),Ee(i[s],!1)!=null&&(e[s]===null||e[s]===void 0||(e[s]=await t.repo(i[s]).findId(e[s])))}return e}const gn=Symbol.for("classBackendMethodsArray");async function Rs(i,e,t){if(e.transactional===void 0||e.transactional===!0)return await vo(i,t);await t(i.dataProvider)}function Ms(i,e){return _e.repo(i,e)}function Dr(i){return i}class ll{constructor(e,t){d(this,"id");d(this,"caption");d(this,"icon");d(this,"where");d(this,"class");d(this,"hide");this.id=e.toString(),this.caption=(t==null?void 0:t.caption)??this.id,this.icon=t==null?void 0:t.icon,this.where=t==null?void 0:t.where,this.class=t==null?void 0:t.class,this.hide=t==null?void 0:t.hide,t!=null&&t.icon&&t.icon.caption===void 0&&(t.icon.caption=t==null?void 0:t.caption)}}var ul=Object.defineProperty,fl=Object.getOwnPropertyDescriptor,Qe=(i,e,t,r)=>{for(var n=r>1?void 0:r?fl(e,t):e,s=i.length-1,a;s>=0;s--)(a=i[s])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&ul(e,t,n),n};let Re=class{constructor(){d(this,"id","");d(this,"entity","");d(this,"entityId","");d(this,"changeDate",new Date);d(this,"userId","");d(this,"changes",[]);d(this,"newRow",!1);d(this,"deleted",!1)}};Qe([X.cuid()],Re.prototype,"id",2);Qe([X.string()],Re.prototype,"entity",2);Qe([X.string()],Re.prototype,"entityId",2);Qe([X.date()],Re.prototype,"changeDate",2);Qe([X.string()],Re.prototype,"userId",2);Qe([X.json({dbName:"changesJson"})],Re.prototype,"changes",2);Qe([X.boolean()],Re.prototype,"newRow",2);Qe([X.boolean()],Re.prototype,"deleted",2);Re=Qe([$n("_ff_change_logs",{caption:"FF Change Logs",allowApiCrud:!1,defaultOrderBy:{changeDate:"desc"}})],Re);async function cl(i,e,t){var r;if(Ht()){const n=[],s=new Ns(i,t),a=(t==null?void 0:t.forceNew)||e.isNew,o=(t==null?void 0:t.forceDate)||new Date;for(const l of s.fields.filter(f=>f.valueChanged()||a&&f.value))try{const f=s.excludedValues.includes(l);n.push({key:l.metadata.key,newValue:f?"***":l.value instanceof Ar?l.value.id:l.metadata.options.valueConverter.toJson(l.value),oldValue:e.isNew?"---":f?"***":l.originalValue instanceof Ar?l.originalValue.id:l.metadata.options.valueConverter.toJson(l.originalValue)})}catch(f){throw console.error(l),f}n.length>0&&await Ms(Re).insert({changeDate:o,changes:n,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(i),userId:((r=_e.user)==null?void 0:r.id)||"",newRow:a})}}async function dl(i,e,t){var a;const r=[],n=new Ns(i,t),s=(t==null?void 0:t.forceDate)||new Date;for(const o of n.fields)try{const l=n.excludedValues.includes(o);r.push({key:o.metadata.key,newValue:l?"***":"---",oldValue:l?"***":o.originalValue instanceof Ar?o.originalValue.id:o.metadata.options.valueConverter.toJson(o.originalValue)})}catch(l){throw console.error(o),l}await Ms(Re).insert({changeDate:s,changes:r,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(i),userId:((a=_e.user)==null?void 0:a.id)||"",deleted:!0})}class Ns{constructor(e,t){d(this,"fields");d(this,"excludedFields");d(this,"excludedValues");const r=ee(e);t!=null&&t.excludeColumns?this.excludedFields=t.excludeColumns(r.fields):this.excludedFields=[],t!=null&&t.excludeValues?this.excludedValues=t.excludeValues(r.fields):this.excludedValues=[],this.excludedFields.push(...r.fields.toArray().filter(n=>n.metadata.options.serverExpression)),this.excludedFields.push(...r.fields.toArray().filter(n=>n.metadata.options.sqlExpression)),this.fields=r.fields.toArray().filter(n=>!this.excludedFields.includes(n))}}const Mt=i=>{if(i)return Array.isArray(i)?i.map(e=>e.id):i.id};function Ri(i,e){return $n(i,{...e,allowApiCrud:e.allowApiCrud??Mt(e.permissionApiCrud),allowApiDelete:e.allowApiDelete??Mt(e.permissionApiDelete),allowApiInsert:e.allowApiInsert??Mt(e.permissionApiInsert),allowApiRead:e.allowApiRead??Mt(e.permissionApiRead),allowApiUpdate:e.allowApiUpdate??Mt(e.permissionApiUpdate),saved:async(t,r)=>{var n;await((n=e==null?void 0:e.saved)==null?void 0:n.call(e,t,r)),e.changeLog===!1||Ht()&&await cl(t,r,e.changeLog)},deleted:async(t,r)=>{var n;await((n=e==null?void 0:e.deleted)==null?void 0:n.call(e,t,r)),e.changeLog===!1||Ht()&&await dl(t,r,e.changeLog)}})}const Mi={FF_Role_Admin:"FF_Role.Admin"};var Bs=Object.defineProperty,hl=Object.getOwnPropertyDescriptor,pl=(i,e,t)=>e in i?Bs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ne=(i,e,t,r)=>{for(var n=r>1?void 0:r?hl(e,t):e,s=i.length-1,a;s>=0;s--)(a=i[s])&&(n=(r?a(e,t,n):a(n))||n);return r&&n&&Bs(e,t,n),n},Rr=(i,e,t)=>pl(i,typeof e!="symbol"?e+"":e,t);const Mr={FF_Role_Auth_Admin:"FF_Role_Auth.Admin",FF_Role_Auth_Invite:"FF_Role_Auth.Invite"};let je=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"identifier");d(this,"roles",[]);d(this,"accounts");d(this,"sessions")}};ne([X.cuid()],je.prototype,"id",2);ne([X.createdAt()],je.prototype,"createdAt",2);ne([X.updatedAt()],je.prototype,"updatedAt",2);ne([X.string({validate:[De.unique(),De.required(),i=>{var e;if(((e=i.identifier)==null?void 0:e.length)<2)throw"Must be at least 2 characters long"}]})],je.prototype,"identifier",2);ne([X.json(()=>[],{inputType:"selectEnum",valueConverter:{toDb:i=>i?i.join(","):[],fromDb:i=>i?i.split(",").map(e=>e.replace("{","").replace("}","")).filter(e=>e!==""):[]}})],je.prototype,"roles",2);ne([Pr.toMany(()=>Fe,"userId")],je.prototype,"accounts",2);ne([Pr.toMany(()=>dt,"userId")],je.prototype,"sessions",2);je=ne([Ri("ff_auth.users",{allowApiCrud:[Mr.FF_Role_Auth_Admin,Mi.FF_Role_Admin],caption:"FF Auth - Users"})],je);let Fe=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"userId");d(this,"user");d(this,"provider",Je.PASSWORD.id);d(this,"providerUserId","");d(this,"hashPassword");d(this,"token");d(this,"expiresAt");d(this,"lastVerifiedAt")}};ne([X.cuid()],Fe.prototype,"id",2);ne([X.createdAt()],Fe.prototype,"createdAt",2);ne([X.updatedAt()],Fe.prototype,"updatedAt",2);ne([X.string()],Fe.prototype,"userId",2);ne([Pr.toOne(()=>je,"userId")],Fe.prototype,"user",2);ne([X.string()],Fe.prototype,"provider",2);ne([X.string()],Fe.prototype,"providerUserId",2);ne([X.string({includeInApi:!1,allowNull:!0})],Fe.prototype,"hashPassword",2);ne([X.string({includeInApi:!1,allowNull:!0})],Fe.prototype,"token",2);ne([X.date({includeInApi:!1,allowNull:!0})],Fe.prototype,"expiresAt",2);ne([X.date({includeInApi:!1,allowNull:!0})],Fe.prototype,"lastVerifiedAt",2);Fe=ne([Ri("ff_auth.accounts",{allowApiCrud:[Mr.FF_Role_Auth_Admin,Mi.FF_Role_Admin],caption:"FF Auth - Accounts",changeLog:{excludeColumns:i=>[i.hashPassword,i.token]}})],Fe);let dt=class{constructor(){d(this,"id");d(this,"expiresAt");d(this,"userId");d(this,"user")}};ne([X.string()],dt.prototype,"id",2);ne([X.date()],dt.prototype,"expiresAt",2);ne([X.string()],dt.prototype,"userId",2);ne([Pr.toOne(()=>je,"userId")],dt.prototype,"user",2);dt=ne([Ri("ff_auth.users_sessions",{allowApiCrud:[Mr.FF_Role_Auth_Admin,Mi.FF_Role_Admin],caption:"FF Auth - Users sessions",changeLog:!1})],dt);let Je=class extends ll{constructor(i,e){super(i,{...e})}};Rr(Je,"DEMO",new Je("DEMO",{caption:"Demo"}));Rr(Je,"PASSWORD",new Je("PASSWORD",{caption:"Password"}));Rr(Je,"OTP",new Je("OTP",{caption:"TOTP"}));Rr(Je,"OAUTH",new Je("OAUTH",{caption:"OAUTH"}));Je=ne([Mo()],Je);var yl=Object.defineProperty,ml=Object.getOwnPropertyDescriptor,He=(i,e,t,r)=>{for(var n=ml(e,t),s=i.length-1,a;s>=0;s--)(a=i[s])&&(n=a(e,t,n)||n);return n&&yl(e,t,n),n},se,Gt,Qt,zt,Kt,Xt,Zt,Yt,er,tr,rr;const Ue=(se=class{static _setAbstraction(e){Le(this,Gt,e.signOut),Le(this,Qt,e.signInDemo),Le(this,zt,e.invite),Le(this,Kt,e.signUpPassword),Le(this,Xt,e.signInPassword),Le(this,Zt,e.forgotPassword),Le(this,Yt,e.resetPassword),Le(this,er,e.signInOTP),Le(this,tr,e.verifyOtp),Le(this,rr,e.signInOAuthGetUrl)}static async signOut(){var e;return await Ne(e=se,Gt).call(e)}static async signInDemo(e){var t;return await Ne(t=se,Qt).call(t,e)}static async invite(e){var t;return await Ne(t=se,zt).call(t,e)}static async signUpPassword(e,t){var r;return await Ne(r=se,Kt).call(r,e,t)}static async signInPassword(e,t){var r;return await Ne(r=se,Xt).call(r,e,t)}static async forgotPassword(e){var t;return await Ne(t=se,Zt).call(t,e)}static async resetPassword(e,t){var r;return await Ne(r=se,Yt).call(r,e,t)}static async signInOTP(e){var t;return await Ne(t=se,er).call(t,e)}static async verifyOtp(e,t){var r;return await Ne(r=se,tr).call(r,e,t)}static async signInOAuthGetUrl(e){var t;return await Ne(t=se,rr).call(t,e)}},Gt=new WeakMap,Qt=new WeakMap,zt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Zt=new WeakMap,Yt=new WeakMap,er=new WeakMap,tr=new WeakMap,rr=new WeakMap,Be(se,Gt),Be(se,Qt),Be(se,zt),Be(se,Kt),Be(se,Xt),Be(se,Zt),Be(se,Yt),Be(se,er),Be(se,tr),Be(se,rr),se);He([We({allowed:!0})],Ue,"signOut");He([We({allowed:!0})],Ue,"signInDemo");He([We({allowed:Mr.FF_Role_Auth_Invite})],Ue,"invite");He([We({allowed:!0})],Ue,"signUpPassword");He([We({allowed:!0})],Ue,"signInPassword");He([We({allowed:!0})],Ue,"forgotPassword");He([We({allowed:!0})],Ue,"resetPassword");He([We({allowed:!0})],Ue,"signInOTP");He([We({allowed:!0})],Ue,"verifyOtp");He([We({allowed:!0})],Ue,"signInOAuthGetUrl");let et=Ue;function Dt(i){i.focus()}const Nt="src/lib/modules/auth/components/ForgotPassword.svelte";function ci(i){var w;let e,t,r,n,s,a,o,l,f,u,c=((w=i[1].ui)==null?void 0:w.strings.send_password_reset_instructions)+"",h,p,y;const g={c:function(){var I;e=J("div"),t=J("p"),r=oe(i[2]),n=oe(i[3]),s=K(),a=J("form"),o=J("input"),f=K(),u=J("button"),h=oe(c),W(t,"class","message"),Ye(t,"error",i[2]),U(t,Nt,28,2,541),W(o,"type","text"),W(o,"placeholder",l=(I=i[1].ui)==null?void 0:I.strings.email_placeholder),U(o,Nt,30,4,657),U(u,Nt,36,4,804),W(a,"class","svelte-wa5ykb"),U(a,Nt,29,2,612),W(e,"class","login"),U(e,Nt,27,0,519)},l:function(I){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(I,S){G(I,e,S),E(e,t),E(t,r),E(t,n),E(e,s),E(e,a),E(a,o),Se(o,i[0]),E(a,f),E(a,u),E(u,h),p||(y=[Cr(Dt.call(null,o)),Pe(o,"input",i[5]),Pe(a,"submit",Er(i[4]),!1,!0,!1,!1)],p=!0)},p:function(I,[S]){var B,T;S&4&&we(r,I[2]),S&4&&Ye(t,"error",I[2]),S&2&&l!==(l=(B=I[1].ui)==null?void 0:B.strings.email_placeholder)&&W(o,"placeholder",l),S&1&&o.value!==I[0]&&Se(o,I[0]),S&2&&c!==(c=((T=I[1].ui)==null?void 0:T.strings.send_password_reset_instructions)+"")&&we(h,c)},i:fe,o:fe,d:function(I){I&&Q(e),p=!1,Ft(y)}};return V("SvelteRegisterBlock",{block:g,id:ci.name,type:"component",source:"",ctx:i}),g}function wl(i,e,t){let{$$slots:r={},$$scope:n}=e;yt("ForgotPassword",r,[]);let{firstlyDataAuth:s}=e,{email:a=""}=e,o="",l="";async function f(){try{await et.forgotPassword(a),window.location.href="/ff/auth/sign-in"}catch(h){h&&t(2,o=h.message??"")}}i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<ForgotPassword> was created without expected prop 'firstlyDataAuth'")});const u=["firstlyDataAuth","email"];Object.keys(e).forEach(h=>{!~u.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<ForgotPassword> was created with unknown prop '${h}'`)});function c(){a=this.value,t(0,a)}return i.$$set=h=>{"firstlyDataAuth"in h&&t(1,s=h.firstlyDataAuth),"email"in h&&t(0,a=h.email)},i.$capture_state=()=>({isError:Dr,AuthController:et,autofocus:Dt,firstlyDataAuth:s,email:a,msgError:o,msgSuccess:l,forgot:f}),i.$inject_state=h=>{"firstlyDataAuth"in h&&t(1,s=h.firstlyDataAuth),"email"in h&&t(0,a=h.email),"msgError"in h&&t(2,o=h.msgError),"msgSuccess"in h&&t(3,l=h.msgSuccess)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[a,s,o,l,f,c]}class Ls extends ht{constructor(e){super(e),pt(this,e,wl,ci,Tt,{firstlyDataAuth:1,email:0}),V("SvelteRegisterComponent",{component:this,tagName:"ForgotPassword",options:e,id:ci.name})}get firstlyDataAuth(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const _t="src/lib/modules/auth/components/ResetPassword.svelte";function di(i){var ae,ue,ve;let e,t,r,n,s,a,o=((ae=i[2].ui)==null?void 0:ae.strings.password)+"",l,f,u,c,h=((ue=i[2].ui)==null?void 0:ue.strings.confirm)+"",p,y,g,w,O,I=((ve=i[2].ui)==null?void 0:ve.strings.reset)+"",S,B,T;const H={c:function(){e=J("div"),t=J("p"),r=oe(i[3]),n=oe(i[4]),s=K(),a=J("form"),l=oe(o),f=K(),u=J("input"),c=K(),p=oe(h),y=K(),g=J("input"),w=K(),O=J("button"),S=oe(I),W(t,"class","message"),Ye(t,"error",i[3]),U(t,_t,29,2,634),W(u,"type","password"),U(u,_t,32,4,792),W(g,"type","password"),U(g,_t,34,4,887),U(O,_t,35,4,940),W(a,"class","svelte-wa5ykb"),U(a,_t,30,2,705),W(e,"class","login"),U(e,_t,28,0,612)},l:function(Z){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(Z,b){G(Z,e,b),E(e,t),E(t,r),E(t,n),E(e,s),E(e,a),E(a,l),E(a,f),E(a,u),Se(u,i[0]),E(a,c),E(a,p),E(a,y),E(a,g),Se(g,i[1]),E(a,w),E(a,O),E(O,S),B||(T=[Pe(u,"input",i[6]),Pe(g,"input",i[7]),Pe(a,"submit",Er(i[5]),!1,!0,!1,!1)],B=!0)},p:function(Z,[b]){var k,F,M;b&8&&we(r,Z[3]),b&16&&we(n,Z[4]),b&8&&Ye(t,"error",Z[3]),b&4&&o!==(o=((k=Z[2].ui)==null?void 0:k.strings.password)+"")&&we(l,o),b&1&&u.value!==Z[0]&&Se(u,Z[0]),b&4&&h!==(h=((F=Z[2].ui)==null?void 0:F.strings.confirm)+"")&&we(p,h),b&2&&g.value!==Z[1]&&Se(g,Z[1]),b&4&&I!==(I=((M=Z[2].ui)==null?void 0:M.strings.reset)+"")&&we(S,I)},i:fe,o:fe,d:function(Z){Z&&Q(e),B=!1,Ft(T)}};return V("SvelteRegisterBlock",{block:H,id:di.name,type:"component",source:"",ctx:i}),H}function gl(i,e,t){let{$$slots:r={},$$scope:n}=e;yt("ResetPassword",r,[]);let{firstlyDataAuth:s}=e,{password1:a=""}=e,{password2:o=""}=e,l="",f="";async function u(){t(3,l=""),t(4,f="");const y=new URL(location.href).searchParams.get("token");try{await et.resetPassword(y??"",a),window.location.href="/"}catch(g){g&&t(3,l=g.message??"")}}i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<ResetPassword> was created without expected prop 'firstlyDataAuth'")});const c=["firstlyDataAuth","password1","password2"];Object.keys(e).forEach(y=>{!~c.indexOf(y)&&y.slice(0,2)!=="$$"&&y!=="slot"&&console.warn(`<ResetPassword> was created with unknown prop '${y}'`)});function h(){a=this.value,t(0,a)}function p(){o=this.value,t(1,o)}return i.$$set=y=>{"firstlyDataAuth"in y&&t(2,s=y.firstlyDataAuth),"password1"in y&&t(0,a=y.password1),"password2"in y&&t(1,o=y.password2)},i.$capture_state=()=>({isError:Dr,AuthController:et,firstlyDataAuth:s,password1:a,password2:o,msgError:l,msgSuccess:f,reset:u}),i.$inject_state=y=>{"firstlyDataAuth"in y&&t(2,s=y.firstlyDataAuth),"password1"in y&&t(0,a=y.password1),"password2"in y&&t(1,o=y.password2),"msgError"in y&&t(3,l=y.msgError),"msgSuccess"in y&&t(4,f=y.msgSuccess)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[a,o,s,l,f,u,h,p]}class qs extends ht{constructor(e){super(e),pt(this,e,gl,di,Tt,{firstlyDataAuth:2,password1:0,password2:1}),V("SvelteRegisterComponent",{component:this,tagName:"ResetPassword",options:e,id:di.name})}get firstlyDataAuth(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password1(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password1(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password2(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password2(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:at}=gi,nt="src/lib/modules/auth/components/SignIn.svelte";function hi(i){var ve,pe,Z;let e,t,r,n,s,a,o=((ve=i[1].ui)==null?void 0:ve.strings.email)+"",l,f,u,c,h,p,y=((pe=i[1].ui)==null?void 0:pe.strings.password)+"",g,w,O,I,S,B=((Z=i[1].ui)==null?void 0:Z.strings.btn_sign_in)+"",T,H,ae;const ue={c:function(){var k;e=J("form"),t=J("p"),r=oe(i[3]),n=oe(i[4]),s=K(),a=J("label"),l=oe(o),f=K(),u=J("input"),h=K(),p=J("label"),g=oe(y),w=K(),O=J("input"),I=K(),S=J("button"),T=oe(B),W(t,"class","message svelte-1rtdg09"),Ye(t,"error",i[3]),U(t,nt,38,4,731),W(u,"type","text"),W(u,"placeholder",c=(k=i[1].ui)==null?void 0:k.strings.email_placeholder),U(u,nt,41,6,860),U(a,nt,39,4,804),W(O,"type","password"),U(O,nt,50,6,1089),U(p,nt,48,4,1030),U(S,nt,52,4,1154),W(e,"class","svelte-1rtdg09"),U(e,nt,37,2,686)},m:function(k,F){G(k,e,F),E(e,t),E(t,r),E(t,n),E(e,s),E(e,a),E(a,l),E(a,f),E(a,u),Se(u,i[0]),E(e,h),E(e,p),E(p,g),E(p,w),E(p,O),Se(O,i[5]),E(e,I),E(e,S),E(S,T),H||(ae=[Pe(u,"input",i[7]),Cr(Dt.call(null,u)),Pe(O,"input",i[8]),Pe(e,"submit",Er(i[6]),!1,!0,!1,!1)],H=!0)},p:function(k,F){var M,te,le,Me;F&8&&we(r,k[3]),F&16&&we(n,k[4]),F&8&&Ye(t,"error",k[3]),F&2&&o!==(o=((M=k[1].ui)==null?void 0:M.strings.email)+"")&&we(l,o),F&2&&c!==(c=(te=k[1].ui)==null?void 0:te.strings.email_placeholder)&&W(u,"placeholder",c),F&1&&u.value!==k[0]&&Se(u,k[0]),F&2&&y!==(y=((le=k[1].ui)==null?void 0:le.strings.password)+"")&&we(g,y),F&32&&O.value!==k[5]&&Se(O,k[5]),F&2&&B!==(B=((Me=k[1].ui)==null?void 0:Me.strings.btn_sign_in)+"")&&we(T,B)},d:function(k){k&&Q(e),H=!1,Ft(ae)}};return V("SvelteRegisterBlock",{block:ue,id:hi.name,type:"if",source:"(27:0) {#if view == 'login'}",ctx:i}),ue}function pi(i){let e,t=i[2]=="login"&&hi(i);const r={c:function(){t&&t.c(),e=bi()},l:function(s){throw new at("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,a){t&&t.m(s,a),G(s,e,a)},p:function(s,[a]){s[2]=="login"?t?t.p(s,a):(t=hi(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:fe,o:fe,d:function(s){s&&Q(e),t&&t.d(s)}};return V("SvelteRegisterBlock",{block:r,id:pi.name,type:"component",source:"",ctx:i}),r}function bl(i,e,t){let{$$slots:r={},$$scope:n}=e;yt("SignIn",r,[]);let{firstlyDataAuth:s}=e,{view:a="login"}=e,{email:o=""}=e,l="",f="",u;async function c(){t(3,l=""),t(4,f="");try{await et.signInPassword(o,u),window.location.href="/"}catch(w){w&&t(3,l=w.message??"")}}const h=()=>{throw new Error("Not impl yet")};i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<SignIn> was created without expected prop 'firstlyDataAuth'")});const p=["firstlyDataAuth","view","email"];Object.keys(e).forEach(w=>{!~p.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignIn> was created with unknown prop '${w}'`)});function y(){o=this.value,t(0,o)}function g(){u=this.value,t(5,u)}return i.$$set=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email)},i.$capture_state=()=>({AuthController:et,isError:Dr,autofocus:Dt,firstlyDataAuth:s,view:a,email:o,msgError:l,msgSuccess:f,password:u,signIn:c,handlePin:h}),i.$inject_state=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,f=w.msgSuccess),"password"in w&&t(5,u=w.password)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[o,s,a,l,f,u,c,y,g]}class js extends ht{constructor(e){super(e),pt(this,e,bl,pi,Tt,{firstlyDataAuth:1,view:2,email:0}),V("SvelteRegisterComponent",{component:this,tagName:"SignIn",options:e,id:pi.name})}get firstlyDataAuth(){throw new at("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new at("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new at("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new at("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new at("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new at("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:ot}=gi,st="src/lib/modules/auth/components/SignUp.svelte";function yi(i){var pe,Z,b;let e,t,r,n,s,a,o=((pe=i[1].ui)==null?void 0:pe.strings.email)+"",l,f,u,c,h,p,y=((Z=i[1].ui)==null?void 0:Z.strings.password)+"",g,w,O,I,S,B,T=((b=i[1].ui)==null?void 0:b.strings.btn_sign_up)+"",H,ae,ue;const ve={c:function(){var F,M;e=J("form"),t=J("p"),r=oe(i[3]),n=oe(i[4]),s=K(),a=J("label"),l=oe(o),f=K(),u=J("input"),h=K(),p=J("label"),g=oe(y),w=K(),O=J("input"),S=K(),B=J("button"),H=oe(T),W(t,"class","message svelte-1rtdg09"),Ye(t,"error",i[3]),U(t,st,38,4,731),W(u,"type","text"),W(u,"placeholder",c=(F=i[1].ui)==null?void 0:F.strings.email_placeholder),U(u,st,41,6,860),U(a,st,39,4,804),W(O,"type","password"),W(O,"placeholder",I=(M=i[1].ui)==null?void 0:M.strings.password_placeholder),U(O,st,50,6,1089),U(p,st,48,4,1030),U(B,st,56,4,1247),W(e,"class","svelte-1rtdg09"),U(e,st,37,2,686)},m:function(F,M){G(F,e,M),E(e,t),E(t,r),E(t,n),E(e,s),E(e,a),E(a,l),E(a,f),E(a,u),Se(u,i[0]),E(e,h),E(e,p),E(p,g),E(p,w),E(p,O),Se(O,i[5]),E(e,S),E(e,B),E(B,H),ae||(ue=[Pe(u,"input",i[7]),Cr(Dt.call(null,u)),Pe(O,"input",i[8]),Pe(e,"submit",Er(i[6]),!1,!0,!1,!1)],ae=!0)},p:function(F,M){var te,le,Me,ze,it;M&8&&we(r,F[3]),M&16&&we(n,F[4]),M&8&&Ye(t,"error",F[3]),M&2&&o!==(o=((te=F[1].ui)==null?void 0:te.strings.email)+"")&&we(l,o),M&2&&c!==(c=(le=F[1].ui)==null?void 0:le.strings.email_placeholder)&&W(u,"placeholder",c),M&1&&u.value!==F[0]&&Se(u,F[0]),M&2&&y!==(y=((Me=F[1].ui)==null?void 0:Me.strings.password)+"")&&we(g,y),M&2&&I!==(I=(ze=F[1].ui)==null?void 0:ze.strings.password_placeholder)&&W(O,"placeholder",I),M&32&&O.value!==F[5]&&Se(O,F[5]),M&2&&T!==(T=((it=F[1].ui)==null?void 0:it.strings.btn_sign_up)+"")&&we(H,T)},d:function(F){F&&Q(e),ae=!1,Ft(ue)}};return V("SvelteRegisterBlock",{block:ve,id:yi.name,type:"if",source:"(27:0) {#if view == 'login'}",ctx:i}),ve}function mi(i){let e,t=i[2]=="login"&&yi(i);const r={c:function(){t&&t.c(),e=bi()},l:function(s){throw new ot("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,a){t&&t.m(s,a),G(s,e,a)},p:function(s,[a]){s[2]=="login"?t?t.p(s,a):(t=yi(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:fe,o:fe,d:function(s){s&&Q(e),t&&t.d(s)}};return V("SvelteRegisterBlock",{block:r,id:mi.name,type:"component",source:"",ctx:i}),r}function vl(i,e,t){let{$$slots:r={},$$scope:n}=e;yt("SignUp",r,[]);let{firstlyDataAuth:s}=e,{view:a="login"}=e,{email:o=""}=e,l="",f="",u;async function c(){t(3,l=""),t(4,f="");try{await et.signUpPassword(o,u),window.location.href="/"}catch(w){w&&t(3,l=w.message??"")}}const h=()=>{throw new Error("Not impl yet")};i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<SignUp> was created without expected prop 'firstlyDataAuth'")});const p=["firstlyDataAuth","view","email"];Object.keys(e).forEach(w=>{!~p.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignUp> was created with unknown prop '${w}'`)});function y(){o=this.value,t(0,o)}function g(){u=this.value,t(5,u)}return i.$$set=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email)},i.$capture_state=()=>({AuthController:et,isError:Dr,autofocus:Dt,firstlyDataAuth:s,view:a,email:o,msgError:l,msgSuccess:f,password:u,signIn:c,handlePin:h}),i.$inject_state=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,f=w.msgSuccess),"password"in w&&t(5,u=w.password)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[o,s,a,l,f,u,c,y,g]}class Js extends ht{constructor(e){super(e),pt(this,e,vl,mi,Tt,{firstlyDataAuth:1,view:2,email:0}),V("SvelteRegisterComponent",{component:this,tagName:"SignUp",options:e,id:mi.name})}get firstlyDataAuth(){throw new ot("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new ot("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new ot("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new ot("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new ot("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new ot("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const Te="src/lib/modules/auth/Page.svelte";function Us(i){let e;const t={c:function(){e=J("h1"),e.textContent=`${i[1].ui.strings.app_name}`,W(e,"class","svelte-h55kwc"),U(e,Te,21,8,492)},m:function(n,s){G(n,e,s)},p:fe,d:function(n){n&&Q(e)}};return V("SvelteRegisterBlock",{block:t,id:Us.name,type:"if",source:"(14:6) {#if firstlyDataAuth.ui?.strings.app_name}",ctx:i}),t}function Vs(i){var n;let e,t;e=new mt({props:{path:(n=i[1].ui)==null?void 0:n.paths.sign_up,$$slots:{default:[$s]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(a,o){Ie(e,a,o),t=!0},p:function(a,o){const l={};o&65&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(z(e.$$.fragment,a),t=!0)},o:function(a){Y(e.$$.fragment,a),t=!1},d:function(a){Oe(e,a)}};return V("SvelteRegisterBlock",{block:r,id:Vs.name,type:"if",source:"(18:6) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),r}function Ws(i){let e,t;e=new Pt({props:{href:i[1].ui.paths.sign_in,$$slots:{default:[Hs]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(s,a){Ie(e,s,a),t=!0},p:function(s,a){const o={};a&64&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(z(e.$$.fragment,s),t=!0)},o:function(s){Y(e.$$.fragment,s),t=!1},d:function(s){Oe(e,s)}};return V("SvelteRegisterBlock",{block:r,id:Ws.name,type:"if",source:"(23:12) {#if firstlyDataAuth.ui.paths.sign_in}",ctx:i}),r}function Hs(i){let e=i[1].ui.strings.back_to_sign_in+"",t;const r={c:function(){t=oe(e)},m:function(s,a){G(s,t,a)},p:fe,d:function(s){s&&Q(t)}};return V("SvelteRegisterBlock",{block:r,id:Hs.name,type:"slot",source:"(24:14) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),r}function $s(i){let e,t,r,n,s;function a(u){i[3](u)}let o={firstlyDataAuth:i[1]};i[0]!==void 0&&(o.email=i[0]),e=new Js({props:o,$$inline:!0}),vi.push(()=>_i(e,"email",a));let l=i[1].ui.paths.sign_in&&Ws(i);const f={c:function(){ke(e.$$.fragment),r=K(),n=J("div"),l&&l.c(),W(n,"class","form-footer svelte-h55kwc"),U(n,Te,28,10,716)},m:function(c,h){Ie(e,c,h),G(c,r,h),G(c,n,h),l&&l.m(n,null),s=!0},p:function(c,h){const p={};!t&&h&1&&(t=!0,p.email=c[0],ki(()=>t=!1)),e.$set(p),c[1].ui.paths.sign_in&&l.p(c,h)},i:function(c){s||(z(e.$$.fragment,c),z(l),s=!0)},o:function(c){Y(e.$$.fragment,c),Y(l),s=!1},d:function(c){c&&(Q(r),Q(n)),Oe(e,c),l&&l.d()}};return V("SvelteRegisterBlock",{block:f,id:$s.name,type:"slot",source:"(19:8) <Route path={firstlyDataAuth.ui?.paths.sign_up}>",ctx:i}),f}function xs(i){var n;let e,t;e=new mt({props:{path:(n=i[1].ui)==null?void 0:n.paths.sign_in,$$slots:{default:[Xs]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(a,o){Ie(e,a,o),t=!0},p:function(a,o){const l={};o&65&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(z(e.$$.fragment,a),t=!0)},o:function(a){Y(e.$$.fragment,a),t=!1},d:function(a){Oe(e,a)}};return V("SvelteRegisterBlock",{block:r,id:xs.name,type:"if",source:"(32:6) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),r}function Gs(i){let e,t;e=new Pt({props:{href:i[1].ui.paths.forgot_password,$$slots:{default:[Qs]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(s,a){Ie(e,s,a),t=!0},p:function(s,a){const o={};a&64&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(z(e.$$.fragment,s),t=!0)},o:function(s){Y(e.$$.fragment,s),t=!1},d:function(s){Oe(e,s)}};return V("SvelteRegisterBlock",{block:r,id:Gs.name,type:"if",source:"(37:12) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),r}function Qs(i){let e=i[1].ui.strings.forgot_password+"",t;const r={c:function(){t=oe(e)},m:function(s,a){G(s,t,a)},p:fe,d:function(s){s&&Q(t)}};return V("SvelteRegisterBlock",{block:r,id:Qs.name,type:"slot",source:"(38:14) <Link href={firstlyDataAuth.ui.paths.forgot_password}>",ctx:i}),r}function zs(i){let e,t,r,n;r=new Pt({props:{href:i[1].ui.paths.sign_up,$$slots:{default:[Ks]},$$scope:{ctx:i}},$$inline:!0});const s={c:function(){e=J("hr"),t=K(),ke(r.$$.fragment),U(e,Te,49,14,1488)},m:function(o,l){G(o,e,l),G(o,t,l),Ie(r,o,l),n=!0},p:function(o,l){const f={};l&64&&(f.$$scope={dirty:l,ctx:o}),r.$set(f)},i:function(o){n||(z(r.$$.fragment,o),n=!0)},o:function(o){Y(r.$$.fragment,o),n=!1},d:function(o){o&&(Q(e),Q(t)),Oe(r,o)}};return V("SvelteRegisterBlock",{block:s,id:zs.name,type:"if",source:"(42:12) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),s}function Ks(i){let e=i[1].ui.strings.btn_sign_up+"",t;const r={c:function(){t=oe(e)},m:function(s,a){G(s,t,a)},p:fe,d:function(s){s&&Q(t)}};return V("SvelteRegisterBlock",{block:r,id:Ks.name,type:"slot",source:"(44:14) <Link href={firstlyDataAuth.ui.paths.sign_up}>",ctx:i}),r}function Xs(i){var h,p;let e,t,r,n,s,a;function o(y){i[4](y)}let l={firstlyDataAuth:i[1]};i[0]!==void 0&&(l.email=i[0]),e=new js({props:l,$$inline:!0}),vi.push(()=>_i(e,"email",o));let f=((h=i[1].ui)==null?void 0:h.paths.forgot_password)&&Gs(i),u=((p=i[1].ui)==null?void 0:p.paths.sign_up)&&zs(i);const c={c:function(){ke(e.$$.fragment),r=K(),n=J("div"),f&&f.c(),s=K(),u&&u.c(),W(n,"class","form-footer svelte-h55kwc"),U(n,Te,42,10,1166)},m:function(g,w){Ie(e,g,w),G(g,r,w),G(g,n,w),f&&f.m(n,null),E(n,s),u&&u.m(n,null),a=!0},p:function(g,w){var I,S;const O={};!t&&w&1&&(t=!0,O.email=g[0],ki(()=>t=!1)),e.$set(O),(I=g[1].ui)!=null&&I.paths.forgot_password&&f.p(g,w),(S=g[1].ui)!=null&&S.paths.sign_up&&u.p(g,w)},i:function(g){a||(z(e.$$.fragment,g),z(f),z(u),a=!0)},o:function(g){Y(e.$$.fragment,g),Y(f),Y(u),a=!1},d:function(g){g&&(Q(r),Q(n)),Oe(e,g),f&&f.d(),u&&u.d()}};return V("SvelteRegisterBlock",{block:c,id:Xs.name,type:"slot",source:"(33:8) <Route path={firstlyDataAuth.ui?.paths.sign_in}>",ctx:i}),c}function Zs(i){var n;let e,t;e=new mt({props:{path:(n=i[1].ui)==null?void 0:n.paths.forgot_password,$$slots:{default:[ta]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(a,o){Ie(e,a,o),t=!0},p:function(a,o){const l={};o&65&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(z(e.$$.fragment,a),t=!0)},o:function(a){Y(e.$$.fragment,a),t=!1},d:function(a){Oe(e,a)}};return V("SvelteRegisterBlock",{block:r,id:Zs.name,type:"if",source:"(52:6) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),r}function Ys(i){let e,t;e=new Pt({props:{href:i[1].ui.paths.sign_in,$$slots:{default:[ea]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(s,a){Ie(e,s,a),t=!0},p:function(s,a){const o={};a&64&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(z(e.$$.fragment,s),t=!0)},o:function(s){Y(e.$$.fragment,s),t=!1},d:function(s){Oe(e,s)}};return V("SvelteRegisterBlock",{block:r,id:Ys.name,type:"if",source:"(57:12) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),r}function ea(i){let e=i[1].ui.strings.back_to_sign_in+"",t;const r={c:function(){t=oe(e)},m:function(s,a){G(s,t,a)},p:fe,d:function(s){s&&Q(t)}};return V("SvelteRegisterBlock",{block:r,id:ea.name,type:"slot",source:"(58:14) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),r}function ta(i){var u;let e,t,r,n,s;function a(c){i[5](c)}let o={firstlyDataAuth:i[1]};i[0]!==void 0&&(o.email=i[0]),e=new Ls({props:o,$$inline:!0}),vi.push(()=>_i(e,"email",a));let l=((u=i[1].ui)==null?void 0:u.paths.sign_in)&&Ys(i);const f={c:function(){ke(e.$$.fragment),r=K(),n=J("div"),l&&l.c(),W(n,"class","form-footer svelte-h55kwc"),U(n,Te,62,10,1888)},m:function(h,p){Ie(e,h,p),G(h,r,p),G(h,n,p),l&&l.m(n,null),s=!0},p:function(h,p){var g;const y={};!t&&p&1&&(t=!0,y.email=h[0],ki(()=>t=!1)),e.$set(y),(g=h[1].ui)!=null&&g.paths.sign_in&&l.p(h,p)},i:function(h){s||(z(e.$$.fragment,h),z(l),s=!0)},o:function(h){Y(e.$$.fragment,h),Y(l),s=!1},d:function(h){h&&(Q(r),Q(n)),Oe(e,h),l&&l.d()}};return V("SvelteRegisterBlock",{block:f,id:ta.name,type:"slot",source:"(53:8) <Route path={firstlyDataAuth.ui?.paths.forgot_password}>",ctx:i}),f}function ra(i){var n;let e,t;e=new mt({props:{path:(n=i[1].ui)==null?void 0:n.paths.reset_password,$$slots:{default:[sa]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(a,o){Ie(e,a,o),t=!0},p:function(a,o){const l={};o&64&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(z(e.$$.fragment,a),t=!0)},o:function(a){Y(e.$$.fragment,a),t=!1},d:function(a){Oe(e,a)}};return V("SvelteRegisterBlock",{block:r,id:ra.name,type:"if",source:"(66:6) {#if firstlyDataAuth.ui?.paths.reset_password}",ctx:i}),r}function ia(i){let e,t;e=new Pt({props:{href:i[1].ui.paths.sign_in,$$slots:{default:[na]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){ke(e.$$.fragment)},m:function(s,a){Ie(e,s,a),t=!0},p:function(s,a){const o={};a&64&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(z(e.$$.fragment,s),t=!0)},o:function(s){Y(e.$$.fragment,s),t=!1},d:function(s){Oe(e,s)}};return V("SvelteRegisterBlock",{block:r,id:ia.name,type:"if",source:"(71:12) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),r}function na(i){let e=i[1].ui.strings.back_to_sign_in+"",t;const r={c:function(){t=oe(e)},m:function(s,a){G(s,t,a)},p:fe,d:function(s){s&&Q(t)}};return V("SvelteRegisterBlock",{block:r,id:na.name,type:"slot",source:"(72:14) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),r}function sa(i){var o;let e,t,r,n;e=new qs({props:{firstlyDataAuth:i[1]},$$inline:!0});let s=((o=i[1].ui)==null?void 0:o.paths.sign_in)&&ia(i);const a={c:function(){ke(e.$$.fragment),t=K(),r=J("div"),s&&s.c(),W(r,"class","form-footer svelte-h55kwc"),U(r,Te,76,10,2349)},m:function(f,u){Ie(e,f,u),G(f,t,u),G(f,r,u),s&&s.m(r,null),n=!0},p:function(f,u){var c;(c=f[1].ui)!=null&&c.paths.sign_in&&s.p(f,u)},i:function(f){n||(z(e.$$.fragment,f),z(s),n=!0)},o:function(f){Y(e.$$.fragment,f),Y(s),n=!1},d:function(f){f&&(Q(t),Q(r)),Oe(e,f),s&&s.d()}};return V("SvelteRegisterBlock",{block:a,id:sa.name,type:"slot",source:"(67:8) <Route path={firstlyDataAuth.ui?.paths.reset_password}>",ctx:i}),a}function aa(i){let e,t,r,n,s;const a={c:function(){e=J("div"),t=J("small"),t.textContent="- 404 -",r=K(),n=J("div"),s=J("small"),s.textContent="Nothing to see here",U(t,Te,96,8,2903),W(e,"class","fallback svelte-h55kwc"),U(e,Te,95,6,2872),U(s,Te,99,8,2976),W(n,"class","fallback svelte-h55kwc"),U(n,Te,98,6,2945)},m:function(l,f){G(l,e,f),E(e,t),G(l,r,f),G(l,n,f),E(n,s)},p:fe,d:function(l){l&&(Q(e),Q(r),Q(n))}};return V("SvelteRegisterBlock",{block:a,id:aa.name,type:"slot",source:"(88:4) <Route fallback>",ctx:i}),a}function oa(i){var g,w,O,I,S;let e,t,r,n,s,a,o,l,f=((g=i[1].ui)==null?void 0:g.strings.app_name)&&Us(i),u=((w=i[1].ui)==null?void 0:w.paths.sign_up)&&Vs(i),c=((O=i[1].ui)==null?void 0:O.paths.sign_in)&&xs(i),h=((I=i[1].ui)==null?void 0:I.paths.forgot_password)&&Zs(i),p=((S=i[1].ui)==null?void 0:S.paths.reset_password)&&ra(i);o=new mt({props:{fallback:!0,$$slots:{default:[aa]},$$scope:{ctx:i}},$$inline:!0});const y={c:function(){e=J("div"),f&&f.c(),t=K(),u&&u.c(),r=K(),c&&c.c(),n=K(),h&&h.c(),s=K(),p&&p.c(),a=K(),ke(o.$$.fragment),W(e,"class","form svelte-h55kwc"),U(e,Te,19,4,416)},m:function(T,H){G(T,e,H),f&&f.m(e,null),E(e,t),u&&u.m(e,null),E(e,r),c&&c.m(e,null),E(e,n),h&&h.m(e,null),E(e,s),p&&p.m(e,null),G(T,a,H),Ie(o,T,H),l=!0},p:function(T,H){var ue,ve,pe,Z,b;(ue=T[1].ui)!=null&&ue.strings.app_name&&f.p(T,H),(ve=T[1].ui)!=null&&ve.paths.sign_up&&u.p(T,H),(pe=T[1].ui)!=null&&pe.paths.sign_in&&c.p(T,H),(Z=T[1].ui)!=null&&Z.paths.forgot_password&&h.p(T,H),(b=T[1].ui)!=null&&b.paths.reset_password&&p.p(T,H);const ae={};H&64&&(ae.$$scope={dirty:H,ctx:T}),o.$set(ae)},i:function(T){l||(z(u),z(c),z(h),z(p),z(o.$$.fragment,T),l=!0)},o:function(T){Y(u),Y(c),Y(h),Y(p),Y(o.$$.fragment,T),l=!1},d:function(T){T&&(Q(e),Q(a)),f&&f.d(),u&&u.d(),c&&c.d(),h&&h.d(),p&&p.d(),Oe(o,T)}};return V("SvelteRegisterBlock",{block:y,id:oa.name,type:"slot",source:"(12:2) <Route>",ctx:i}),y}function wi(i){let e,t,r;t=new mt({props:{$$slots:{default:[oa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){e=J("div"),ke(t.$$.fragment),W(e,"class","wrapper svelte-h55kwc"),U(e,Te,17,0,380)},l:function(a){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,o){G(a,e,o),Ie(t,e,null),r=!0},p:function(a,[o]){const l={};o&65&&(l.$$scope={dirty:o,ctx:a}),t.$set(l)},i:function(a){r||(z(t.$$.fragment,a),r=!0)},o:function(a){Y(t.$$.fragment,a),r=!1},d:function(a){a&&Q(e),Oe(t)}};return V("SvelteRegisterBlock",{block:n,id:wi.name,type:"component",source:"",ctx:i}),n}function _l(i,e,t){let{$$slots:r={},$$scope:n}=e;yt("Page",r,[]);let{firstlyData:s}=e,a=s.props,o="";i.$$.on_mount.push(function(){s===void 0&&!("firstlyData"in e||i.$$.bound[i.$$.props.firstlyData])&&console.warn("<Page> was created without expected prop 'firstlyData'")});const l=["firstlyData"];Object.keys(e).forEach(h=>{!~l.indexOf(h)&&h.slice(0,2)!=="$$"&&h!=="slot"&&console.warn(`<Page> was created with unknown prop '${h}'`)});function f(h){o=h,t(0,o)}function u(h){o=h,t(0,o)}function c(h){o=h,t(0,o)}return i.$$set=h=>{"firstlyData"in h&&t(2,s=h.firstlyData)},i.$capture_state=()=>({Link:Pt,Route:mt,ForgotPassword:Ls,ResetPassword:qs,SignIn:js,SignUp:Js,firstlyData:s,firstlyDataAuth:a,email:o}),i.$inject_state=h=>{"firstlyData"in h&&t(2,s=h.firstlyData),"firstlyDataAuth"in h&&t(1,a=h.firstlyDataAuth),"email"in h&&t(0,o=h.email)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[o,a,s,f,u,c]}class Cl extends ht{constructor(e){super(e),pt(this,e,_l,wi,Tt,{firstlyData:2}),V("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:wi.name})}get firstlyData(){throw new Error("<Page>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyData(e){throw new Error("<Page>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{Cl as default};
