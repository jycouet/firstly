var Ga=Object.defineProperty;var Hi=i=>{throw TypeError(i)};var Qa=(i,e,t)=>e in i?Ga(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>Qa(i,typeof e!="symbol"?e+"":e,t),Gi=(i,e,t)=>e.has(i)||Hi("Cannot "+t);var Le=(i,e,t)=>(Gi(i,e,"read from private field"),t?t.call(i):e.get(i)),qe=(i,e,t)=>e.has(i)?Hi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),$e=(i,e,t,n)=>(Gi(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);import{n as le,s as za,r as Tt,a as Pt,i as Ka,g as Xa,S as yt,b as mt,c as Or,d as R,e as Ii,v as It,f as Ot,h as gt,j as Qi,k as Un,o as zi,l as Vn,m as Za,p as Ar,q as Oi,t as U,u as M,w as Sr,x as N,y as Cr,z as V,A as Er,B as Fr,C as Tr,D as ti,E as Ki,F as Ya,G as j,H as Xi,I as J,J as Pn,K as Be,L as xa,M as ie,N as Q,O as B,P as Qe,Q as S,R as Fe,T as Dn,U as Ie,V as Rn,W as re,X as se,Y as ae,Z as Dt,_ as Rt,$ as Bt,a0 as eo}from"./index-CHdpDVEV.js";function to(i,e){const t={},n={},r={$$scope:1};let s=i.length;for(;s--;){const a=i[s],o=e[s];if(o){for(const l in a)l in o||(n[l]=1);for(const l in o)r[l]||(t[l]=o[l],r[l]=1);i[s]=o}else for(const l in a)r[l]=1}for(const a in n)a in t||(t[a]=void 0);return t}const _t=[];function Ai(i,e){return{subscribe:Ht(i,e).subscribe}}function Ht(i,e=le){let t;const n=new Set;function r(o){if(Pt(i,o)&&(i=o,t)){const l=!_t.length;for(const f of n)f[1](),_t.push(f,i);if(l){for(let f=0;f<_t.length;f+=2)_t[f][0](_t[f+1]);_t.length=0}}}function s(o){r(o(i))}function a(o,l=le){const f=[o,l];return n.add(f),n.size===1&&(t=e(r,s)||le),o(i),()=>{n.delete(f),n.size===0&&t&&(t(),t=null)}}return{set:r,update:s,subscribe:a}}function Bn(i,e,t){const n=!Array.isArray(i),r=n?[i]:i;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Ai(t,(a,o)=>{let l=!1;const f=[];let u=0,c=le;const h=()=>{if(u)return;c();const m=e(n?f[0]:f,a,o);s?a(m):c=Ka(m)?m:le},p=r.map((m,y)=>za(m,_=>{f[y]=_,u&=~(1<<y),l&&h()},()=>{u|=1<<y}));return l=!0,h(),function(){Tt(p),c(),l=!1}})}const no=i=>{const{subscribe:e,update:t}=Ht(i);return{subscribe:e,set:(n={})=>{t(r=>Object.assign(r,n))}}},nt=no({mode:"window",basePath:null}),Wn=(i=Xa(nt).mode)=>{let e="popstate";i==="window"&&(e="popstate"),i==="hash"&&(e="hashchange"),window.dispatchEvent(new Event(e))},Zi={go:(i=0)=>{history.go(i),Wn()},push:(i,e=null)=>{history.pushState(e,"",i),Wn()},replace:(i,e=null)=>{history.replaceState(e,"",i),Wn()}},io=i=>{const e=i.match(/^(\/[^?#]*)?/),t=i.match(/\?([^#]*)?/),n=i.match(/#(.*)?/);return{path:(e==null?void 0:e[1])||"/",query:t!=null&&t[1]?`?${t==null?void 0:t[1]}`:"",hash:n!=null&&n[1]?`#${n==null?void 0:n[1]}`:""}},Yi=()=>{const{pathname:i,search:e,hash:t}=document.location;return{path:i,query:e,hash:t}},xi=()=>{let i=document.location.hash.substring(1);return i[0]!=="/"&&(i="/"+i),io(i)},ro=Ai(Yi(),i=>{const e=()=>i(Yi());return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)}),so=Ai(xi(),i=>{const e=()=>i(xi());return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)}),Si=Bn([nt,ro,so],([i,e,t],n)=>{i.mode==="window"&&n(e),i.mode==="hash"&&n(t)}),Hn=Bn(Si,i=>i.path);Bn(Si,i=>i.query);Bn(Si,i=>i.hash);const Vt=i=>i.split(/(?=\/)/),Pr=()=>{let i=0;return()=>i++},ni=(i,e)=>e===null?i:i.startsWith(e)?i.slice(e.length):i,{Error:$t}=Ii;function ii(i){let e;const t=i[11].default,n=Ar(t,i,i[10],null),r={c:function(){n&&n.c()},m:function(a,o){n&&n.m(a,o),e=!0},p:function(a,o){n&&n.p&&(!e||o&1024)&&Er(n,t,a,a[10],e?Tr(t,a[10],o,null):Fr(a[10]),null)},i:function(a){e||(M(n,a),e=!0)},o:function(a){N(n,a),e=!1},d:function(a){n&&n.d(a)}};return R("SvelteRegisterBlock",{block:r,id:ii.name,type:"if",source:"(98:0) {#if isRouteActive(getPathWithoutBase($globalPath, $options.basePath), $route, $contextChildRoutes)}",ctx:i}),r}function ri(i){let e=si(ni(i[1],i[2].basePath),i[0],i[3]),t,n,r=e&&ii(i);const s={c:function(){r&&r.c(),t=Oi()},l:function(o){throw new $t("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(o,l){r&&r.m(o,l),U(o,t,l),n=!0},p:function(o,[l]){l&15&&(e=si(ni(o[1],o[2].basePath),o[0],o[3])),e?r?(r.p(o,l),l&15&&M(r,1)):(r=ii(o),r.c(),M(r,1),r.m(t.parentNode,t)):r&&(Sr(),N(r,1,1,()=>{r=null}),Cr())},i:function(o){n||(M(r),n=!0)},o:function(o){N(r),n=!1},d:function(o){o&&V(t),r&&r.d(o)}};return R("SvelteRegisterBlock",{block:s,id:ri.name,type:"component",source:"",ctx:i}),s}const er=(i,e,t,n,r)=>{const s=(f,u,c)=>{const h=Vt(u).filter(p=>p!=="/").length;return(c??0)+(f?1:h)},a=(f,u)=>{const c={invalidPath:`<Route path="${f==null?void 0:f.path}" /> has invalid path. Path must start with '/'`,fallbackOutsideRoot:"<Route fallback /> cannot be outside root <Route />",pathOutsideRoot:`<Route path="${f==null?void 0:f.path}" /> cannot be outside root <Route />`,fallbackInsideFallback:"<Route fallback /> cannot be inside <Route fallback>",pathInsideFallback:`<Route path="${f==null?void 0:f.path}" /> cannot be inside <Route fallback>`};if(f.path[0]!=="/")throw new Error(c.invalidPath);if(f.root&&f.fallback)throw new Error(c.fallbackOutsideRoot);if(f.root&&f.path!=="/")throw new Error(c.pathOutsideRoot);if(u!=null&&u.fallback&&f.fallback)throw new Error(c.fallbackInsideFallback);if(u!=null&&u.fallback&&!f.fallback)throw new Error(c.pathInsideFallback)},o=s(t,n,r==null?void 0:r.depth),l={id:i,root:e,fallback:t,path:n,depth:o};return a(l,r),l},tr=()=>{const{subscribe:i,update:e}=Ht([]);return{subscribe:i,update:t=>e(n=>[...n.filter(r=>t.id!==r.id),t]),remove:t=>e(n=>n.filter(r=>t.id!==r.id))}},si=(i,e,t)=>{const n=(f,u,c,h)=>{let p=Vt(f).filter(_=>_!=="/"),m=Vt(c).filter(_=>_!=="/"),y="";if(c==="/")return u||p.length===h;for(let _=h-m.length;_<h;_++)y=y+p[_];return c===y},r=(f,u,c)=>{var m,y,_,w;let h=Vt(f).filter(k=>k!=="/"),p=!1;for(let k=0;k<(c==null?void 0:c.length)&&!p;k++)(m=c[k])!=null&&m.fallback||(p=n(f,((y=c[k])==null?void 0:y.root)??!1,((_=c[k])==null?void 0:_.path)??"",((w=c[k])==null?void 0:w.depth)??0));return h.length>=u&&!p},{root:s,fallback:a,path:o,depth:l}=e;return a?r(i,l,t):n(i,s,o,l)},nr=Pr(),un={},Gn={};function ao(i,e,t){let n,r,s,a,o;It(Hn,"globalPath"),Ot(i,Hn,A=>t(1,s=A)),It(nt,"options"),Ot(i,nt,A=>t(2,a=A));let{$$slots:l={},$$scope:f}=e;gt("Route",l,["default"]);const u=nr(),c=!Qi(un);let{fallback:h=!1}=e,{path:p="/"}=e;const m=Ht();It(m,"route"),Ot(i,m,A=>t(0,n=A));const y=Un(un);It(y,"contextRoute"),Ot(i,y,A=>t(9,r=A));const _=tr(),w=Un(Gn);It(w,"contextChildRoutes"),Ot(i,w,A=>t(3,o=A)),zi(()=>w==null?void 0:w.remove(n)),Vn(un,m),Vn(Gn,_);const k=["fallback","path"];return Object.keys(e).forEach(A=>{!~k.indexOf(A)&&A.slice(0,2)!=="$$"&&A!=="slot"&&console.warn(`<Route> was created with unknown prop '${A}'`)}),i.$$set=A=>{"fallback"in A&&t(7,h=A.fallback),"path"in A&&t(8,p=A.path),"$$scope"in A&&t(10,f=A.$$scope)},i.$capture_state=()=>({writable:Ht,createIdIssuer:Pr,getPathSegments:Vt,getRoute:er,createChildRoutes:tr,isRouteActive:si,getId:nr,routeContextKey:un,childRoutesContextKey:Gn,onDestroy:zi,getContext:Un,setContext:Vn,hasContext:Qi,globalPath:Hn,options:nt,getPathWithoutBase:ni,id:u,root:c,fallback:h,path:p,route:m,contextRoute:y,childRoutes:_,contextChildRoutes:w,$route:n,$contextRoute:r,$globalPath:s,$options:a,$contextChildRoutes:o}),i.$inject_state=A=>{"fallback"in A&&t(7,h=A.fallback),"path"in A&&t(8,p=A.path)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&896&&Za(m,n=er(u,c,h,p,r),n),i.$$.dirty&1&&(w==null||w.update(n))},[n,s,a,o,m,y,w,h,p,r,f,l]}class Ve extends yt{constructor(e){super(e),mt(this,e,ao,ri,Or,{fallback:7,path:8}),R("SvelteRegisterComponent",{component:this,tagName:"Route",options:e,id:ri.name})}get fallback(){throw new $t("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fallback(e){throw new $t("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get path(){throw new $t("<Route>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set path(e){throw new $t("<Route>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const ir=i=>{var o;const e=(o=i.target)==null?void 0:o.closest("a[href]"),t=e==null?void 0:e.href;if(e===null||t===null)return!0;const n=["","true"].includes(e.getAttribute("data-handle-ignore")??"false"),r=(e.getAttribute("target")??"_self")!=="_self",s=i.metaKey||i.ctrlKey||i.altKey||i.shiftKey,a=new URL(t).origin!==document.location.origin;if(n||r||s||a)return!0;t===document.location.href?Zi.replace(t):Zi.push(t),i.preventDefault()},Dr=i=>(i.addEventListener("click",ir),{destroy:()=>{i.removeEventListener("click",ir)}}),oo="home/jycouet/udev/gh/dp/my-minion-mr/packages/firstly/node_modules/.pnpm/svelte-micro@2.5.7_svelte@4.2.18/node_modules/svelte-micro/dist/lib/components/Link.svelte";function ai(i){let e,t,n,r;const s=i[5].default,a=Ar(s,i,i[4],null);let o=[{href:i[0]},i[1]],l={};for(let u=0;u<o.length;u+=1)l=ti(l,o[u]);const f={c:function(){e=j("a"),a&&a.c(),Xi(e,l),J(e,oo,15,0,417)},l:function(c){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(c,h){U(c,e,h),a&&a.m(e,null),t=!0,n||(r=[Pn(Dr.call(null,e)),Be(e,"click",i[6],!1,!1,!1,!1)],n=!0)},p:function(c,[h]){a&&a.p&&(!t||h&16)&&Er(a,s,c,c[4],t?Tr(s,c[4],h,null):Fr(c[4]),null),Xi(e,l=to(o,[(!t||h&1)&&{href:c[0]},h&2&&c[1]]))},i:function(c){t||(M(a,c),t=!0)},o:function(c){N(a,c),t=!1},d:function(c){c&&V(e),a&&a.d(c),n=!1,Tt(r)}};return R("SvelteRegisterBlock",{block:f,id:ai.name,type:"component",source:"",ctx:i}),f}const rr=(i,e,t)=>(i==="hash"?"#":"")+(e??"")+t;function lo(i,e,t){let n;const r=["href"];let s=Ki(e,r),a;It(nt,"options"),Ot(i,nt,c=>t(3,a=c));let{$$slots:o={},$$scope:l}=e;gt("Link",o,["default"]);let{href:f}=e;i.$$.on_mount.push(function(){f===void 0&&!("href"in e||i.$$.bound[i.$$.props.href])&&console.warn("<Link> was created without expected prop 'href'")});function u(c){xa.call(this,i,c)}return i.$$set=c=>{e=ti(ti({},e),Ya(c)),t(1,s=Ki(e,r)),"href"in c&&t(2,f=c.href),"$$scope"in c&&t(4,l=c.$$scope)},i.$capture_state=()=>({getFormatedHref:rr,options:nt,linkHandle:Dr,href:f,formatedHref:n,$options:a}),i.$inject_state=c=>{"href"in e&&t(2,f=c.href),"formatedHref"in e&&t(0,n=c.formatedHref)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&12&&t(0,n=rr(a.mode,a.basePath,f))},[n,s,f,a,l,o,u]}class We extends yt{constructor(e){super(e),mt(this,e,lo,ai,Or,{href:2}),R("SvelteRegisterComponent",{component:this,tagName:"Link",options:e,id:ai.name})}get href(){throw new Error("<Link>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set href(e){throw new Error("<Link>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class ct{constructor(...e){d(this,"fields");d(this,"options",{});d(this,"target");d(this,"readonly",!0);d(this,"allowNull",!1);d(this,"dbReadOnly",!1);d(this,"isServerExpression",!1);d(this,"key","");d(this,"caption","");d(this,"inputType","");d(this,"dbName","");d(this,"valueType");this.fields=e}apiUpdateAllowed(e){throw new Error("Method not implemented.")}displayValue(e){throw new Error("Method not implemented.")}includedInApi(e){throw new Error("Method not implemented.")}toInput(e,t){throw new Error("Method not implemented.")}fromInput(e,t){throw new Error("Method not implemented.")}getDbName(){return Promise.resolve("")}getId(e){let t=r=>e[r.key];typeof e=="function"&&(t=e);let n="";return this.fields.forEach(r=>{n.length>0&&(n+=","),n+=r.valueConverter.toJson(t(r))}),n}get valueConverter(){throw new Error("cant get value converter of compound id")}isEqualTo(e){let t={},r=e.toString().split(",");return this.fields.forEach((s,a)=>{t[s.key]=s.valueConverter.fromJson(r[a])}),t}}function oe(i,e=!0){var n;if(i===void 0)throw new Error("entity is undefined");let t=i[ft];if(!t&&e)throw new Error("item "+(((n=i.constructor)==null?void 0:n.name)||i)+" was not initialized using a context");return t}const ft=Symbol.for("entityMember"),Rr=Symbol.for("entityInfo"),Br=Symbol.for("entityInfo_key");function Pe(i,e=!0){if(i===void 0){if(e)throw new Error("Undefined is not an entity :)");return}let t=i[Rr];if(!t&&e)throw new Error(i.prototype.constructor.name+" is not a known entity, did you forget to set @Entity() or did you forget to add the '@' before the call to Entity?");return t}function uo(i){return i[Br]}function Qn(i,e){return{[Mr]:{toType:i,type:e}}}const Mr=Symbol.for("relationInfo");function fo(i){return i==null?void 0:i[Mr]}const oi=Symbol.for("fieldRelationInfo");function ce(i){if(i)return i[oi]}function co(i,e,t){for(const n of i.fields.toArray()){const r=fo(n.options);if(r&&!n[oi]){const s=r.toType(),a=e.repo(s,t),o=n.options;n[oi]={type:r.type,toEntity:s,options:o,toRepo:a,getFields:()=>{let l=o.field,f={fields:o.fields,compoundIdField:void 0};function u(p){return Error(`Error for relation: "${i.metadata.key}.${n.key}", `+p)}let c=()=>l||f.fields;if(r.type==="toMany"&&!c()){for(const p of a.fields.toArray())if(!c()){const m=ce(p),y=p.options;if(m&&m.toEntity===i.metadata.entityType){if(m.type==="reference")l=p.key;else if(m.type==="toOne"){if(y.field)l=y.field;else if(y.fields){let _={};for(const w in y.fields)if(Object.prototype.hasOwnProperty.call(y.fields,w)){const k=y.fields[w];_[k]=w}f.fields=_}}}}if(!c())throw u(`No matching field found on target "${a.metadata.key}". Please specify field/fields`)}function h(p,m){const y=m.fields.find(p);if(!y)throw u(`Field "${p}" was not found in "${m.key}".`);return y}r.type==="reference"&&(l=n.key),l&&(r.type==="toOne"||r.type==="reference"?a.metadata.idMetadata.field instanceof ct?f.compoundIdField=l:f.fields={[a.metadata.idMetadata.field.key]:l}:i.metadata.idMetadata.field instanceof ct?f.compoundIdField=l:f.fields={[l]:i.metadata.idMetadata.field.key});for(const p in f.fields)Object.prototype.hasOwnProperty.call(f.fields,p)&&(h(p,a.metadata),h(f.fields[p],i.metadata));return f}}}}}class q{constructor(e){d(this,"apply");this.apply=e}static throwErrorIfFilterIsEmpty(e,t){if(q.isFilterEmpty(e))throw{message:`${t}: requires a filter to protect against accidental delete/update of all rows`,httpStatusCode:400}}static isFilterEmpty(e){if(e.$and){for(const t of e.$and)if(!q.isFilterEmpty(t))return!1}if(e.$or){for(const t of e.$or)if(q.isFilterEmpty(t))return!0;return!1}return Object.keys(e).filter(t=>!["$or","$and"].includes(t)).length==0}static async getPreciseValues(e,t){const n=new In;return await q.fromEntityFilter(e,t).__applyToConsumer(n),n.preciseValues}async getPreciseValues(){const e=new In;return await this.__applyToConsumer(e),e.preciseValues}static createCustom(e,t=""){let n={key:t,rawFilterTranslator:e};return Object.assign(r=>{if(r==null&&(r={}),!n.key)throw"Usage of custom filter before a key was assigned to it";return{[dt+n.key]:r}},{rawFilterInfo:n})}static entityFilterToJson(e,t){return q.fromEntityFilter(e,t).toJson()}static entityFilterFromJson(e,t){return yn(e,{get:n=>t[n]})}static fromEntityFilter(e,t){let n=[];for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){let s=t[r];if(r=="$or")n.push(new yo(...s.map(a=>q.fromEntityFilter(e,a))));else if(r=="$not")n.push(new mo(q.fromEntityFilter(e,s)));else if(r=="$and")n.push(new sr(...s.map(a=>q.fromEntityFilter(e,a))));else if(r.startsWith(dt))n.push(new q(a=>{a.custom(r.substring(dt.length),s)}));else if(r==Nr)n.push(new q(a=>a.databaseCustom(s)));else{const a=e.fields[r],o=ce(a),l=a.options;let f=(o==null?void 0:o.type)==="toOne"?l.fields?new po(a,e.fields,l):new ho(e.fields[l.field]):new bn(a),u=!1;if(s!==void 0&&s!=null){s.$id!==void 0&&(s=s.$id);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const h=s[c];switch(c){case"$gte":case">=":n.push(f.isGreaterOrEqualTo(h)),u=!0;break;case"$gt":case">":n.push(f.isGreaterThan(h)),u=!0;break;case"$lte":case"<=":n.push(f.isLessOrEqualTo(h)),u=!0;break;case"$lt":case"<":n.push(f.isLessThan(h)),u=!0;break;case"$ne":case"$not":case"!=":case"$nin":u=!0,Array.isArray(h)?n.push(f.isNotIn(h)):n.push(f.isDifferentFrom(h));break;case"$in":u=!0,n.push(f.isIn(h));break;case"$contains":u=!0,n.push(f.contains(h));break;case"$startsWith":u=!0,n.push(f.startsWith(h));break;case"$endsWith":u=!0,n.push(f.endsWith(h));break;case"$notContains":u=!0,n.push(f.notContains(h));break}}Array.isArray(s)&&(u=!0,n.push(f.isIn(s)))}!u&&s!==void 0&&n.push(f.isEqualTo(s))}}return new sr(...n)}__applyToConsumer(e){this.apply(e)}static async resolve(e){return typeof e=="function"?await e():e}toJson(){let e=new vn;return this.__applyToConsumer(e),e.result}static async translateCustomWhere(e,t,n){let r=new kn(async(s,a)=>{let o=[];for(const l in t.entityType){const f=t.entityType[l];f&&f.rawFilterInfo&&f.rawFilterInfo.rawFilterTranslator&&f.rawFilterInfo.key==s&&o.push(await q.fromEntityFilter(t,await f.rawFilterInfo.rawFilterTranslator(a,n)))}return o});return e.__applyToConsumer(r),await r.resolve(),e=new q(s=>r.applyTo(s)),e}}class bn{constructor(e){d(this,"metadata");this.metadata=e}processVal(e){if(Pe(this.metadata.valueType,!1)){if(e==null){if(e===null&&!this.metadata.allowNull){const n=ce(this.metadata);if((n==null?void 0:n.type)==="reference")return n.toRepo.metadata.idMetadata.field.options.valueType===Number?0:""}return null}return typeof e=="string"||typeof e=="number"?e:oe(e).getId()}return e}contains(e){return new q(t=>t.containsCaseInsensitive(this.metadata,e))}notContains(e){return new q(t=>t.notContainsCaseInsensitive(this.metadata,e))}startsWith(e){return new q(t=>t.startsWithCaseInsensitive(this.metadata,e))}endsWith(e){return new q(t=>t.endsWithCaseInsensitive(this.metadata,e))}isLessThan(e){return e=this.processVal(e),new q(t=>t.isLessThan(this.metadata,e))}isGreaterOrEqualTo(e){return e=this.processVal(e),new q(t=>t.isGreaterOrEqualTo(this.metadata,e))}isNotIn(e){return new q(t=>{for(const n of e)t.isDifferentFrom(this.metadata,this.processVal(n))})}isDifferentFrom(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new q(t=>t.isNotNull(this.metadata)):new q(t=>t.isDifferentFrom(this.metadata,e))}isLessOrEqualTo(e){return e=this.processVal(e),new q(t=>t.isLessOrEqualTo(this.metadata,e))}isGreaterThan(e){return e=this.processVal(e),new q(t=>t.isGreaterThan(this.metadata,e))}isEqualTo(e){return e=this.processVal(e),e==null&&this.metadata.allowNull?new q(t=>t.isNull(this.metadata)):new q(t=>t.isEqualTo(this.metadata,e))}isIn(e){return e=e.map(t=>this.processVal(t)),(e==null?void 0:e.length)==1&&e[0]!=null&&e[0]!==null?new q(t=>t.isEqualTo(this.metadata,e[0])):new q(t=>t.isIn(this.metadata,e))}}class ho extends bn{processVal(e){return e?typeof e=="string"||typeof e=="number"?e:oe(e).getId():null}}class po{constructor(e,t,n){d(this,"metadata");d(this,"fields");d(this,"relationOptions");this.metadata=e,this.fields=t,this.relationOptions=n}processVal(e){throw new Error("Invalid for Many To One Relation Field")}contains(e){throw new Error("Invalid for Many To One Relation Field")}notContains(e){throw new Error("Invalid for Many To One Relation Field")}endsWith(e){throw new Error("Invalid for Many To One Relation Field")}startsWith(e){throw new Error("Invalid for Many To One Relation Field")}isLessThan(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isNotIn(e){return new q(t=>{e.forEach(n=>this.isDifferentFrom(n).__applyToConsumer(t))})}isDifferentFrom(e){return new q(t=>{const n=[];for(const r in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,r)){const s=this.relationOptions.fields[r];n.push(new q(a=>new bn(this.fields.find(s)).isDifferentFrom(e[r]).__applyToConsumer(a)))}t.or(n)})}isLessOrEqualTo(e){throw new Error("Invalid for Many To One Relation Field")}isGreaterThan(e){throw new Error("Invalid for Many To One Relation Field")}isEqualTo(e){return new q(t=>{for(const n in this.relationOptions.fields)if(Object.prototype.hasOwnProperty.call(this.relationOptions.fields,n)){const r=this.relationOptions.fields[n];new bn(this.fields.find(r)).isEqualTo(e[n]).__applyToConsumer(t)}})}isIn(e){return new q(t=>{t.or(e.map(n=>this.isEqualTo(n)))})}}class sr extends q{constructor(...t){super(n=>{for(const r of this.filters)r&&r.__applyToConsumer(n)});d(this,"filters");this.filters=t}add(t){this.filters.push(t)}}class yo extends q{constructor(...t){super(n=>{let r=this.filters.filter(s=>s!==void 0);r.length>1?n.or(r):r.length==1&&r[0].__applyToConsumer(n)});d(this,"filters");this.filters=t}}class mo extends q{constructor(t){super(n=>{n.not(t)});d(this,"filter");this.filter=t}}const dt="$custom$",Nr="$db$",li="$an array";class vn{constructor(){d(this,"result",{});d(this,"hasUndefined",!1)}databaseCustom(e){throw new Error("database custom is not allowed with api calls.")}custom(e,t){Array.isArray(t)&&(t={[li]:t}),this.add(dt+e,t)}add(e,t){t===void 0&&(this.hasUndefined=!0);let n=this.result;if(!n[e]){n[e]=t;return}let r=n[e];r instanceof Array?r.push(t):r=[r,t],n[e]=r}or(e){this.add("OR",e.map(t=>{let n=new vn;return t.__applyToConsumer(n),n.result}))}not(e){let t=new vn;e.__applyToConsumer(t),this.add("NOT",t.result)}isNull(e){this.add(e.key+".null",!0)}isNotNull(e){this.add(e.key+".null",!1)}isIn(e,t){this.add(e.key+".in",t.map(n=>e.valueConverter.toJson(n)))}isEqualTo(e,t){this.add(e.key,e.valueConverter.toJson(t))}isDifferentFrom(e,t){this.add(e.key+".ne",e.valueConverter.toJson(t))}isGreaterOrEqualTo(e,t){this.add(e.key+".gte",e.valueConverter.toJson(t))}isGreaterThan(e,t){this.add(e.key+".gt",e.valueConverter.toJson(t))}isLessOrEqualTo(e,t){this.add(e.key+".lte",e.valueConverter.toJson(t))}isLessThan(e,t){this.add(e.key+".lt",e.valueConverter.toJson(t))}containsCaseInsensitive(e,t){this.add(e.key+".contains",t)}notContainsCaseInsensitive(e,t){this.add(e.key+".notContains",t)}startsWithCaseInsensitive(e,t){this.add(e.key+".startsWith",t)}endsWithCaseInsensitive(e,t){this.add(e.key+".endsWith",t)}}function yn(i,e){let t={};function n(o){t.$and||(t.$and=[]),t.$and.push(o)}function r(o,l){t[o]===void 0?t[o]=l:n({[o]:l})}[...i.fields].forEach(o=>{function l(u,c,h=!1,p=!1){let m=e.get(o.key+u);if(m!==void 0){let y=_=>{let w=_;if(h){let A;typeof _=="string"?A=JSON.parse(_):A=_,w=A.map(E=>p?E:o.valueConverter.fromJson(E))}else w=p?w:o.valueConverter.fromJson(w);let k=c(w);k!==void 0&&r(o.key,k)};if(!h&&m instanceof Array)m.forEach(_=>{y(_)});else{h&&typeof m=="string"&&(m=JSON.parse(m));const _=a(m);for(const w of _)y(w)}}}l("",u=>u),l(".gt",u=>({$gt:u})),l(".gte",u=>({$gte:u})),l(".lt",u=>({$lt:u})),l(".lte",u=>({$lte:u})),l(".ne",u=>({$ne:u})),l(".in",u=>u,!0);var f=e.get(o.key+".null");if(f)switch(f=f.toString().trim().toLowerCase(),f){case"y":case"true":case"yes":r(o.key,null);break;default:r(o.key,{$ne:null});break}l(".contains",u=>({$contains:u}),!1,!0),l(".notContains",u=>({$notContains:u}),!1,!0),l(".startsWith",u=>({$startsWith:u}),!1,!0),l(".endsWith",u=>({$endsWith:u}),!1,!0)});let s=e.get("OR");if(s){const l=a(s).map(f=>({$or:f.map(u=>yn(i,{get:c=>u[c]}))}));l.length==1?t.$or?t.$or.push(l[0].$or):t.$or=l[0].$or:n({$and:l})}if(s=e.get("NOT"),s){let o=a(s);const l=[];for(const f of o)if(Array.isArray(f))for(const u of f)l.push({$not:yn(i,{get:c=>u[c]})});else l.push({$not:yn(i,{get:u=>f[u]})});l.length==1&&!t.$not?t=l[0]:n({$and:l})}for(const o in i.entityType){const l=i.entityType[o];if(l&&l.rawFilterInfo&&l.rawFilterInfo.rawFilterTranslator){let f=e.get(dt+o);if(f!==void 0){const u=c=>{c[li]!=null&&(c=c[li]),r(dt+o,c)};Array.isArray(f)?f.forEach(c=>u(c)):u(f)}}}return t;function a(o){if(!Array.isArray(o))return[o];const l=[],f=[];for(const u of o)Array.isArray(u)?f.push(u):l.push(u);return f.push(l),f}}class kn{constructor(e){d(this,"translateCustom");d(this,"commands",[]);d(this,"promises",[]);this.translateCustom=e}applyTo(e){this.commands.forEach(t=>t(e))}or(e){let t;this.promises.push(Promise.all(e.map(async n=>{let r=new kn(this.translateCustom);return n.__applyToConsumer(r),await r.resolve(),new q(s=>r.applyTo(s))})).then(n=>{t=n})),this.commands.push(n=>n.or(t))}not(e){let t;this.promises.push((async()=>{let n=new kn(this.translateCustom);e.__applyToConsumer(n),await n.resolve(),t=new q(r=>n.applyTo(r))})()),this.commands.push(n=>n.not(t))}isEqualTo(e,t){this.commands.push(n=>n.isEqualTo(e,t))}isDifferentFrom(e,t){this.commands.push(n=>n.isDifferentFrom(e,t))}isNull(e){this.commands.push(t=>t.isNull(e))}isNotNull(e){this.commands.push(t=>t.isNotNull(e))}isGreaterOrEqualTo(e,t){this.commands.push(n=>n.isGreaterOrEqualTo(e,t))}isGreaterThan(e,t){this.commands.push(n=>n.isGreaterThan(e,t))}isLessOrEqualTo(e,t){this.commands.push(n=>n.isLessOrEqualTo(e,t))}isLessThan(e,t){this.commands.push(n=>n.isLessThan(e,t))}containsCaseInsensitive(e,t){this.commands.push(n=>n.containsCaseInsensitive(e,t))}notContainsCaseInsensitive(e,t){this.commands.push(n=>n.notContainsCaseInsensitive(e,t))}startsWithCaseInsensitive(e,t){this.commands.push(n=>n.startsWithCaseInsensitive(e,t))}endsWithCaseInsensitive(e,t){this.commands.push(n=>n.endsWithCaseInsensitive(e,t))}isIn(e,t){this.commands.push(n=>n.isIn(e,t))}custom(e,t){this.promises.push((async()=>{let n=await this.translateCustom(e,t);n&&(Array.isArray(n)?n.forEach(r=>r.__applyToConsumer(this)):n.__applyToConsumer(this))})())}databaseCustom(e){this.commands.push(t=>t.databaseCustom(e))}async resolve(){for(;this.promises.length>0;){let e=this.promises;this.promises=[],await Promise.all(e)}}}class In{constructor(){d(this,"rawValues",{});d(this,"preciseValues",new Proxy(this.rawValues,{get:(e,t)=>{if(t in e){let n=e[t];if(n.bad)return;if(n.values.length>0){const r=ce(n.field);if(r){if(r.type==="reference")return n.values.map(s=>r.toRepo.metadata.idMetadata.getIdFilter(s));throw new Error("Only relations toOne without field are supported.")}return n.values}}}}))}ok(e,...t){let n=this.rawValues[e.key];n?n.values.push(...t.filter(r=>!n.values.includes(r))):this.rawValues[e.key]={field:e,bad:!1,values:[...t]}}notOk(e){let t=this.rawValues[e.key];t?t.bad=!0:this.rawValues[e.key]={field:e,bad:!0,values:[]}}not(e){}or(e){const t=e.map(n=>{let r=new In;return n.__applyToConsumer(r),r});for(const n of t)for(const r in n.rawValues)if(Object.prototype.hasOwnProperty.call(n.rawValues,r)){const s=n.rawValues[r];s&&(s.bad?this.notOk(s.field):this.ok(s.field,...s.values))}for(const n in this.rawValues)if(Object.prototype.hasOwnProperty.call(this.rawValues,n))for(const r of t)r.rawValues[n]||this.notOk(this.rawValues[n].field)}isEqualTo(e,t){this.ok(e,t)}isDifferentFrom(e,t){this.notOk(e)}isNull(e){this.ok(e,null)}isNotNull(e){this.notOk(e)}isGreaterOrEqualTo(e,t){this.notOk(e)}isGreaterThan(e,t){this.notOk(e)}isLessOrEqualTo(e,t){this.notOk(e)}isLessThan(e,t){this.notOk(e)}containsCaseInsensitive(e,t){this.notOk(e)}notContainsCaseInsensitive(e,t){this.notOk(e)}startsWithCaseInsensitive(e,t){this.notOk(e)}endsWithCaseInsensitive(e,t){this.notOk(e)}isIn(e,t){this.ok(e,...t)}custom(e,t){}databaseCustom(e){}}var go={};const zn=Symbol.for("remult-static1");let mn={defaultRemultFactory:void 0,remultFactory:void 0,defaultRemult:void 0,asyncContext:void 0,columnsOfType:new Map,allEntities:[],classHelpers:new Map,actionInfo:{allActions:[],runningOnServer:!1,runActionWithoutBlockingUI:i=>i(),startBusyWithProgress:()=>({progress:i=>{},close:()=>{}})},fieldOptionsEnricher:void 0,captionTransformer:void 0,defaultDataProvider:()=>{}};typeof process<"u"&&go.IGNORE_GLOBAL_REMULT_IN_TESTS||typeof globalThis[zn]>"u"?(globalThis[zn]=mn,mn.remultFactory=()=>Lr()):mn=globalThis[zn];const F=mn;function Lr(){return F.defaultRemult||(F.defaultRemult=F.defaultRemultFactory()),F.defaultRemult}function wo(){F.remultFactory=()=>Lr()}function ht(i){const e=i;if(typeof e[Gt]=="function")return e[Gt]();throw Error("Error getting repository internal from "+i)}const Gt=Symbol.for("getInternal");class _o{constructor(){d(this,"iAmRemultProxy",!0);d(this,"repoCache",new Map);d(this,"repo",(...e)=>{let t=F,n=this.repoCache.get(e[0]);n||this.repoCache.set(e[0],n=new Map);let r=n.get(e[1]);return r||(r={get fields(){return F.remultFactory().repo(...e).metadata.fields},[Gt](){return t.remultFactory().repo(...e)[Gt]()},relations:s=>t.remultFactory().repo(...e).relations(s),validate:(s,...a)=>t.remultFactory().repo(...e).validate(s,...a),addEventListener:(...s)=>t.remultFactory().repo(...e).addEventListener(...s),count:(...s)=>t.remultFactory().repo(...e).count(...s),create:(...s)=>t.remultFactory().repo(...e).create(...s),delete:s=>t.remultFactory().repo(...e).delete(s),deleteMany:s=>t.remultFactory().repo(...e).deleteMany(s),updateMany:(...s)=>t.remultFactory().repo(...e).updateMany(...s),find:(...s)=>t.remultFactory().repo(...e).find(...s),groupBy:(...s)=>t.remultFactory().repo(...e).groupBy(...s),aggregate:(...s)=>t.remultFactory().repo(...e).aggregate(...s),findFirst:(...s)=>t.remultFactory().repo(...e).findFirst(...s),findOne:(...s)=>t.remultFactory().repo(...e).findOne(...s),findId:(s,a)=>t.remultFactory().repo(...e).findId(s,a),toJson:s=>t.remultFactory().repo(...e).toJson(s),fromJson:(s,a)=>t.remultFactory().repo(...e).fromJson(s,a),getEntityRef:(...s)=>t.remultFactory().repo(...e).getEntityRef(...s),insert:s=>t.remultFactory().repo(...e).insert(s),liveQuery:(...s)=>t.remultFactory().repo(...e).liveQuery(...s),get metadata(){return F.remultFactory().repo(...e).metadata},query:s=>t.remultFactory().repo(...e).query(s),save:s=>t.remultFactory().repo(...e).save(s),upsert:s=>t.remultFactory().repo(...e).upsert(s),update:(s,a)=>t.remultFactory().repo(...e).update(s,a)},n.set(e[1],r),r)})}get liveQuerySubscriber(){return F.remultFactory().liveQuerySubscriber}set liveQuerySubscriber(e){F.remultFactory().liveQuerySubscriber=e}get liveQueryStorage(){return F.remultFactory().liveQueryStorage}set liveQueryStorage(e){F.remultFactory().liveQueryStorage=e}get liveQueryPublisher(){return F.remultFactory().liveQueryPublisher}set liveQueryPublisher(e){F.remultFactory().liveQueryPublisher=e}initUser(){return F.remultFactory().initUser()}call(e,t,...n){return F.remultFactory().call(e,t,...n)}get context(){return F.remultFactory().context}get dataProvider(){return F.remultFactory().dataProvider}set dataProvider(e){F.remultFactory().dataProvider=e}get repCache(){return F.remultFactory().repCache}authenticated(){return F.remultFactory().authenticated()}isAllowed(e){return F.remultFactory().isAllowed(e)}isAllowedForInstance(e,t){return F.remultFactory().isAllowedForInstance(e,t)}clearAllCache(){return F.remultFactory().clearAllCache()}useFetch(e){return F.remultFactory().useFetch(e)}get user(){return F.remultFactory().user}set user(e){F.remultFactory().user=e}get apiClient(){return F.remultFactory().apiClient}set apiClient(e){F.remultFactory().apiClient=e}get subscriptionServer(){return F.remultFactory().subscriptionServer}set subscriptionServer(e){F.remultFactory().subscriptionServer=e}}const Se=new _o,bo="$count",vo=Symbol.for("GroupByForApiKey"),ko=["sum","avg","min","max","distinctCount"],qr={error500RetryCount:4};function ui(i){return i.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,e=>e.toUpperCase()).replace("Email","eMail")}class Io{constructor(e,t,n){d(this,"repository");d(this,"isReferenceRelation");d(this,"allowNull");d(this,"storedItem");d(this,"id");this.repository=e,this.isReferenceRelation=t,this.allowNull=n}toJson(){if(this.storedItem)return this.item===null?null:this.repository.toJson(this.item)}setId(e){this.repository.metadata.idMetadata.field.valueType==Number&&(e=+e),this.id=e}waitLoadOf(e){return e==null?null:ht(this.repository)._getCachedByIdAsync(e,!1)}get(e){if(e==null)return null;const t=ht(this.repository)._getCachedById(e,this.isReferenceRelation);return this.isReferenceRelation&&!this.storedItem?!this.allowNull&&(this.id===0||this.id==="")?null:void 0:t}set(e){if(e===null&&!this.allowNull&&this.isReferenceRelation&&(this.id==0||this.id=="")){this.storedItem={item:null};return}if(this.storedItem=void 0,e)if(typeof e=="string"||typeof e=="number")this.id=e;else{let t=oe(e,!1);t&&!this.isReferenceRelation?(ht(this.repository)._addToCache(e),this.id=t.getId()):(this.storedItem={item:e},this.id=e[this.repository.metadata.idMetadata.field.key])}else e===null?this.id=null:this.id=void 0}get item(){return this.storedItem?this.storedItem.item:this.get(this.id)}async waitLoad(){return this.waitLoadOf(this.id)}}class ar{constructor(e){d(this,"url");this.url=e}add(e,t){this.url.indexOf("?")>=0?this.url+="&":this.url+="?",this.url+=encodeURIComponent(e)+"="+encodeURIComponent(t)}addObject(e,t=""){if(e!=null)for(var n in e){let r=e[n];this.add(n+t,r)}}}function Et(i){if(!i)return new or;let e;return e||$r(i)&&(e=new Oo(i)),e||typeof i=="function"&&(e=new or(i)),e}function $r(i){let e=i;return!!(e&&e.get&&e.put&&e.post&&e.delete)}class Oo{constructor(e){d(this,"http");this.http=e}async post(e,t){return await On(()=>fn(this.http.post(e,t)))}delete(e){return fn(this.http.delete(e))}put(e,t){return fn(this.http.put(e,t))}async get(e){return await On(()=>fn(this.http.get(e)))}}async function On(i){var t,n,r,s;let e=0;for(;;)try{return await i()}catch(a){if(((t=a.message)!=null&&t.startsWith("Error occurred while trying to proxy")||(n=a.message)!=null&&n.startsWith("Error occured while trying to proxy")||(r=a.message)!=null&&r.includes("http proxy error")||(s=a.message)!=null&&s.startsWith("Gateway Timeout")||a.status==500)&&e++<qr.error500RetryCount){await new Promise((o,l)=>{setTimeout(()=>{o({})},500)});continue}throw a}}function fn(i){let e;return i.toPromise!==void 0?e=i.toPromise():e=i,e.then(t=>t&&(t.status==200||t.status==201)&&t.headers&&t.request&&t.data!==void 0?t.data:t).catch(async t=>{throw await Ao(t)})}async function Ao(i){var s,a,o;let e=await i;var t;e.error?t=e.error:e.isAxiosError&&(typeof((s=e.response)==null?void 0:s.data)=="string"?t=e.response.data:t=(a=e==null?void 0:e.response)==null?void 0:a.data),t||(t=e.message),e.status==0&&e.error.isTrusted&&(t="Network Error"),typeof t=="string"&&(t={message:t}),e.modelState&&(t.modelState=e.modelState);let n=e.status;n===void 0&&(n=(o=e.response)==null?void 0:o.status),n!=null&&(t.httpStatusCode=n);var r=Object.assign(t??{},{});return r}class fi{constructor(e,t){d(this,"apiProvider");d(this,"entityRequested");d(this,"isProxy",!0);this.apiProvider=e,this.entityRequested=t}getEntityDataProvider(e){var t;return(t=this.entityRequested)==null||t.call(this,e),new So(()=>{var n;return jr((n=this.apiProvider())==null?void 0:n.url,e.key)},()=>Et(this.apiProvider().httpClient),e)}async transaction(e){throw new Error("Method not implemented.")}}function jr(i,e){return i==null&&(i="/api"),i+"/"+e}function Ci(i,e){if(i.include){let t={};for(const n in i.include)if(Object.prototype.hasOwnProperty.call(i.include,n)){let r=i.include[n];if(typeof r=="object"){const s=ce(e.fields.find(n));s&&(r=Ci(r,s.toRepo.metadata))}t[n]=r}i={...i,include:t}}return i.where&&(i={...i,where:q.entityFilterToJson(e,i.where)}),i.load&&(i={...i,load:i.load(e.fields).map(t=>t.key)}),i}class So{constructor(e,t,n){d(this,"url");d(this,"http");d(this,"entity");this.url=e,this.http=t,this.entity=n}query(e,t){return this.buildFindRequest(e).run("query",{aggregate:this.buildAggregateOptions(t)}).then(({items:r,aggregates:s})=>({items:r.map(a=>this.translateFromJson(a)),aggregates:s}))}async groupBy(e){const{run:t}=this.buildFindRequest({where:e==null?void 0:e.where,limit:e==null?void 0:e.limit,page:e==null?void 0:e.page}),n=this.buildAggregateOptions(e),r=await t("groupBy",Object.keys(n).length>0?n:void 0);return e!=null&&e.group&&r.forEach(s=>{for(const a of e.group)s[a.key]=a.valueConverter.fromJson(s[a.key])}),r}buildAggregateOptions(e){var t,n,r,s,a,o,l;return{groupBy:(t=e==null?void 0:e.group)==null?void 0:t.map(f=>f.key),sum:(n=e==null?void 0:e.sum)==null?void 0:n.map(f=>f.key),avg:(r=e==null?void 0:e.avg)==null?void 0:r.map(f=>f.key),min:(s=e==null?void 0:e.min)==null?void 0:s.map(f=>f.key),max:(a=e==null?void 0:e.max)==null?void 0:a.map(f=>f.key),distinctCount:(o=e==null?void 0:e.distinctCount)==null?void 0:o.map(f=>f.key),orderBy:(l=e==null?void 0:e.orderBy)==null?void 0:l.map(f=>{var u;return{...f,field:(u=f.field)==null?void 0:u.key}})}}translateFromJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.fromJson(e[n.key]);return t}translateToJson(e){let t={};for(const n of this.entity.fields)t[n.key]=n.valueConverter.toJson(e[n.key]);return t}async count(e){const{run:t}=this.buildFindRequest({where:e});return t("count").then(n=>+n.count)}async deleteMany(e){const{run:t}=this.buildFindRequest({where:e},"delete");return t("deleteMany").then(n=>+n.deleted)}async updateMany(e,t){const{run:n}=this.buildFindRequest({where:e},"put");return n("updateMany",this.toJsonOfIncludedKeys(t)).then(r=>+r.updated)}async upsertMany(e){const{run:t}=this.buildFindRequest(void 0);return t("upsertMany",e.map(n=>({where:this.toJsonOfIncludedKeys(n.where),set:n.set!==void 0?this.toJsonOfIncludedKeys(n.set):void 0}))).then(n=>n.map(r=>this.translateFromJson(r)))}find(e){let{run:t}=this.buildFindRequest(e);return t().then(n=>n.map(r=>this.translateFromJson(r)))}buildFindRequest(e,t){t||(t="get");let n=new ar(this.url()),r;if(e){if(e.where&&(r=e.where.toJson(),Eo(r,n)&&(r=void 0)),e.orderBy&&e.orderBy.Segments){let a="",o="",l=!1;e.orderBy.Segments.forEach(f=>{a.length>0&&(a+=",",o+=","),a+=f.field.key,o+=f.isDescending?"desc":"asc",f.isDescending&&(l=!0)}),a&&n.add("_sort",a),l&&n.add("_order",o)}e.limit&&n.add("_limit",e.limit),e.page&&n.add("_page",e.page)}const s=(a,o)=>{let l=new ar(n.url);if(!a&&r&&(a="get"),a&&l.add("__action",a),r){if(t==="put")return this.http().post(l.url,{set:o,where:r});o={...o,where:r}}return o&&t!="put"?this.http().post(l.url,o):this.http()[t](l.url,o)};return{createKey:()=>JSON.stringify({url:n,filterObject:r}),run:s,subscribe:async a=>({result:await s(Fo+a),unsubscribe:async()=>F.actionInfo.runActionWithoutBlockingUI(()=>this.http().post(this.url()+"?__action=endLiveQuery",{id:a}))})}}update(e,t){return this.http().put(this.url()+(e!=""?"/"+encodeURIComponent(e):"?__action=emptyId"),this.toJsonOfIncludedKeys(t)).then(n=>this.translateFromJson(n))}toJsonOfIncludedKeys(e){let t={},n=Object.keys(e);for(const r of this.entity.fields)n.includes(r.key)&&(t[r.key]=r.valueConverter.toJson(e[r.key]));return t}async delete(e){if(e=="")await this.deleteMany(q.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)));else return this.http().delete(this.url()+"/"+encodeURIComponent(e))}insert(e){return this.http().post(this.url(),this.translateToJson(e)).then(t=>this.translateFromJson(t))}insertMany(e){return this.http().post(this.url(),e.map(t=>this.translateToJson(t))).then(t=>t.map(n=>this.translateFromJson(n)))}}class or{constructor(e){d(this,"fetch");this.fetch=e}async get(e){return await On(async()=>this.myFetch(e).then(t=>t))}put(e,t){return this.myFetch(e,{method:"put",body:JSON.stringify(t)})}delete(e){return this.myFetch(e,{method:"delete"})}async post(e,t){return await On(()=>this.myFetch(e,{method:"post",body:JSON.stringify(t)}))}myFetch(e,t){const n={};if(t!=null&&t.body&&(n["Content-type"]="application/json"),typeof window<"u"&&typeof window.document<"u"&&typeof(window.document.cookie!=="undefined"))for(const r of window.document.cookie.split(";"))r.trim().startsWith("XSRF-TOKEN=")&&(n["X-XSRF-TOKEN"]=r.split("=")[1]);return(this.fetch||fetch)(e,{credentials:"include",method:t==null?void 0:t.method,body:t==null?void 0:t.body,headers:n}).then(r=>Co(r)).catch(async r=>{throw await r})}}function Co(i){if(i.status!=204){if(i.status>=200&&i.status<300)return i.json();throw i.json().then(e=>({...e,message:e.message||i.statusText,url:i.url,status:i.status})).catch(()=>{throw{message:i.statusText,url:i.url,status:i.status}})}}function Eo(i,e){for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t];if(Array.isArray(n)&&(n.length>0&&typeof n[0]=="object"||n.length>10)||t==="NOT")return!1}for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t];Array.isArray(n)?t.endsWith(".in")?e.add(t,JSON.stringify(n)):n.forEach(r=>e.add(t,r)):t.startsWith(dt)?e.add(t,JSON.stringify(n)):e.add(t,n)}return!0}const Fo="liveQuery-";var cn,To=new Uint8Array(16);function Po(){if(!cn&&(cn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!cn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cn(To)}const Do=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ro(i){return typeof i=="string"&&Do.test(i)}var ve=[];for(var Kn=0;Kn<256;++Kn)ve.push((Kn+256).toString(16).substr(1));function Bo(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(ve[i[e+0]]+ve[i[e+1]]+ve[i[e+2]]+ve[i[e+3]]+"-"+ve[i[e+4]]+ve[i[e+5]]+"-"+ve[i[e+6]]+ve[i[e+7]]+"-"+ve[i[e+8]]+ve[i[e+9]]+"-"+ve[i[e+10]]+ve[i[e+11]]+ve[i[e+12]]+ve[i[e+13]]+ve[i[e+14]]+ve[i[e+15]]).toLowerCase();if(!Ro(t))throw TypeError("Stringified UUID is invalid");return t}function ci(i,e,t){i=i||{};var n=i.random||(i.rng||Po)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Bo(n)}class Te{constructor(...e){d(this,"Segments");this.Segments=e}toEntityOrderBy(){let e={};for(const t of this.Segments)t.isDescending?e[t.field.key]="desc":e[t.field.key]="asc";return e}reverse(){let e=new Te;for(const t of this.Segments)e.Segments.push({field:t.field,isDescending:!t.isDescending});return e}compare(e,t,n){n||(n=r=>r.key);for(let r=0;r<this.Segments.length;r++){let s=this.Segments[r],a=e[n(s.field)],o=t[n(s.field)],l=s.isDescending,f=Mo(a,o,l);if(f!=0)return f}return 0}static translateOrderByToSort(e,t){let n=new Te;if(t){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r];let a=e.fields.find(r);const o=l=>{switch(s){case"desc":n.Segments.push({field:l,isDescending:!0});break;case"asc":n.Segments.push({field:l})}};if(a){const l=ce(a);if((l==null?void 0:l.type)==="toOne"){const f=l.options;if(typeof f.field=="string")o(e.fields.find(f.field));else if(f.fields){for(const u in f.fields)if(Object.prototype.hasOwnProperty.call(f.fields,u)){const c=f.fields[u];o(e.fields.find(c.toString()))}}}else o(a)}}}return n}static createUniqueSort(e,t){(!t||Object.keys(t).length===0)&&e.options.defaultOrderBy&&(t=Te.translateOrderByToSort(e,e.options.defaultOrderBy)),t||(t=new Te);for(const n of e.idMetadata.fields)t.Segments.find(r=>r.field==n)||t.Segments.push({field:n});return t}static createUniqueEntityOrderBy(e,t){(!t||Object.keys(t).length===0)&&(t=e.options.defaultOrderBy),t?t={...t}:t={};for(const n of e.idMetadata.fields)t[n.key]||(t[n.key]="asc");return t}}function Mo(i,e,t){i=lr(i),e=lr(e);let n=0;return i>e?n=1:i<e&&(n=-1),t&&(n*=-1),n}function lr(i){return i==null||i==null?i:i.id!==void 0?i.id:i}const Xn="stream";class No{constructor(e,t,n){d(this,"repo");d(this,"query");d(this,"queryChannel");d(this,"subscribeCode");d(this,"unsubscribe",()=>{});d(this,"defaultQueryState",[]);d(this,"listeners",[]);d(this,"id",ci());this.repo=e,this.query=t,this.queryChannel=`users:${n}:queries:${this.id}`,this.id=this.queryChannel}sendDefaultState(e){e(this.createReducerType(()=>[...this.defaultQueryState],this.allItemsMessage(this.defaultQueryState)))}async setAllItems(e){const t=await ht(this.repo)._fromJsonArray(e,this.query.options);this.forListeners(n=>{n(()=>t)},this.allItemsMessage(t))}allItemsMessage(e){return[{type:"all",data:e}]}forListeners(e,t){e(n=>{if(this.defaultQueryState=n(this.defaultQueryState),t.find(r=>r.type==="add"||r.type==="replace")&&this.query.options.orderBy){const r=Te.translateOrderByToSort(this.repo.metadata,this.query.options.orderBy);this.defaultQueryState.sort((s,a)=>r.compare(s,a))}});for(const n of this.listeners)e(r=>{n.next(this.createReducerType(r,t))})}createReducerType(e,t){return{applyChanges:e,changes:t,items:this.defaultQueryState}}async handle(e){{let t=e.filter(({type:r})=>r=="add"||r=="replace"),n=await ht(this.repo)._fromJsonArray(t.map(r=>r.data.item),this.query.options);for(let r=0;r<t.length;r++){const s=t[r];s.data.item=n[r]}}this.forListeners(t=>{t(n=>{n||(n=[]);for(const r of e)switch(r.type){case"all":this.setAllItems(r.data);break;case"replace":{n=n.map(s=>this.repo.metadata.idMetadata.getId(s)===r.data.oldId?r.data.item:s);break}case"add":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==this.repo.metadata.idMetadata.getId(r.data.item)),n.push(r.data.item);break;case"remove":n=n.filter(s=>this.repo.metadata.idMetadata.getId(s)!==r.data.id);break}return n})},e)}}const Lo="_liveQueryKeepAlive";class qo{constructor(e,t){d(this,"apiProvider");d(this,"getUserId");d(this,"queries",new Map);d(this,"channels",new Map);d(this,"client");d(this,"interval");this.apiProvider=e,this.getUserId=t}wrapMessageHandling(e){var t=this.apiProvider().wrapMessageHandling;t?t(e):e()}hasQueriesForTesting(){return this.queries.size>0}runPromise(e){return e}close(){this.queries.clear(),this.channels.clear(),this.closeIfNoListeners()}async subscribeChannel(e,t){let n=()=>{};const r=await this.openIfNoOpened();try{let s=this.channels.get(e);if(!s){this.channels.set(e,s=new $o);try{s.unsubscribe=await r.subscribe(e,a=>this.wrapMessageHandling(()=>s.handle(a)),a=>{t.error(a)})}catch(a){throw t.error(a),a}}s.listeners.push(t),n=()=>{s.listeners.splice(s.listeners.indexOf(t),1),s.listeners.length==0&&(this.channels.delete(e),s.unsubscribe()),this.closeIfNoListeners()}}catch(s){throw t.error(s),s}return()=>{n(),n=()=>{}}}closeIfNoListeners(){this.client&&this.queries.size===0&&this.channels.size===0&&(this.runPromise(this.client.then(e=>e.close())),this.client=void 0,clearInterval(this.interval),this.interval=void 0)}subscribe(e,t,n){let r=!0,s=()=>{r=!1};return this.runPromise(ht(e)._buildEntityDataProviderFindOptions(t).then(a=>{if(!r)return;const{createKey:o,subscribe:l}=new fi(this.apiProvider).getEntityDataProvider(e.metadata).buildFindRequest(a),f=o();let u=this.queries.get(f);u?u.sendDefaultState(n.next):(this.queries.set(f,u=new No(e,{entityKey:e.metadata.key,options:t},this.getUserId())),u.subscribeCode=()=>{u.unsubscribe&&(u.unsubscribe(),u.unsubscribe=()=>{}),this.runPromise(this.subscribeChannel(u.queryChannel,{next:c=>this.runPromise(u.handle(c)),complete:()=>{},error:c=>{u.listeners.forEach(h=>h.error(c))}}).then(c=>{if(u.listeners.length==0){c();return}this.runPromise(l(u.queryChannel).then(h=>{if(u.listeners.length===0){h.unsubscribe(),c();return}this.runPromise(u.setAllItems(h.result)),u.unsubscribe=()=>{u.unsubscribe=()=>{},c(),this.runPromise(h.unsubscribe())}}).catch(h=>{u.listeners.forEach(p=>p.error(h)),c(),this.queries.delete(f)}))})).catch(c=>{u.listeners.forEach(h=>h.error(c))})},u.subscribeCode()),u.listeners.push(n),s=()=>{u.listeners.splice(u.listeners.indexOf(n),1),n.complete(),u.listeners.length==0&&(this.queries.delete(f),u.unsubscribe()),this.closeIfNoListeners()}}).catch(a=>{n.error(a)})),()=>{s()}}openIfNoOpened(){return this.client?this.client:(this.interval=setInterval(async()=>{const e=[];for(const t of this.queries.values())e.push(t.queryChannel);if(e.length>0){let t=this.apiProvider();const n=await this.runPromise(await F.actionInfo.runActionWithoutBlockingUI(()=>Et(t.httpClient).post(t.url+"/"+Lo,e)));for(const r of n)for(const s of this.queries.values())s.queryChannel===r&&s.subscribeCode()}},3e4),this.runPromise(this.client=this.apiProvider().subscriptionClient.openConnection(()=>{for(const e of this.queries.values())e.subscribeCode()})))}}class $o{constructor(){d(this,"unsubscribe",()=>{});d(this,"listeners",[])}async handle(e){for(const t of this.listeners)t.next(e)}}class Ei{openConnection(e){let t;const n=new Map,r=Et(Se.apiClient.httpClient);let s=!1,a;const o={close(){a.close()},async subscribe(u,c){let h=n.get(u);return h||(n.set(u,h=[]),await f(u)),h.push(c),()=>{h.splice(h.indexOf(c,1)),h.length==0&&(F.actionInfo.runActionWithoutBlockingUI(()=>r.post(Se.apiClient.url+"/"+Xn+"/unsubscribe",{channel:u,clientId:t})),n.delete(u))}}},l=()=>new Promise(u=>{h();let c=0;function h(){a&&a.close(),a=Ei.createEventSource(Se.apiClient.url+"/"+Xn),a.onmessage=p=>{let m=JSON.parse(p.data);const y=n.get(m.channel);y&&y.forEach(_=>_(m.data))},a.onerror=p=>{console.error("Live Query Event Source Error",p),a.close(),c++<qr.error500RetryCount&&setTimeout(()=>{h()},500)},a.addEventListener("connectionId",async p=>{if(t=p.data,s){for(const m of n.keys())await f(m);e()}else s=!0,u(o)})}});return l();async function f(u){await F.actionInfo.runActionWithoutBlockingUI(()=>r.post(Se.apiClient.url+"/"+Xn+"/subscribe",{channel:u,clientId:t}))===jo&&await l()}}static createEventSource(e){return new EventSource(e,{withCredentials:!0})}}const jo="client connection not found",di=Symbol.for("serverActionField");class Jo{constructor(e){d(this,"remultObjectStorage");this.remultObjectStorage=e}static enable(){F.remultFactory=()=>{const e=F.asyncContext.getStore();if(e)return e.remult;throw new Error("remult object was requested outside of a valid request cycle.valid context, try running `withRemult` or run  within initApi or a remult request cycle")}}static disable(){wo()}async run(e,t){return this.remultObjectStorage?this.remultObjectStorage.run({remult:e},()=>t(e)):t(e)}isInInitRequest(){var e,t;return(t=(e=this.remultObjectStorage)==null?void 0:e.getStore())==null?void 0:t.inInitRequest}setInInitRequest(e){var n,r;const t=(n=this.remultObjectStorage)==null?void 0:n.getStore();t&&(e||(r=this.remultObjectStorage)!=null&&r.isStub)&&(t.inInitRequest=e)}getStore(){if(!this.remultObjectStorage)throw new Error("can't use static remult in this environment, `async_hooks` were not initialized");return this.remultObjectStorage.getStore()}}F.asyncContext||(F.asyncContext=new Jo(void 0));function Qt(){return F.actionInfo.runningOnServer||!Se.dataProvider.isProxy}class je{constructor(e){d(this,"repo",(e,t)=>{t===void 0&&(t=this.dataProvider);let n=this.repCache.get(t);n||this.repCache.set(t,n=new Map);let r=n.get(e);return r||(n.set(e,r=new Fi(e,this,t,Zo(e,this))),co(r,this,t)),r});d(this,"user");d(this,"dataProvider",new fi(()=>this.apiClient));d(this,"repCache",new Map);d(this,"liveQueryStorage");d(this,"subscriptionServer");d(this,"liveQueryPublisher",{itemChanged:async()=>{}});d(this,"liveQuerySubscriber",new qo(()=>this.apiClient,()=>{var e;return(e=this.user)==null?void 0:e.id}));d(this,"context",{});d(this,"apiClient",{url:"/api",subscriptionClient:new Ei});if(e&&e.getEntityDataProvider){this.dataProvider=e;return}if($r(e))this.apiClient.httpClient=e;else if(typeof e=="function")this.apiClient.httpClient=e;else if(e){const t=e;t.httpClient&&(this.apiClient.httpClient=t.httpClient),t.url&&(this.apiClient.url=t.url),t.subscriptionClient&&(this.apiClient.subscriptionClient=t.subscriptionClient),t.wrapMessageHandling&&(this.apiClient.wrapMessageHandling=t.wrapMessageHandling)}}async initUser(){const t=await Et(this.apiClient.httpClient).get(jr(this.apiClient.url,"me"));return this.user=(t==null?void 0:t.id)!=null?t:void 0,this.user}authenticated(){var e;return((e=this.user)==null?void 0:e.id)!==void 0}isAllowed(e){var t,n;if(e!=null){if(e instanceof Array){for(const r of e)if(this.isAllowed(r)===!0)return!0;return!1}return typeof e=="function"?e(this):typeof e=="boolean"?e:!!(typeof e=="string"&&(n=(t=this.user)==null?void 0:t.roles)!=null&&n.includes(e.toString()))}}isAllowedForInstance(e,t){if(Array.isArray(t)){for(const n of t)if(this.isAllowedForInstance(e,n))return!0}else return typeof t=="function"?t(e,this):this.isAllowed(t)}useFetch(e){this.dataProvider=new fi(()=>({httpClient:e}))}call(e,t,...n){const r=e[di];if(!r.doWork)throw Error("The method received is not a valid backend method");return r.doWork(n,t,this.apiClient.url,Et(this.apiClient.httpClient))}clearAllCache(){this.repCache.clear()}}d(je,"onFind",(e,t)=>{}),d(je,"entityRefInit");F.defaultRemultFactory=()=>new je;class Jr{constructor(){d(this,"classes",new Map)}}function Uo(i,e){let t=i;for(;;){let n=F.classHelpers.get(t);n||F.classHelpers.set(t,n=new Jr),n.classes.set(i,e);let r=Object.getPrototypeOf(t.prototype);if(r==null)break;t=r.constructor}}const Vo={defaultPageSize:200};async function Wo(i,e){const t=new Ho(i.liveQueryPublisher);let n=!0;const r=i.dataProvider;try{await i.dataProvider.transaction(async s=>{i.dataProvider=s,i.liveQueryPublisher=t,await e(s),n=!0}),n&&await t.flush()}finally{i.dataProvider=r}}class Ho{constructor(e){d(this,"orig");d(this,"transactionItems",new Map);this.orig=e}async itemChanged(e,t){let n=this.transactionItems.get(e);n||this.transactionItems.set(e,n=[]);for(const r of t)if(r.oldId!==void 0){const s=n.find(a=>a.id===r.oldId);s!==void 0?(r.deleted&&(s.deleted=!0),r.id!=s.id&&(s.id=r.id)):n.push(r)}else n.push(r)}async flush(){for(const e of this.transactionItems.keys())await this.orig.itemChanged(e,this.transactionItems.get(e))}}function jt(i,e){return e&&Object.assign(i,e),i}class Ur extends Error{constructor(t){super(t.message);d(this,"modelState");d(this,"stack");d(this,"exception");d(this,"httpStatusCode");Object.assign(this,t)}}class Ge{}d(Ge,"number","number"),d(Ge,"date","date"),d(Ge,"checkbox","checkbox"),d(Ge,"password","password"),d(Ge,"email","email"),d(Ge,"tel","tel"),d(Ge,"time","time");const z=class z{};d(z,"Date",{toJson:e=>{if(e===null)return null;if(!e)return"";if(typeof e=="string"&&(e=new Date(e)),e instanceof Date)return e.toISOString();throw new Error("Expected date but got "+e)},fromJson:e=>{if(e===null)return null;if(e!=null&&e!=""&&!e.startsWith("0000-00-00"))return new Date(Date.parse(e))},toDb:e=>e,fromDb:e=>{if(typeof e=="number"&&(e=new Date(e)),typeof e=="string"&&(e=new Date(e)),e&&!(e instanceof Date))throw"expected date but got "+e;return e},fromInput:e=>z.Date.fromJson(e),toInput:e=>z.Date.toJson(e),displayValue:e=>e?e.toLocaleString():""}),d(z,"DateOnly",{fromInput:e=>z.DateOnly.fromJson(e),toInput:e=>z.DateOnly.toJson(e),toJson:e=>{var t=e;return(typeof t=="string"||typeof t=="number")&&(t=new Date(t)),!t||t==null?null:t.getHours()==0?new Date(t.valueOf()-t.getTimezoneOffset()*6e4).toISOString().substring(0,10):t.toISOString().substring(0,10)},fromJson:e=>{if(!e||e==""||e=="0000-00-00")return null;let t=new Date(Date.parse(e));return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},inputType:Ge.date,toDb:e=>e?z.DateOnly.fromJson(z.DateOnly.toJson(e)):null,fromDb:e=>z.Date.fromDb(e),fieldTypeInDb:"date",displayValue:e=>e?e.toLocaleDateString(void 0):""}),d(z,"DateOnlyString",{...z.DateOnly,toDb:e=>{let t=z.DateOnly.toJson(e);if(t)return t.replace(/-/g,"")},fromDb:e=>{if(e===null)return null;if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))}}),d(z,"Boolean",{toDb:e=>e,inputType:Ge.checkbox,fromDb:e=>z.Boolean.fromJson(e),fromJson:e=>typeof e=="boolean"?e:e===1?!0:e!=null?e.toString().trim().toLowerCase()=="true":e,toJson:e=>e,fromInput:e=>z.Boolean.fromJson(e),toInput:e=>z.Boolean.toJson(e)}),d(z,"Number",{fromDb:e=>{if(e===null)return null;if(e!==void 0)return+e},toDb:e=>e,fromJson:e=>z.Number.fromDb(e),toJson:e=>z.Number.toDb(e),fromInput:(e,t)=>{let n=+e;if(e!=null)return n},toInput:(e,t)=>(e==null?void 0:e.toString())??"",inputType:Ge.number}),d(z,"String",{fromDb:bt,toDb:bt,fromJson:bt,toJson:bt,fromInput:bt,toInput:bt}),d(z,"Integer",{...z.Number,toJson:e=>{let t=z.Number.toDb(e);return t&&+(+t).toFixed(0)},toDb:e=>z.Integer.toJson(e),fieldTypeInDb:"integer"}),d(z,"Default",{fromJson:e=>e,toJson:e=>e,fromDb:e=>z.JsonString.fromDb(e),toDb:e=>z.JsonString.toDb(e),fromInput:e=>z.Default.fromJson(e),toInput:e=>z.Default.toJson(e),displayValue:e=>e+"",fieldTypeInDb:"",inputType:"text"}),d(z,"JsonString",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e==null?null:e?JSON.parse(z.JsonString.fromJson(e)):void 0,toDb:e=>e!==void 0?e===null?null:JSON.stringify(z.JsonString.toJson(e)):void 0,fromInput:e=>z.JsonString.fromJson(e),toInput:e=>z.JsonString.toJson(e)}),d(z,"JsonValue",{fromJson:e=>e,toJson:e=>e,fromDb:e=>e,toDb:e=>e,fromInput:e=>z.JsonString.fromJson(e),toInput:e=>z.JsonString.toJson(e),fieldTypeInDb:"json"});let Ae=z;function bt(i){return i==null?i:typeof i!="string"?i.toString():i}function Zn(i,e,t){let n=q.fromEntityFilter(i,e);const r=()=>{};n&&n.__applyToConsumer({custom:r,databaseCustom:r,containsCaseInsensitive:r,notContainsCaseInsensitive:r,startsWithCaseInsensitive:r,endsWithCaseInsensitive:r,isDifferentFrom:r,isEqualTo:(s,a)=>{t[s.key]=a},isGreaterOrEqualTo:r,isGreaterThan:r,isIn:r,isLessOrEqualTo:r,isLessThan:r,isNotNull:r,isNull:r,not:r,or:r})}class Jt{constructor(){d(this,"entityLoaders",new Map);d(this,"promises",[])}load(e,t){let n=this.entityLoaders.get(e.entityType);n||this.entityLoaders.set(e.entityType,n=new Go(e));const r=n.find(t);return this.promises.push(r),r}async resolveAll(){for(const t of this.entityLoaders.values())for(const n of t.queries.values())n.resolve();if(this.promises.length===0)return;const e=this.promises;this.promises=[],await Promise.all(e),await this.resolveAll()}}class Go{constructor(e){d(this,"rel");d(this,"queries",new Map);this.rel=e}find(e){const{where:t,...n}=Ci(e,this.rel.metadata),r=JSON.stringify(n);let s=this.queries.get(r);return s||this.queries.set(r,s=new Qo(this.rel)),s.find(e,t)}}class Qo{constructor(e){d(this,"rel");d(this,"pendingInStatements",new Map);d(this,"whereVariations",new Map);this.rel=e}find(e,t){const n=JSON.stringify(t);let r=this.whereVariations.get(n);if(!r){const s=Object.keys(t);if(s.length===1&&typeof t[s[0]]!="object"&&!e.limit){let a=this.pendingInStatements.get(s[0]);a||this.pendingInStatements.set(s[0],a=new zo(this.rel,s[0],e)),this.whereVariations.set(n,r={result:a.find(t)})}else this.whereVariations.set(n,r={result:this.rel.find(e)})}return r.result}resolve(){const e=[...this.pendingInStatements.values()];this.pendingInStatements.clear();for(const t of e)t.resolve()}}class zo{constructor(e,t,n){d(this,"rel");d(this,"key");d(this,"options");d(this,"values",new Map);this.rel=e,this.key=t,this.options=n}async resolve(){const e=[...this.values.values()];if(e.length==1){this.rel.find(this.options).then(e[0].resolve,e[0].reject);return}var t={...this.options};t.where={[this.key]:e.map(r=>r.value)},t.limit=1e3,t.page=1;let n=[];try{for(;;){const r=await this.rel.find(t);if(n.push(...r),r.length<t.limit)break;t.page++}for(const r of this.values.values())r.resolve(n.filter(s=>{const o=oe(s).fields.find(this.key),l=ce(o.metadata),f=(l==null?void 0:l.type)==="reference"?o.getId():s[this.key];return r.value==f}))}catch(r){for(const s of this.values.values())s.reject(r)}}find(e){const t=e[this.key];let n=this.values.get(t);if(!n){let r,s,a=new Promise((o,l)=>{r=o,s=l});this.values.set(t,n={value:t,resolve:r,reject:s,result:a})}return n.result}}F.actionInfo;const we=class we{};d(we,"required",Ut(async(e,t)=>!t.valueIsNull()&&t.value!==""&&(t.value!==void 0||ce(t.metadata)!==void 0),"Should not be empty")),d(we,"unique",Ut(async(e,t)=>{if(!t.entityRef)throw"unique validation may only work on columns that are attached to an entity";return t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0},"already exists")),d(we,"uniqueOnBackend",Ut(async(e,t)=>t.isBackend()&&(t.isNew||t.valueChanged())?await t.entityRef.repository.count({[t.metadata.key]:t.value})==0:!0,we.unique.defaultMessage)),d(we,"regex",tt((e,t)=>t.test(e))),d(we,"email",gn(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),"Invalid Email")),d(we,"url",gn(e=>!!new URL(e),"Invalid Url")),d(we,"in",tt((e,t)=>t.includes(e),e=>`Value must be one of: ${e.map(t=>typeof t=="object"?(t==null?void 0:t.id)!==void 0?t==null?void 0:t.id:t==null?void 0:t.toString():t).join(", ")}`)),d(we,"notNull",gn(e=>e!=null,"Should not be null")),d(we,"enum",tt((e,t)=>Object.values(t).includes(e),e=>`Value must be one of ${wn(e).join(", ")}`)),d(we,"relationExists",Ut(async(e,t)=>t.valueIsNull()||!t.isBackend()?!0:!!await t.load(),"Relation value does not exist")),d(we,"min",tt((e,t)=>e>=t,e=>`Value must be bigger than or equal to ${e}`)),d(we,"max",tt((e,t)=>e<=t,e=>`Value must be smaller than or equal to ${e}`)),d(we,"maxLength",tt((e,t)=>e.length<=t,e=>`Value must be at most ${e} characters`)),d(we,"minLength",tt((e,t)=>e.length>=t,e=>`Value must be at least ${e} characters`)),d(we,"range",tt((e,[t,n])=>e>=t&&e<=n,([e,t])=>`Value must be between ${e} and ${t}`)),d(we,"defaultMessage","Invalid value");let Me=we;function Ut(i,e){const t=async(r,s,a)=>{const o=await i(r,s);typeof o=="string"&&o.length>0?s.error=o:o||(s.error=typeof a=="function"&&a(r,s,void 0)||a||typeof e=="function"&&e(r,s,void 0)||e||Me.defaultMessage)},n=(r,s,a)=>typeof r=="string"||r==="function"||r===void 0&&s===void 0?async(o,l,f)=>await t(o,l,r||f):t(r,s,a);return Object.defineProperty(n,"defaultMessage",{get:()=>e,set:r=>{e=r},enumerable:!0}),Object.assign(n,{withMessage:r=>async(s,a)=>n(s,a,r)})}function gn(i,e){return Ut((t,n)=>n.value===void 0||n.value===null?!0:i(n.value),e)}function tt(i,e){const t=Ko((n,r,s)=>r.value===void 0||r.value===null?!0:i(r.value,s),(n,r,s)=>typeof e=="function"&&e(s)||e,!0);return Object.assign((n,r)=>t(n,r),{get defaultMessage(){return e},set defaultMessage(n){e=n}})}function Ko(i,e,t=!1){return Object.assign((r,s)=>async(a,o)=>{const l=await i(a,o,r);typeof l=="string"?o.error=l:l||(o.error=s?typeof s=="function"?t?s(r):s(a,o,r):s:e?typeof e=="function"?e(a,o,r):e:Me.defaultMessage)},{get defaultMessage(){return e},set defaultMessage(r){e=r}})}function wn(i){return Object.values(i).filter(e=>typeof i[e]!="number")}function _n(i,e,t=!1){if(!e)return i;const n=Array.isArray(e)?e:[e],r=Array.isArray(i)?i:i?[i]:[];return t?[...n,...r]:[...r,...n]}function Ct(i,e){return typeof i[e]<"u"}class Xo{constructor(e,t){d(this,"options");d(this,"repo");d(this,"_count");d(this,"_aggregates");this.options=e,this.repo=t,this.options||(this.options={}),this.options.pageSize||(this.options.pageSize=Vo.defaultPageSize)}async getPage(e){return(e??0)<1&&(e=1),this.repo.find({where:this.options.where,orderBy:this.options.orderBy,limit:this.options.pageSize,page:e,load:this.options.load,include:this.options.include})}async count(){return this._count===void 0&&(this._count=await this.repo.count(this.options.where)),this._count}async forEach(e){let t=0;for await(const n of this)await e(n),t++;return t}async paginator(e){this.options.orderBy=Te.createUniqueEntityOrderBy(this.repo.metadata,this.options.orderBy);let t={where:{$and:[this.options.where,e]},orderBy:this.options.orderBy,limit:this.options.pageSize,load:this.options.load,include:this.options.include},n=()=>this.repo.find(t);if(this._aggregates===void 0&&Ct(this.options,"aggregate")){let o=this.options.aggregate;if(this.repo._dataProvider.isProxy){const l=new Jt;n=()=>this.repo._rawFind(t,!1,l,async f=>{const u=await this.repo._edp.query(f,await this.repo.__buildGroupByOptions(o));return this._aggregates=u.aggregates,u.items}).then(async f=>(await l.resolveAll(),f))}else{let l=n();n=async()=>(this._aggregates=await this.repo.aggregate({...o,where:this.options.where}),this._count=this._aggregates.$count,l)}}let r=await n(),s=()=>{throw new Error("no more pages")},a=r.length==this.options.pageSize;if(a){let o=await this.repo._createAfterFilter(this.options.orderBy,r[r.length-1]);s=()=>this.paginator(o)}return{count:()=>this.count(),hasNextPage:a,items:r,nextPage:s,aggregates:this._aggregates}}[Symbol.asyncIterator](){this.options.where||(this.options.where={});let e=this.options.orderBy;this.options.orderBy=Te.createUniqueEntityOrderBy(this.repo.metadata,e);let t=-1,n,r,s=0;return r=async()=>{if(this.options.progress&&this.options.progress.progress(s++/await this.count()),n===void 0||t==n.items.length){if(n&&!n.hasNextPage)return{value:void 0,done:!0};let a=n;if(n?n=await n.nextPage():n=await this.paginator(),t=0,n.items.length==0)return{value:void 0,done:!0};if(((a==null?void 0:a.items.length)??!1)&&this.repo.getEntityRef(a.items[0]).getId()==this.repo.getEntityRef(n.items[0]).getId())throw new Error("pagination failure, returned same first row")}return t<n.items.length?{value:n.items[t++],done:!1}:{done:!0,value:void 0}},{next:async()=>r()}}}class Fi{constructor(e,t,n,r,s){d(this,"_entity");d(this,"_remult");d(this,"_dataProvider");d(this,"_info");d(this,"_defaultFindOptions");d(this,"__edp");d(this,"_idCache",new Map);d(this,"listeners");d(this,"_cache",new Map);this._entity=e,this._remult=t,this._dataProvider=n,this._info=r,this._defaultFindOptions=s}_notFoundError(e){return{message:`id ${e} not found in entity ${this.metadata.key}`,httpStatusCode:404}}[Gt](){return this}async _createAfterFilter(e,t){let n=new Map;for(const a of Te.translateOrderByToSort(this.metadata,e).Segments){let o=t[a.field.key];n.set(a.field.key,o)}let r={$or:[]},s=[];for(const a of Te.translateOrderByToSort(this.metadata,e).Segments){let o={};for(const l of s)o[l.key]=n.get(l.key);s.push(a.field),a.isDescending?o[a.field.key]={$lt:n.get(a.field.key)}:o[a.field.key]={$gt:n.get(a.field.key)},r.$or.push(o)}return r}relations(e){return new Proxy({},{get:(t,n)=>{const r=this.fields.find(n),s=ce(r);if(!s)throw Error(n+" is not a relation");const{toRepo:a,returnNull:o,returnUndefined:l}=this._getFocusedRelationRepo(r,e);return s.type==="toMany"?a:{findOne:f=>o?Promise.resolve(null):l?Promise.resolve(void 0):a.findFirst({},f)}}})}_getFocusedRelationRepo(e,t){const n=ce(e);let r=n.toRepo,{findOptions:s,returnNull:a,returnUndefined:o}=this._findOptionsBasedOnRelation(n,e,void 0,t,r);return{toRepo:new Fi(r._entity,r._remult,r._dataProvider,r._info,s),returnNull:a,returnUndefined:o}}get _edp(){return this.__edp?this.__edp:this.__edp=this._dataProvider.getEntityDataProvider(this.metadata)}async aggregate(e){return(await this.groupBy(e))[0]}async groupBy(e){var t=await this.__buildGroupByOptions(e);const n=await this._edp.groupBy(t);if(!(e!=null&&e[vo])&&e.group){const r={include:{}};for(const a of e.group)r.include[a]=!0;const s=new Jt;await this._populateRelationsForFields(t.group,r,n,s),await s.resolveAll()}return n}async __buildGroupByOptions(e){var a,o,l,f,u,c;let t=await this._buildEntityDataProviderFindOptions({...e});const n=h=>{const p=this.metadata.fields.find(h);if(p===void 0)throw Error(`key "${h}" not found in entity`);return p},r=h=>{var p;if((p=e==null?void 0:e.group)!=null&&p.includes(h))throw Error(`field "${h}" cannot be used both in an aggregate and in group by`);return n(h)};var s={where:t.where,limit:t.limit,page:t.page,group:(a=e==null?void 0:e.group)==null?void 0:a.map(n),sum:(o=e==null?void 0:e.sum)==null?void 0:o.map(r),avg:(l=e==null?void 0:e.avg)==null?void 0:l.map(r),min:(f=e==null?void 0:e.min)==null?void 0:f.map(r),max:(u=e==null?void 0:e.max)==null?void 0:u.map(r),distinctCount:(c=e==null?void 0:e.distinctCount)==null?void 0:c.map(r)};if(e!=null&&e.orderBy){s.orderBy=[];for(const h in e.orderBy)if(Object.prototype.hasOwnProperty.call(e==null?void 0:e.orderBy,h)){const p=e.orderBy[h];if(p){if(typeof p=="string")s.orderBy.push({field:h==="$count"?void 0:n(h),isDescending:p==="desc",operation:h==="$count"?"count":void 0});else for(const m in p)if(Object.prototype.hasOwnProperty.call(p,m)){const y=p[m];s.orderBy.push({field:this.metadata.fields.find(h),isDescending:y==="desc",operation:m})}}}}return s}_getCachedById(e,t){e=e+"",this._getCachedByIdAsync(e,t);let n=this._idCache.get(e);if(!(n instanceof Promise))return n}async _getCachedByIdAsync(e,t){e=e+"";let n=this._idCache.get(e);if(n instanceof Promise)return await n;if(this._idCache.has(e))return n;if(t)return;this._idCache.set(e,void 0);let r=this.findId(e).then(s=>(s===void 0?n=null:n=s,this._idCache.set(e,n),n));return this._idCache.set(e,r),await r}_addToCache(e){e&&this._idCache.set(this.getEntityRef(e).getId()+"",e)}get metadata(){return this._info}addEventListener(e){return this.listeners||(this.listeners=[]),this.listeners.push(e),()=>{this.listeners.splice(this.listeners.indexOf(e),1)}}query(e){return new Xo(e,this)}getEntityRef(e){let t=e[ft];return t||(this._fixTypes(e),t=new dn(this._info,e,this,this._edp,this._remult,!0),Object.defineProperty(e,ft,{get:()=>t}),t.saveOriginalData()),t}async delete(e){const t=oe(e,!1);if(t)return t.delete();if(typeof e=="string"||typeof e=="number"){if(this._dataProvider.isProxy)return this._edp.delete(e);{let r=await this.findId(e);if(!r)throw this._notFoundError(e);return await oe(r).delete()}}let n=this._getRefForExistingRow(e,void 0);return this._dataProvider.isProxy||await n.reload(),n.delete()}__cleanupPartialObject(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n],s=this.fields[r];if(s){const a=ce(s);a&&a.type==="toOne"&&a.options.field&&t.indexOf(a.options.field)>n&&a.toRepo.getEntityRef(e[r]).getId()!==e[a.options.field]&&delete e[r]}}for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n],ce(this.fields[n]));for(const n of this.fields);}async insert(e){if(Array.isArray(e))if(this._dataProvider.isProxy){let t=[],n=[];for(const r of e){this.__cleanupPartialObject(r);let s=oe(e,!1);if(s){if(!s.isNew())throw"Item is not new"}else s=await this.getEntityRef(this.create(r));t.push(s),n.push(await s.buildDtoForInsert())}return At(await this._edp.insertMany(n),(r,s)=>t[s].processInsertResponseDto(r))}else{let t=[];for(const n of e)t.push(await this.insert(n));return t}else{let t=oe(e,!1);if(t){if(!t.isNew())throw"Item is not new";return await t.save()}else return this.__cleanupPartialObject(e),await this.getEntityRef(this.create(e)).save()}}get fields(){return this.metadata.fields}async validate(e,...t){{let n=oe(e,!1);if(n||(n=this.getEntityRef({...e})),!t||t.length===0)return await n.validate();{n.__clearErrorsAndReportChanged();let r=!1;for(const s of t)await n.fields.find(s).validate()||(r=!0);return r?n.buildErrorInfoObject():void 0}}}__createDto(e){this.__cleanupPartialObject(e);const n=this.getEntityRef({...e}).copyDataToObject(!1),r=Object.keys(e);for(const s of this.fields)(s.dbReadOnly||!r.includes(s.key))&&delete n[s.key];return n}async updateMany({where:e,set:t}){if(this.__cleanupPartialObject(t),q.throwErrorIfFilterIsEmpty(e,"updateMany"),this._dataProvider.isProxy)return this._edp.updateMany(await this._translateWhereToFilter(e),this.__createDto({...t}));{let n=0;for await(const r of this.query({where:e,aggregate:void 0}))jt(r,t),await oe(r).save(),n++;return n}}async update(e,t){{let r=oe(t,!1);if(r)return await r.save()}{let r=oe(e,!1);if(r)return jt(e,t),r.save()}this.__cleanupPartialObject(t);let n;if(typeof e=="object"?(n=this._getRefForExistingRow(e,this.metadata.idMetadata.getId(e)),Object.assign(n.instance,t)):n=this._getRefForExistingRow(t,e),this._dataProvider.isProxy)return await n.save(Object.keys(t));{const r=await n.reload();if(!r)throw this._notFoundError(n.id);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){let a=n.fields[s];if(t[s]===void 0&&ce(a.metadata))continue;a&&(r[s]=t[s])}return await this._fixTypes(r),await n.save()}}async upsert(e){if(this._dataProvider.isProxy){let s=await this._edp.upsertMany((Array.isArray(e)?e:[e]).map(l=>{var f;return(f=this._defaultFindOptions)!=null&&f.where&&(Zn(this.metadata,this._defaultFindOptions.where,l.where),this._fixTypes(l)),{where:this.__createDto(l.where),set:l.set?this.__createDto(l.set):void 0}}));const a=new Jt,o=await this._loadManyToOneForManyRows(s,{},a);return await a.resolveAll(),Array.isArray(e)?o:o[0]}if(Array.isArray(e))return At(e,s=>this.upsert(s));let t=e;var n=await this.findFirst(t.where,{createIfNotFound:!0}),r=oe(n,!1);return r.isNew()?(t.set&&jt(n,t.set),await r.save()):t.set?(jt(n,t.set),await r.save()):n}_getRefForExistingRow(e,t){let n=oe(e,!1);if(!n){const r=new this._entity(this._remult);for(const a of this._fieldsOf(e)){const o=a.key;r[o]=e[o]}this._fixTypes(r);let s=new dn(this._info,r,this,this._edp,this._remult,!1);typeof t=="object"&&(t=this.metadata.idMetadata.getId(t)),t?(s.id=t,s.originalId=t):s.id=s.getId(),n=s,Object.defineProperty(r,ft,{get:()=>s})}return n}async save(e){if(Array.isArray(e))return At(e,t=>this.save(t));{let t=oe(e,!1);if(t)return await t.save();if(e instanceof zr)return await this.getEntityRef(e).save();{let n=this.metadata.idMetadata.getId(e);return n===void 0?this.insert(e):this.update(n,e)}}}liveQuery(e){return e||(e={}),{subscribe:t=>{let n=t;return typeof t=="function"&&(n={next:t,complete:()=>{},error:()=>{}}),n.error??(n.error=()=>{}),n.complete??(n.complete=()=>{}),this._remult.liveQuerySubscriber.subscribe(this,e,n)}}}async _rawFind(e,t=!1,n,r){e||(e={}),this._defaultFindOptions&&(e={...this._defaultFindOptions,...e});let s=await this._buildEntityDataProviderFindOptions(e);t&&(delete s.orderBy,delete s.limit),je.onFind(this._info,e);const a=await r(s);return await this._loadManyToOneForManyRows(a,e,n)}async find(e,t=!1){const n=new Jt,r=await this._rawFind(e,t,n,s=>this._edp.find(s));return await n.resolveAll(),r}async _buildEntityDataProviderFindOptions(e){e={...e};let t={};return t={},(!e.orderBy||Object.keys(e.orderBy).length===0)&&(this._dataProvider.isProxy||(e.orderBy=this._info.entityInfo.defaultOrderBy)),t.where=await this._translateWhereToFilter(e.where),e.orderBy!==void 0&&(t.orderBy=Te.translateOrderByToSort(this.metadata,e.orderBy)),e.limit!==void 0&&(t.limit=e.limit),e.page!==void 0&&(t.page=e.page),t}async _fromJsonArray(e,t){const n=new Jt,r=await this._loadManyToOneForManyRows(e.map(s=>{let a={};for(const o of this.metadata.fields.toArray())a[o.key]=o.valueConverter.fromJson(s[o.key]);return a}),t,n);return await n.resolveAll(),r}async _loadManyToOneForManyRows(e,t,n){let r;t!=null&&t.load&&(r=t.load(this.metadata.fields));for(const f of this.metadata.fields)if(Pe(f.valueType,!1)&&!ce(f)){let h=!f.options.lazy;if(r!==void 0&&(h=r.includes(f)),h){let p=this._remult.repo(f.valueType),m=[];for(const y of e){let _=y[f.key];_!=null&&!m.includes(_)&&!p._idCache.has(_+"")&&m.push(_)}m.length>0&&await s(p,m)}}async function s(f,u){let c=await f.find({where:f.metadata.idMetadata.getIdFilter(...u)},!0);for(const h of c)f._addToCache(h)}const a=new Set(this.fields.toArray().map(f=>{const u=this.__getRelationAndInclude(f,t);if(u.rel&&!u.incl)return f.key}).filter(f=>f!==void 0));let o=await At(e,async f=>await this._mapRawDataToResult(f,r,a));const l=this.metadata.fields.toArray();return this._populateRelationsForFields(l,t,o,n),o}_populateRelationsForFields(e,t,n,r){for(const s of e){let{rel:a,incl:o}=this.__getRelationAndInclude(s,t);if(a)if(o){const l=a.toRepo;for(const f of n){let{findOptions:u,returnNull:c}=this._findOptionsBasedOnRelation(a,s,o,f,l);const h=s.key;if(c)f[h]=null;else{const p=a.toEntity,m=l;r.load({entityType:p,find:y=>m._rawFind(y,!1,r,_=>m._edp.find(_)),metadata:m.metadata},u).then(y=>{y.length==0&&a.type=="toOne"||(f[h]=a.type!=="toMany"?y.length==0?null:y[0]:y)})}}}else for(const l of n)Reflect.deleteProperty(l,s.key)}}__getRelationAndInclude(e,t){var a;let n=ce(e),r=e.options.defaultIncluded;const s=(a=t==null?void 0:t.include)==null?void 0:a[e.key];return s!==void 0&&(r=s),{rel:n,incl:r}}_findOptionsBasedOnRelation(e,t,n,r,s){let a=!1,o=!1,l=[],f={},u=[];typeof e.options.findOptions=="function"?u.push(e.options.findOptions(r)):typeof e.options.findOptions=="object"&&u.push(e.options.findOptions),typeof n=="object"&&u.push(n);for(const p of u){p.where&&l.push(p.where);for(const m of["limit","include","orderBy"])p[m]&&(f[m]=p[m])}const c=e.getFields(),h=p=>{const m=oe(r,!1);let y=e.type==="reference"&&m?m.fields.find(t.key).getId():r[p];return(e.type==="toOne"||e.type==="reference")&&(y===null?a=!0:y===void 0?o=!0:e.type==="reference"&&typeof y=="object"&&(y=s.metadata.idMetadata.getId(y))),y};c.compoundIdField&&(e.type==="toMany"?l.push({[c.compoundIdField]:this.metadata.idMetadata.getId(r)}):l.push(s.metadata.idMetadata.getIdFilter(h(c.compoundIdField))));for(const p in c.fields)Object.prototype.hasOwnProperty.call(c.fields,p)&&l.push({[p]:h(c.fields[p])});return f.where={$and:l},(e.type==="toOne"||e.type==="reference")&&f.orderBy&&(f.limit=1),{findOptions:f,returnNull:a,returnUndefined:o}}async _mapRawDataToResult(e,t,n){let r=new this._entity(this._remult),s=new dn(this._info,r,this,this._edp,this._remult,!1,n);return Object.defineProperty(r,ft,{get:()=>s}),await s.loadDataFrom(e,t),s.saveOriginalData(),r}toJson(e){return e==null?e:Array.isArray(e)?e.map(t=>this.toJson(t)):typeof e.then=="function"?e.then(t=>this.toJson(t)):this.getEntityRef(e).toApiJson(!0)}fromJson(e,t){if(e==null)return e;if(Array.isArray(e))return e.map(r=>this.fromJson(r,t));let n=new this._entity(this._remult);for(const r of this._fieldsOf(e)){const s=r.key;if(Pe(r.valueType,!1)){let o=e[r.key];typeof o=="string"||typeof o=="number"?n[s]=o:n[s]=this._remult.repo(r.valueType).fromJson(o)}else e[s]!==void 0&&(n[s]=r.valueConverter.fromJson(e[r.key]))}if(this._fixTypes(n),t)return this.create(n);{let r=new dn(this._info,n,this,this._edp,this._remult,!1);return Object.defineProperty(n,ft,{get:()=>r}),r.id=r.getId(),r.saveOriginalData(),r.originalId=r.id,n}}async count(e){return this._edp.count(await this._translateWhereToFilter(e))}async deleteMany({where:e}){if(q.throwErrorIfFilterIsEmpty(e,"deleteMany"),this._dataProvider.isProxy)return this._edp.deleteMany(await this._translateWhereToFilter(e));{let t=0;for await(const n of this.query({where:e,aggregate:void 0}))await oe(n).delete(),t++;return t}}async findOne(e,t=!1){let n,r,s=e??{};if(s.useCache){let a=Ci(s,this.metadata),o=JSON.stringify(a);if(r=this._cache.get(o),r!==void 0)if(r.value&&this.getEntityRef(r.value).wasDeleted())r=void 0,this._cache.delete(o);else return r.promise;else r={value:void 0,promise:void 0},this._cache.set(o,r)}return n=this.find({...s,limit:1},t).then(async a=>{let o;return a.length>0&&(o=a[0]),!o&&s.createIfNotFound&&(o=this.create(),s.where&&await Zn(this.metadata,s.where,o)),o}),r&&(r.promise=n=n.then(a=>(r.value=a,a))),n}async findFirst(e,t,n=!1){if(t||(t={}),e)if(t.where){let r=t.where;t.where={$and:[r,e]}}else t.where=e;return this.findOne(t,n)}_fieldsOf(e){let t=Object.keys(e);return this.metadata.fields.toArray().filter(n=>t.includes(n.key))}create(e){var n;let t=new this._entity(this._remult);if(e){for(const r of this._fieldsOf(e)){const s=r.key;t[s]=e[s]}this._fixTypes(t)}return(n=this._defaultFindOptions)!=null&&n.where&&(Zn(this.metadata,this._defaultFindOptions.where,t),this._fixTypes(t)),this.getEntityRef(t),t}async _fixTypes(e){for(const t of this._fieldsOf(e)){const n=e[t.key];if(n!=null)if(t.valueType===Date&&!(n instanceof Date))e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n));else for(const[r,s]of[[String,"string"],[Number,"number"],[Boolean,"boolean"]])t.valueType===r&&typeof n!==s&&(e[t.key]=t.valueConverter.fromJson(t.valueConverter.toJson(n)))}return e}findId(e,t){if(e==null)return Promise.resolve(null);if(typeof e!="string"&&typeof e!="number")throw new Error("id can be either number or string, but got: "+typeof e);return this.findFirst({},{...t,where:this.metadata.idMetadata.getIdFilter(e)},!0)}async _translateWhereToFilter(e){var r,s;let t=e??{};(r=this._defaultFindOptions)!=null&&r.where&&(t={$and:[t,(s=this._defaultFindOptions)==null?void 0:s.where]}),this._dataProvider.isProxy||(this.metadata.options.backendPreprocessFilter&&(t=await this.metadata.options.backendPreprocessFilter(t,{metadata:this.metadata,getFilterPreciseValues:a=>q.getPreciseValues(this.metadata,a||t)})),this.metadata.options.backendPrefilter&&(t={$and:[t,await q.resolve(this.metadata.options.backendPrefilter)]}));let n=await q.fromEntityFilter(this.metadata,t);return n&&!this._dataProvider.isProxy&&(n=await q.translateCustomWhere(n,this.metadata,this._remult)),n}}function Zo(i,e){let t=F.columnsOfType.get(i);t||F.columnsOfType.set(i,t=[]);let n=Pe(i)(e),r=uo(i),s=Object.getPrototypeOf(i);for(;s!=null;){let a=F.columnsOfType.get(s);a&&t.unshift(...a.filter(l=>!t.find(f=>f.key==l.key)));let o=Pe(s,!1);if(o){let l=o(e);n={...l,...n};let f=["saving","saved","deleting","deleted","validation"];for(const u of f)if(l[u]&&l[u]!==n[u]){let c=n[u];n[u]=async(h,p)=>{await c(h,p),await l[u](h,p)}}}s=Object.getPrototypeOf(s)}return new tl(Wr(t,e),n,e,i,r)}class Vr{constructor(e,t,n,r,s){d(this,"fieldsMetadata");d(this,"instance");d(this,"remult");d(this,"isNewRow");d(this,"_error");d(this,"_subscribers");d(this,"_isLoading",!1);d(this,"lookups",new Map);d(this,"errors");d(this,"originalValues",{});this.fieldsMetadata=e,this.instance=t,this.remult=n,this.isNewRow=r;{let a=n;a!=null&&a.iAmRemultProxy&&(n=F.remultFactory())}for(const a of e)if(Pe(a.valueType,!1)&&n){let l=new Io(n.repo(a.valueType),!!ce(a),a.allowNull);this.lookups.set(a.key,l);let f=t[a.key],u;Object.defineProperty(t,a.key,{get:()=>(this._subscribers&&(this._subscribers.reportObserved(),u||(u=this.fields.find(a.key),u._subscribers||(u._subscribers=new hn)),u._subscribers.reportObserved()),l.item),set:c=>{var h;l.set(c),(h=this._subscribers)==null||h.reportChanged(),u||(u=this.fields.find(a.key),u._subscribers||(u._subscribers=new hn)),u._subscribers.reportChanged()},enumerable:!(s!=null&&s.has(a.key))}),l.set(f)}else{const l=ce(a);if((l==null?void 0:l.type)==="toOne"){let f=t.hasOwnProperty(a.key),u=t[a.key];r&&!u&&(f=!1),Object.defineProperty(t,a.key,{get:()=>u,set:c=>{if(u=c,c===void 0)return;const h=a.options;if(h.field&&(this.instance[h.field]=l.toRepo.metadata.idMetadata.getId(c)),h.fields){for(const p in h.fields)if(Object.prototype.hasOwnProperty.call(h.fields,p)){const m=h.fields[p];this.instance[m]=c==null?null:c[p]}}},enumerable:!(s!=null&&s.has(a.key))}),f&&(t[a.key]=u)}}}get error(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._error}set error(e){var t;this._error=e,(t=this._subscribers)==null||t.reportChanged()}subscribe(e){return this.initSubscribers(),this._subscribers.subscribe(e)}initSubscribers(){if(!this._subscribers){this._subscribers=new hn;const e=this._subscribers;for(const t of this.fieldsMetadata){let n=Pe(t.valueType,!1),r=this.fields.find(t.key);if(r._subscribers=new hn,!(n&&this.remult||ce(t))){let s=this.instance[t.key];Object.defineProperty(this.instance,t.key,{get:()=>(e.reportObserved(),r._subscribers.reportObserved(),s),set:a=>{s=a,e.reportChanged(),r._subscribers.reportChanged()},enumerable:!0})}}}}get isLoading(){var e;return(e=this._subscribers)==null||e.reportObserved(),this._isLoading}set isLoading(e){var t;this._isLoading=e,(t=this._subscribers)==null||t.reportChanged()}async waitLoad(){await At([...this.lookups.values()],e=>e.waitLoad())}__assertValidity(){if(!this.hasErrors())throw this.buildErrorInfoObject()}buildErrorInfoObject(){var t;let e={modelState:Object.assign({},this.errors),message:this.error};if(!e.message){for(const n of this.fieldsMetadata)if((t=this.errors)!=null&&t[n.key]){e.message=this.fields[n.key].metadata.caption+": "+this.errors[n.key],this.error=e.message;break}}return new Ur(e)}catchSaveErrors(e){let t=e;if(t instanceof Promise)return t.then(r=>this.catchSaveErrors(r));t.error&&(t=t.error),t.message?this.error=t.message:t.Message?this.error=t.Message:this.error=t;let n=t.modelState;throw n||(n=t.ModelState),n&&(this.errors=n),e}__clearErrorsAndReportChanged(){this.errors=void 0,this.error=void 0,this._reportChangedToEntityAndFields()}_reportChangedToEntityAndFields(){if(this._subscribers){this._subscribers.reportChanged();for(const e of this.fields)e._subscribers.reportChanged()}}hasErrors(){var e;return(e=this._subscribers)==null||e.reportObserved(),!this.error&&this.errors==null}copyDataToObject(e=!1){let t={};for(const n of this.fieldsMetadata){let r=this.lookups.get(n.key),s;const a=ce(n);r?s=r.id:s=this.instance[n.key],a&&e&&!n.allowNull&&s==null&&(a.toRepo.metadata.idMetadata.field.valueType===Number?s=0:s=""),(!a||a.type==="reference")&&(s!==void 0&&(s=n.valueConverter.toJson(s),s!=null&&(s=n.valueConverter.fromJson(JSON.parse(JSON.stringify(s))))),t[n.key]=s)}return t}saveOriginalData(){this.originalValues=this.copyDataToObject(),this.saveMoreOriginalData()}saveMoreOriginalData(){}async validate(){if(this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.hasErrors(),!this.hasErrors())return this.buildErrorInfoObject()}async __validateEntity(){this.__clearErrorsAndReportChanged(),await this.__performColumnAndEntityValidations(),this.__assertValidity()}async __performColumnAndEntityValidations(){}toApiJson(e=!1,t=!1){let n={};for(const r of this.fieldsMetadata)if(t||!this.remult||r.includedInApi(this.instance)){let s,a=this.lookups.get(r.key),o=!1;a?e?(s=a.toJson(),o=!0,n[r.key]=s):s=a.id:ce(r)&&!e?o=!0:(s=this.instance[r.key],this.remult||s&&Pe(s.constructor,!1)&&(s=oe(s).getId())),o||(n[r.key]=r.valueConverter.toJson(s))}return n}async _updateEntityBasedOnApi(e,t=!1){let n=Object.keys(e);for(const r of this.fieldsMetadata)if(n.includes(r.key)&&r.includedInApi(this.instance)&&(!this.remult||t||r.apiUpdateAllowed(this.instance))){let s=this.lookups.get(r.key);s?s.id=e[r.key]:this.instance[r.key]=r.valueConverter.fromJson(e[r.key])}await At([...this.fields].filter(r=>!ce(r.metadata)),r=>r.load())}}class dn extends Vr{constructor(t,n,r,s,a,o,l){super(t.fieldsMetadata,n,a,o,l);d(this,"info");d(this,"repo");d(this,"edp");d(this,"_isNew");d(this,"repository");d(this,"metadata");d(this,"_wasDeleted",!1);d(this,"_columns");d(this,"_saving",!1);d(this,"id");d(this,"originalId");if(this.info=t,this.repo=r,this.edp=s,this._isNew=o,this.repository=r,this.metadata=t,o)for(const f of t.fieldsMetadata){const u=f.key;f.options.defaultValue&&n[u]===void 0&&(typeof f.options.defaultValue=="function"?n[u]=f.options.defaultValue(n):n[u]||(n[u]=f.options.defaultValue))}this.info.entityInfo.entityRefInit&&this.info.entityInfo.entityRefInit(this,n),je.entityRefInit&&je.entityRefInit(this,n)}clone(){const t=this.toApiJson(!0,!0);return this.repo.fromJson(t,this.isNew())}get relations(){return this.repo.relations(this.instance)}get apiUpdateAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiUpdate)}get apiDeleteAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiDelete)}get apiInsertAllowed(){return this.remult.isAllowedForInstance(this.instance,this.metadata.options.allowApiInsert)}getId(){const t=n=>{let r=this.lookups.get(n.key);return r?r.id:this.instance[n.key]};return this.metadata.idMetadata.field instanceof ct?this.metadata.idMetadata.field.getId(t):t(this.metadata.idMetadata.field)}saveMoreOriginalData(){this.originalId=this.getId()}wasDeleted(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._wasDeleted}undoChanges(){this.loadDataFrom(this.originalValues),this.__clearErrorsAndReportChanged()}async reload(){return await this.edp.find({where:await this.getIdFilter()}).then(async t=>{if(t.length===0)throw this.repo._notFoundError(this.id);await this.loadDataFrom(t[0]),this.saveOriginalData()}),this._reportChangedToEntityAndFields(),this.instance}get fields(){if(!this._columns){let t=[],n={find:r=>n[typeof r=="string"?r:r.key],[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t};for(const r of this.info.fieldsMetadata)t.push(n[r.key]=new An(r.options,r,this.instance,this,this));this._columns=n}return this._columns}async save(t){var n,r;try{if(this._saving)throw new Error("cannot save while entity is already saving");if(this._saving=!0,this.wasDeleted())throw new Error("cannot save a deleted row");this.isLoading=!0,t===void 0&&await this.__validateEntity();let s=!1,a=this.buildLifeCycleEvent(()=>s=!0);if(!this.repo._dataProvider.isProxy){for(const c of this.fields)c.metadata.options.saving&&await c.metadata.options.saving(this.instance,c,a);this.info.entityInfo.saving&&await this.info.entityInfo.saving(this.instance,a)}this.__assertValidity();let o=this.copyDataToObject(this.isNew()),l=[];for(const c of this.metadata.fields)if(c.dbReadOnly||t!==void 0&&!t.includes(c.key)){o[c.key]=void 0,l.push(c.key);let h=this.fields.find(c);h.value=h.originalValue}let f,u=this.isNew();try{if((n=this._subscribers)==null||n.reportChanged(),this.isNew())s?f=(f=await this.edp.find({where:await this.getIdFilter()}))[0]:f=await this.edp.insert(o);else{let c={},h=!1;for(const p in o)if(Object.prototype.hasOwnProperty.call(o,p)){const m=o[p];this.fields.find(p).valueChanged()&&!l.includes(p)&&m!==void 0&&(c[p]=m,h=!0)}if(!h)return this.instance;if(s)f=(await this.edp.find({where:await this.getIdFilter()}))[0];else{if(this.id===void 0)throw new Error("Invalid operation, id is undefined");f=await this.edp.update(this.id,c)}}if(f&&await this.loadDataFrom(f),a.id=this.getId(),!this.repo._dataProvider.isProxy&&(this.info.entityInfo.saved&&await this.info.entityInfo.saved(this.instance,a),this.repo.listeners))for(const c of this.repo.listeners)await((r=c.saved)==null?void 0:r.call(c,this.instance,u));return this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!1}]),this.saveOriginalData(),this._isNew=!1,this.instance}catch(c){throw await this.catchSaveErrors(c)}}finally{this.isLoading=!1,this._reportChangedToEntityAndFields(),this._saving=!1}}async processInsertResponseDto(t){return await this.loadDataFrom(t),this.saveOriginalData(),this._isNew=!1,this.instance}async buildDtoForInsert(){await this.__validateEntity(),this.__assertValidity();let t=this.copyDataToObject(this.isNew());for(const n of this.metadata.fields)if(n.dbReadOnly){t[n.key]=void 0;let r=this.fields.find(n);r.value=r.originalValue}return t}buildLifeCycleEvent(t=()=>{}){const n=this;return{isNew:n.isNew(),fields:n.fields,id:n.getId(),originalId:n.getOriginalId(),metadata:n.repo.metadata,repository:n.repo,preventDefault:()=>t(),relations:n.repo.relations(n.instance)}}async getIdFilter(){return await this.repo._translateWhereToFilter(this.repo.metadata.idMetadata.getIdFilter(this.id))}async delete(){var r;this.__clearErrorsAndReportChanged();let t=!0,n=this.buildLifeCycleEvent(()=>t=!1);this.repo._dataProvider.isProxy||this.info.entityInfo.deleting&&await this.info.entityInfo.deleting(this.instance,n),this.__assertValidity();try{if(t){if(this.id===void 0)throw new Error("Invalid operation, id is undefined");await this.edp.delete(this.id)}if(this.repo._dataProvider.isProxy||this.info.entityInfo.deleted&&await this.info.entityInfo.deleted(this.instance,n),this.repo.listeners)for(const s of this.repo.listeners)await((r=s.deleted)==null?void 0:r.call(s,this.instance));this.repo._remult.liveQueryPublisher.itemChanged(this.repo.metadata.key,[{id:this.getId(),oldId:this.getOriginalId(),deleted:!0}]),this._wasDeleted=!0}catch(s){throw await this.catchSaveErrors(s)}}async loadDataFrom(t,n){for(const r of this.info.fields){let s=this.lookups.get(r.key);s?(s.id=t[r.key],n===void 0?!r.options.lazy&&!ce(r)&&await s.waitLoad():n.includes(r)&&await s.waitLoad()):ce(r)||(t[r.key]===void 0?delete this.instance[r.key]:this.instance[r.key]=t[r.key])}await this.calcServerExpression(),this.id=this.getId()}getOriginalId(){return this.originalId}async calcServerExpression(){if(!this.repo._dataProvider.isProxy){for(const t of this.info.fieldsMetadata)if(t.options.serverExpression){const n=await t.options.serverExpression(this.instance);n!==void 0&&(this.instance[t.key]=n)}}}isNew(){var t;return(t=this._subscribers)==null||t.reportObserved(),this._isNew}wasChanged(){var t;(t=this._subscribers)==null||t.reportObserved();for(const n of this.fields){const r=ce(n.metadata);if((!r||r.type=="reference")&&n.valueChanged())return!0}return!1}async __performColumnAndEntityValidations(){var t;for(const n of this.fieldsMetadata)n.options.validate&&await new An(n.options,n,this.instance,this,this).__performValidation();if(this.info.entityInfo.validation){let n=this.buildLifeCycleEvent(()=>{});await this.info.entityInfo.validation(this.instance,n)}if(this.repo.listeners)for(const n of this.repo.listeners)await((t=n.validating)==null?void 0:t.call(n,this.instance))}}const ur=Symbol.for("controllerColumns");function Wr(i,e){return i.map(t=>Pi(t.settings(e),e))}function fr(i,e){const t=e||Se;let n=i[ur];if(n||(n=i[ft]),!n){let r=F.columnsOfType.get(i.constructor);r||F.columnsOfType.set(i.constructor,r=[]);let s=Object.getPrototypeOf(i.constructor);for(;s!=null;){let a=F.columnsOfType.get(s);a&&r.unshift(...a.filter(o=>!r.find(l=>l.key==o.key))),s=Object.getPrototypeOf(s)}i[ur]=n=new Yo(Wr(r,t).map(a=>new Gr(a,void 0,t)),i,t)}return n}class Yo extends Vr{constructor(t,n,r){super(t,n,r,!1);d(this,"fields");let s=[],a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>s[Symbol.iterator](),toArray:()=>s};for(const o of t)s.push(a[o.key]=new An(o.options,o,n,void 0,this));this.fields=a}async __performColumnAndEntityValidations(){for(const t of this.fields)t instanceof An&&await t.__performValidation()}}class An{constructor(e,t,n,r,s){d(this,"settings");d(this,"metadata");d(this,"container");d(this,"helper");d(this,"rowBase");d(this,"_subscribers");d(this,"target");d(this,"entityRef");this.settings=e,this.metadata=t,this.container=n,this.helper=r,this.rowBase=s,this.target=this.settings.target,this.entityRef=this.helper}subscribe(e){return this._subscribers||this.rowBase.initSubscribers(),this._subscribers.subscribe(e)}valueIsNull(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id===void 0||e.id===null:this.value===null}originalValueIsNull(){return this.reportObserved(),this.rowBase.lookups.get(this.metadata.key),this.rawOriginalValue()===null}get key(){return this.metadata.key}get repo(){var e;return(e=this.helper)==null?void 0:e.repository}async load(){let e=this.rowBase.lookups.get(this.metadata.key),t=ce(this.metadata);if(t&&this.helper){if(t.type==="toMany")return this.container[this.metadata.key]=await this.repo.relations(this.container)[this.key].find();{let n=await this.repo.relations(this.container)[this.metadata.key].findOne();if(n)this.container[this.metadata.key]=n;else return null}}else if(e)return this.valueChanged()&&await e.waitLoadOf(this.rawOriginalValue()),await e.waitLoad();return this.value}reportObserved(){var e,t;(e=this._subscribers)==null||e.reportObserved(),(t=this.rowBase._subscribers)==null||t.reportObserved()}reportChanged(){var e,t;(e=this._subscribers)==null||e.reportChanged(),(t=this.rowBase._subscribers)==null||t.reportChanged()}get error(){if(this.reportObserved(),!!this.rowBase.errors)return this.rowBase.errors[this.metadata.key]}set error(e){this.rowBase.errors||(this.rowBase.errors={}),this.rowBase.errors[this.metadata.key]=e,this.reportChanged()}get displayValue(){return this.reportObserved(),this.value!=null?this.settings.displayValue?this.settings.displayValue(this.container,this.value):this.metadata.valueConverter.displayValue?this.metadata.valueConverter.displayValue(this.value):this.value.toString():""}get value(){return this.container[this.metadata.key]}set value(e){this.container[this.metadata.key]=e}get originalValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.get(this.rawOriginalValue()):this.rowBase.originalValues[this.metadata.key]}rawOriginalValue(){return this.rowBase.originalValues[this.metadata.key]}setId(e){this.value=e}getId(){let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id:null:this.value}get inputValue(){this.reportObserved();let e=this.rowBase.lookups.get(this.metadata.key);return e?e.id!=null?e.id.toString():null:this.metadata.valueConverter.toInput(this.value,this.settings.inputType)}set inputValue(e){let t=this.rowBase.lookups.get(this.metadata.key);t?t.setId(e):this.value=this.metadata.valueConverter.fromInput(e,this.settings.inputType)}valueChanged(){this.reportObserved();let e=this.value,t=this.rowBase.lookups.get(this.metadata.key);return t&&(e=t.id),JSON.stringify(this.metadata.valueConverter.toJson(this.rowBase.originalValues[this.metadata.key]))!=JSON.stringify(this.metadata.valueConverter.toJson(e))}async __performValidation(){var e;try{const t=n=>{n!==!0&&n!==void 0&&!this.error&&(typeof n=="string"&&n.length>0?this.error=n:this.error="invalid value")};if(this.settings.validate){let n=this,r={entityRef:this.entityRef,get error(){return n.error},set error(s){n.error=s},isNew:((e=this.entityRef)==null?void 0:e.isNew())??!1,load:()=>n.load(),metadata:n.metadata,originalValue:n.originalValue,value:n.value,valueChanged:()=>n.valueChanged(),originalValueIsNull:()=>n.originalValueIsNull(),valueIsNull:()=>n.valueIsNull(),isBackend:()=>{var s,a,o;return!((o=(a=(s=n.rowBase)==null?void 0:s.remult)==null?void 0:a.dataProvider)!=null&&o.isProxy)}};if(Array.isArray(this.settings.validate))for(const s of this.settings.validate)t(await s(this.container,r));else typeof this.settings.validate=="function"&&t(await this.settings.validate(this.container,r))}}catch(t){typeof t=="string"?this.error=t:this.error=t==null?void 0:t.message}}async validate(){return await this.__performValidation(),!this.error}}let xo={transformCaption:(i,e,t,n)=>t};const Yn=F.fieldOptionsEnricher||{enrichFieldOptions:i=>i},el=F.captionTransformer||(F.captionTransformer=xo);function Hr(i,e,t,n){let r;return typeof i=="function"?t&&(r=i(t)):i&&(r=i),r=el.transformCaption(t,e,r??"",n),r||(e?ui(e):"")}class Gr{constructor(e,t,n){d(this,"settings");d(this,"entityDefs");d(this,"remult");d(this,"options");d(this,"target");d(this,"readonly",!1);d(this,"valueConverter");d(this,"allowNull");d(this,"caption");d(this,"dbName");d(this,"inputType");d(this,"key");d(this,"isServerExpression",!1);d(this,"valueType");this.settings=e,this.entityDefs=t,this.remult=n,this.options=this.settings,this.target=this.settings.target,this.valueConverter=new Proxy(this.settings.valueConverter??{},{get:(r,s)=>{let a=r[s];return typeof a=="function"?(...o)=>{try{return r[s](...o)}catch(l){const f=`${String(s)} failed for value ${o==null?void 0:o[0]}. Error: ${typeof l=="string"?l:l.message}`;throw new Ur({message:this.caption+": "+f,modelState:{[this.key]:f}})}}:a}}),this.allowNull=!!this.settings.allowNull,this.valueType=this.settings.valueType,this.key=this.settings.key,this.inputType=this.settings.inputType,e.serverExpression&&(this.isServerExpression=!0),typeof this.settings.allowApiUpdate=="boolean"&&(this.readonly=this.settings.allowApiUpdate),this.inputType||(this.inputType=this.valueConverter.inputType),this.dbName=e.dbName,this.dbName==null&&(this.dbName=e.key),this.caption=Hr(e.caption,e.key,n,t)}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!0:this.remult.isAllowedForInstance(e,this.options.allowApiUpdate)}displayValue(e){return this.entityDefs.getEntityMetadataWithoutBreakingTheEntity(e).fields.find(this.key).displayValue}includedInApi(e){return this.options.includeInApi===void 0?!0:this.remult.isAllowedForInstance(e,this.options.includeInApi)}toInput(e,t){return this.valueConverter.toInput(e,t)}fromInput(e,t){return this.valueConverter.fromInput(e,t)}async getDbName(){return Di(this,this.entityDefs)}get dbReadOnly(){return!!this.settings.dbReadOnly}}class tl{constructor(e,t,n,r,s){d(this,"entityInfo");d(this,"remult");d(this,"entityType");d(this,"key");d(this,"options");d(this,"fieldsMetadata",[]);d(this,"idMetadata",{getId:e=>{if(e==null)return e;const t=oe(e,!1);return t?t.getId():this.idMetadata.field instanceof ct?this.idMetadata.field.getId(e):e[this.idMetadata.field.key]},field:void 0,get fields(){return this.field instanceof ct?this.field.fields:[this.field]},createIdInFilter:e=>e.length>0?{$or:e.map(t=>this.idMetadata.getIdFilter(oe(t).getId()))}:{[this.fields.toArray()[0].key]:[]},isIdField:e=>e.key==this.idMetadata.field.key,getIdFilter:(...e)=>{if(this.idMetadata.field instanceof ct){let t=this.idMetadata.field;return e.length==1?t.isEqualTo(e[0]):{$or:e.map(n=>t.isEqualTo(n))}}return e.length==1?{[this.idMetadata.field.key]:e[0]}:{[this.idMetadata.field.key]:e}}});d(this,"fields");d(this,"dbName");d(this,"caption");if(this.entityInfo=t,this.remult=n,this.entityType=r,this.key=s,this.options=t,this.options.allowApiCrud!==void 0){let o;typeof this.options.allowApiCrud=="function"?o=(l,f)=>this.options.allowApiCrud(f):o=this.options.allowApiCrud,this.options.allowApiDelete===void 0&&(this.entityInfo.allowApiDelete=o),this.options.allowApiInsert===void 0&&(this.entityInfo.allowApiInsert=o),this.options.allowApiUpdate===void 0&&(this.entityInfo.allowApiUpdate=o),this.options.allowApiRead===void 0&&(this.options.allowApiRead=this.options.allowApiCrud)}this.options.allowApiRead===void 0&&(this.options.allowApiRead=!0),this.key||(this.key=r.name),t.dbName||(t.dbName=this.key),this.dbName=t.dbName;let a={find:o=>a[typeof o=="string"?o:o.key],[Symbol.iterator]:()=>this.fieldsMetadata[Symbol.iterator](),toArray:()=>this.fieldsMetadata};for(const o of e)this.fieldsMetadata.push(a[o.key]=new Gr(o,this,n));if(this.fields=a,this.caption=Hr(t.caption,this.key,n,this),t.id){let o=typeof t.id=="string"?this.fields.find(t.id):Array.isArray(t.id)?t.id.map(l=>this.fields.find(l)):typeof t.id=="function"?t.id(this.fields):Object.keys(t.id).map(l=>this.fields.find(l));Array.isArray(o)?o.length>1?this.idMetadata.field=new ct(...o):o.length==1&&(this.idMetadata.field=o[0]):this.idMetadata.field=o}if(!this.idMetadata.field){const o=this.fields.id;o?this.idMetadata.field=o:this.idMetadata.field=[...this.fields][0]}}apiUpdateAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiUpdateAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiUpdate)}get apiReadAllowed(){return this.options.allowApiRead===void 0?!0:this.remult.isAllowed(this.options.allowApiRead)}apiDeleteAllowed(e){return this.options.allowApiDelete===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiDeleteAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiDelete)}apiInsertAllowed(e){return this.options.allowApiUpdate===void 0?!1:e?this.getEntityMetadataWithoutBreakingTheEntity(e).apiInsertAllowed:this.remult.isAllowedForInstance(void 0,this.options.allowApiInsert)}getEntityMetadataWithoutBreakingTheEntity(e){let t=oe(e,!1);return t||this.remult.repo(this.entityType).getEntityRef({...e})}getDbName(){return Zr(this)}}function nl(...i){return(e,t)=>(i||(i=[]),i.splice(0,0,{valueType:e}),e[Ti]=i,e)}function il(i){var e,t;return((t=(e=i.options)==null?void 0:e.valueConverter)==null?void 0:t.fieldTypeInDb)==="autoincrement"}function rl(...i){return(e,t)=>{nl(n=>{n.valueConverter=Sn.get(e),n.displayValue=(r,s)=>s==null?void 0:s.caption,n.validate=(r,s)=>{const a=Sn.get(e).getValues();return s.value&&!a.find(o=>o===s.value)&&(s.value=a.find(o=>o.id===s.value.id)||s.value),Me.in(a)(r,s)}},...i)(e)}}class Sn{constructor(e){d(this,"valueListType");d(this,"byIdMap",new Map);d(this,"values",[]);d(this,"isNumeric",!1);d(this,"fieldTypeInDb");d(this,"inputType");this.valueListType=e;for(let n in this.valueListType){let r=this.valueListType[n];r instanceof this.valueListType&&(r.id===void 0&&(r.id=n),typeof r.id=="number"&&(this.isNumeric=!0),r.caption===void 0&&(r.caption=ui(r.id!==void 0?r.id.toString():n)),this.byIdMap.set(r.id,r),this.values.push(r))}this.isNumeric&&(this.fieldTypeInDb="integer");var t=this.valueListType[Ti];if(t){for(const n of t)n!=null&&n.getValues&&(this.values.splice(0,this.values.length,...n.getValues()),this.byIdMap.clear(),this.values.forEach(r=>{r.caption===void 0&&r.id!==void 0&&(r.caption=ui(r.id)),this.byIdMap.set(r.id,r)}));if(this.values.find(n=>n.id===void 0))throw new Error(`ValueType ${this.valueListType} has values without an id`)}else throw new Error("ValueType not yet initialized, did you forget to call @ValueListFieldType on "+e)}static get(e){let t=cr.get(e);return t||(t=new Sn(e),cr.set(e,t)),t}getValues(){return this.values}byId(e){return this.isNumeric&&(e=+e),this.byIdMap.get(e)}fromJson(e){return this.byId(e)}toJson(e){if(e)return e.id}fromDb(e){return this.fromJson(e)}toDb(e){return this.toJson(e)}toInput(e,t){return this.toJson(e)}fromInput(e,t){return this.fromJson(e)}displayValue(e){return e?e.caption:""}}const cr=new Map,Ti=Symbol.for("storableMember"),xn=Symbol.for("fieldOptionalValues");function Qr(i,e){var n;let t={};for(const r of i)if(r)if(typeof r=="function")r(t,e);else{const{validate:s,...a}=r;t.validate=_n(t.validate,s),Object.assign(t,a)}return(n=Yn.enrichFieldOptions)==null||n.call(Yn,t),t}function Pi(i,e){if(i.valueType){let r=i.valueType[Ti];r&&(i=Qr([...r,i],e))}if(i.valueType==String){let r=i;i.valueConverter||(r.valueConverter=Ae.String)}if(i.valueType==Number){let r=i;i.valueConverter||(r.valueConverter=Ae.Number)}if(i.valueType==Date){let r=i;i.valueConverter||(r.valueConverter=Ae.Date)}if(i.valueType==Boolean){let r=i;r.valueConverter||(r.valueConverter=Ae.Boolean)}if(!i.valueConverter){if(Pe(i.valueType,!1)){let s;i.valueConverter={toDb:a=>a,fromDb:a=>a},i.valueConverter=new Proxy(i.valueConverter,{get(a,o){if(a[o]===void 0&&s===void 0){if(o==="inputType")return"";s=e.repo(i.valueType).metadata.idMetadata.field.valueType===Number;for(const l of["fieldTypeInDb","toJson","fromJson","toDb","fromDb"])a[l]=s?Ae.Integer[l]:Ae.String[l]}return a[o]},set(a,o,l,f){return a[o]=l,!0}})}else i.valueConverter=Ae.Default;return i}i.valueConverter.toJson||(i.valueConverter.toJson=r=>r),i.valueConverter.fromJson||(i.valueConverter.fromJson=r=>r);const t=i.valueConverter.fromJson,n=i.valueConverter.toJson;return i.valueConverter.toDb||(i.valueConverter.toDb=r=>n(r)),i.valueConverter.fromDb||(i.valueConverter.fromDb=r=>t(r)),i.valueConverter.toInput||(i.valueConverter.toInput=r=>n(r)),i.valueConverter.fromInput||(i.valueConverter.fromInput=r=>t(r)),i}class zr{get _(){return oe(this)}save(){return oe(this).save()}assign(e){return jt(this,e),this}delete(){return this._.delete()}isNew(){return this._.isNew()}get $(){return this._.fields}}class hn{constructor(){d(this,"_subscribers")}reportChanged(){this._subscribers&&this._subscribers.forEach(e=>e.reportChanged())}reportObserved(){this._subscribers&&this._subscribers.forEach(e=>e.reportObserved())}subscribe(e){let t;return typeof e=="function"?t={reportChanged:()=>e(),reportObserved:()=>{}}:t=e,this._subscribers||(this._subscribers=[]),this._subscribers.push(t),()=>this._subscribers=this._subscribers.filter(n=>n!=t)}}function sl(i){return i.metadata?i.metadata:Pe(i,!1)?Se.repo(i).metadata:i}function al(i){return Pe(i,!1)?Se.repo(i):i}async function At(i,e){const t=[];for(let n=0;n<i.length;n++){const r=i[n];t.push(await e(r,n))}return t}const St=class St{constructor(e){d(this,"sql");d(this,"wrapIdentifier",e=>e);d(this,"provideMigrationBuilder");d(this,"createdEntities",[]);d(this,"end");this.sql=e,e.wrapIdentifier&&(this.wrapIdentifier=t=>e.wrapIdentifier(t)),Ct(e,"provideMigrationBuilder")&&(this.provideMigrationBuilder=t=>e.provideMigrationBuilder(t)),Ct(e,"end")&&(this.end=()=>e.end())}static getDb(e){const t=e||Se.dataProvider;if(Ct(t,"createCommand"))return t;throw"the data provider is not an SqlCommandFactory"}createCommand(){return new ll(this.sql.createCommand(),St.LogToConsole)}async execute(e){return await this.createCommand().execute(e)}_getSourceSql(){return this.sql}async ensureSchema(e){this.sql.ensureSchema&&await this.sql.ensureSchema(e)}getEntityDataProvider(e){if(!this.sql.supportsJsonColumnType)for(const t of e.fields.toArray())t.valueConverter.fieldTypeInDb==="json"&&(t.valueConverter={...t.valueConverter,toDb:Ae.JsonString.toDb,fromDb:Ae.JsonString.fromDb});return new Kr(e,this,async t=>{this.createdEntities.indexOf(t.$entityName)<0&&(this.createdEntities.push(t.$entityName),await this.sql.entityIsUsedForTheFirstTime(e))},this.sql)}transaction(e){return this.sql.transaction(async t=>{let n=!1;try{await e(new St({createCommand:()=>{let r=t.createCommand();return{addParameterAndReturnSqlToken:s=>r.param(s),param:s=>r.param(s),execute:async s=>{if(n)throw"can't run a command after the transaction was completed";return r.execute(s)}}},getLimitSqlSyntax:this.sql.getLimitSqlSyntax,entityIsUsedForTheFirstTime:r=>t.entityIsUsedForTheFirstTime(r),transaction:r=>t.transaction(r),supportsJsonColumnType:this.sql.supportsJsonColumnType,wrapIdentifier:this.wrapIdentifier,end:this.end,doesNotSupportReturningSyntax:this.sql.doesNotSupportReturningSyntax,doesNotSupportReturningSyntaxOnlyForUpdate:this.sql.doesNotSupportReturningSyntaxOnlyForUpdate,orderByNullsFirst:this.sql.orderByNullsFirst}))}finally{n=!0}})}static rawFilter(e){return{[Nr]:{buildSql:e}}}static async filterToRaw(e,t,n,r,s){n||(n=new ul);const a=al(e);var o=new Ye(n,r||await Xr(a.metadata,s));return o._addWhere=!1,await(await ht(a)._translateWhereToFilter(t)).__applyToConsumer(o),await o.resolveWhere()}};d(St,"LogToConsole",!1),d(St,"durationThreshold",0);let Ft=St;const ol=new Map([["INSERT",""],["SELECT",""],["UPDATE",""],["DELETE",""],["CREATE",""],["ALTER",""],["DROP",""],["TRUNCATE",""],["GRANT",""],["REVOKE",""]]);class ll{constructor(e,t){d(this,"origin");d(this,"logToConsole");d(this,"args",{});this.origin=e,this.logToConsole=t}addParameterAndReturnSqlToken(e){return this.param(e)}param(e,t){let n=this.origin.param(e);return this.args[n]=e,n}async execute(e){try{let n=new Date,r=await this.origin.execute(e);if(this.logToConsole!==!1){var t=new Date().valueOf()-n.valueOf();if(t>=Ft.durationThreshold){const s=t/1e3;if(this.logToConsole==="oneLiner"){const a=e.replace(/(\r\n|\n|\r|\t)/gm," ").replace(/  +/g," ").trim(),o=a.split(" ")[0].toUpperCase();console.info(`${ol.get(o)||""} (${s.toFixed(3)}) ${a} ${JSON.stringify(this.args)}`)}else typeof this.logToConsole=="function"?this.logToConsole(s,e,this.args):console.info(e+`
`,{arguments:this.args,duration:s})}}return r}catch(n){throw console.error((n.message||"Sql Error")+`:
`,e,{arguments:this.args,error:n}),n}}}class Kr{constructor(e,t,n,r){d(this,"entity");d(this,"sql");d(this,"iAmUsed");d(this,"strategy");this.entity=e,this.sql=t,this.iAmUsed=n,this.strategy=r}async init(){let e=await Xr(this.entity,t=>this.sql.wrapIdentifier(t));return await this.iAmUsed(e),e}async count(e){let t=await this.init(),n="select count(*) count from "+t.$entityName,r=this.sql.createCommand();if(e){let s=new Ye(r,t);e.__applyToConsumer(s),n+=await s.resolveWhere()}return r.execute(n).then(s=>Number(s.rows[0].count))}async groupBy(e){return await fl(e,await this.init(),this.sql.createCommand(),this.sql._getSourceSql().orderByNullsFirst,this.sql._getSourceSql().getLimitSqlSyntax)}async find(e){let t=await this.init(),{colKeys:n,select:r}=this.buildSelect(t);r="select "+r,r+=`
 from `+t.$entityName;let s=this.sql.createCommand();if(e){if(e.where){let a=new Ye(s,t);e.where.__applyToConsumer(a),r+=await a.resolveWhere()}if(e.limit&&(e.orderBy=Te.createUniqueSort(this.entity,e.orderBy)),e.orderBy||(e.orderBy=Te.createUniqueSort(this.entity,new Te)),e.orderBy){let a=!0,o=[];for(const l of e.orderBy.Segments)o.push(l);for(const l of o)a?(r+=" Order By ",a=!1):r+=", ",r+=t.$dbNameOf(l.field),l.isDescending&&(r+=" desc"),this.sql._getSourceSql().orderByNullsFirst&&(l.isDescending?r+=" nulls last":r+=" nulls first")}if(e.limit){let a=1;e.page&&(a=e.page),a<1&&(a=1),r+=" "+this.strategy.getLimitSqlSyntax(e.limit,(a-1)*e.limit)}}return s.execute(r).then(a=>a.rows.map(o=>this.buildResultRow(n,o,a)))}buildResultRow(e,t,n){let r={};for(let s=0;s<e.length;s++){const a=e[s];try{r[a.key]=a.valueConverter.fromDb(t[n.getColumnKeyInResultForIndexInSelect(s)])}catch(o){throw new Error("Failed to load from db:"+a.key+`\r
`+o)}}return r}buildSelect(e){let t="",n=[];for(const r of this.entity.fields)r.isServerExpression||(n.length>0&&(t+=", "),t+=e.$dbNameOf(r),r.options.sqlExpression&&(t+=" as "+r.key),n.push(r));return{colKeys:n,select:t}}async update(e,t){let n=await this.init(),r=this.sql.createCommand(),s="update "+n.$entityName+" set ",a=!1;for(const h of this.entity.fields)if(!hr(h,n)){if(t[h.key]!==void 0){let p=h.valueConverter.toDb(t[h.key]);p!==void 0&&(a?s+=", ":a=!0,s+=n.$dbNameOf(h)+" = "+r.param(p))}}const o=this.entity.idMetadata.getIdFilter(e);let l=new Ye(r,n);q.fromEntityFilter(this.entity,o).__applyToConsumer(l),s+=await l.resolveWhere();let{colKeys:f,select:u}=this.buildSelect(n),c=!0;return this.sql._getSourceSql().doesNotSupportReturningSyntax&&(c=!1),c&&this.sql._getSourceSql().doesNotSupportReturningSyntaxOnlyForUpdate&&(c=!1),c&&(s+=" returning "+u),r.execute(s).then(h=>{var p,m;if((m=(p=this.sql._getSourceSql()).afterMutation)==null||m.call(p),!c)return dr(this.entity,this,t,e,"update");if(h.rows.length!=1)throw new Error("Failed to update row with id "+e+", rows updated: "+h.rows.length);return this.buildResultRow(f,h.rows[0],h)})}async delete(e){let t=await this.init(),n=this.sql.createCommand(),r=new Ye(n,t);q.fromEntityFilter(this.entity,this.entity.idMetadata.getIdFilter(e)).__applyToConsumer(r);let s="delete from "+t.$entityName;return s+=await r.resolveWhere(),n.execute(s).then(()=>{var a,o;(o=(a=this.sql._getSourceSql()).afterMutation)==null||o.call(a)})}async insert(e){let t=await this.init(),n=this.sql.createCommand(),r="",s="",a=!1;for(const u of this.entity.fields)if(!hr(u,t)){let c=u.valueConverter.toDb(e[u.key]);c!=null&&(a?(r+=", ",s+=", "):a=!0,r+=t.$dbNameOf(u),s+=n.param(c))}let o=`insert into ${t.$entityName} (${r}) values (${s})`,{colKeys:l,select:f}=this.buildSelect(t);return this.sql._getSourceSql().doesNotSupportReturningSyntax||(o+=" returning "+f),await n.execute(o).then(u=>{var c,h;if((h=(c=this.sql._getSourceSql()).afterMutation)==null||h.call(c),this.sql._getSourceSql().doesNotSupportReturningSyntax)if(il(this.entity.idMetadata.field)){const p=u.rows[0];if(typeof p!="number")throw new Error("Auto increment, for a database that is does not support returning syntax, should return an array with the single last added id. Instead it returned: "+JSON.stringify(p));return this.find({where:new q(m=>m.isEqualTo(this.entity.idMetadata.field,p))}).then(m=>m[0])}else return dr(this.entity,this,e,void 0,"insert");return this.buildResultRow(l,u.rows[0],u)})}}d(Kr,"LogToConsole",!1);class ul{execute(e){throw new Error("Method not implemented.")}addParameterAndReturnSqlToken(e){return this.param(e)}param(e){return e===null?"null":(e instanceof Date&&(e=e.toISOString()),typeof e=="string"?(e==null&&(e=""),"'"+e.replace(/'/g,"''")+"'"):e.toString())}}function dr(i,e,t,n,r){const s=n!==void 0?i.idMetadata.getIdFilter(n):{};return e.find({where:new q(a=>{for(const o of i.idMetadata.fields)a.isEqualTo(o,t[o.key]??s[o.key])})}).then(a=>{if(a.length!=1)throw new Error(`Failed to ${r} row - result contained ${a.length} rows`);return a[0]})}async function fl(i,e,t,n,r){let s="select count(*) as count",a="";const o=[];if(o.push((c,h)=>{h[bo]=Number(c)}),i!=null&&i.group)for(const c of i==null?void 0:i.group)c.isServerExpression||(s+=", "+e.$dbNameOf(c),c.options.sqlExpression&&(s+=" as "+c.key),a==""?a=" group by ":a+=", ",a+=e.$dbNameOf(c)),o.push((h,p)=>{p[c.key]=c.valueConverter.fromDb(h)});for(const c of ko){const h=i==null?void 0:i[c];if(h)for(const p of h){if(!p.isServerExpression){const y=await e.$dbNameOf(p);s+=`, ${u(c,y)} as ${p.key}_${c}`}const m=p.valueType===Number||c=="distinctCount";o.push((y,_)=>{m&&(y=Number(y)),_[p.key]={..._[p.key],[c]:y}})}}if(s+=`
 from `+e.$entityName,i!=null&&i.where){let c=new Ye(t,e);i==null||i.where.__applyToConsumer(c),s+=await c.resolveWhere()}a&&(s+=a);let l="";if(i!=null&&i.orderBy){for(const c of i==null?void 0:i.orderBy){l==""?l=" order by ":l+=", ";let h=c.field&&await e.$dbNameOf(c.field);switch(c.operation){case"count":h=c.operation+"(*)";break;case void 0:break;default:h=u(c.operation,h)}l+=h,c.isDescending&&(l+=" desc"),n&&(c.isDescending?l+=" nulls last":l+=" nulls first")}l&&(s+=l)}if(i!=null&&i.limit){let c=1;i.page&&(c=i.page),c<1&&(c=1),s+=" "+r(i.limit,(c-1)*i.limit)}const f=await t.execute(s);return f.rows.map(c=>{let h={};return o.forEach((p,m)=>p(c[f.getColumnKeyInResultForIndexInSelect(m)],h)),h});function u(c,h){return c==="distinctCount"?`count (distinct ${h})`:`${c}( ${h} )`}}class Ye{constructor(e,t){d(this,"r");d(this,"nameProvider");d(this,"where","");d(this,"_addWhere",!0);d(this,"promises",[]);this.r=e,this.nameProvider=t}async resolveWhere(){for(;this.promises.length>0;){let e=this.promises;this.promises=[];for(const t of e)await t}return this.where}custom(e,t){throw new Error("Custom filter should be translated before it gets here")}or(e){let t="";this.promises.push((async()=>{for(const n of e){let r=new Ye(this.r,this.nameProvider);r._addWhere=!1,n.__applyToConsumer(r);let s=await r.resolveWhere();if(!s)return;s.length>0&&(t.length>0&&(t+=" or "),e.length>1?t+="("+s+")":t+=s)}this.addToWhere("("+t+")")})())}not(e){this.promises.push((async()=>{let t=new Ye(this.r,this.nameProvider);t._addWhere=!1,e.__applyToConsumer(t);let n=await t.resolveWhere();n&&this.addToWhere("not ("+n+")")})())}isNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is null"))())}isNotNull(e){this.promises.push((async()=>this.addToWhere(this.nameProvider.$dbNameOf(e)+" is not null"))())}isIn(e,t){this.promises.push((async()=>{t&&t.length>0?this.addToWhere(this.nameProvider.$dbNameOf(e)+" in ("+t.map(n=>this.r.param(e.valueConverter.toDb(n))).join(",")+")"):this.addToWhere("1 = 0 /*isIn with no values*/")})())}isEqualTo(e,t){this.add(e,t,"=")}isDifferentFrom(e,t){this.add(e,t,"<>")}isGreaterOrEqualTo(e,t){this.add(e,t,">=")}isGreaterThan(e,t){this.add(e,t,">")}isLessOrEqualTo(e,t){this.add(e,t,"<=")}isLessThan(e,t){this.add(e,t,"<")}containsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}notContainsCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("not lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"%')")})())}startsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('"+t.replace(/'/g,"''")+"%')")})())}endsWithCaseInsensitive(e,t){this.promises.push((async()=>{this.addToWhere("lower ("+this.nameProvider.$dbNameOf(e)+") like lower ('%"+t.replace(/'/g,"''")+"')")})())}add(e,t,n){this.promises.push((async()=>{let r=this.nameProvider.$dbNameOf(e)+" "+n+" "+this.r.param(e.valueConverter.toDb(t));this.addToWhere(r)})())}addToWhere(e){this.where.length==0?this._addWhere&&(this.where+=" where "):this.where+=" and ",this.where+=e}databaseCustom(e){this.promises.push((async()=>{if(e!=null&&e.buildSql){let t=new cl(this.r,this.nameProvider.wrapIdentifier),n=await e.buildSql(t);typeof n!="string"&&(n=t.sql),n&&this.addToWhere("("+n+")")}})())}}class cl{constructor(e,t){d(this,"r");d(this,"wrapIdentifier");d(this,"sql","");d(this,"param",(e,t)=>(typeof t=="object"&&t.valueConverter.toDb&&(e=t.valueConverter.toDb(e)),this.r.param(e)));d(this,"filterToRaw",async(e,t)=>Ft.filterToRaw(e,t,this,void 0,this.wrapIdentifier));this.r=e,this.wrapIdentifier=t,this.param.bind(this),this.filterToRaw.bind(this)}addParameterAndReturnSqlToken(e){return this.param(e)}}function hr(i,e){return i.dbReadOnly||i.isServerExpression||i.options.sqlExpression&&i.dbName!=e.$dbNameOf(i)}async function Xr(i,e){return dl(i,e,!0)}async function dl(i,e,t=!1){let n=typeof e=="function"?{wrapIdentifier:e}:e||{};var r=sl(i);n.wrapIdentifier||(n.wrapIdentifier=Se.dataProvider.wrapIdentifier),n.wrapIdentifier||(n.wrapIdentifier=a=>a);const s={$entityName:await Zr(r,n.wrapIdentifier),toString:()=>s.$entityName,$dbNameOf:a=>{var o;return typeof a=="string"?o=a:o=a.key,s[o]},wrapIdentifier:n.wrapIdentifier};for(const a of r.fields){let o=await Di(a,r,n.wrapIdentifier,t);a.options.sqlExpression||(typeof n.tableName=="string"?o=n.wrapIdentifier(n.tableName)+"."+o:n.tableName===!0&&(o=s.$entityName+"."+o)),s[a.key]=o}return s}async function Zr(i,e=t=>t){if(i.options.sqlExpression){if(typeof i.options.sqlExpression=="string")return i.options.sqlExpression;if(typeof i.options.sqlExpression=="function"){const t=i.options.sqlExpression;try{return i.options.sqlExpression="recursive sqlExpression call for entity '"+i.key+"'. ",await t(i)}finally{i.options.sqlExpression=t}}}return e(i.dbName)}const ei=Symbol.for("sqlExpressionInProgressKey");async function Di(i,e,t=r=>r,n=!1){try{if(i.options.sqlExpression){let a;if(typeof i.options.sqlExpression=="function"){if(i[ei]&&!n)return"recursive sqlExpression call for field '"+i.key+"'. \0";try{i[ei]=!0,a=await i.options.sqlExpression(e),a.includes("\0")||(i.options.sqlExpression=()=>a)}finally{delete i[ei]}}else a=i.options.sqlExpression;return a||i.dbName}const r=ce(i);let s=(r==null?void 0:r.type)==="toOne"&&i.options.field;if(s){let a=e.fields.find(s);if(a)return Di(a,e,t,n)}return t(i.dbName)}finally{}}function Yr(i,...e){return(t,n)=>{let r=t;for(;r!=null;){for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)){const o=t[a];o!=null&&o.rawFilterInfo&&(o.rawFilterInfo.key||(o.rawFilterInfo.key=a))}r=Object.getPrototypeOf(r)}let s=a=>{let o={};for(const f of e)f&&(typeof f=="function"?f(o,a):Object.assign(o,f));let l=Object.getPrototypeOf(t);if(l){let f=Pe(l,!1);if(f){let u=f(a);u&&(o={...u,...o})}}return o};return F.allEntities.push(t),Uo(t,{key:i}),t[Rr]=s,t[Br]=i,t}}var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rt={},fe={},_e={};Object.defineProperty(_e,"__esModule",{value:!0});_e.output=_e.exists=_e.hash=_e.bytes=_e.bool=_e.number=_e.isBytes=void 0;function En(i){if(!Number.isSafeInteger(i)||i<0)throw new Error(`positive integer expected, not ${i}`)}_e.number=En;function xr(i){if(typeof i!="boolean")throw new Error(`boolean expected, not ${i}`)}_e.bool=xr;function es(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}_e.isBytes=es;function Ri(i,...e){if(!es(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}_e.bytes=Ri;function ts(i){if(typeof i!="function"||typeof i.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");En(i.outputLen),En(i.blockLen)}_e.hash=ts;function ns(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}_e.exists=ns;function is(i,e){Ri(i);const t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}_e.output=is;const hl={number:En,bool:xr,bytes:Ri,hash:ts,exists:ns,output:is};_e.default=hl;var W={};Object.defineProperty(W,"__esModule",{value:!0});W.add5L=W.add5H=W.add4H=W.add4L=W.add3H=W.add3L=W.add=W.rotlBL=W.rotlBH=W.rotlSL=W.rotlSH=W.rotr32L=W.rotr32H=W.rotrBL=W.rotrBH=W.rotrSL=W.rotrSH=W.shrSL=W.shrSH=W.toBig=W.split=W.fromBig=void 0;const pn=BigInt(2**32-1),hi=BigInt(32);function Bi(i,e=!1){return e?{h:Number(i&pn),l:Number(i>>hi&pn)}:{h:Number(i>>hi&pn)|0,l:Number(i&pn)|0}}W.fromBig=Bi;function rs(i,e=!1){let t=new Uint32Array(i.length),n=new Uint32Array(i.length);for(let r=0;r<i.length;r++){const{h:s,l:a}=Bi(i[r],e);[t[r],n[r]]=[s,a]}return[t,n]}W.split=rs;const ss=(i,e)=>BigInt(i>>>0)<<hi|BigInt(e>>>0);W.toBig=ss;const as=(i,e,t)=>i>>>t;W.shrSH=as;const os=(i,e,t)=>i<<32-t|e>>>t;W.shrSL=os;const ls=(i,e,t)=>i>>>t|e<<32-t;W.rotrSH=ls;const us=(i,e,t)=>i<<32-t|e>>>t;W.rotrSL=us;const fs=(i,e,t)=>i<<64-t|e>>>t-32;W.rotrBH=fs;const cs=(i,e,t)=>i>>>t-32|e<<64-t;W.rotrBL=cs;const ds=(i,e)=>e;W.rotr32H=ds;const hs=(i,e)=>i;W.rotr32L=hs;const ps=(i,e,t)=>i<<t|e>>>32-t;W.rotlSH=ps;const ys=(i,e,t)=>e<<t|i>>>32-t;W.rotlSL=ys;const ms=(i,e,t)=>e<<t-32|i>>>64-t;W.rotlBH=ms;const gs=(i,e,t)=>i<<t-32|e>>>64-t;W.rotlBL=gs;function ws(i,e,t,n){const r=(e>>>0)+(n>>>0);return{h:i+t+(r/2**32|0)|0,l:r|0}}W.add=ws;const _s=(i,e,t)=>(i>>>0)+(e>>>0)+(t>>>0);W.add3L=_s;const bs=(i,e,t,n)=>e+t+n+(i/2**32|0)|0;W.add3H=bs;const vs=(i,e,t,n)=>(i>>>0)+(e>>>0)+(t>>>0)+(n>>>0);W.add4L=vs;const ks=(i,e,t,n,r)=>e+t+n+r+(i/2**32|0)|0;W.add4H=ks;const Is=(i,e,t,n,r)=>(i>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0);W.add5L=Is;const Os=(i,e,t,n,r,s)=>e+t+n+r+s+(i/2**32|0)|0;W.add5H=Os;const pl={fromBig:Bi,split:rs,toBig:ss,shrSH:as,shrSL:os,rotrSH:ls,rotrSL:us,rotrBH:fs,rotrBL:cs,rotr32H:ds,rotr32L:hs,rotlSH:ps,rotlSL:ys,rotlBH:ms,rotlBL:gs,add:ws,add3L:_s,add3H:bs,add4L:vs,add4H:ks,add5H:Os,add5L:Is};W.default=pl;var As={},Mn={};Object.defineProperty(Mn,"__esModule",{value:!0});Mn.crypto=void 0;Mn.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(i){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(i,"__esModule",{value:!0}),i.randomBytes=i.wrapXOFConstructorWithOpts=i.wrapConstructorWithOpts=i.wrapConstructor=i.checkOpts=i.Hash=i.concatBytes=i.toBytes=i.utf8ToBytes=i.asyncLoop=i.nextTick=i.hexToBytes=i.bytesToHex=i.byteSwap32=i.byteSwapIfBE=i.byteSwap=i.isLE=i.rotl=i.rotr=i.createView=i.u32=i.u8=i.isBytes=void 0;const e=Mn,t=_e;function n(v){return v instanceof Uint8Array||v!=null&&typeof v=="object"&&v.constructor.name==="Uint8Array"}i.isBytes=n;const r=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);i.u8=r;const s=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));i.u32=s;const a=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);i.createView=a;const o=(v,T)=>v<<32-T|v>>>T;i.rotr=o;const l=(v,T)=>v<<T|v>>>32-T>>>0;i.rotl=l,i.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const f=v=>v<<24&4278190080|v<<8&16711680|v>>>8&65280|v>>>24&255;i.byteSwap=f,i.byteSwapIfBE=i.isLE?v=>v:v=>(0,i.byteSwap)(v);function u(v){for(let T=0;T<v.length;T++)v[T]=(0,i.byteSwap)(v[T])}i.byteSwap32=u;const c=Array.from({length:256},(v,T)=>T.toString(16).padStart(2,"0"));function h(v){(0,t.bytes)(v);let T="";for(let P=0;P<v.length;P++)T+=c[v[P]];return T}i.bytesToHex=h;const p={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function m(v){if(v>=p._0&&v<=p._9)return v-p._0;if(v>=p._A&&v<=p._F)return v-(p._A-10);if(v>=p._a&&v<=p._f)return v-(p._a-10)}function y(v){if(typeof v!="string")throw new Error("hex string expected, got "+typeof v);const T=v.length,P=T/2;if(T%2)throw new Error("padded hex string expected, got unpadded hex of length "+T);const I=new Uint8Array(P);for(let D=0,ne=0;D<P;D++,ne+=2){const be=m(v.charCodeAt(ne)),Ce=m(v.charCodeAt(ne+1));if(be===void 0||Ce===void 0){const Re=v[ne]+v[ne+1];throw new Error('hex string expected, got non-hex character "'+Re+'" at index '+ne)}I[D]=be*16+Ce}return I}i.hexToBytes=y;const _=async()=>{};i.nextTick=_;async function w(v,T,P){let I=Date.now();for(let D=0;D<v;D++){P(D);const ne=Date.now()-I;ne>=0&&ne<T||(await(0,i.nextTick)(),I+=ne)}}i.asyncLoop=w;function k(v){if(typeof v!="string")throw new Error(`utf8ToBytes expected string, got ${typeof v}`);return new Uint8Array(new TextEncoder().encode(v))}i.utf8ToBytes=k;function A(v){return typeof v=="string"&&(v=k(v)),(0,t.bytes)(v),v}i.toBytes=A;function E(...v){let T=0;for(let I=0;I<v.length;I++){const D=v[I];(0,t.bytes)(D),T+=D.length}const P=new Uint8Array(T);for(let I=0,D=0;I<v.length;I++){const ne=v[I];P.set(ne,D),D+=ne.length}return P}i.concatBytes=E;class H{clone(){return this._cloneInto()}}i.Hash=H;const Z={}.toString;function ee(v,T){if(T!==void 0&&Z.call(T)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(v,T)}i.checkOpts=ee;function ue(v){const T=I=>v().update(A(I)).digest(),P=v();return T.outputLen=P.outputLen,T.blockLen=P.blockLen,T.create=()=>v(),T}i.wrapConstructor=ue;function me(v){const T=(I,D)=>v(D).update(A(I)).digest(),P=v({});return T.outputLen=P.outputLen,T.blockLen=P.blockLen,T.create=I=>v(I),T}i.wrapConstructorWithOpts=me;function X(v){const T=(I,D)=>v(D).update(A(I)).digest(),P=v({});return T.outputLen=P.outputLen,T.blockLen=P.blockLen,T.create=I=>v(I),T}i.wrapXOFConstructorWithOpts=X;function ge(v=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(v));throw new Error("crypto.getRandomValues must be defined")}i.randomBytes=ge})(As);Object.defineProperty(fe,"__esModule",{value:!0});fe.shake256=fe.shake128=fe.keccak_512=fe.keccak_384=fe.keccak_256=fe.keccak_224=fe.sha3_512=fe.sha3_384=fe.sha3_256=fe.sha3_224=fe.Keccak=fe.keccakP=void 0;const vt=_e,zt=W,Ze=As,Ss=[],Cs=[],Es=[],yl=BigInt(0),Nt=BigInt(1),ml=BigInt(2),gl=BigInt(7),wl=BigInt(256),_l=BigInt(113);for(let i=0,e=Nt,t=1,n=0;i<24;i++){[t,n]=[n,(2*t+3*n)%5],Ss.push(2*(5*n+t)),Cs.push((i+1)*(i+2)/2%64);let r=yl;for(let s=0;s<7;s++)e=(e<<Nt^(e>>gl)*_l)%wl,e&ml&&(r^=Nt<<(Nt<<BigInt(s))-Nt);Es.push(r)}const[bl,vl]=(0,zt.split)(Es,!0),pr=(i,e,t)=>t>32?(0,zt.rotlBH)(i,e,t):(0,zt.rotlSH)(i,e,t),yr=(i,e,t)=>t>32?(0,zt.rotlBL)(i,e,t):(0,zt.rotlSL)(i,e,t);function Fs(i,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let a=0;a<10;a++)t[a]=i[a]^i[a+10]^i[a+20]^i[a+30]^i[a+40];for(let a=0;a<10;a+=2){const o=(a+8)%10,l=(a+2)%10,f=t[l],u=t[l+1],c=pr(f,u,1)^t[o],h=yr(f,u,1)^t[o+1];for(let p=0;p<50;p+=10)i[a+p]^=c,i[a+p+1]^=h}let r=i[2],s=i[3];for(let a=0;a<24;a++){const o=Cs[a],l=pr(r,s,o),f=yr(r,s,o),u=Ss[a];r=i[u],s=i[u+1],i[u]=l,i[u+1]=f}for(let a=0;a<50;a+=10){for(let o=0;o<10;o++)t[o]=i[a+o];for(let o=0;o<10;o++)i[a+o]^=~t[(o+2)%10]&t[(o+4)%10]}i[0]^=bl[n],i[1]^=vl[n]}t.fill(0)}fe.keccakP=Fs;class on extends Ze.Hash{constructor(e,t,n,r=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,vt.number)(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,Ze.u32)(this.state)}keccak(){Ze.isLE||(0,Ze.byteSwap32)(this.state32),Fs(this.state32,this.rounds),Ze.isLE||(0,Ze.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,vt.exists)(this);const{blockLen:t,state:n}=this;e=(0,Ze.toBytes)(e);const r=e.length;for(let s=0;s<r;){const a=Math.min(t-this.pos,r-s);for(let o=0;o<a;o++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,t&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){(0,vt.exists)(this,!1),(0,vt.bytes)(e),this.finish();const t=this.state,{blockLen:n}=this;for(let r=0,s=e.length;r<s;){this.posOut>=n&&this.keccak();const a=Math.min(n-this.posOut,s-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,vt.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,vt.output)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:r,rounds:s,enableXOF:a}=this;return e||(e=new on(t,n,r,a,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=r,e.enableXOF=a,e.destroyed=this.destroyed,e}}fe.Keccak=on;const st=(i,e,t)=>(0,Ze.wrapConstructor)(()=>new on(e,i,t));fe.sha3_224=st(6,144,224/8);fe.sha3_256=st(6,136,256/8);fe.sha3_384=st(6,104,384/8);fe.sha3_512=st(6,72,512/8);fe.keccak_224=st(1,144,224/8);fe.keccak_256=st(1,136,256/8);fe.keccak_384=st(1,104,384/8);fe.keccak_512=st(1,72,512/8);const Ts=(i,e,t)=>(0,Ze.wrapXOFConstructorWithOpts)((n={})=>new on(e,i,n.dkLen===void 0?t:n.dkLen,!0));fe.shake128=Ts(31,168,128/8);fe.shake256=Ts(31,136,256/8);const{sha3_512:kl}=fe,Ps=24,Wt=32,pi=(i=4,e=Math.random)=>{let t="";for(;t.length<i;)t=t+Math.floor(e()*36).toString(36);return t};function Ds(i){let e=8n,t=0n;for(const n of i.values()){const r=BigInt(n);t=(t<<e)+r}return t}const Rs=(i="")=>Ds(kl(i)).toString(36).slice(1),mr=Array.from({length:26},(i,e)=>String.fromCharCode(e+97)),Il=i=>mr[Math.floor(i()*mr.length)],Bs=({globalObj:i=typeof Cn<"u"?Cn:typeof window<"u"?window:{},random:e=Math.random}={})=>{const t=Object.keys(i).toString(),n=t.length?t+pi(Wt,e):pi(Wt,e);return Rs(n).substring(0,Wt)},Ms=i=>()=>i++,Ol=476782367,Ns=({random:i=Math.random,counter:e=Ms(Math.floor(i()*Ol)),length:t=Ps,fingerprint:n=Bs({random:i})}={})=>function(){const s=Il(i),a=Date.now().toString(36),o=e().toString(36),l=pi(t,i),f=`${a+l+o+n}`;return`${s+Rs(f).substring(1,t)}`},Al=Ns(),Sl=(i,{minLength:e=2,maxLength:t=Wt}={})=>{const n=i.length,r=/^[0-9a-z]+$/;try{if(typeof i=="string"&&n>=e&&n<=t&&r.test(i))return!0}finally{}return!1};rt.getConstants=()=>({defaultLength:Ps,bigLength:Wt});rt.init=Ns;rt.createId=Al;rt.bufToBigInt=Ds;rt.createCounter=Ms;rt.createFingerprint=Bs;rt.isCuid=Sl;const{createId:Cl,init:zl,getConstants:Kl,isCuid:Xl}=rt;var gr=Cl;const wr=gn(i=>!isNaN(i)&&isFinite(i));class te{static object(...e){return ke(void 0,...e)}static json(...e){let t=e;return t.valueConverter&&!t.valueConverter.fieldTypeInDb&&(t.valueConverter.fieldTypeInDb="json"),ke(void 0,{valueConverter:{fieldTypeInDb:"json"}},...e)}static dateOnly(...e){return ke(()=>Date,{valueConverter:Ae.DateOnly},...e)}static date(...e){return ke(()=>Date,...e)}static integer(...e){return ke(()=>Number,{valueConverter:Ae.Integer,validate:wr},...e)}static autoIncrement(...e){return ke(()=>Number,{allowApiUpdate:!1,dbReadOnly:!0,valueConverter:{...Ae.Integer,fieldTypeInDb:"autoincrement"}},...e)}static number(...e){return ke(()=>Number,{validate:wr},...e)}static createdAt(...e){return ke(()=>Date,{allowApiUpdate:!1,saving:(t,n,{isNew:r})=>{r&&(n.value=new Date)}},...e)}static updatedAt(...e){return ke(()=>Date,{allowApiUpdate:!1,saving:(t,n)=>{n.value=new Date}},...e)}static uuid(...e){return ke(()=>String,{allowApiUpdate:!1,defaultValue:()=>ci(),saving:(t,n)=>{n.value||(n.value=ci())}},...e)}static cuid(...e){return ke(()=>String,{allowApiUpdate:!1,defaultValue:()=>gr(),saving:(t,n)=>{n.value||(n.value=gr())}},...e)}static literal(e,...t){return te.string({validate:(n,r)=>Me.in(e())(n,r),[xn]:e},...t)}static enum(e,...t){let n;return ke(()=>e(),{validate:(r,s)=>Me.enum(e())(r,s),[xn]:()=>wn(e())},...t,r=>{if(r[xn]=()=>wn(e()),n===void 0){let s=e();n=wn(s).find(o=>typeof o=="string")?Ae.String:Ae.Integer}r.valueConverter?r.valueConverter.fieldTypeInDb||(r.valueConverter.fieldTypeInDb=n.fieldTypeInDb):r.valueConverter=n})}static string(...e){return ke(()=>String,...e)}static boolean(...e){return ke(()=>Boolean,...e)}}class Nn{static toOne(e,t){let n=typeof t=="string"?{field:t}:t||{};return!n.field&&!n.fields&&!n.findOptions?ke(e,{...n,...Qn(e,"reference")}):ke(()=>{},{...n,serverExpression:()=>{},...Qn(e,"toOne")})}static toMany(e,t){return ke(()=>{},{...typeof t=="string"?{field:t}:t,serverExpression:()=>{},...Qn(e,"toMany")})}}function ke(i,...e){return(t,n,r)=>{const s=typeof n=="string"?n:n.name.toString();let a=f=>{let u=Qr(e,f);if(u.required&&(u.validate=_n(u.validate,Me.required,!0)),Ct(u,"maxLength")){let h=u;h.maxLength&&(h.validate=_n(h.validate,Me.maxLength(h.maxLength)))}if(Ct(u,"minLength")){let h=u;h.minLength&&(h.validate=_n(h.validate,Me.minLength(h.minLength)))}!u.valueType&&i&&(u.valueType=i()),u.key||(u.key=s),u.dbName||(u.dbName=u.key);let c=u.valueType;return c||(c=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:type",t,s):[],u.valueType=c),u.target||(u.target=t),u};Ls(t);let o=F.columnsOfType.get(t.constructor);o||(o=[],F.columnsOfType.set(t.constructor,o));let l=o.find(f=>f.key==s);if(!l)o.push({key:s,settings:a});else{let f=l.settings;l.settings=u=>{let c=f(u),h=a(u);return Object.assign(c,h)}}}}function Ls(i){if(!i)throw new Error("Set the 'experimentalDecorators:true' option in your 'tsconfig' or 'jsconfig' (target undefined)")}function El(i,e,t,n){var r=arguments.length,s=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(i,e,t,n);else for(var o=i.length-1;o>=0;o--)(a=i[o])&&(s=(r<3?a(s):r>3?a(e,t,s):a(e,t))||s);return r>3&&s&&Object.defineProperty(e,t,s),s}function Fl(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}class Fn extends zr{constructor(){super(...arguments);d(this,"id")}}El([te.uuid(),Fl("design:type",String)],Fn.prototype,"id",void 0);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var _r;(function(i){(function(e){var t=typeof Cn=="object"?Cn:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(s,a){return function(o,l){typeof s[o]!="function"&&Object.defineProperty(s,o,{configurable:!0,writable:!0,value:l}),a&&a(o,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",o={__proto__:[]}instanceof Array,l=!a&&!o,f={create:a?function(){return Jn(Object.create(null))}:o?function(){return Jn({__proto__:null})}:function(){return Jn({})},has:l?function(g,b){return t.call(g,b)}:function(g,b){return b in g},get:l?function(g,b){return t.call(g,b)?g[b]:void 0}:function(g,b){return g[b]}},u=Object.getPrototypeOf(Function),c=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!c&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Va(),p=!c&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Wa(),m=!c&&typeof WeakMap=="function"?WeakMap:Ha(),y=new m;function _(g,b,O,C){if(he(O)){if(!Ji(g))throw new TypeError;if(!Ui(b))throw new TypeError;return X(g,b)}else{if(!Ji(g))throw new TypeError;if(!Oe(b))throw new TypeError;if(!Oe(C)&&!he(C)&&!wt(C))throw new TypeError;return wt(C)&&(C=void 0),O=Xe(O),ge(g,b,O,C)}}e("decorate",_);function w(g,b){function O(C,L){if(!Oe(C))throw new TypeError;if(!he(L)&&!qa(L))throw new TypeError;ne(g,b,C,L)}return O}e("metadata",w);function k(g,b,O,C){if(!Oe(O))throw new TypeError;return he(C)||(C=Xe(C)),ne(g,b,O,C)}e("defineMetadata",k);function A(g,b,O){if(!Oe(b))throw new TypeError;return he(O)||(O=Xe(O)),T(g,b,O)}e("hasMetadata",A);function E(g,b,O){if(!Oe(b))throw new TypeError;return he(O)||(O=Xe(O)),P(g,b,O)}e("hasOwnMetadata",E);function H(g,b,O){if(!Oe(b))throw new TypeError;return he(O)||(O=Xe(O)),I(g,b,O)}e("getMetadata",H);function Z(g,b,O){if(!Oe(b))throw new TypeError;return he(O)||(O=Xe(O)),D(g,b,O)}e("getOwnMetadata",Z);function ee(g,b){if(!Oe(g))throw new TypeError;return he(b)||(b=Xe(b)),be(g,b)}e("getMetadataKeys",ee);function ue(g,b){if(!Oe(g))throw new TypeError;return he(b)||(b=Xe(b)),Ce(g,b)}e("getOwnMetadataKeys",ue);function me(g,b,O){if(!Oe(b))throw new TypeError;he(O)||(O=Xe(O));var C=v(b,O,!1);if(he(C)||!C.delete(g))return!1;if(C.size>0)return!0;var L=y.get(b);return L.delete(O),L.size>0||y.delete(b),!0}e("deleteMetadata",me);function X(g,b){for(var O=g.length-1;O>=0;--O){var C=g[O],L=C(b);if(!he(L)&&!wt(L)){if(!Ui(L))throw new TypeError;b=L}}return b}function ge(g,b,O,C){for(var L=g.length-1;L>=0;--L){var Ee=g[L],G=Ee(b,O,C);if(!he(G)&&!wt(G)){if(!Oe(G))throw new TypeError;C=G}}return C}function v(g,b,O){var C=y.get(g);if(he(C)){if(!O)return;C=new h,y.set(g,C)}var L=C.get(b);if(he(L)){if(!O)return;L=new h,C.set(b,L)}return L}function T(g,b,O){var C=P(g,b,O);if(C)return!0;var L=jn(b);return wt(L)?!1:T(g,L,O)}function P(g,b,O){var C=v(b,O,!1);return he(C)?!1:Na(C.has(g))}function I(g,b,O){var C=P(g,b,O);if(C)return D(g,b,O);var L=jn(b);if(!wt(L))return I(g,L,O)}function D(g,b,O){var C=v(b,O,!1);if(!he(C))return C.get(g)}function ne(g,b,O,C){var L=v(O,C,!0);L.set(g,b)}function be(g,b){var O=Ce(g,b),C=jn(g);if(C===null)return O;var L=be(C,b);if(L.length<=0)return O;if(O.length<=0)return L;for(var Ee=new p,G=[],K=0,$=O;K<$.length;K++){var Y=$[K],x=Ee.has(Y);x||(Ee.add(Y),G.push(Y))}for(var et=0,Wi=L;et<Wi.length;et++){var Y=Wi[et],x=Ee.has(Y);x||(Ee.add(Y),G.push(Y))}return G}function Ce(g,b){var O=[],C=v(g,b,!1);if(he(C))return O;for(var L=C.keys(),Ee=$a(L),G=0;;){var K=Ja(Ee);if(!K)return O.length=G,O;var $=ja(K);try{O[G]=$}catch(Y){try{Ua(Ee)}finally{throw Y}}G++}}function Re(g){if(g===null)return 1;switch(typeof g){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return g===null?1:6;default:return 6}}function he(g){return g===void 0}function wt(g){return g===null}function Ra(g){return typeof g=="symbol"}function Oe(g){return typeof g=="object"?g!==null:typeof g=="function"}function Ba(g,b){switch(Re(g)){case 0:return g;case 1:return g;case 2:return g;case 3:return g;case 4:return g;case 5:return g}var O="string",C=Vi(g,r);if(C!==void 0){var L=C.call(g,O);if(Oe(L))throw new TypeError;return L}return Ma(g)}function Ma(g,b){var O,C;{var L=g.toString;if(ln(L)){var C=L.call(g);if(!Oe(C))return C}var O=g.valueOf;if(ln(O)){var C=O.call(g);if(!Oe(C))return C}}throw new TypeError}function Na(g){return!!g}function La(g){return""+g}function Xe(g){var b=Ba(g);return Ra(b)?b:La(b)}function Ji(g){return Array.isArray?Array.isArray(g):g instanceof Object?g instanceof Array:Object.prototype.toString.call(g)==="[object Array]"}function ln(g){return typeof g=="function"}function Ui(g){return typeof g=="function"}function qa(g){switch(Re(g)){case 3:return!0;case 4:return!0;default:return!1}}function Vi(g,b){var O=g[b];if(O!=null){if(!ln(O))throw new TypeError;return O}}function $a(g){var b=Vi(g,s);if(!ln(b))throw new TypeError;var O=b.call(g);if(!Oe(O))throw new TypeError;return O}function ja(g){return g.value}function Ja(g){var b=g.next();return b.done?!1:b}function Ua(g){var b=g.return;b&&b.call(g)}function jn(g){var b=Object.getPrototypeOf(g);if(typeof g!="function"||g===u||b!==u)return b;var O=g.prototype,C=O&&Object.getPrototypeOf(O);if(C==null||C===Object.prototype)return b;var L=C.constructor;return typeof L!="function"||L===g?b:L}function Va(){var g={},b=[],O=function(){function G(K,$,Y){this._index=0,this._keys=K,this._values=$,this._selector=Y}return G.prototype["@@iterator"]=function(){return this},G.prototype[s]=function(){return this},G.prototype.next=function(){var K=this._index;if(K>=0&&K<this._keys.length){var $=this._selector(this._keys[K],this._values[K]);return K+1>=this._keys.length?(this._index=-1,this._keys=b,this._values=b):this._index++,{value:$,done:!1}}return{value:void 0,done:!0}},G.prototype.throw=function(K){throw this._index>=0&&(this._index=-1,this._keys=b,this._values=b),K},G.prototype.return=function(K){return this._index>=0&&(this._index=-1,this._keys=b,this._values=b),{value:K,done:!0}},G}();return function(){function G(){this._keys=[],this._values=[],this._cacheKey=g,this._cacheIndex=-2}return Object.defineProperty(G.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),G.prototype.has=function(K){return this._find(K,!1)>=0},G.prototype.get=function(K){var $=this._find(K,!1);return $>=0?this._values[$]:void 0},G.prototype.set=function(K,$){var Y=this._find(K,!0);return this._values[Y]=$,this},G.prototype.delete=function(K){var $=this._find(K,!1);if($>=0){for(var Y=this._keys.length,x=$+1;x<Y;x++)this._keys[x-1]=this._keys[x],this._values[x-1]=this._values[x];return this._keys.length--,this._values.length--,K===this._cacheKey&&(this._cacheKey=g,this._cacheIndex=-2),!0}return!1},G.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=g,this._cacheIndex=-2},G.prototype.keys=function(){return new O(this._keys,this._values,C)},G.prototype.values=function(){return new O(this._keys,this._values,L)},G.prototype.entries=function(){return new O(this._keys,this._values,Ee)},G.prototype["@@iterator"]=function(){return this.entries()},G.prototype[s]=function(){return this.entries()},G.prototype._find=function(K,$){return this._cacheKey!==K&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=K)),this._cacheIndex<0&&$&&(this._cacheIndex=this._keys.length,this._keys.push(K),this._values.push(void 0)),this._cacheIndex},G}();function C(G,K){return G}function L(G,K){return K}function Ee(G,K){return[G,K]}}function Wa(){return function(){function g(){this._map=new h}return Object.defineProperty(g.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),g.prototype.has=function(b){return this._map.has(b)},g.prototype.add=function(b){return this._map.set(b,b),this},g.prototype.delete=function(b){return this._map.delete(b)},g.prototype.clear=function(){this._map.clear()},g.prototype.keys=function(){return this._map.keys()},g.prototype.values=function(){return this._map.values()},g.prototype.entries=function(){return this._map.entries()},g.prototype["@@iterator"]=function(){return this.keys()},g.prototype[s]=function(){return this.keys()},g}()}function Ha(){var g=16,b=f.create(),O=C();return function(){function $(){this._key=C()}return $.prototype.has=function(Y){var x=L(Y,!1);return x!==void 0?f.has(x,this._key):!1},$.prototype.get=function(Y){var x=L(Y,!1);return x!==void 0?f.get(x,this._key):void 0},$.prototype.set=function(Y,x){var et=L(Y,!0);return et[this._key]=x,this},$.prototype.delete=function(Y){var x=L(Y,!1);return x!==void 0?delete x[this._key]:!1},$.prototype.clear=function(){this._key=C()},$}();function C(){var $;do $="@@WeakMap@@"+K();while(f.has(b,$));return b[$]=!0,$}function L($,Y){if(!t.call($,O)){if(!Y)return;Object.defineProperty($,O,{value:f.create()})}return $[O]}function Ee($,Y){for(var x=0;x<Y;++x)$[x]=Math.random()*255|0;return $}function G($){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array($)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array($)):Ee(new Uint8Array($),$):Ee(new Array($),$)}function K(){var $=G(g);$[6]=$[6]&79|64,$[8]=$[8]&191|128;for(var Y="",x=0;x<g;++x){var et=$[x];(x===4||x===6||x===8)&&(Y+="-"),et<16&&(Y+="0"),Y+=et.toString(16).toLowerCase()}return Y}}function Jn(g){return g.__=void 0,delete g.__,g}})})(_r||(_r={}));const Tn=class Tn{constructor(e,t,n){d(this,"actionUrl");d(this,"queue");d(this,"allowed");d(this,"doWork");this.actionUrl=e,this.queue=t,this.allowed=n}async run(e,t,n){t===void 0&&(t=Se.apiClient.url),n||(n=Et(Se.apiClient.httpClient));let r=await n.post(t+"/"+this.actionUrl,e),s=r;if(s&&s.queuedJobId){let a=F.actionInfo.startBusyWithProgress();try{let o;if(await F.actionInfo.runActionWithoutBlockingUI(async()=>{for(;!o||!o.done;)o&&await new Promise(l=>setTimeout(()=>{l(void 0)},200)),o=await n.post(t+"/"+Tn.apiUrlForJobStatus,{queuedJobId:r.queuedJobId}),o.progress&&a.progress(o.progress)}),o.error)throw o.error;return a.progress(1),o.result}finally{a.close()}}else return r}__register(e){e(this.actionUrl,this.queue,this.allowed,async(t,n,r)=>{try{var s=await this.execute(t,n,r);r.success(s)}catch(a){a.isForbiddenError?r.forbidden():r.error(a,void 0)}})}};d(Tn,"apiUrlForJobStatus","jobStatusInQueue");let Kt=Tn;class yi extends Error{constructor(t="Forbidden"){super(t);d(this,"isForbiddenError",!0)}}class Tl extends Kt{constructor(t,n,r,s){super(t,r.queue??!1,r.allowed);d(this,"types");d(this,"options");d(this,"originalMethod");this.types=n,this.options=r,this.originalMethod=s}async execute(t,n,r){let s={data:{}},a=n.dataProvider;return await js(n,this.options,async()=>{if(!n.isAllowedForInstance(void 0,this.options.allowed))throw new yi;t.args=await $s(this.types(),t.args,n,a,r);try{s.data=await this.originalMethod(t.args)}catch(o){throw o}}),s}}function ze(i){return(e,t,n)=>{const r=typeof t=="string"?t:t.name.toString(),s=n?n.value:e;let a=s;Ls(e);function o(){var u=typeof Reflect.getMetadata=="function"?Reflect.getMetadata("design:paramtypes",e,r):[];return i.paramTypes&&(u=typeof i.paramTypes=="function"?i.paramTypes():i.paramTypes),u}if(e.prototype!==void 0){let u=new Tl((i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+r,()=>o(),i,c=>s.apply(void 0,c));return u.doWork=async(c,h,p,m)=>(c=kr(o(),c),i.blockUser===!1?await F.actionInfo.runActionWithoutBlockingUI(async()=>(await u.run({args:c},p,m)).data):(await u.run({args:c},p,m)).data),a=async function(...c){return Qt()?await s.apply(this,c):await u.doWork(c,void 0)},br(e,a),a[di]=u,n?(n.value=a,n):a}let l=F.classHelpers.get(e.constructor);l||(l=new Jr,F.classHelpers.set(e.constructor,l));let f={__register(u){let c=new je;for(const h of l.classes.keys()){let p=l.classes.get(h);p.key||(p.key=c.repo(h).metadata.key),u(p.key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+r,i?i.queue??!1:!1,i.allowed,async(m,y,_)=>{m.args=m.args.map(k=>qs(k)?void 0:k);let w=i.allowed;try{let k=y,A;await js(k,i,async()=>{if(m.args=await $s(o(),m.args,k,k.dataProvider,_),F.allEntities.includes(h)){let E=k.repo(h),H;const Z=m.rowInfo;if(Z.isNewRow)H=E.create(),await E.getEntityRef(H)._updateEntityBasedOnApi(Z.data);else{let ue=await E.find({where:{...E.metadata.idMetadata.getIdFilter(Z.id),$and:[E.metadata.options.apiPrefilter??{}]}});if(ue.length!=1)throw new Error("not found or too many matches");H=ue[0],await E.getEntityRef(H)._updateEntityBasedOnApi(Z.data)}if(!k.isAllowedForInstance(H,w))throw new yi;let ee=oe(H);await ee.__validateEntity();try{A={result:await s.apply(H,m.args),rowInfo:{data:await ee.toApiJson(),isNewRow:ee.isNew(),wasChanged:ee.wasChanged(),id:ee.getOriginalId()}}}catch(ue){throw ee.catchSaveErrors(ue)}}else{let E=new h(k,k.dataProvider),H=fr(E,k);if(await H._updateEntityBasedOnApi(m.fields),!k.isAllowedForInstance(E,w))throw new yi;await H.__validateEntity();try{A={result:await s.apply(E,m.args),fields:await H.toApiJson()}}catch(Z){throw H.catchSaveErrors(Z)}}}),_.success(A)}catch(k){k.isForbiddenError?_.forbidden():_.error(k,void 0)}})}},doWork:async function(u,c,h,p){if(u=kr(o(),u),F.allEntities.includes(e.constructor)){let m=oe(c);await m.__validateEntity();let y=l.classes.get(c.constructor);y.key||(y.key=m.repository.metadata.key+"_methods");try{let _=await new class extends Kt{constructor(){super(...arguments);d(this,"execute")}}(y.key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+r,(i==null?void 0:i.queue)??!1,i.allowed).run({args:u,rowInfo:{data:await m.toApiJson(),isNewRow:m.isNew(),wasChanged:m.wasChanged(),id:m.getOriginalId()}},h,p);return await m._updateEntityBasedOnApi(_.rowInfo.data,!0),_.result}catch(_){throw m.catchSaveErrors(_)}}else{let m=fr(c,void 0);try{await m.__validateEntity();let y=await new class extends Kt{constructor(){super(...arguments);d(this,"execute")}}(l.classes.get(c.constructor).key+"/"+(i!=null&&i.apiPrefix?i.apiPrefix+"/":"")+r,(i==null?void 0:i.queue)??!1,i.allowed).run({args:u,fields:await m.toApiJson()},h,p);return await m._updateEntityBasedOnApi(y.fields),y.result}catch(y){throw m.catchSaveErrors(y)}}}};return a=async function(...u){let c=this;return Qt()?await s.apply(c,u):f.doWork(u,c)},br(e.constructor,a),a[di]=f,n?(n.value=a,n):a}}const Pl={_isUndefined:!0};function br(i,e){(i[Ir]||(i[Ir]=[])).push(e),F.actionInfo.allActions.push(e)}function qs(i){return i&&i._isUndefined}class vr{constructor(e){d(this,"res");this.res=e}progress(e){this.res.progress(e)}}function kr(i,e){if(i)for(let t=0;t<i.length;t++){const n=i[t];for(const r of[je,Ft])(e[t]instanceof r||n==r)&&(e[t]=void 0);if(e[t]!=null){let r={valueType:n};if(r=Pi(r,new je),Pe(n,!1)!=null){let a=oe(e[t]);e[t]=a.getId()}r.valueConverter&&(e[t]=r.valueConverter.toJson(e[t]))}}return e.map(t=>t!==void 0?t:Pl)}async function $s(i,e,t,n,r){for(let s=0;s<e.length;s++){const a=e[s];qs(a)&&(e[s]=void 0)}if(i)for(let s=0;s<i.length;s++)if(e.length<s&&e.push(void 0),i[s]==je||i[s]==je)e[s]=t;else if(i[s]==Ft&&n)e[s]=n;else if(i[s]==vr)e[s]=new vr(r);else{let a={valueType:i[s]};a=Pi(a,t),a.valueConverter&&(e[s]=a.valueConverter.fromJson(e[s])),Pe(i[s],!1)!=null&&(e[s]===null||e[s]===void 0||(e[s]=await t.repo(i[s]).findId(e[s])))}return e}const Ir=Symbol.for("classBackendMethodsArray");async function js(i,e,t){if(e.transactional===void 0||e.transactional===!0)return await Wo(i,t);await t(i.dataProvider)}function Js(i,e){return Se.repo(i,e)}function Ln(i){return i}class Dl{constructor(e,t){d(this,"id");d(this,"caption");d(this,"icon");d(this,"where");d(this,"class");d(this,"hide");this.id=e.toString(),this.caption=(t==null?void 0:t.caption)??this.id,this.icon=t==null?void 0:t.icon,this.where=t==null?void 0:t.where,this.class=t==null?void 0:t.class,this.hide=t==null?void 0:t.hide,t!=null&&t.icon&&t.icon.caption===void 0&&(t.icon.caption=t==null?void 0:t.caption)}}var Rl=Object.defineProperty,Bl=Object.getOwnPropertyDescriptor,xe=(i,e,t,n)=>{for(var r=n>1?void 0:n?Bl(e,t):e,s=i.length-1,a;s>=0;s--)(a=i[s])&&(r=(n?a(e,t,r):a(r))||r);return n&&r&&Rl(e,t,r),r};let Ne=class{constructor(){d(this,"id","");d(this,"entity","");d(this,"entityId","");d(this,"changeDate",new Date);d(this,"userId","");d(this,"changes",[]);d(this,"newRow",!1);d(this,"deleted",!1)}};xe([te.cuid()],Ne.prototype,"id",2);xe([te.string()],Ne.prototype,"entity",2);xe([te.string()],Ne.prototype,"entityId",2);xe([te.date()],Ne.prototype,"changeDate",2);xe([te.string()],Ne.prototype,"userId",2);xe([te.json({dbName:"changesJson"})],Ne.prototype,"changes",2);xe([te.boolean()],Ne.prototype,"newRow",2);xe([te.boolean()],Ne.prototype,"deleted",2);Ne=xe([Yr("_ff_change_logs",{caption:"FF Change Logs",allowApiCrud:!1,defaultOrderBy:{changeDate:"desc"}})],Ne);async function Ml(i,e,t){var n;if(Qt()){const r=[],s=new Us(i,t),a=(t==null?void 0:t.forceNew)||e.isNew,o=(t==null?void 0:t.forceDate)||new Date;for(const l of s.fields.filter(f=>f.valueChanged()||a&&f.value))try{const f=s.excludedValues.includes(l);r.push({key:l.metadata.key,newValue:f?"***":l.value instanceof Fn?l.value.id:l.metadata.options.valueConverter.toJson(l.value),oldValue:e.isNew?"---":f?"***":l.originalValue instanceof Fn?l.originalValue.id:l.metadata.options.valueConverter.toJson(l.originalValue)})}catch(f){throw console.error(l),f}r.length>0&&await Js(Ne).insert({changeDate:o,changes:r,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(i),userId:((n=Se.user)==null?void 0:n.id)||"",newRow:a})}}async function Nl(i,e,t){var a;const n=[],r=new Us(i,t),s=(t==null?void 0:t.forceDate)||new Date;for(const o of r.fields)try{const l=r.excludedValues.includes(o);n.push({key:o.metadata.key,newValue:l?"***":"---",oldValue:l?"***":o.originalValue instanceof Fn?o.originalValue.id:o.metadata.options.valueConverter.toJson(o.originalValue)})}catch(l){throw console.error(o),l}await Js(Ne).insert({changeDate:s,changes:n,entity:e.metadata.key,entityId:e.metadata.idMetadata.getId(i),userId:((a=Se.user)==null?void 0:a.id)||"",deleted:!0})}class Us{constructor(e,t){d(this,"fields");d(this,"excludedFields");d(this,"excludedValues");const n=oe(e);t!=null&&t.excludeColumns?this.excludedFields=t.excludeColumns(n.fields):this.excludedFields=[],t!=null&&t.excludeValues?this.excludedValues=t.excludeValues(n.fields):this.excludedValues=[],this.excludedFields.push(...n.fields.toArray().filter(r=>r.metadata.options.serverExpression)),this.excludedFields.push(...n.fields.toArray().filter(r=>r.metadata.options.sqlExpression)),this.fields=n.fields.toArray().filter(r=>!this.excludedFields.includes(r))}}const Lt=i=>{if(i)return Array.isArray(i)?i.map(e=>e.id):i.id};function Mi(i,e){return Yr(i,{...e,allowApiCrud:e.allowApiCrud??Lt(e.permissionApiCrud),allowApiDelete:e.allowApiDelete??Lt(e.permissionApiDelete),allowApiInsert:e.allowApiInsert??Lt(e.permissionApiInsert),allowApiRead:e.allowApiRead??Lt(e.permissionApiRead),allowApiUpdate:e.allowApiUpdate??Lt(e.permissionApiUpdate),saved:async(t,n)=>{var r;await((r=e==null?void 0:e.saved)==null?void 0:r.call(e,t,n)),e.changeLog===!1||Qt()&&await Ml(t,n,e.changeLog)},deleted:async(t,n)=>{var r;await((r=e==null?void 0:e.deleted)==null?void 0:r.call(e,t,n)),e.changeLog===!1||Qt()&&await Nl(t,n,e.changeLog)}})}const Ni={FF_Role_Admin:"FF_Role.Admin"};var Vs=Object.defineProperty,Ll=Object.getOwnPropertyDescriptor,ql=(i,e,t)=>e in i?Vs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,de=(i,e,t,n)=>{for(var r=n>1?void 0:n?Ll(e,t):e,s=i.length-1,a;s>=0;s--)(a=i[s])&&(r=(n?a(e,t,r):a(r))||r);return n&&r&&Vs(e,t,r),r},qn=(i,e,t)=>ql(i,typeof e!="symbol"?e+"":e,t);const $n={FF_Role_Auth_Admin:"FF_Role_Auth.Admin",FF_Role_Auth_Invite:"FF_Role_Auth.Invite"};let Je=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"identifier");d(this,"roles",[]);d(this,"accounts");d(this,"sessions")}};de([te.cuid()],Je.prototype,"id",2);de([te.createdAt()],Je.prototype,"createdAt",2);de([te.updatedAt()],Je.prototype,"updatedAt",2);de([te.string({validate:[Me.unique(),Me.required(),i=>{var e;if(((e=i.identifier)==null?void 0:e.length)<2)throw"Must be at least 2 characters long"}]})],Je.prototype,"identifier",2);de([te.json(()=>[],{inputType:"selectEnum",valueConverter:{toDb:i=>i?i.join(","):[],fromDb:i=>i?i.split(",").map(e=>e.replace("{","").replace("}","")).filter(e=>e!==""):[]}})],Je.prototype,"roles",2);de([Nn.toMany(()=>De,"userId")],Je.prototype,"accounts",2);de([Nn.toMany(()=>pt,"userId")],Je.prototype,"sessions",2);Je=de([Mi("ff_auth.users",{allowApiCrud:[$n.FF_Role_Auth_Admin,Ni.FF_Role_Admin],caption:"FF Auth - Users"})],Je);let De=class{constructor(){d(this,"id");d(this,"createdAt");d(this,"updatedAt");d(this,"userId");d(this,"user");d(this,"provider",Ue.PASSWORD.id);d(this,"providerUserId","");d(this,"hashPassword");d(this,"token");d(this,"expiresAt");d(this,"lastVerifiedAt")}};de([te.cuid()],De.prototype,"id",2);de([te.createdAt()],De.prototype,"createdAt",2);de([te.updatedAt()],De.prototype,"updatedAt",2);de([te.string()],De.prototype,"userId",2);de([Nn.toOne(()=>Je,"userId")],De.prototype,"user",2);de([te.string()],De.prototype,"provider",2);de([te.string()],De.prototype,"providerUserId",2);de([te.string({includeInApi:!1,allowNull:!0})],De.prototype,"hashPassword",2);de([te.string({includeInApi:!1,allowNull:!0})],De.prototype,"token",2);de([te.date({includeInApi:!1,allowNull:!0})],De.prototype,"expiresAt",2);de([te.date({includeInApi:!1,allowNull:!0})],De.prototype,"lastVerifiedAt",2);De=de([Mi("ff_auth.accounts",{allowApiCrud:[$n.FF_Role_Auth_Admin,Ni.FF_Role_Admin],caption:"FF Auth - Accounts",changeLog:{excludeColumns:i=>[i.hashPassword,i.token]}})],De);let pt=class{constructor(){d(this,"id");d(this,"expiresAt");d(this,"userId");d(this,"user")}};de([te.string()],pt.prototype,"id",2);de([te.date()],pt.prototype,"expiresAt",2);de([te.string()],pt.prototype,"userId",2);de([Nn.toOne(()=>Je,"userId")],pt.prototype,"user",2);pt=de([Mi("ff_auth.users_sessions",{allowApiCrud:[$n.FF_Role_Auth_Admin,Ni.FF_Role_Admin],caption:"FF Auth - Users sessions",changeLog:!1})],pt);let Ue=class extends Dl{constructor(i,e){super(i,{...e})}};qn(Ue,"DEMO",new Ue("DEMO",{caption:"Demo"}));qn(Ue,"PASSWORD",new Ue("PASSWORD",{caption:"Password"}));qn(Ue,"OTP",new Ue("OTP",{caption:"TOTP"}));qn(Ue,"OAUTH",new Ue("OAUTH",{caption:"OAUTH"}));Ue=de([rl()],Ue);var $l=Object.defineProperty,jl=Object.getOwnPropertyDescriptor,Ke=(i,e,t,n)=>{for(var r=jl(e,t),s=i.length-1,a;s>=0;s--)(a=i[s])&&(r=a(e,t,r)||r);return r&&$l(e,t,r),r},pe,Xt,Zt,Yt,xt,en,tn,nn,rn,sn,an;const He=(pe=class{static _setAbstraction(e){$e(this,Xt,e.signOut),$e(this,Zt,e.signInDemo),$e(this,Yt,e.invite),$e(this,xt,e.signUpPassword),$e(this,en,e.signInPassword),$e(this,tn,e.forgotPassword),$e(this,nn,e.resetPassword),$e(this,rn,e.signInOTP),$e(this,sn,e.verifyOtp),$e(this,an,e.signInOAuthGetUrl)}static async signOut(){var e;return await Le(e=pe,Xt).call(e)}static async signInDemo(e){var t;return await Le(t=pe,Zt).call(t,e)}static async invite(e){var t;return await Le(t=pe,Yt).call(t,e)}static async signUpPassword(e,t){var n;return await Le(n=pe,xt).call(n,e,t)}static async signInPassword(e,t){var n;return await Le(n=pe,en).call(n,e,t)}static async forgotPassword(e){var t;return await Le(t=pe,tn).call(t,e)}static async resetPassword(e,t){var n;return await Le(n=pe,nn).call(n,e,t)}static async signInOTP(e){var t;return await Le(t=pe,rn).call(t,e)}static async verifyOtp(e,t){var n;return await Le(n=pe,sn).call(n,e,t)}static async signInOAuthGetUrl(e){var t;return await Le(t=pe,an).call(t,e)}},Xt=new WeakMap,Zt=new WeakMap,Yt=new WeakMap,xt=new WeakMap,en=new WeakMap,tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,sn=new WeakMap,an=new WeakMap,qe(pe,Xt),qe(pe,Zt),qe(pe,Yt),qe(pe,xt),qe(pe,en),qe(pe,tn),qe(pe,nn),qe(pe,rn),qe(pe,sn),qe(pe,an),pe);Ke([ze({allowed:!0})],He,"signOut");Ke([ze({allowed:!0})],He,"signInDemo");Ke([ze({allowed:$n.FF_Role_Auth_Invite})],He,"invite");Ke([ze({allowed:!0})],He,"signUpPassword");Ke([ze({allowed:!0})],He,"signInPassword");Ke([ze({allowed:!0})],He,"forgotPassword");Ke([ze({allowed:!0})],He,"resetPassword");Ke([ze({allowed:!0})],He,"signInOTP");Ke([ze({allowed:!0})],He,"verifyOtp");Ke([ze({allowed:!0})],He,"signInOAuthGetUrl");let it=He;function Mt(i){i.focus()}const qt="src/lib/modules/auth/components/ForgotPassword.svelte";function mi(i){var w;let e,t,n,r,s,a,o,l,f,u,c=((w=i[1].ui)==null?void 0:w.strings.send_password_reset_instructions)+"",h,p,m,y;const _={c:function(){var A;e=j("div"),t=j("p"),n=ie(i[2]),r=ie(i[4]),s=Q(),a=j("form"),o=j("input"),f=Q(),u=j("button"),h=ie(c),B(t,"class","message"),Qe(t,"error",i[2]),J(t,qt,32,2,615),o.required=!0,B(o,"type","text"),B(o,"placeholder",l=(A=i[1].ui)==null?void 0:A.strings.email_placeholder),J(o,qt,34,4,731),u.disabled=p=!i[0]||i[3],J(u,qt,41,4,893),B(a,"class","svelte-wa5ykb"),J(a,qt,33,2,686),B(e,"class","login"),J(e,qt,31,0,593)},l:function(A){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(A,E){U(A,e,E),S(e,t),S(t,n),S(t,r),S(e,s),S(e,a),S(a,o),Fe(o,i[0]),S(a,f),S(a,u),S(u,h),m||(y=[Pn(Mt.call(null,o)),Be(o,"input",i[6]),Be(a,"submit",Dn(i[5]),!1,!0,!1,!1)],m=!0)},p:function(A,[E]){var H,Z;E&4&&Ie(n,A[2]),E&4&&Qe(t,"error",A[2]),E&2&&l!==(l=(H=A[1].ui)==null?void 0:H.strings.email_placeholder)&&B(o,"placeholder",l),E&1&&o.value!==A[0]&&Fe(o,A[0]),E&2&&c!==(c=((Z=A[1].ui)==null?void 0:Z.strings.send_password_reset_instructions)+"")&&Ie(h,c),E&9&&p!==(p=!A[0]||A[3])&&Rn(u,"disabled",p)},i:le,o:le,d:function(A){A&&V(e),m=!1,Tt(y)}};return R("SvelteRegisterBlock",{block:_,id:mi.name,type:"component",source:"",ctx:i}),_}function Jl(i,e,t){let{$$slots:n={},$$scope:r}=e;gt("ForgotPassword",n,[]);let{firstlyDataAuth:s}=e,{email:a=""}=e,o="",l="",f=!1;async function u(){t(3,f=!0);try{await it.forgotPassword(a),window.location.href="/ff/auth/sign-in"}catch(p){p&&t(2,o=p.message??"")}finally{t(3,f=!1)}}i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<ForgotPassword> was created without expected prop 'firstlyDataAuth'")});const c=["firstlyDataAuth","email"];Object.keys(e).forEach(p=>{!~c.indexOf(p)&&p.slice(0,2)!=="$$"&&p!=="slot"&&console.warn(`<ForgotPassword> was created with unknown prop '${p}'`)});function h(){a=this.value,t(0,a)}return i.$$set=p=>{"firstlyDataAuth"in p&&t(1,s=p.firstlyDataAuth),"email"in p&&t(0,a=p.email)},i.$capture_state=()=>({isError:Ln,AuthController:it,autofocus:Mt,firstlyDataAuth:s,email:a,msgError:o,msgSuccess:l,loading:f,forgot:u}),i.$inject_state=p=>{"firstlyDataAuth"in p&&t(1,s=p.firstlyDataAuth),"email"in p&&t(0,a=p.email),"msgError"in p&&t(2,o=p.msgError),"msgSuccess"in p&&t(4,l=p.msgSuccess),"loading"in p&&t(3,f=p.loading)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[a,s,o,f,l,u,h]}class Li extends yt{constructor(e){super(e),mt(this,e,Jl,mi,Pt,{firstlyDataAuth:1,email:0}),R("SvelteRegisterComponent",{component:this,tagName:"ForgotPassword",options:e,id:mi.name})}get firstlyDataAuth(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new Error("<ForgotPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new Error("<ForgotPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const kt="src/lib/modules/auth/components/ResetPassword.svelte";function gi(i){var X,ge,v;let e,t,n,r,s,a,o=((X=i[2].ui)==null?void 0:X.strings.password)+"",l,f,u,c,h,p=((ge=i[2].ui)==null?void 0:ge.strings.confirm)+"",m,y,_,w,k,A,E=((v=i[2].ui)==null?void 0:v.strings.reset)+"",H,Z,ee,ue;const me={c:function(){var P,I;e=j("div"),t=j("p"),n=ie(i[3]),r=ie(i[4]),s=Q(),a=j("form"),l=ie(o),f=Q(),u=j("input"),h=Q(),m=ie(p),y=Q(),_=j("input"),k=Q(),A=j("button"),H=ie(E),B(t,"class","message"),Qe(t,"error",i[3]),J(t,kt,33,2,708),B(u,"type","password"),u.required=!0,B(u,"placeholder",c=(P=i[2].ui)==null?void 0:P.strings.password_placeholder),J(u,kt,36,4,866),B(_,"type","password"),_.required=!0,B(_,"placeholder",w=(I=i[2].ui)==null?void 0:I.strings.password_placeholder),J(_,kt,43,4,1061),A.disabled=Z=!i[0]||!i[1]||i[5],J(A,kt,49,4,1214),B(a,"class","svelte-wa5ykb"),J(a,kt,34,2,779),B(e,"class","login"),J(e,kt,32,0,686)},l:function(P){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(P,I){U(P,e,I),S(e,t),S(t,n),S(t,r),S(e,s),S(e,a),S(a,l),S(a,f),S(a,u),Fe(u,i[0]),S(a,h),S(a,m),S(a,y),S(a,_),Fe(_,i[1]),S(a,k),S(a,A),S(A,H),ee||(ue=[Be(u,"input",i[7]),Be(_,"input",i[8]),Be(a,"submit",Dn(i[6]),!1,!0,!1,!1)],ee=!0)},p:function(P,[I]){var D,ne,be,Ce,Re;I&8&&Ie(n,P[3]),I&16&&Ie(r,P[4]),I&8&&Qe(t,"error",P[3]),I&4&&o!==(o=((D=P[2].ui)==null?void 0:D.strings.password)+"")&&Ie(l,o),I&4&&c!==(c=(ne=P[2].ui)==null?void 0:ne.strings.password_placeholder)&&B(u,"placeholder",c),I&1&&u.value!==P[0]&&Fe(u,P[0]),I&4&&p!==(p=((be=P[2].ui)==null?void 0:be.strings.confirm)+"")&&Ie(m,p),I&4&&w!==(w=(Ce=P[2].ui)==null?void 0:Ce.strings.password_placeholder)&&B(_,"placeholder",w),I&2&&_.value!==P[1]&&Fe(_,P[1]),I&4&&E!==(E=((Re=P[2].ui)==null?void 0:Re.strings.reset)+"")&&Ie(H,E),I&35&&Z!==(Z=!P[0]||!P[1]||P[5])&&Rn(A,"disabled",Z)},i:le,o:le,d:function(P){P&&V(e),ee=!1,Tt(ue)}};return R("SvelteRegisterBlock",{block:me,id:gi.name,type:"component",source:"",ctx:i}),me}function Ul(i,e,t){let{$$slots:n={},$$scope:r}=e;gt("ResetPassword",n,[]);let{firstlyDataAuth:s}=e,{password1:a=""}=e,{password2:o=""}=e,l="",f="",u=!1;async function c(){t(3,l=""),t(4,f=""),t(5,u=!0);const y=new URL(location.href).searchParams.get("token");try{await it.resetPassword(y??"",a),window.location.href="/"}catch(_){_&&t(3,l=_.message??"")}finally{t(5,u=!1)}}i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<ResetPassword> was created without expected prop 'firstlyDataAuth'")});const h=["firstlyDataAuth","password1","password2"];Object.keys(e).forEach(y=>{!~h.indexOf(y)&&y.slice(0,2)!=="$$"&&y!=="slot"&&console.warn(`<ResetPassword> was created with unknown prop '${y}'`)});function p(){a=this.value,t(0,a)}function m(){o=this.value,t(1,o)}return i.$$set=y=>{"firstlyDataAuth"in y&&t(2,s=y.firstlyDataAuth),"password1"in y&&t(0,a=y.password1),"password2"in y&&t(1,o=y.password2)},i.$capture_state=()=>({isError:Ln,AuthController:it,firstlyDataAuth:s,password1:a,password2:o,msgError:l,msgSuccess:f,loading:u,reset:c}),i.$inject_state=y=>{"firstlyDataAuth"in y&&t(2,s=y.firstlyDataAuth),"password1"in y&&t(0,a=y.password1),"password2"in y&&t(1,o=y.password2),"msgError"in y&&t(3,l=y.msgError),"msgSuccess"in y&&t(4,f=y.msgSuccess),"loading"in y&&t(5,u=y.loading)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[a,o,s,l,f,u,c,p,m]}class qi extends yt{constructor(e){super(e),mt(this,e,Ul,gi,Pt,{firstlyDataAuth:2,password1:0,password2:1}),R("SvelteRegisterComponent",{component:this,tagName:"ResetPassword",options:e,id:gi.name})}get firstlyDataAuth(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password1(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password1(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get password2(){throw new Error("<ResetPassword>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set password2(e){throw new Error("<ResetPassword>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:lt}=Ii,at="src/lib/modules/auth/components/SignIn.svelte";function wi(i){var ge,v,T;let e,t,n,r,s,a,o=((ge=i[1].ui)==null?void 0:ge.strings.email)+"",l,f,u,c,h,p,m=((v=i[1].ui)==null?void 0:v.strings.password)+"",y,_,w,k,A,E,H=((T=i[1].ui)==null?void 0:T.strings.btn_sign_in)+"",Z,ee,ue,me;const X={c:function(){var I,D;e=j("form"),t=j("p"),n=ie(i[3]),r=ie(i[4]),s=Q(),a=j("label"),l=ie(o),f=Q(),u=j("input"),h=Q(),p=j("label"),y=ie(m),_=Q(),w=j("input"),A=Q(),E=j("button"),Z=ie(H),B(t,"class","message svelte-1rtdg09"),Qe(t,"error",i[3]),J(t,at,43,4,867),u.required=!0,B(u,"type","text"),B(u,"placeholder",c=(I=i[1].ui)==null?void 0:I.strings.email_placeholder),J(u,at,46,6,996),J(a,at,44,4,940),w.required=!0,B(w,"type","password"),B(w,"placeholder",k=(D=i[1].ui)==null?void 0:D.strings.password_placeholder),J(w,at,56,6,1242),J(p,at,54,4,1183),E.disabled=ee=!i[0]||!i[5]||i[6],J(E,at,63,4,1417),B(e,"class","svelte-1rtdg09"),J(e,at,42,2,822)},m:function(I,D){U(I,e,D),S(e,t),S(t,n),S(t,r),S(e,s),S(e,a),S(a,l),S(a,f),S(a,u),Fe(u,i[0]),S(e,h),S(e,p),S(p,y),S(p,_),S(p,w),Fe(w,i[5]),S(e,A),S(e,E),S(E,Z),ue||(me=[Be(u,"input",i[8]),Pn(Mt.call(null,u)),Be(w,"input",i[9]),Be(e,"submit",Dn(i[7]),!1,!0,!1,!1)],ue=!0)},p:function(I,D){var ne,be,Ce,Re,he;D&8&&Ie(n,I[3]),D&16&&Ie(r,I[4]),D&8&&Qe(t,"error",I[3]),D&2&&o!==(o=((ne=I[1].ui)==null?void 0:ne.strings.email)+"")&&Ie(l,o),D&2&&c!==(c=(be=I[1].ui)==null?void 0:be.strings.email_placeholder)&&B(u,"placeholder",c),D&1&&u.value!==I[0]&&Fe(u,I[0]),D&2&&m!==(m=((Ce=I[1].ui)==null?void 0:Ce.strings.password)+"")&&Ie(y,m),D&2&&k!==(k=(Re=I[1].ui)==null?void 0:Re.strings.password_placeholder)&&B(w,"placeholder",k),D&32&&w.value!==I[5]&&Fe(w,I[5]),D&2&&H!==(H=((he=I[1].ui)==null?void 0:he.strings.btn_sign_in)+"")&&Ie(Z,H),D&97&&ee!==(ee=!I[0]||!I[5]||I[6])&&Rn(E,"disabled",ee)},d:function(I){I&&V(e),ue=!1,Tt(me)}};return R("SvelteRegisterBlock",{block:X,id:wi.name,type:"if",source:"(31:0) {#if view == 'login'}",ctx:i}),X}function _i(i){let e,t=i[2]=="login"&&wi(i);const n={c:function(){t&&t.c(),e=Oi()},l:function(s){throw new lt("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,a){t&&t.m(s,a),U(s,e,a)},p:function(s,[a]){s[2]=="login"?t?t.p(s,a):(t=wi(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:le,o:le,d:function(s){s&&V(e),t&&t.d(s)}};return R("SvelteRegisterBlock",{block:n,id:_i.name,type:"component",source:"",ctx:i}),n}function Vl(i,e,t){let{$$slots:n={},$$scope:r}=e;gt("SignIn",n,[]);let{firstlyDataAuth:s}=e,{view:a="login"}=e,{email:o=""}=e,l="",f="",u,c=!1;async function h(){t(3,l=""),t(4,f=""),t(6,c=!0);try{await it.signInPassword(o,u),window.location.href=new URL(window.location.href).searchParams.get("redirect")??"/"}catch(w){w&&t(3,l=w.message??"")}finally{t(6,c=!1)}}const p=()=>{throw new Error("Not impl yet")};i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<SignIn> was created without expected prop 'firstlyDataAuth'")});const m=["firstlyDataAuth","view","email"];Object.keys(e).forEach(w=>{!~m.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignIn> was created with unknown prop '${w}'`)});function y(){o=this.value,t(0,o)}function _(){u=this.value,t(5,u)}return i.$$set=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email)},i.$capture_state=()=>({AuthController:it,isError:Ln,autofocus:Mt,firstlyDataAuth:s,view:a,email:o,msgError:l,msgSuccess:f,password:u,loading:c,signIn:h,handlePin:p}),i.$inject_state=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,f=w.msgSuccess),"password"in w&&t(5,u=w.password),"loading"in w&&t(6,c=w.loading)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[o,s,a,l,f,u,c,h,y,_]}class $i extends yt{constructor(e){super(e),mt(this,e,Vl,_i,Pt,{firstlyDataAuth:1,view:2,email:0}),R("SvelteRegisterComponent",{component:this,tagName:"SignIn",options:e,id:_i.name})}get firstlyDataAuth(){throw new lt("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new lt("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new lt("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new lt("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new lt("<SignIn>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new lt("<SignIn>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const{Error:ut}=Ii,ot="src/lib/modules/auth/components/SignUp.svelte";function bi(i){var ge,v,T;let e,t,n,r,s,a,o=((ge=i[1].ui)==null?void 0:ge.strings.email)+"",l,f,u,c,h,p,m=((v=i[1].ui)==null?void 0:v.strings.password)+"",y,_,w,k,A,E,H=((T=i[1].ui)==null?void 0:T.strings.btn_sign_up)+"",Z,ee,ue,me;const X={c:function(){var I,D;e=j("form"),t=j("p"),n=ie(i[3]),r=ie(i[4]),s=Q(),a=j("label"),l=ie(o),f=Q(),u=j("input"),h=Q(),p=j("label"),y=ie(m),_=Q(),w=j("input"),A=Q(),E=j("button"),Z=ie(H),B(t,"class","message svelte-1rtdg09"),Qe(t,"error",i[3]),J(t,ot,42,4,805),u.required=!0,B(u,"type","text"),B(u,"placeholder",c=(I=i[1].ui)==null?void 0:I.strings.email_placeholder),J(u,ot,45,6,934),J(a,ot,43,4,878),w.required=!0,B(w,"type","password"),B(w,"placeholder",k=(D=i[1].ui)==null?void 0:D.strings.password_placeholder),J(w,ot,55,6,1180),J(p,ot,53,4,1121),E.disabled=ee=!i[0]||!i[5]||i[6],J(E,ot,62,4,1355),B(e,"class","svelte-1rtdg09"),J(e,ot,41,2,760)},m:function(I,D){U(I,e,D),S(e,t),S(t,n),S(t,r),S(e,s),S(e,a),S(a,l),S(a,f),S(a,u),Fe(u,i[0]),S(e,h),S(e,p),S(p,y),S(p,_),S(p,w),Fe(w,i[5]),S(e,A),S(e,E),S(E,Z),ue||(me=[Be(u,"input",i[8]),Pn(Mt.call(null,u)),Be(w,"input",i[9]),Be(e,"submit",Dn(i[7]),!1,!0,!1,!1)],ue=!0)},p:function(I,D){var ne,be,Ce,Re,he;D&8&&Ie(n,I[3]),D&16&&Ie(r,I[4]),D&8&&Qe(t,"error",I[3]),D&2&&o!==(o=((ne=I[1].ui)==null?void 0:ne.strings.email)+"")&&Ie(l,o),D&2&&c!==(c=(be=I[1].ui)==null?void 0:be.strings.email_placeholder)&&B(u,"placeholder",c),D&1&&u.value!==I[0]&&Fe(u,I[0]),D&2&&m!==(m=((Ce=I[1].ui)==null?void 0:Ce.strings.password)+"")&&Ie(y,m),D&2&&k!==(k=(Re=I[1].ui)==null?void 0:Re.strings.password_placeholder)&&B(w,"placeholder",k),D&32&&w.value!==I[5]&&Fe(w,I[5]),D&2&&H!==(H=((he=I[1].ui)==null?void 0:he.strings.btn_sign_up)+"")&&Ie(Z,H),D&97&&ee!==(ee=!I[0]||!I[5]||I[6])&&Rn(E,"disabled",ee)},d:function(I){I&&V(e),ue=!1,Tt(me)}};return R("SvelteRegisterBlock",{block:X,id:bi.name,type:"if",source:"(31:0) {#if view == 'login'}",ctx:i}),X}function vi(i){let e,t=i[2]=="login"&&bi(i);const n={c:function(){t&&t.c(),e=Oi()},l:function(s){throw new ut("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(s,a){t&&t.m(s,a),U(s,e,a)},p:function(s,[a]){s[2]=="login"?t?t.p(s,a):(t=bi(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:le,o:le,d:function(s){s&&V(e),t&&t.d(s)}};return R("SvelteRegisterBlock",{block:n,id:vi.name,type:"component",source:"",ctx:i}),n}function Wl(i,e,t){let{$$slots:n={},$$scope:r}=e;gt("SignUp",n,[]);let{firstlyDataAuth:s}=e,{view:a="login"}=e,{email:o=""}=e,l="",f="",u,c=!1;async function h(){t(3,l=""),t(4,f=""),t(6,c=!0);try{await it.signUpPassword(o,u),window.location.href="/"}catch(w){w&&t(3,l=w.message??"")}finally{t(6,c=!1)}}const p=()=>{throw new Error("Not impl yet")};i.$$.on_mount.push(function(){s===void 0&&!("firstlyDataAuth"in e||i.$$.bound[i.$$.props.firstlyDataAuth])&&console.warn("<SignUp> was created without expected prop 'firstlyDataAuth'")});const m=["firstlyDataAuth","view","email"];Object.keys(e).forEach(w=>{!~m.indexOf(w)&&w.slice(0,2)!=="$$"&&w!=="slot"&&console.warn(`<SignUp> was created with unknown prop '${w}'`)});function y(){o=this.value,t(0,o)}function _(){u=this.value,t(5,u)}return i.$$set=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email)},i.$capture_state=()=>({AuthController:it,isError:Ln,autofocus:Mt,firstlyDataAuth:s,view:a,email:o,msgError:l,msgSuccess:f,password:u,loading:c,signIn:h,handlePin:p}),i.$inject_state=w=>{"firstlyDataAuth"in w&&t(1,s=w.firstlyDataAuth),"view"in w&&t(2,a=w.view),"email"in w&&t(0,o=w.email),"msgError"in w&&t(3,l=w.msgError),"msgSuccess"in w&&t(4,f=w.msgSuccess),"password"in w&&t(5,u=w.password),"loading"in w&&t(6,c=w.loading)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),[o,s,a,l,f,u,c,h,y,_]}class ji extends yt{constructor(e){super(e),mt(this,e,Wl,vi,Pt,{firstlyDataAuth:1,view:2,email:0}),R("SvelteRegisterComponent",{component:this,tagName:"SignUp",options:e,id:vi.name})}get firstlyDataAuth(){throw new ut("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyDataAuth(e){throw new ut("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get view(){throw new ut("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set view(e){throw new ut("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get email(){throw new ut("<SignUp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set email(e){throw new ut("<SignUp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}const ye="src/lib/modules/auth/Page.svelte";function Ws(i){var m,y,_,w,k;let e,t,n,r,s,a,o,l=((m=i[2].ui)==null?void 0:m.strings.app_name)&&Gs(i),f=((y=i[2].ui)==null?void 0:y.paths.sign_up)&&Qs(i),u=((_=i[2].ui)==null?void 0:_.paths.sign_in)&&Zs(i),c=((w=i[2].ui)==null?void 0:w.paths.forgot_password)&&ia(i),h=((k=i[2].ui)==null?void 0:k.paths.reset_password)&&oa(i);const p={c:function(){e=j("div"),t=j("div"),l&&l.c(),n=Q(),f&&f.c(),r=Q(),u&&u.c(),s=Q(),c&&c.c(),a=Q(),h&&h.c(),B(t,"class","form svelte-ckniid"),J(t,ye,110,8,3685),B(e,"class","centered-layout svelte-ckniid"),J(e,ye,109,6,3647)},m:function(E,H){U(E,e,H),S(e,t),l&&l.m(t,null),S(t,n),f&&f.m(t,null),S(t,r),u&&u.m(t,null),S(t,s),c&&c.m(t,null),S(t,a),h&&h.m(t,null),o=!0},p:function(E,H){var Z,ee,ue,me,X;(Z=E[2].ui)!=null&&Z.strings.app_name&&l.p(E,H),(ee=E[2].ui)!=null&&ee.paths.sign_up&&f.p(E,H),(ue=E[2].ui)!=null&&ue.paths.sign_in&&u.p(E,H),(me=E[2].ui)!=null&&me.paths.forgot_password&&c.p(E,H),(X=E[2].ui)!=null&&X.paths.reset_password&&h.p(E,H)},i:function(E){o||(M(f),M(u),M(c),M(h),o=!0)},o:function(E){N(f),N(u),N(c),N(h),o=!1},d:function(E){E&&V(e),l&&l.d(),f&&f.d(),u&&u.d(),c&&c.d(),h&&h.d()}};return R("SvelteRegisterBlock",{block:p,id:Ws.name,type:"else",source:"(100:4) {:else}",ctx:i}),p}function Hs(i){var k,A,E,H,Z,ee,ue;let e,t,n,r,s,a,o,l,f,u,c=((k=i[2].ui)==null?void 0:k.strings.app_name)&&ca(i),h=((A=i[2].ui)==null?void 0:A.paths.sign_up)&&da(i),p=((E=i[2].ui)==null?void 0:E.paths.sign_in)&&ma(i),m=((H=i[2].ui)==null?void 0:H.paths.forgot_password)&&ka(i),y=((Z=i[2].ui)==null?void 0:Z.paths.reset_password)&&Sa(i),_=((ue=(ee=i[2].ui)==null?void 0:ee.images)==null?void 0:ue.main)&&Ta(i);const w={c:function(){e=j("div"),t=j("div"),n=j("div"),c&&c.c(),r=Q(),h&&h.c(),s=Q(),p&&p.c(),a=Q(),m&&m.c(),o=Q(),y&&y.c(),l=Q(),f=j("div"),_&&_.c(),B(n,"class","form svelte-ckniid"),J(n,ye,25,10,596),B(t,"class","form-side svelte-ckniid"),J(t,ye,24,8,562),B(f,"class","image-side svelte-ckniid"),J(f,ye,102,8,3433),B(e,"class","split-layout svelte-ckniid"),J(e,ye,23,6,527)},m:function(X,ge){U(X,e,ge),S(e,t),S(t,n),c&&c.m(n,null),S(n,r),h&&h.m(n,null),S(n,s),p&&p.m(n,null),S(n,a),m&&m.m(n,null),S(n,o),y&&y.m(n,null),S(e,l),S(e,f),_&&_.m(f,null),u=!0},p:function(X,ge){var v,T,P,I,D,ne,be;(v=X[2].ui)!=null&&v.strings.app_name&&c.p(X,ge),(T=X[2].ui)!=null&&T.paths.sign_up&&h.p(X,ge),(P=X[2].ui)!=null&&P.paths.sign_in&&p.p(X,ge),(I=X[2].ui)!=null&&I.paths.forgot_password&&m.p(X,ge),(D=X[2].ui)!=null&&D.paths.reset_password&&y.p(X,ge),(be=(ne=X[2].ui)==null?void 0:ne.images)!=null&&be.main&&_.p(X,ge)},i:function(X){u||(M(h),M(p),M(m),M(y),u=!0)},o:function(X){N(h),N(p),N(m),N(y),u=!1},d:function(X){X&&V(e),c&&c.d(),h&&h.d(),p&&p.d(),m&&m.d(),y&&y.d(),_&&_.d()}};return R("SvelteRegisterBlock",{block:w,id:Hs.name,type:"if",source:"(14:4) {#if hasMainImage}",ctx:i}),w}function Gs(i){let e;const t={c:function(){e=j("h1"),e.textContent=`${i[2].ui.strings.app_name}`,B(e,"class","svelte-ckniid"),J(e,ye,112,12,3769)},m:function(r,s){U(r,e,s)},p:le,d:function(r){r&&V(e)}};return R("SvelteRegisterBlock",{block:t,id:Gs.name,type:"if",source:"(103:10) {#if firstlyDataAuth.ui?.strings.app_name}",ctx:i}),t}function Qs(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.sign_up,$$slots:{default:[Xs]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:Qs.name,type:"if",source:"(107:10) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),n}function zs(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[Ks]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:zs.name,type:"if",source:"(112:16) {#if firstlyDataAuth.ui.paths.sign_in}",ctx:i}),n}function Ks(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:Ks.name,type:"slot",source:"(113:18) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function Xs(i){let e,t,n,r,s;function a(u){i[7](u)}let o={firstlyDataAuth:i[2]};i[0]!==void 0&&(o.email=i[0]),e=new ji({props:o,$$inline:!0}),Dt.push(()=>Rt(e,"email",a));let l=i[2].ui.paths.sign_in&&zs(i);const f={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),l&&l.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,119,14,4013)},m:function(c,h){se(e,c,h),U(c,n,h),U(c,r,h),l&&l.m(r,null),s=!0},p:function(c,h){const p={};!t&&h&1&&(t=!0,p.email=c[0],Bt(()=>t=!1)),e.$set(p),c[2].ui.paths.sign_in&&l.p(c,h)},i:function(c){s||(M(e.$$.fragment,c),M(l),s=!0)},o:function(c){N(e.$$.fragment,c),N(l),s=!1},d:function(c){c&&(V(n),V(r)),ae(e,c),l&&l.d()}};return R("SvelteRegisterBlock",{block:f,id:Xs.name,type:"slot",source:"(108:12) <Route path={firstlyDataAuth.ui?.paths.sign_up}>",ctx:i}),f}function Zs(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.sign_in,$$slots:{default:[na]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:Zs.name,type:"if",source:"(121:10) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function Ys(i){let e,t;e=new We({props:{href:i[2].ui.paths.forgot_password,$$slots:{default:[xs]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:Ys.name,type:"if",source:"(126:16) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),n}function xs(i){let e=i[2].ui.strings.forgot_password+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:xs.name,type:"slot",source:"(127:18) <Link href={firstlyDataAuth.ui.paths.forgot_password}>",ctx:i}),n}function ea(i){let e,t,n,r;n=new We({props:{href:i[2].ui.paths.sign_up,$$slots:{default:[ta]},$$scope:{ctx:i}},$$inline:!0});const s={c:function(){e=j("hr"),t=Q(),re(n.$$.fragment),J(e,ye,140,18,4861)},m:function(o,l){U(o,e,l),U(o,t,l),se(n,o,l),r=!0},p:function(o,l){const f={};l&1024&&(f.$$scope={dirty:l,ctx:o}),n.$set(f)},i:function(o){r||(M(n.$$.fragment,o),r=!0)},o:function(o){N(n.$$.fragment,o),r=!1},d:function(o){o&&(V(e),V(t)),ae(n,o)}};return R("SvelteRegisterBlock",{block:s,id:ea.name,type:"if",source:"(131:16) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),s}function ta(i){let e=i[2].ui.strings.btn_sign_up+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:ta.name,type:"slot",source:"(133:18) <Link href={firstlyDataAuth.ui.paths.sign_up}>",ctx:i}),n}function na(i){var h,p;let e,t,n,r,s,a;function o(m){i[8](m)}let l={firstlyDataAuth:i[2]};i[0]!==void 0&&(l.email=i[0]),e=new $i({props:l,$$inline:!0}),Dt.push(()=>Rt(e,"email",o));let f=((h=i[2].ui)==null?void 0:h.paths.forgot_password)&&Ys(i),u=((p=i[2].ui)==null?void 0:p.paths.sign_up)&&ea(i);const c={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),f&&f.c(),s=Q(),u&&u.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,133,14,4511)},m:function(y,_){se(e,y,_),U(y,n,_),U(y,r,_),f&&f.m(r,null),S(r,s),u&&u.m(r,null),a=!0},p:function(y,_){var k,A;const w={};!t&&_&1&&(t=!0,w.email=y[0],Bt(()=>t=!1)),e.$set(w),(k=y[2].ui)!=null&&k.paths.forgot_password&&f.p(y,_),(A=y[2].ui)!=null&&A.paths.sign_up&&u.p(y,_)},i:function(y){a||(M(e.$$.fragment,y),M(f),M(u),a=!0)},o:function(y){N(e.$$.fragment,y),N(f),N(u),a=!1},d:function(y){y&&(V(n),V(r)),ae(e,y),f&&f.d(),u&&u.d()}};return R("SvelteRegisterBlock",{block:c,id:na.name,type:"slot",source:"(122:12) <Route path={firstlyDataAuth.ui?.paths.sign_in}>",ctx:i}),c}function ia(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.forgot_password,$$slots:{default:[aa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:ia.name,type:"if",source:"(141:10) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),n}function ra(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[sa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:ra.name,type:"if",source:"(146:16) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function sa(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:sa.name,type:"slot",source:"(147:18) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function aa(i){var u;let e,t,n,r,s;function a(c){i[9](c)}let o={firstlyDataAuth:i[2]};i[0]!==void 0&&(o.email=i[0]),e=new Li({props:o,$$inline:!0}),Dt.push(()=>Rt(e,"email",a));let l=((u=i[2].ui)==null?void 0:u.paths.sign_in)&&ra(i);const f={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),l&&l.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,153,14,5305)},m:function(h,p){se(e,h,p),U(h,n,p),U(h,r,p),l&&l.m(r,null),s=!0},p:function(h,p){var y;const m={};!t&&p&1&&(t=!0,m.email=h[0],Bt(()=>t=!1)),e.$set(m),(y=h[2].ui)!=null&&y.paths.sign_in&&l.p(h,p)},i:function(h){s||(M(e.$$.fragment,h),M(l),s=!0)},o:function(h){N(e.$$.fragment,h),N(l),s=!1},d:function(h){h&&(V(n),V(r)),ae(e,h),l&&l.d()}};return R("SvelteRegisterBlock",{block:f,id:aa.name,type:"slot",source:"(142:12) <Route path={firstlyDataAuth.ui?.paths.forgot_password}>",ctx:i}),f}function oa(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.reset_password,$$slots:{default:[fa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:oa.name,type:"if",source:"(155:10) {#if firstlyDataAuth.ui?.paths.reset_password}",ctx:i}),n}function la(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[ua]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:la.name,type:"if",source:"(160:16) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function ua(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:ua.name,type:"slot",source:"(161:18) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function fa(i){var o;let e,t,n,r;e=new qi({props:{firstlyDataAuth:i[2]},$$inline:!0});let s=((o=i[2].ui)==null?void 0:o.paths.sign_in)&&la(i);const a={c:function(){re(e.$$.fragment),t=Q(),n=j("div"),s&&s.c(),B(n,"class","form-footer svelte-ckniid"),J(n,ye,167,14,5814)},m:function(f,u){se(e,f,u),U(f,t,u),U(f,n,u),s&&s.m(n,null),r=!0},p:function(f,u){var c;(c=f[2].ui)!=null&&c.paths.sign_in&&s.p(f,u)},i:function(f){r||(M(e.$$.fragment,f),M(s),r=!0)},o:function(f){N(e.$$.fragment,f),N(s),r=!1},d:function(f){f&&(V(t),V(n)),ae(e,f),s&&s.d()}};return R("SvelteRegisterBlock",{block:a,id:fa.name,type:"slot",source:"(156:12) <Route path={firstlyDataAuth.ui?.paths.reset_password}>",ctx:i}),a}function ca(i){let e;const t={c:function(){e=j("h1"),e.textContent=`${i[2].ui.strings.app_name}`,B(e,"class","svelte-ckniid"),J(e,ye,27,14,684)},m:function(r,s){U(r,e,s)},p:le,d:function(r){r&&V(e)}};return R("SvelteRegisterBlock",{block:t,id:ca.name,type:"if",source:"(18:12) {#if firstlyDataAuth.ui?.strings.app_name}",ctx:i}),t}function da(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.sign_up,$$slots:{default:[ya]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:da.name,type:"if",source:"(22:12) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),n}function ha(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[pa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:ha.name,type:"if",source:"(27:18) {#if firstlyDataAuth.ui.paths.sign_in}",ctx:i}),n}function pa(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:pa.name,type:"slot",source:"(28:20) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function ya(i){let e,t,n,r,s;function a(u){i[4](u)}let o={firstlyDataAuth:i[2]};i[0]!==void 0&&(o.email=i[0]),e=new ji({props:o,$$inline:!0}),Dt.push(()=>Rt(e,"email",a));let l=i[2].ui.paths.sign_in&&ha(i);const f={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),l&&l.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,34,16,938)},m:function(c,h){se(e,c,h),U(c,n,h),U(c,r,h),l&&l.m(r,null),s=!0},p:function(c,h){const p={};!t&&h&1&&(t=!0,p.email=c[0],Bt(()=>t=!1)),e.$set(p),c[2].ui.paths.sign_in&&l.p(c,h)},i:function(c){s||(M(e.$$.fragment,c),M(l),s=!0)},o:function(c){N(e.$$.fragment,c),N(l),s=!1},d:function(c){c&&(V(n),V(r)),ae(e,c),l&&l.d()}};return R("SvelteRegisterBlock",{block:f,id:ya.name,type:"slot",source:"(23:14) <Route path={firstlyDataAuth.ui?.paths.sign_up}>",ctx:i}),f}function ma(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.sign_in,$$slots:{default:[va]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:ma.name,type:"if",source:"(36:12) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function ga(i){let e,t;e=new We({props:{href:i[2].ui.paths.forgot_password,$$slots:{default:[wa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:ga.name,type:"if",source:"(41:18) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),n}function wa(i){let e=i[2].ui.strings.forgot_password+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:wa.name,type:"slot",source:"(42:20) <Link href={firstlyDataAuth.ui.paths.forgot_password}>",ctx:i}),n}function _a(i){let e,t,n,r;n=new We({props:{href:i[2].ui.paths.sign_up,$$slots:{default:[ba]},$$scope:{ctx:i}},$$inline:!0});const s={c:function(){e=j("hr"),t=Q(),re(n.$$.fragment),J(e,ye,55,20,1824)},m:function(o,l){U(o,e,l),U(o,t,l),se(n,o,l),r=!0},p:function(o,l){const f={};l&1024&&(f.$$scope={dirty:l,ctx:o}),n.$set(f)},i:function(o){r||(M(n.$$.fragment,o),r=!0)},o:function(o){N(n.$$.fragment,o),r=!1},d:function(o){o&&(V(e),V(t)),ae(n,o)}};return R("SvelteRegisterBlock",{block:s,id:_a.name,type:"if",source:"(46:18) {#if firstlyDataAuth.ui?.paths.sign_up}",ctx:i}),s}function ba(i){let e=i[2].ui.strings.btn_sign_up+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:ba.name,type:"slot",source:"(48:20) <Link href={firstlyDataAuth.ui.paths.sign_up}>",ctx:i}),n}function va(i){var h,p;let e,t,n,r,s,a;function o(m){i[5](m)}let l={firstlyDataAuth:i[2]};i[0]!==void 0&&(l.email=i[0]),e=new $i({props:l,$$inline:!0}),Dt.push(()=>Rt(e,"email",o));let f=((h=i[2].ui)==null?void 0:h.paths.forgot_password)&&ga(i),u=((p=i[2].ui)==null?void 0:p.paths.sign_up)&&_a(i);const c={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),f&&f.c(),s=Q(),u&&u.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,48,16,1460)},m:function(y,_){se(e,y,_),U(y,n,_),U(y,r,_),f&&f.m(r,null),S(r,s),u&&u.m(r,null),a=!0},p:function(y,_){var k,A;const w={};!t&&_&1&&(t=!0,w.email=y[0],Bt(()=>t=!1)),e.$set(w),(k=y[2].ui)!=null&&k.paths.forgot_password&&f.p(y,_),(A=y[2].ui)!=null&&A.paths.sign_up&&u.p(y,_)},i:function(y){a||(M(e.$$.fragment,y),M(f),M(u),a=!0)},o:function(y){N(e.$$.fragment,y),N(f),N(u),a=!1},d:function(y){y&&(V(n),V(r)),ae(e,y),f&&f.d(),u&&u.d()}};return R("SvelteRegisterBlock",{block:c,id:va.name,type:"slot",source:"(37:14) <Route path={firstlyDataAuth.ui?.paths.sign_in}>",ctx:i}),c}function ka(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.forgot_password,$$slots:{default:[Aa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1025&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:ka.name,type:"if",source:"(56:12) {#if firstlyDataAuth.ui?.paths.forgot_password}",ctx:i}),n}function Ia(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[Oa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:Ia.name,type:"if",source:"(61:18) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function Oa(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:Oa.name,type:"slot",source:"(62:20) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function Aa(i){var u;let e,t,n,r,s;function a(c){i[6](c)}let o={firstlyDataAuth:i[2]};i[0]!==void 0&&(o.email=i[0]),e=new Li({props:o,$$inline:!0}),Dt.push(()=>Rt(e,"email",a));let l=((u=i[2].ui)==null?void 0:u.paths.sign_in)&&Ia(i);const f={c:function(){re(e.$$.fragment),n=Q(),r=j("div"),l&&l.c(),B(r,"class","form-footer svelte-ckniid"),J(r,ye,68,16,2290)},m:function(h,p){se(e,h,p),U(h,n,p),U(h,r,p),l&&l.m(r,null),s=!0},p:function(h,p){var y;const m={};!t&&p&1&&(t=!0,m.email=h[0],Bt(()=>t=!1)),e.$set(m),(y=h[2].ui)!=null&&y.paths.sign_in&&l.p(h,p)},i:function(h){s||(M(e.$$.fragment,h),M(l),s=!0)},o:function(h){N(e.$$.fragment,h),N(l),s=!1},d:function(h){h&&(V(n),V(r)),ae(e,h),l&&l.d()}};return R("SvelteRegisterBlock",{block:f,id:Aa.name,type:"slot",source:"(57:14) <Route path={firstlyDataAuth.ui?.paths.forgot_password}>",ctx:i}),f}function Sa(i){var r;let e,t;e=new Ve({props:{path:(r=i[2].ui)==null?void 0:r.paths.reset_password,$$slots:{default:[Fa]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(a,o){se(e,a,o),t=!0},p:function(a,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:a}),e.$set(l)},i:function(a){t||(M(e.$$.fragment,a),t=!0)},o:function(a){N(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return R("SvelteRegisterBlock",{block:n,id:Sa.name,type:"if",source:"(70:12) {#if firstlyDataAuth.ui?.paths.reset_password}",ctx:i}),n}function Ca(i){let e,t;e=new We({props:{href:i[2].ui.paths.sign_in,$$slots:{default:[Ea]},$$scope:{ctx:i}},$$inline:!0});const n={c:function(){re(e.$$.fragment)},m:function(s,a){se(e,s,a),t=!0},p:function(s,a){const o={};a&1024&&(o.$$scope={dirty:a,ctx:s}),e.$set(o)},i:function(s){t||(M(e.$$.fragment,s),t=!0)},o:function(s){N(e.$$.fragment,s),t=!1},d:function(s){ae(e,s)}};return R("SvelteRegisterBlock",{block:n,id:Ca.name,type:"if",source:"(75:18) {#if firstlyDataAuth.ui?.paths.sign_in}",ctx:i}),n}function Ea(i){let e=i[2].ui.strings.back_to_sign_in+"",t;const n={c:function(){t=ie(e)},m:function(s,a){U(s,t,a)},p:le,d:function(s){s&&V(t)}};return R("SvelteRegisterBlock",{block:n,id:Ea.name,type:"slot",source:"(76:20) <Link href={firstlyDataAuth.ui.paths.sign_in}>",ctx:i}),n}function Fa(i){var o;let e,t,n,r;e=new qi({props:{firstlyDataAuth:i[2]},$$inline:!0});let s=((o=i[2].ui)==null?void 0:o.paths.sign_in)&&Ca(i);const a={c:function(){re(e.$$.fragment),t=Q(),n=j("div"),s&&s.c(),B(n,"class","form-footer svelte-ckniid"),J(n,ye,82,16,2823)},m:function(f,u){se(e,f,u),U(f,t,u),U(f,n,u),s&&s.m(n,null),r=!0},p:function(f,u){var c;(c=f[2].ui)!=null&&c.paths.sign_in&&s.p(f,u)},i:function(f){r||(M(e.$$.fragment,f),M(s),r=!0)},o:function(f){N(e.$$.fragment,f),N(s),r=!1},d:function(f){f&&(V(t),V(n)),ae(e,f),s&&s.d()}};return R("SvelteRegisterBlock",{block:a,id:Fa.name,type:"slot",source:"(71:14) <Route path={firstlyDataAuth.ui?.paths.reset_password}>",ctx:i}),a}function Ta(i){let e,t;const n={c:function(){e=j("img"),eo(e.src,t=i[2].ui.images.main)||B(e,"src",t),B(e,"alt","Authentication"),B(e,"class","svelte-ckniid"),J(e,ye,104,12,3519)},m:function(s,a){U(s,e,a)},p:le,d:function(s){s&&V(e)}};return R("SvelteRegisterBlock",{block:n,id:Ta.name,type:"if",source:"(95:10) {#if firstlyDataAuth.ui?.images?.main}",ctx:i}),n}function Pa(i){let e,t,n,r,s;const a={c:function(){e=j("div"),t=j("small"),t.textContent="- 404 -",n=Q(),r=j("div"),s=j("small"),s.textContent="Nothing to see here",J(t,ye,190,8,6452),B(e,"class","fallback svelte-ckniid"),J(e,ye,189,6,6421),J(s,ye,193,8,6525),B(r,"class","fallback svelte-ckniid"),J(r,ye,192,6,6494)},m:function(l,f){U(l,e,f),S(e,t),U(l,n,f),U(l,r,f),S(r,s)},p:le,d:function(l){l&&(V(e),V(n),V(r))}};return R("SvelteRegisterBlock",{block:a,id:Pa.name,type:"slot",source:"(180:4) <Route fallback>",ctx:i}),a}function Da(i){let e,t,n,r,s;const a=[Hs,Ws],o=[];function l(u,c){return u[1]?0:1}e=l(i),t=o[e]=a[e](i),r=new Ve({props:{fallback:!0,$$slots:{default:[Pa]},$$scope:{ctx:i}},$$inline:!0});const f={c:function(){t.c(),n=Q(),re(r.$$.fragment)},m:function(c,h){o[e].m(c,h),U(c,n,h),se(r,c,h),s=!0},p:function(c,h){let p=e;e=l(c),e===p?o[e].p(c,h):(Sr(),N(o[p],1,1,()=>{o[p]=null}),Cr(),t=o[e],t?t.p(c,h):(t=o[e]=a[e](c),t.c()),M(t,1),t.m(n.parentNode,n));const m={};h&1024&&(m.$$scope={dirty:h,ctx:c}),r.$set(m)},i:function(c){s||(M(t),M(r.$$.fragment,c),s=!0)},o:function(c){N(t),N(r.$$.fragment,c),s=!1},d:function(c){c&&V(n),o[e].d(c),ae(r,c)}};return R("SvelteRegisterBlock",{block:f,id:Da.name,type:"slot",source:"(13:2) <Route>",ctx:i}),f}function ki(i){let e,t,n;t=new Ve({props:{$$slots:{default:[Da]},$$scope:{ctx:i}},$$inline:!0});const r={c:function(){e=j("div"),re(t.$$.fragment),B(e,"class","wrapper svelte-ckniid"),Qe(e,"with-image",i[1]),J(e,ye,20,0,434)},l:function(a){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(a,o){U(a,e,o),se(t,e,null),n=!0},p:function(a,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:a}),t.$set(l),(!n||o&2)&&Qe(e,"with-image",a[1])},i:function(a){n||(M(t.$$.fragment,a),n=!0)},o:function(a){N(t.$$.fragment,a),n=!1},d:function(a){a&&V(e),ae(t)}};return R("SvelteRegisterBlock",{block:r,id:ki.name,type:"component",source:"",ctx:i}),r}function Hl(i,e,t){var _,w;let n,{$$slots:r={},$$scope:s}=e;gt("Page",r,[]);let{firstlyData:a}=e,o=a.props,l="";i.$$.on_mount.push(function(){a===void 0&&!("firstlyData"in e||i.$$.bound[i.$$.props.firstlyData])&&console.warn("<Page> was created without expected prop 'firstlyData'")});const f=["firstlyData"];Object.keys(e).forEach(k=>{!~f.indexOf(k)&&k.slice(0,2)!=="$$"&&k!=="slot"&&console.warn(`<Page> was created with unknown prop '${k}'`)});function u(k){l=k,t(0,l)}function c(k){l=k,t(0,l)}function h(k){l=k,t(0,l)}function p(k){l=k,t(0,l)}function m(k){l=k,t(0,l)}function y(k){l=k,t(0,l)}return i.$$set=k=>{"firstlyData"in k&&t(3,a=k.firstlyData)},i.$capture_state=()=>({Link:We,Route:Ve,ForgotPassword:Li,ResetPassword:qi,SignIn:$i,SignUp:ji,firstlyData:a,firstlyDataAuth:o,email:l,hasMainImage:n}),i.$inject_state=k=>{"firstlyData"in k&&t(3,a=k.firstlyData),"firstlyDataAuth"in k&&t(2,o=k.firstlyDataAuth),"email"in k&&t(0,l=k.email),"hasMainImage"in k&&t(1,n=k.hasMainImage)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),t(1,n=!!((w=(_=o.ui)==null?void 0:_.images)!=null&&w.main)),[l,n,o,a,u,c,h,p,m,y]}class Zl extends yt{constructor(e){super(e),mt(this,e,Hl,ki,Pt,{firstlyData:3}),R("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:ki.name})}get firstlyData(){throw new Error("<Page>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set firstlyData(e){throw new Error("<Page>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}export{Zl as default};
